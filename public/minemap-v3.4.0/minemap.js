/**
 * minemap-3d-engine
 * version: v3.4.0-beta.4
 * submission time: 2022-11-01 13:43:35 +0800
 * build time: 2022-11-01 13:49:03
 * branch: master
 * SHA: 34794ad4ee314f12a3ad099e5708ca77504711d3
 */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.minemap = factory());
})(this, (function () { 'use strict';

/* eslint-disable */

var shared, worker, minemap;
// define gets called three times: one for each chunk. we rely on the order
// they're imported to know which is which
function define(_, chunk) {
	if (!shared) {
		shared = chunk;
	} else if (!worker) {
		worker = chunk;
	} else {
		var workerBundleString =
			"self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; (" +
			shared +
			")(sharedChunk); (" +
			worker +
			")(sharedChunk); self.onerror = null;";

		var sharedChunk = {};
		shared(sharedChunk);
		minemap = chunk(sharedChunk);
		if (typeof window !== "undefined" && window && window.URL && window.URL.createObjectURL) {
			minemap.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: "text/javascript" }));
		}
	}
}


define(["exports"],(function(t){"use strict";function e(t){var e={exports:{}};return t(e,e.exports),e.exports}var A="undefined"!=typeof self?self:{};A.performance&&A.performance.now?A.performance.now.bind(A.performance):Date.now.bind(Date);const r=A.requestAnimationFrame||A.mozRequestAnimationFrame||A.webkitRequestAnimationFrame||A.msRequestAnimationFrame,i=A.cancelAnimationFrame||A.mozCancelAnimationFrame||A.webkitCancelAnimationFrame||A.msCancelAnimationFrame;let n;const s={now:()=>void 0!==n?n:A.performance.now(),setNow(t){n=t;},restoreNow(){n=void 0;},frame(t){const e=r(t);return {cancel:()=>i(e)}},getImageData(t){const e=A.document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},resolveURL(t){const e=A.document.createElement("a");return e.href=t,e.href},hardwareConcurrency:A.navigator.hardwareConcurrency||4,get devicePixelRatio(){return A.devicePixelRatio},supportsWebp:!1};if(A.document){const t=A.document.createElement("img");t.onload=function(){s.supportsWebp=!0;},t.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";}var a=o;function o(t,e,A,r){this.cx=3*t,this.bx=3*(A-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=A,this.p2y=r;}o.prototype.sampleCurveX=function(t){return ((this.ax*t+this.bx)*t+this.cx)*t},o.prototype.sampleCurveY=function(t){return ((this.ay*t+this.by)*t+this.cy)*t},o.prototype.sampleCurveDerivativeX=function(t){return (3*this.ax*t+2*this.bx)*t+this.cx},o.prototype.solveCurveX=function(t,e){var A,r,i,n,s;for(void 0===e&&(e=1e-6),i=t,s=0;s<8;s++){if(n=this.sampleCurveX(i)-t,Math.abs(n)<e)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=n/a;}if((i=t)<(A=0))return A;if(i>(r=1))return r;for(;A<r;){if(n=this.sampleCurveX(i),Math.abs(n-t)<e)return i;t>n?A=i:r=i,i=.5*(r-A)+A;}return i},o.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};class h{constructor(t,e,A){this.column=t,this.row=e,this.zoom=A;}clone(){return new h(this.column,this.row,this.zoom)}zoomTo(t){return this.clone()._zoomTo(t)}sub(t){return this.clone()._sub(t)}_zoomTo(t){const e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this}_sub(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this}}var l=c;function c(t,e,A){this.x=t,this.y=e,this.z=A||0;}c.prototype={clone:function(){return new c(this.x,this.y,this.z)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,A=t.y-this.y;return e*e+A*A},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),A=Math.sin(t),r=A*this.x+e*this.y;return this.x=e*this.x-A*this.y,this.y=r,this},_rotateAround:function(t,e){var A=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+A*(this.y-e.y);return this.x=e.x+A*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(t){return t instanceof c?t:Array.isArray(t)?new c(t[0],t[1],t[2]):t};const u=Math.pow(2,53)-1;function p(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,A=e*t;return 4*(t<.5?A:3*(t-e)+A-.75)}function d(t,e,A,r){const i=new a(t,e,A,r);return function(t){return i.solve(t)}}const f=d(.25,.1,.25,1),y=d(0,.7,1,.3),g=d(0,0,1,1),m=d(.42,0,1,1),B=d(0,0,.58,1),w=d(.42,0,.58,1);function x(t,e,A){return Math.min(A,Math.max(e,t))}function C(t,e,A){const r=A-e,i=((t-e)%r+r)%r+e;return i===e?A:i}function E(t,e,A){if(!t.length)return A(null,[]);let r=t.length;const i=new Array(t.length);let n=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(n=t),i[s]=e,0==--r&&A(n,i);}));}));}function _(t,...e){for(const A of e)for(const e in A)t[e]=A[e];return t}let v=1;function b(){return v++}function U(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e));}));}function F(t,e){return -1!==t.indexOf(e,t.length-e.length)}function M(t,e,A){const r={};for(const i in t)r[i]=e.call(A||this,t[i],i,t);return r}function Q(t,e,A){const r={};for(const i in t)e.call(A||this,t[i],i,t)&&(r[i]=t[i]);return r}function I(t){return Array.isArray(t)?t.map(I):"object"==typeof t&&t?M(t,I):t}const S={};function T(t){S[t]||("undefined"!=typeof console&&console.warn(t),S[t]=!0);}function R(t,e,A){return (A.y-t.y)*(e.x-t.x)>(e.y-t.y)*(A.x-t.x)}function L(t){let e=0;for(let A,r,i=0,n=t.length,s=n-1;i<n;s=i++)A=t[i],r=t[s],e+=(r.x-A.x)*(A.y+r.y);return e}function P(){return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}const H={create:function(t,e,r){const i=A.document.createElement(t);return void 0!==e&&(i.className=e),r&&r.appendChild(i),i},createNS:function(t,e){return A.document.createElementNS(t,e)}},O=A.document&&A.document.documentElement.style,D=O&&void 0!==O.userSelect?"userSelect":"WebkitUserSelect";let N;H.disableDrag=function(){O&&D&&(N=O[D],O[D]="none");},H.enableDrag=function(){O&&D&&(O[D]=N);},H.setTransform=function(t,e){t.style.transform=e;};const k=function(t){if(!O)return null;for(let e=0;e<t.length;e++)if(t[e]in O)return t[e];return t[0]}(["transformOrigin","WebkitTransformOrigin"]);H.setTransformOrigin=function(t,e){t.style[k]=e;},H.getAllStyle=function(t){return A.getComputedStyle(t)};let V=!1;try{const t=Object.defineProperty({},"passive",{get(){V=!0;}});A.addEventListener("test",t,t),A.removeEventListener("test",t,t);}catch(t){V=!1;}H.addEventListener=function(t,e,A,r={}){t.addEventListener(e,A,"passive"in r&&V?r:r.capture);},H.removeEventListener=function(t,e,A,r={}){t.removeEventListener(e,A,"passive"in r&&V?r:r.capture);};const G=function(t){t.preventDefault(),t.stopPropagation(),A.removeEventListener("click",G,!0);};function K(t,e,A){const r=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new l((A.clientX-e.left)*r,(A.clientY-e.top)*r)}H.suppressClick=function(){A.addEventListener("click",G,!0),A.setTimeout((()=>{A.removeEventListener("click",G,!0);}),0);},H.mousePos=function(t,e){const A=t.getBoundingClientRect();return K(t,A,e=e.touches?e.touches[0]:e)},H.touchPos=function(t,e){const A=t.getBoundingClientRect(),r=[];for(let i=0;i<e.length;i++)r.push(K(t,A,e[i]));return r},H.mouseButton=function(t){return void 0!==A.InstallTrigger&&2===t.button&&t.ctrlKey&&A.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},H.remove=function(t){t.parentNode&&t.parentNode.removeChild(t);};const z={supported:!1,testSupport:function(t){!j&&q&&(Y?W(t):X=t);}};let X,q,j=!1,Y=!1;function W(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,q),t.isContextLost())return;z.supported=!0;}catch(t){}t.deleteTexture(e),j=!0;}A.document&&(q=A.document.createElement("img"),q.onload=function(){X&&W(X),X=null,Y=!0;},q.onerror=function(){j=!0,X=null;},q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Z=6378137,J=3.141592653589793,$={DEFAULT_SPHERE_TRIANGLES:[],SCROLL_ZOOM_SPHERE_CONTROL:4,TILE_GRIDSAMPLES_SPLIT:{SMALL:4,MIDDLE:6,LARGE:9,LARGE_S:20,SMALL_Z_SAMPLES:16,MIDDLE_Z_SAMPLES:8,LARGE_Z_SAMPLES:2,LARGE_S_Z_SAMPLES:1,THE_MIN_SAMPLES:1},TRANSFORM:{PROJECTION_CHANGE_SMALL_ZOOM:5,PROJECTION_CHANGE_MIDDLE_ZOOM:10,PROJECTION_CHANGE_LARGE_ZOOM:15,MAX_LAT:85.051129,MIN_LAT:-85.051129,SPHERE_MAX_PITCH:85,PLAIN_MAX_PITCH:60,SPHERE_DRAG_PAN_MAX_PITCH:45,DEG_TO_RAD:J/180,RAD_TO_DEG:180/J,R:Z,R1:6356752.314245179,REAL_R:6378137,R_SCALE:1,R_ZOOM:1,CIR:2*J*Z,COVERING_TILE_ZOOM:6,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,UNIT_Z:[0,0,1],UNIT_Z_REVERSE:[0,0,-1],VIEW_MAX_BOUNDING:{west:-180,south:-85.05113,east:180,north:85.05113},TWO_PI:2*J,PI_OVER_TWO:J/2,FP_ZOOM:17,TERRAIN_FIND_ZOOM_MIN:5,TERRAIN_SIMPLIFY_ZOOM_MAX:15,ERR_TERRAIN_ALT:-Z,OFFSCREEN_WIDTH:2048,OFFSCREEN_HEIGHT:2048,SHADOW_VIEWPORT_SIZE:[8192,8192],RAY_PICK_MIN_ZOOM:4,BOUND_KEYS:["topLeft","topMidL","topMiddle","topMidR","topRight","bottomRight","bottomMiddle","bottomLeft"]},CesiumMath:{EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296,PI:Math.PI,ONE_OVER_PI:1/Math.PI,PI_OVER_TWO:Math.PI/2,PI_OVER_THREE:Math.PI/3,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,THREE_PI_OVER_TWO:3*Math.PI/2,TWO_PI:2*Math.PI,ONE_OVER_TWO_PI:1/(2*Math.PI),RADIANS_PER_DEGREE:Math.PI/180,DEGREES_PER_RADIAN:180/Math.PI,RADIANS_PER_ARCSECOND:Math.PI/180/3600},TEXTUREWRAP:{REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648},TEXTUREMAGNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729},TEXTUREMINNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},SOURCE:{MAX_BOUNDS:[[-180,90],[180,90],[180,-90],[-180,-90]],ERROR_IMG_INDEX:-999,CLOCK_SKEW_RETRY_TIMEOUT:3e4,TRANSPARENT_PNG_URL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",MAX_PARALLEL_IMAGE_REQUESTS:16,GLOBAL_SOURCE_ID:"sphere-image-globe",SKYBOX_SOURCE_ID:"sphere-image-skybox",PANORAMA_SOURCE_ID:"panorama-special-source",ATMOSPHERE_SOURCE_ID:"sphere-atmosphere",COSMOS_SOURCE_ID:"sphere-cosmos",MAX_GLTF_TILE_COUNT:300,MAX_GLTF_TILE_TO_FIND_PARENT:64,MAX_IMAGE_CONCURRENCY:32,TEXTURE_CUBE_KEYS:["px","nx","py","ny","pz","nz"],ION_ACCESS_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMGY4ODczYy1mNTk4LTRiMDUtYmIxYy0xZWYwOWZmMGY4NjQiLCJpZCI6NDQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJhc3NldHMiOlsxLDIsMyw0LDYxOTMsNjI3Myw3MTYyLDczNTMsNzE0Ml0sImlhdCI6MTU0MTYxODM0NX0.lWnGs9ySXO4QK3HagcMsDpZ8L01DpmUDQm38-2QAQuE"},HIGHLIGHT_TYPE:{PRIMITIVE:"PRIMITIVE",NODE:"NODE",SCENE:"SCENE"},MODEL_TYPE:{OSGB:"osgb",E3DCM:"e3dcm",TDMODEL:"3dmodel"},LAYER:{PANORAMA_LAYER_ID:"panorama-special-layer",RADIATION_REGIONS:5},TILE:{EXTENT:8192,DEPTH_MAX_RANGE:1,OFFSCREEN_SIZE:1024},FPMODE:{MAP:"MAP",DRAG_ROTATE:"DRAG_ROTATE",NULL:"NULL"},FRAMEBUFFER:{DEPTH_IMAGE_SCALE:1},EFFECTS:{FOG_START_DISTANCE:4e3,FOG_CALC_LENGTH:2e4,SHADOW_OFFSET:25e-8},CAMERA:{SUNLIGHT_CAMERA_ID:"SUNLIGHT_CAMERA_ID",SKYBOX_CAMERA_ID:"SKYBOX_CAMERA_ID",ATMOSPHERE_BLEND_CAMERA_ID:"ATMOSPHERE_BLEND_CAMERA_ID",DRAW_MODE:{NORMAL:"NORMAL",OFFSCREEN:"OFFSCREEN",OFFSCREEN_VIEWSHED:"OFFSCREEN_VIEWSHED",ONSCREEN_SHADOW:"SHADOW",ONSCREEN_VIEWSHED:"VIEWSHED",ONSCREEN_ALL:"ONSCREEN_ALL"},SUNLIGHT_FIXED_MODE:{FIXED:"FIXED",DYNAMIC:"DYNAMIC"}},GL_CONST:{SHADOW_TEXTURE_UNIT1:{VALUE:33984,INDEX:0},SHADOW_TEXTURE_UNIT2:{VALUE:33985,INDEX:1},SHADOW_BASE_TEXTURE_UNIT:{VALUE:33986,INDEX:2},FXAA_TEXTURE_UNIT1:{VALUE:33987,INDEX:3},BLUR_TEXTURE_UNIT1:{VALUE:33988,INDEX:4},BLUR_TEXTURE_UNIT2:{VALUE:33989,INDEX:5},MODEL_TEXTURE_UNIT1:{VALUE:33990,INDEX:6},MODEL_TEXTURE_UNIT2:{VALUE:33991,INDEX:7},MODEL_TEXTURE_UNIT3:{VALUE:33992,INDEX:8},MODEL_TEXTURE_UNIT4:{VALUE:33993,INDEX:9},MODEL_TEXTURE_UNIT5:{VALUE:33994,INDEX:10},VIDEO_TEXTURE_UNIT1:{VALUE:33995,INDEX:11},PATTERN_TEXTURE_UNIT1:{VALUE:33996,INDEX:12},BRDF_TEXTURE_UNIT:{VALUE:33997,INDEX:13},TEXTURE14:{VALUE:33998,INDEX:14},TEXTURE15:{VALUE:33999,INDEX:15},TEXTURE16:{VALUE:34e3,INDEX:16},TEXTURE17:{VALUE:34001,INDEX:17},TEXTURE18:{VALUE:34002,INDEX:18}},PERFORMANCE:{MODE:{FLIGHT:"FLIGHT",MANUAL:"MANUAL"},SMOOTH_CONSTS:{FRAME_RATE:30,FRAME_DURATION:33.33}},COMPRESSED_TEXTURE_TYPE:{COMPRESSED_RGB_S3TC:{COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},COMPRESSED_RGB_PVRTC:{COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843},COMPRESSED_RGB_ETC1_WEBGL:36196},COLORTYPEANDLENGTH:{ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FRAGMENT_SHADER:35632},PixelDatatype:{UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635}};function tt(t,e,A){let r="",i=e;for(;i<A;){const e=t[i];let n,s,a,o=null,h=e>239?4:e>223?3:e>191?2:1;if(i+h>A)break;1===h?e<128&&(o=e):2===h?(n=t[i+1],128==(192&n)&&(o=(31&e)<<6|63&n,o<=127&&(o=null))):3===h?(n=t[i+1],s=t[i+2],128==(192&n)&&128==(192&s)&&(o=(15&e)<<12|(63&n)<<6|63&s,(o<=2047||o>=55296&&o<=57343)&&(o=null))):4===h&&(n=t[i+1],s=t[i+2],a=t[i+3],128==(192&n)&&128==(192&s)&&128==(192&a)&&(o=(15&e)<<18|(63&n)<<12|(63&s)<<6|63&a,(o<=65535||o>=1114112)&&(o=null))),null===o?(o=65533,h=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),r+=String.fromCharCode(o),i+=h;}return r}function et(t,e){if(e&&-1!==e.indexOf("?")){const A=e.split("?")[1],r=new RegExp(`(^|&)${t}=([^&]*)(&|$)`),i=A.match(r);if(null!=i)return unescape(i[2])}return null}function At(t){const e=t.responseURL||t.__responseURL,A=t.response,r=A?A.byteLength:0,i=et("token",e)||"",n=et("appKey",e)||"",s=et("key",e)||"";return r>8?rt(A,r,s.length>0?s:n.length>0?n:i):A}function rt(t,e,A){const r=new Uint8Array(t),i=tt(r,e-8,e),n=tt(r,0,9);if(i&&"minedata"===i.toLowerCase())return A&&function(t,e){const A=t.length-8;if(A<=e)for(let e=0;e<A/2;e++){const r=t[e];t[e]=t[A-e-1],t[A-e-1]=r;}else {const r=parseInt(A/e),i=parseInt(e/2);for(let A=0;A<r;A++){const r=A*e,n=(A+1)*e-1;for(let e=r,A=0;e<r+i;e++,A++){const r=n-A,i=t[e];t[e]=t[r],t[r]=i;}}}}(r,function(t){let e=0;const A=t.length;for(let r=0;r<A;r++)e+=t.charCodeAt(r);return parseInt(e/A)}(A)),r.slice(0,e-8);if(n&&"mineearth"===n.toLowerCase()){const t=r[9],e=r[10];return function(t,e,A){const r=Math.floor((t.length-e*A)/e),i=Array.from(t);let n=0,s=r;const a=[];for(let t=0;t<e;t++){const t=i.slice(n,s);a.push(t),n=s+A,s=n+r;}if(i.length>n){const t=i.slice(n,i.length);a.push(t);}return new Uint8Array(a.flat())}(r.slice(11,r.length),t,e)}return t}function it(t){const e=rt(t,t?t.byteLength:0);return e.buffer?e.buffer:e}const nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",PanoramaImage:"PanoramaImage",PanoramaJson:"PanoramaJson"};"function"==typeof Object.freeze&&Object.freeze(nt);class st extends Error{constructor(t,e,A){401===e&&A.includes("minemap")&&(t+=": you may have provided an invalid MineMap key."),super(t),this.status=e,this.url=A;}toString(){return `${this.name}: ${this.message} (${this.status}): ${this.url}`}}const at=P()?()=>self.worker&&self.worker.referrer:()=>("blob:"===A.location.protocol?A.parent:A).location.href,ot=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(at())&&!/^\w+:/.test(r))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(t,e){const r=new A.AbortController,i=new A.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:at(),signal:r.signal});let n=!1,s=!1;"json"===t.type&&i.headers.set("Accept","application/json");return s||A.fetch(i).then((A=>A.ok?((A,r,i)=>{("arrayBuffer"===t.type?A.arrayBuffer():"json"===t.type?A.json():A.text()).then((r=>{if(s)return;n=!0;let i=r;const a=A.url.includes("png")||A.url.includes("jpg");"arrayBuffer"!==t.type||a||(i=At({responseURL:A.url,response:r})),e(null,i,A.headers.get("Cache-Control"),A.headers.get("Expires"));})).catch((t=>{s||e(new Error(t.message));}));})(A):e(new st(A.statusText,A.status,t.url)))).catch((t=>{20!==t.code&&e(new Error(t.message));})),{cancel:()=>{s=!0,n||r.abort();}}}(t,e);if(P()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){const r=new A.XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);return "json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{e(new Error(r.statusText));},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let A=r.response;if("json"===t.type)try{A=JSON.parse(r.response);}catch(t){return e(t)}let i=A;const n=t.url.includes("png")||t.url.includes("jpg");"arrayBuffer"!==t.type||n||(i=At(r)),e(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"));}else e(new st(r.statusText,r.status,t.url));},r.send(t.body),{cancel:()=>r.abort()}}(t,e)},ht=function(t,e){return ot(_(t,{type:"arrayBuffer"}),e)};function lt(t){const e=A.document.createElement("a");return e.href=t,e.protocol===A.document.location.protocol&&e.host===A.document.location.host}let ct,ut;ct=[],ut=0;const pt=function(t,e){if(z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ut>=$.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS){const A={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0;}};return ct.push(A),A}ut++;let r=!1;const i=()=>{if(!r)for(r=!0,ut--;ct.length&&ut<$.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS;){const t=ct.shift(),{requestParameters:e,callback:A,cancelled:r}=t;r||(t.cancel=pt(e,A).cancel);}},n=ht(t,((r,n,s,a)=>{if(i(),r)e(r);else if(n){const r=!!t.isImageBitmap||t.isImageBitmap;A.createImageBitmap&&!r?function(t,e,r){const i=new A.Blob([new Uint8Array(t)],{type:"image/png"});A.createImageBitmap(i,e).then((t=>{r(null,t);})).catch((t=>{r(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`));}));}(n,t.imageBitmapOptions,((t,A)=>e(t,A,s,a))):function(t,e){const r=new A.Image,i=A.URL;r.onload=()=>{e(null,r),i.revokeObjectURL(r.src),r.onload=null;},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new A.Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?i.createObjectURL(n):$.SOURCE.TRANSPARENT_PNG_URL;}(n,((t,A)=>e(t,A,s,a)));}}));return {cancel:()=>{n.cancel(),i();}}};function dt(t,e,A){A[t]&&-1!==A[t].indexOf(e)||(A[t]=A[t]||[],A[t].push(e));}function ft(t,e,A){if(A&&A[t]){const r=A[t].indexOf(e);-1!==r&&A[t].splice(r,1);}}class yt{constructor(t,e={}){_(this,e),this.type=t;}}class gt extends yt{constructor(t,e={}){super("error",_({error:t},e));}}class mt{on(t,e){return this._listeners=this._listeners||{},dt(t,e,this._listeners),this}off(t,e){return ft(t,e,this._listeners),ft(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},dt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new yt(t,e||{}));const A=t.type;if(this.listens(A)){t.target=this;const e=this._listeners&&this._listeners[A]?this._listeners[A].slice():[];for(const A of e)A.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[A]?this._oneTimeListeners[A].slice():[];for(const e of r)ft(A,e,this._oneTimeListeners),e&&e.call(this,t);const i=this._eventedParent;i&&(_(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t));}else t instanceof gt&&console.error(t.error);return this}listens(t){return !!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Bt={$version:8,$root:{version:{required:!0,type:"enum",values:[8],"doc-en":"Style specification version number. Must be 8."},name:{type:"string","doc-en":"A human-readable name for the style."},metadata:{type:"*","doc-en":"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},center:{type:"array",value:"number","doc-en":"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction)."},zoom:{type:"number","doc-en":"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction)."},bearing:{type:"number",default:0,period:360,units:"degrees","doc-en":'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).'},pitch:{type:"number",default:0,units:"degrees","doc-en":"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction)."},light:{type:"light","doc-en":"The global light source."},sources:{required:!0,type:"sources","doc-en":"Data source specifications."},sprite:{type:"string","doc-en":"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},IBL:{type:"string","doc-en":"The base request path of the picture used to request the PBR effect"},glyphs:{type:"string","doc-en":"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},transition:{type:"transition","doc-en":"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property."},layers:{required:!0,type:"array",value:"layer","doc-en":"Layers will be drawn in the order of this array."}},sources:{"*":{type:"source","doc-en":"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_geojson","source_video","source_videoProjection","source_image","source_sphere_image","source_3d_model","source_3d_tiles","source_panorama"],source_vector:{type:{required:!0,type:"enum",values:{vector:{"doc-en":"A vector tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},"*":{type:"*","doc-en":"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{"doc-en":"A raster tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs, as in the TileJSON spec."},terrainTiles:{type:"array",value:"string"},renderWithTerrain:{type:"boolean"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels","doc-en":"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*","doc-en":"Other keys to configure the data source.",expose:!1}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{"doc-en":"A GeoJSON data source."}},"doc-en":"The data type of the GeoJSON source."},data:{type:"*","doc-en":"A URL to a GeoJSON file, or inline GeoJSON."},minzoom:{type:"number",default:1,"doc-en":"Creates the minimum zoom level for the vector tile (a lower scale level represents a smaller scale level)."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,"doc-en":"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},tolerance:{type:"number",default:.375,"doc-en":"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,"doc-en":"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.minemap.com/minemap-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,"doc-en":"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number","doc-en":"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1,"doc-en":"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."}},source_sphere_image:{type:{required:!0,type:"enum",values:{"sphere-image":{}}},url:{required:!0,type:"string"},renderInner:{required:!0,type:"boolean"},radius:{required:!0,type:"number"},extractRadius:{required:!1,type:"number"},gridSamples:{required:!1,type:"number"},debug:{type:"boolean"},renderAtmosphere:{type:"boolean"},dayTextureUrl:{type:"string"},nightTextureUrl:{type:"string"}},source_3d_model:{type:{required:!0,type:"enum",values:{"3d-model":{}}},data:{type:"*"},maxzoom:{type:"number",default:22},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},scale:{required:!0,type:"array",value:{type:"number"}},pickable:{type:"boolean"},filter:{type:"array",value:"*"},aabbFilter:{type:"array",value:"*"},rotation:{required:!0,type:"array",value:{type:"number"}},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},translation:{required:!0,type:"array",value:{type:"number"}},modelFolder:{required:!0,type:"string"},debug:{type:"boolean"},configuration:{type:"object"},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!0}},source_video:{type:{required:!0,type:"enum",values:{video:{"doc-en":"A video data source."}},"doc-en":"The data type of the video source."},urls:{required:!0,type:"array",value:"string","doc-en":"URLs to video content in order of preferred format."},coordinates:{required:!0,"doc-en":"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number","doc-en":"A single longitude, latitude pair."}},grid:{type:"number",default:1}},source_videoProjection:{type:{required:!0,type:"enum",values:{"video-project":{"doc-en":"A video projection data source."}},"doc-en":"The data type of the video projection source."},videoMatchOptions:{required:!0,"doc-en":"video projection data set.",type:"array",value:{type:"array",value:"Object","doc-en":"A Single video projection parameter combination."}}},source_image:{type:{required:!0,type:"enum",values:{image:{"doc-en":"An image data source."}},"doc-en":"The data type of the image source."},url:{required:!0,type:"string","doc-en":"URL that points to an image."},coordinates:{required:!0,"doc-en":"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number","doc-en":"单个经度，纬度组。."}},grid:{type:"number",default:1},wms:{required:!1,type:"boolean","doc-en":"Whether use WMS service."}},source_panorama:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"}},source_3d_tiles:{type:{required:!0,type:"enum",values:{"3d-tiles":{}}},url:{type:"string",value:{type:"any"}},urls:{type:"array",value:{type:"object"}},maxzoom:{type:"number",default:22},minzoom:{type:"number",default:14},maximumMemoryUsage:{type:"number"},maximumScreenSpaceError:{type:"number"},throttleRequests:{type:"boolean"},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},collectResourceTiming:{required:!0,type:"boolean"},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},pickable:{type:"boolean"},debug:{type:"boolean"},forceLocation:{type:"array",value:{type:"number"}},translation:{type:"array",value:{type:"number"}},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!1}},layer:{id:{type:"string","doc-en":"Unique layer name.",required:!0},type:{type:"enum",values:{raster:{},fill:{},line:{},airline:{},symbol:{},circle:{},heatmap:{},extrusion:{},histogram:{},dynamicLine:{},tracking:{},sprite:{},"3d-model":{},"3d-tiles":{},panorama:{},symtracking:{},background:{"doc-en":"The background color or pattern of the map."}},"doc-en":"Rendering type of this layer.",required:!0},metadata:{type:"*","doc-en":"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},source:{type:"string","doc-en":"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string","doc-en":"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter","doc-en":"A expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `feature-state` expression is not supported in filter expressions."},layout:{type:"layout","doc-en":"Layout properties for the layer."},paint:{type:"paint","doc-en":"Default paint properties for this layer."},"depth-test":{type:"boolean",from:["raster","circle","tracking"]},location:{type:"array",value:{type:"number"},from:["3d-model"]},rotation:{type:"array",value:{type:"number"},from:["3d-model"]},translation:{type:"array",value:{type:"number"},from:["3d-model"]},scale:{type:"array",value:{type:"number"},from:["3d-model"]},clipGround:{type:"boolean",from:["3d-model"]},isSpecialLight:{type:"boolean",from:["3d-model"]},highLightColorsIndex:{type:"number",from:["3d-model"]},highLightColors:{type:"array",value:{type:"string"},from:["3d-model"]},"viewshed-render":{type:"boolean",from:["3d-model","3d-tiles"]},cvtBGR2RGB:{type:"boolean",from:["3d-tiles"]},"radiation-regions":{type:"array",value:{type:"any"},required:!1,from:["extrusion"]},"shadow-center":{type:"array",value:{type:"number"},from:["3d-model"]},specialLights:{type:"array",value:{type:"*"},from:["3d-model"]},vectorRenderInSpace:{type:"boolean",from:["line","fill","symbol","symtracking"]},classificationType:{type:"number",from:["line","fill","3d-model"]},usePBR:{type:"boolean",default:!1,from:["3d-model","3d-tiles"]},phongLight:{type:"boolean",default:!1,from:["3d-model","3d-tiles"]},phongLightConfig:{type:"phongLightConfig",from:["3d-model","3d-tiles","extrusion"]},lightExposure:{type:"number",from:["3d-model"]}},phongLightConfig:{Ambient:{type:"number",default:.6,minimum:0,maximum:1},Diffuse:{type:"number",minimum:0,maximum:1,default:.5},SpecularColor:{type:"number",minimum:0,maximum:1,default:.3},Shininess:{type:"number",default:2,minimum:0,maximum:1e3}},layout:["layout_background","layout_fill","layout_line","layout_airline","layout_symbol","layout_circle","layout_heatmap","layout_raster","layout_extrusion","layout_histogram","layout_dynamicLine","layout_tracking","layout_sprite","layout_3d-model","layout_3d-tiles","layout_panorama","layout_symtracking"],layout_background:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_sprite:{"sprite-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},dynamic:{type:"enum",values:{water:{},none:{}},default:"none",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"constant"}},layout_airline:{"airline-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"airline-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"airline-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"airline-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"airline-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"airline-display-mode":{type:"enum",function:"piecewise-constant",values:["loop","reverse","loop-reserve","reverse-reserve"],default:"loop","property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},"round-butt":{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},"doc-en":"Whether draw border.","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point","doc-en":"Label placement relative to its geometry.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-height-key":{type:"string",default:"symbolHeight","property-type":"constant"},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,"doc-en":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels","doc-en":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,"doc-en":"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],"doc-en":"Font stack to use for displaying text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems","doc-en":"The maximum line width for text wrapping.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems","doc-en":"Text leading value for multi-line text.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!0},"text-letter-spacing":{type:"number",default:0,units:"ems","doc-en":"Text tracking amount.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{"doc-en":"The text is aligned to the left."},center:{"doc-en":"The text is centered."},right:{"doc-en":"The text is aligned to the right."}},default:"center","doc-en":"Text justification options.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{"doc-en":"The center of the text is placed closest to the anchor."},left:{"doc-en":"The left side of the text is placed closest to the anchor."},right:{"doc-en":"The right side of the text is placed closest to the anchor."},top:{"doc-en":"The top of the text is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the text is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the text is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the text is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the text is placed closest to the anchor."}},default:"center","doc-en":"Part of the text placed closest to the anchor.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees","doc-en":"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the text clockwise.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,"doc-en":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{"doc-en":"The text is not altered."},uppercase:{"doc-en":"Forces all letters to be displayed in uppercase."},lowercase:{"doc-en":"Forces all letters to be displayed in lowercase."}},default:"none","doc-en":"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array","doc-en":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number","doc-en":"基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_extrusion:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_histogram:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"histogram-max-height-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's height * 100",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's color becomes a single histogram longitudinal difference value rendering, use the 'histogram-colors' attribute in paint to render",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},layout_dynamicLine:{"dynamicLine-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of dynamicLine endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of dynamicLine when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"dynamicLine-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"dynamicLine-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"dynamicLine-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_tracking:{"tracking-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"tracking-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-sort-key":{type:"number","doc-en":"基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:{loop:{},reverse:{},"loop-reserve":{},"reverse-reserve":{}},default:"loop","property-type":"data-constant"}},"layout_3d-model":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-tiles":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_panorama:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_symtracking:{"symtracking-display-mode":{type:"enum",function:"piecewise-constant",values:{default:{},"time-sequence":{},timestamp:{}},default:"default","property-type":"data-constant"},"symtracking-time-segment":{type:"number",default:20,minimum:1,units:"second","property-type":"constant"},"symtracking-fps":{type:"number",default:1,minimum:1,"property-type":"constant"},"symtracking-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symtracking-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"compatible-mode":{type:"boolean",default:!0,"property-type":"constant"},"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like minemap GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"map","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-size":{type:"number",default:1,minimum:0,units:"图标原始大小的倍数因子","units-en":"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-field":{type:"string",default:"",tokens:!0,"doc-en":"Value to use for a text label.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},filter:{type:"array",value:"*","doc-en":"A filter selects specific features from a layer."},filter_operator:{type:"enum",values:{"==":{},like:{},"!like":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},arrin:{},"!arrin":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{"doc-en":"Filter to point geometries."},LineString:{"doc-en":"Filter to line geometries."},Polygon:{"doc-en":"Filter to polygon geometries."}},"doc-en":"The geometry type for the filter to select."},function:{expression:{type:"expression","doc-en":"An expression."},stops:{type:"array","doc-en":"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,"doc-en":"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string","doc-en":"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{"doc-en":"Return the input value as the output value."},exponential:{"doc-en":"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{"doc-en":"Return the output value of the stop just less than the function input."},categorical:{"doc-en":"Return the output value of the stop equal to the function input."}},"doc-en":"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{"doc-en":"Use the RGB color space to interpolate color values"},lab:{"doc-en":"Use the LAB color space to interpolate color values."},hcl:{"doc-en":"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},"doc-en":"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,"doc-en":"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,"doc-en":"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,"doc-en":"An expression defines a function that can be used for data-driven style properties or feature filters."},light:{anchor:{type:"enum",default:"viewport",values:{map:{"doc-en":"The position of the light source is aligned to the rotation of the map."},viewport:{"doc-en":"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_background","paint_fill","paint_line","paint_airline","paint_symbol","paint_circle","paint_raster","paint_extrusion","paint_histogram","paint_dynamicLine","paint_tracking","paint_sprite","paint_3d-model","paint_panorama","paint_symtracking"],paint_background:{"background-color":{type:"color",default:"#000000","doc-en":"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,"doc-en":"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-pattern-fixed":{type:"boolean",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity at which the background will be drawn.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number","doc-en":"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees","doc-en":"Rotates hues around the color wheel.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number","doc-en":"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number","doc-en":"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum","doc-en":"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{"doc-en":"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{"doc-en":"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds","doc-en":"Fade duration when a new tile is added.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_fill:{"fill-antialias":{type:"boolean",default:!0,"doc-en":"Whether or not the fill should be antialiased.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000","doc-en":"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"fill-outline-color":{type:"color","doc-en":"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"`discard`Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"fill-water":{type:"enum",values:{water:{},none:{}},default:"none",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"constant",expose:!1},"fill-dynamic-speed":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-dynamic-image-url":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"}},paint_line:{"line-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,"property-type":"data-driven"},"line-border-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,"doc-en":"`discard`The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number","doc-en":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-gradient":{type:"color","doc-en":'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"half-render":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-normal-direction":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},paint_airline:{"airline-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"airline-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `airline-translate`.",default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"airline-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-offset":{type:"number",default:0,"doc-en":"`discard`The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"airline-type":{type:"enum",function:"piecewise-constant",values:["none","history"],default:"real-time","property-type":"constant"},"airline-seg-group":{type:"number",default:1,requires:[{"airline-type":"history"}],minimum:1,maximum:600,"property-type":"constant"},"airline-speed":{type:"number",function:"interpolated",default:10,minimum:1,maximum:500,transition:!0,"property-type":"constant"}},paint_symbol:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels","doc-en":"Circle radius.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000","doc-en":"The fill color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,"doc-en":"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number","doc-en":"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{"doc-en":"The circle is translated relative to the map."},viewport:{"doc-en":"The circle is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{"doc-en":"Circles are scaled according to their apparent distance to the camera."},viewport:{"doc-en":"Circles are not scaled."}},default:"map","doc-en":"Controls the scaling behavior of the circle when the map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The circle is aligned to the plane of the map."},viewport:{"doc-en":"The circle is aligned to the plane of the viewport."}},default:"viewport","doc-en":"Orientation of circle when map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000","doc-en":"The stroke color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number","doc-en":"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-height":{type:"number",default:0,minimum:0,expression:{interpolated:!1,parameters:["zoom","feature","feature-state"]},"property-type":"constant"},"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels","doc-en":"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,"doc-en":"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,"doc-en":"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],"doc-en":'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number","doc-en":"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_extrusion:{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-translate-anchor":{type:"enum",values:{map:{"doc-en":"The fill-extrusion is translated relative to the map."},viewport:{"doc-en":"The fill-extrusion is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-top-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-pattern-factor":{type:"array",value:"number",length:2,"property-type":"constant"},"extrusion-close-stencil-clip":{type:"boolean",default:!1,"property-type":"data-constant"},"extrusion-self-bloom":{type:"boolean",default:!1,"doc-en":"The  extrude  layer generate bloom by oneself.","property-type":"data-constant"},"extrusion-bloom-height":{type:"number",default:!1,"doc-en":"Maximum height of self illumination of building white mode","property-type":"data-constant"},"extrusion-glow-pure-color-height":{type:"number",default:.4,"doc-en":"building white mold height to control the building white mold gradient range.","property-type":"data-constant"},"extrusion-glow-width":{type:"number",default:.005,"doc-en":"width of building white mold refresh strip.","property-type":"data-constant"},"extrusion-glow-speed":{type:"number",default:12,"doc-en":"speed of building white strip refresh.","property-type":"data-constant"}},paint_histogram:{"histogram-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill histogram layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The histogram's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-colors":{type:"array",value:"string",length:5,default:["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],requires:[{"!":"histogram-color-render"}],"doc-en":"Histogram segmented color, this parameter has effect only when histogram-color-render is enabled.","property-type":"data-constant"},"histogram-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"`discard`Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-vertical-gradient":{type:"boolean",default:!0,"doc-en":"Whether to apply a vertical gradient to the sides of a histogram layer. If true, sides will be shaded slightly darker farther down.",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-dynamic":{type:"boolean",default:!1,"doc-en":"Whether to perform dynamic up and down rendering",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-constant"},"histogram-heightArr1":{type:"color",default:[0,0,0,0],"doc-en":"The first trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr2":{type:"color",default:[0,0,0,0],"doc-en":"The second trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr3":{type:"color",default:[0,0,0,0],"doc-en":"The third trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-speed":{type:"number","doc-en":"The speed of dynamic up and down rendering",default:1,minimum:1,maximum:1e3,transition:!0,"property-type":"data-constant"},"histogram-count":{type:"number",default:12,"doc-en":"The count of dynamic up and down rendering",minimum:1,maximum:12,units:"millisecond",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-max-height":{type:"number",default:200,minimum:0,units:"meters","doc-en":"The maximum height of the histogram, 'only effective when' histogram-color-render 'is turned on, When this value is identical with 'histostore-height', the column will be equally divided into 4 sections of colors from bottom to top according to the colors specified by 'histostore-colors'","property-type":"data-constant"},"depth-change":{type:"boolean",default:!1,transition:!0,"doc-en":"Turn on or off the transparency gradient from top to bottom",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-constant"}},paint_dynamicLine:{"dynamicLine-opacity":{type:"number","doc-en":"The opacity at which the dynamicLine will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-color":{type:"color","doc-en":"The color with which the dynamicLine will be drawn.",default:"#000000",transition:!0,requires:[{"!":"dynamicLine-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"dynamicLine-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-seg-group":{type:"number","doc-en":"The number of displayed segments of the dynamicLine. When the value is 1, the dynamicLine displays only one segment. The larger the value, the more segments the dynamicLine displays",default:20,minimum:1,maximum:600,"property-type":"constant"},"dynamicLine-speed":{type:"number","doc-en":"The moving speed of dynamicLines, the higher the value, the faster the speed",default:1,minimum:1,maximum:500,"property-type":"constant"}},paint_tracking:{"tracking-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `tracking-translate`.",default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history"],default:"real-time","property-type":"constant"},"tracking-run-time":{type:"number",default:0,minimum:0,"property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},paint_sprite:{"sprite-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `sprite-translate`.",default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed":{type:"number","doc-en":"Play speed of sprite",default:5,minimum:1e-6,maximum:2e3,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"}},"paint_3d-model":{"3d-model-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-tiles":{},paint_panorama:{"panorama-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symtracking:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"`discard`Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"`discard`Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symtracking-delay":{type:"number",default:10,minimum:0,maximum:120,"doc-en":"Motion icon update delay, which is the cycle interval time. If the value is 0, there is no interval for the animation cycle. If it is 5, the interval between animation cycles will be 5 seconds.","property-type":"constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds","doc-en":"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds","doc-en":"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type","doc-en":"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type","doc-en":"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type","doc-en":"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type","doc-en":"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string"}}};class wt{constructor(t,e,A,r){this.message=(t?`${t}: `:"")+A,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__);}}function xt(t){const e=t.value;return e?[new wt(t.key,e,"constants have been deprecated as of v8")]:[]}function Ct(t,...e){for(const A of e)for(const e in A)t[e]=A[e];return t}function Et(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function _t(t){if(Array.isArray(t))return t.map(_t);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const A in t)e[A]=_t(t[A]);return e}return Et(t)}class vt extends Error{constructor(t,e){super(e),this.message=e,this.key=t;}}var bt=vt;class Ut{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,A]of e)this.bindings[t]=A;}concat(t){return new Ut(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return !!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Ft=Ut;const Mt={kind:"null"},Qt={kind:"number"},It={kind:"string"},St={kind:"boolean"},Tt={kind:"color"},Rt={kind:"object"},Lt={kind:"value"},Pt={kind:"collator"},Ht={kind:"formatted"},Ot={kind:"resolvedImage"};function Dt(t,e){return {kind:"array",itemType:t,N:e}}function Nt(t){if("array"===t.kind){const e=Nt(t.itemType);return "number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const kt=[Mt,Qt,It,St,Tt,Ht,Rt,Dt(Lt),Ot];function Vt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Vt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else {if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of kt)if(!Vt(t,e))return null}return `Expected ${Nt(t)} but found ${Nt(e)} instead.`}function Gt(t,e){return e.some((e=>e.kind===t.kind))}function Kt(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}const zt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xt(t){return (t=Math.round(t))<0?0:t>255?255:t}function qt(t){return t<0?0:t>1?1:t}function jt(t){return Xt("%"===t[t.length-1]?Number(t.slice(0,-1))/100*255:Number(t))}function Yt(t){return "%"!==t[t.length-1]?null:qt(Number(t.slice(0,-1))/100)}function Wt(t,e,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?t+(e-t)*A*6:2*A<1?e:3*A<2?t+(e-t)*(2/3-A)*6:t}function Zt(t){return t<48?NaN:t<=57?t-48:t<97?NaN:t<=102?t-87:NaN}const Jt=new Set([" ","\t","\n","\r",",","/"]);function $t(t){const e=t.trim().toLowerCase();if(e in zt)return zt[e].slice();if("#"===e[0]){const t=4===e.length||5===e.length,A=7===e.length||9===e.length;if(!t&&!A)return null;const r=t?1:2,i=[0,0,0,255],n=5===e.length||9===e.length?4:3;for(let A=0;A<n;A++){const n=Zt(e.charCodeAt(A*r+1));if(i[A]=16*n+(t?n:Zt(e.charCodeAt(A*r+2))),Number.isNaN(i[A]))return null}return i[3]/=255,i}const A=e.indexOf("(");let r=e.indexOf(")");if(-1===r&&(r=e.length),-1!==A&&(r+1===e.length||r===e.length)){const t=e.substr(0,A),i=[];let n="";for(let t=A+1;t<r;t++)Jt.has(e[t])?0!==n.length&&(i.push(n),n=""):n+=e[t];0!==n.length&&i.push(n);const s=4===i.length?function(t){return Yt(t)??qt(Number(t))}(i.pop()):1;if(3!==i.length)return null;let a,o,h,l,c,u;switch(t){case"rgba":case"rgb":return u=[...i.map(jt),s],u.some(Number.isNaN)?null:u;case"hsla":case"hsl":return a=(function(t){return t.endsWith("deg")?Number(t.slice(0,-3)):t.endsWith("grad")?360*Number(t.slice(0,-4))/400:t.endsWith("rad")?360*Number(t.slice(0,-3))/(2*Math.PI):t.endsWith("turn")?360*Number(t.slice(0,-4)):Number(t)}(i[0])%360+360)%360/360,Number.isNaN(a)?null:(o=Yt(i[1]),Number.isNaN(o)||null===o?null:(h=Yt(i[2]),Number.isNaN(h)||null===h?null:(c=h<=.5?h*(o+1):h+o-h*o,l=2*h-c,[Xt(255*Wt(l,c,a+1/3)),Xt(255*Wt(l,c,a)),Xt(255*Wt(l,c,a-1/3)),s])));default:return null}}return null}class te{constructor(t,e,A,r=1){this.r=t,this.g=e,this.b=A,this.a=r;}static parse(t){if(!t)return;if(t instanceof te)return t;if("string"!=typeof t)return;const e=$t(t);return e?new te(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,A,r]=this.toArray();return `rgba(${Math.round(t)},${Math.round(e)},${Math.round(A)},${r})`}toArray(){const{r:t,g:e,b:A,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*A/r,r]}}te.black=new te(0,0,0,1),te.white=new te(1,1,1,1),te.transparent=new te(0,0,0,0);var ee=te;class Ae{constructor(t,e,A){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=A,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class re{constructor(t,e,A){this.type=Pt,this.locale=A,this.caseSensitive=t,this.diacriticSensitive=e;}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const A=t[1];if("object"!=typeof A||Array.isArray(A))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==A["case-sensitive"]&&A["case-sensitive"],1,St);if(!r)return null;const i=e.parse(void 0!==A["diacritic-sensitive"]&&A["diacritic-sensitive"],1,St);if(!i)return null;let n=null;return A.locale&&(n=e.parse(A.locale,1,It),!n)?null:new re(r,i,n)}evaluate(t){return new Ae(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale);}possibleOutputs(){return [void 0]}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ie={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ne(t){for(const e of t)if(ae(e.charCodeAt(0)))return !0;return !1}function se(t){return !(ie.Arabic(t)||ie["Arabic Supplement"](t)||ie["Arabic Extended-A"](t)||ie["Arabic Presentation Forms-A"](t)||ie["Arabic Presentation Forms-B"](t))}function ae(t){return !(746!==t&&747!==t&&(t<4352||!(ie["Bopomofo Extended"](t)||ie.Bopomofo(t)||ie["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ie["CJK Compatibility Ideographs"](t)||ie["CJK Compatibility"](t)||ie["CJK Radicals Supplement"](t)||ie["CJK Strokes"](t)||!(!ie["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ie["CJK Unified Ideographs Extension A"](t)||ie["CJK Unified Ideographs"](t)||ie["Enclosed CJK Letters and Months"](t)||ie["Hangul Compatibility Jamo"](t)||ie["Hangul Jamo Extended-A"](t)||ie["Hangul Jamo Extended-B"](t)||ie["Hangul Jamo"](t)||ie["Hangul Syllables"](t)||ie.Hiragana(t)||ie["Ideographic Description Characters"](t)||ie.Kanbun(t)||ie["Kangxi Radicals"](t)||ie["Katakana Phonetic Extensions"](t)||ie.Katakana(t)&&12540!==t||!(!ie["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ie["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ie["Unified Canadian Aboriginal Syllabics"](t)||ie["Unified Canadian Aboriginal Syllabics Extended"](t)||ie["Vertical Forms"](t)||ie["Yijing Hexagram Symbols"](t)||ie["Yi Syllables"](t)||ie["Yi Radicals"](t))))}function oe(t){return !(ae(t)||function(t){return !!(ie["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ie["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ie["Letterlike Symbols"](t)||ie["Number Forms"](t)||ie["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ie["Control Pictures"](t)&&9251!==t||ie["Optical Character Recognition"](t)||ie["Enclosed Alphanumerics"](t)||ie["Geometric Shapes"](t)||ie["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ie["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ie["CJK Symbols and Punctuation"](t)||ie.Katakana(t)||ie["Private Use Area"](t)||ie["CJK Compatibility Forms"](t)||ie["Small Form Variants"](t)||ie["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function he(t){return t>=1424&&t<=2303||ie["Arabic Presentation Forms-A"](t)||ie["Arabic Presentation Forms-B"](t)}function le(t,e){return !(!e&&he(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ie.Khmer(t))}function ce(t){for(const e of t)if(he(e.charCodeAt(0)))return !0;return !1}class ue{constructor(t,e,A){this.text=t,this.scale=e,this.fontStack=A;}}class pe{constructor(t){this.sections=t;}static fromString(t){return new pe([new ue(t,null,null,null)])}static factory(t){return t instanceof pe?t:pe.fromString(t)}toString(){return this.sections.map((t=>t.text)).join("")}containsRTLText(){for(const t of this.sections)if(ce(t.text))return !0;return !1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.text);const A=e.fontStack?["literal",e.fontStack.split(",")]:null;t.push({"text-font":A,"font-scale":e.scale});}return t}}class de{constructor(t){this.name=t.name,this.available=t.available;}toString(){return this.name}static fromString(t){return t?new de({name:t,available:!1}):null}serialize(){return ["image",this.name]}}function fe(t,e,A,r){return "number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof A&&A>=0&&A<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,A,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,A,r]:[t,e,A]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ye(t){if(null===t)return !0;if("string"==typeof t)return !0;if("boolean"==typeof t)return !0;if("number"==typeof t)return !0;if(t instanceof ee)return !0;if(t instanceof Ae)return !0;if(t instanceof pe)return !0;if(t instanceof de)return !0;if(Array.isArray(t)){for(const e of t)if(!ye(e))return !1;return !0}if("object"==typeof t){for(const e in t)if(!ye(t[e]))return !1;return !0}return !1}function ge(t){if(null===t)return Mt;if("string"==typeof t)return It;if("boolean"==typeof t)return St;if("number"==typeof t)return Qt;if(t instanceof ee)return Tt;if(t instanceof Ae)return Pt;if(t instanceof pe)return Ht;if(t instanceof de)return Ot;if(Array.isArray(t)){const e=t.length;let A;for(const e of t){const t=ge(e);if(A){if(A===t)continue;A=Lt;break}A=t;}return Dt(A||Lt,e)}return Rt}function me(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ee||t instanceof pe||t instanceof de?t.toString():JSON.stringify(t)}class Be{constructor(t,e){this.type=t,this.value=e;}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ye(t[1]))return e.error("invalid value");const A=t[1];let r=ge(A);const i=e.expectedType;return "array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Be(r,A)}evaluate(){return this.value}eachChild(){}possibleOutputs(){return [this.value]}serialize(){return "array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ee?["rgba"].concat(this.value.toArray()):this.value instanceof pe?this.value.serialize():this.value}}var we=Be,xe=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t;}toJSON(){return this.message}};const Ce={string:It,number:Qt,boolean:St,object:Rt};class Ee{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const A=Ce[t[0]],r=[];for(let A=1;A<t.length;A++){const i=e.parse(t[A],A,Lt);if(!i)return null;r.push(i);}return new Ee(A,r)}evaluate(t){for(let e=0;e<this.args.length;e++){const A=this.args[e].evaluate(t);if(!Vt(this.type,ge(A)))return A;if(e===this.args.length-1)throw new xe(`Expected value to be of type ${Nt(this.type)}, but found ${Nt(ge(A))} instead.`)}return null}eachChild(t){this.args.forEach(t);}possibleOutputs(){return [].concat(...this.args.map((t=>t.possibleOutputs())))}serialize(){return [this.type.kind].concat(this.args.map((t=>t.serialize())))}}var _e=Ee;const ve={string:It,number:Qt,boolean:St};class be{constructor(t,e){this.type=t,this.input=e;}static parse(t,e){if(t.length<2||t.length>4)return e.error(`Expected 1, 2, or 3 arguments, but found ${t.length-1} instead.`);let A,r;if(t.length>2){const r=t[1];if("string"!=typeof r||!(r in ve))return e.error('The item type argument of "array" must be one of string, number, boolean',1);A=ve[r];}else A=Lt;if(t.length>3){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);r=t[2];}const i=Dt(A,r),n=e.parse(t[t.length-1],t.length-1,Lt);return n?new be(i,n):null}evaluate(t){const e=this.input.evaluate(t);if(Vt(this.type,ge(e)))throw new xe(`Expected value to be of type ${Nt(this.type)}, but found ${Nt(ge(e))} instead.`);return e}eachChild(t){t(this.input);}possibleOutputs(){return this.input.possibleOutputs()}serialize(){const t=["array"],e=this.type.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){t.push(e.kind);const A=this.type.N;"number"==typeof A&&t.push(A);}return t.push(this.input.serialize()),t}}var Ue=be;const Fe={"to-number":Qt,"to-color":Tt};class Me{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const A=Fe[t[0]],r=[];for(let A=1;A<t.length;A++){const i=e.parse(t[A],A,Lt);if(!i)return null;r.push(i);}return new Me(A,r)}evaluate(t){if("color"===this.type.kind){let e,A;for(const r of this.args)if(e=r.evaluate(t),A=null,"string"==typeof e){const A=t.parseColor(e);if(A)return A}else if(Array.isArray(e)&&(A=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:fe(e[0],e[1],e[2],e[3]),!A))return new ee(e[0]/255,e[1]/255,e[2]/255,e[3]);throw new xe(A||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}if("formatted"===this.type.kind)return pe.fromString(me(this.args[0].evaluate(t)));if("resolvedImage"===this.type.kind)return de.fromString(me(this.args[0].evaluate(t)));{let e=null;for(const A of this.args){if(e=A.evaluate(t),null===e)continue;const r=Number(e);if(!isNaN(r))return r}throw new xe(`Could not convert ${JSON.stringify(e)} to number.`)}}eachChild(t){this.args.forEach(t);}possibleOutputs(){return [].concat(...this.args.map((t=>t.possibleOutputs())))}serialize(){const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize());})),t}}var Qe=Me;const Ie=["Unknown","Point","LineString","Polygon"];var Se=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null;}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?this.feature._feature?"number"==typeof this.feature._feature.type?Ie[this.feature._feature.type]:this.feature._feature.type:"number"==typeof this.feature.type?Ie[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&this.feature.hasOwnProperty("geometry")?this.feature.geometry:this.feature&&this.feature._feature&&this.feature._feature.hasOwnProperty("geometry")?this.feature._feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ee.parse(t)),e}};class Te{constructor(t,e,A,r){this.name=t,this.type=e,this._evaluate=A,this.args=r;}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t);}possibleOutputs(){return [void 0]}serialize(){return [this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const A=t[0],r=Te.definitions[A];if(!r)return e.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,n=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=n.filter((([e])=>!Array.isArray(e)||e.length===t.length-1)),a=[];for(let A=1;A<t.length;A++){const r=t[A];let i;if(1===s.length){const t=s[0][0];i=Array.isArray(t)?t[A-1]:t.type;}const n=e.parse(r,1+a.length,i);if(!n)return null;a.push(n);}let o=null;for(const[t,r]of s)if(o=new sA(e.registry,e.path,null,e.scope),Array.isArray(t)&&t.length!==a.length)o.error(`Expected ${t.length} arguments, but found ${a.length} instead.`);else {for(let e=0;e<a.length;e++){const A=Array.isArray(t)?t[e]:t.type,r=a[e];o.concat(e+1).checkSubtype(A,r.type);}if(0===o.errors.length)return new Te(A,i,r,a)}if(1===s.length)e.errors.push.apply(e.errors,o.errors);else {const t=(s.length?s:n).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Nt).join(", ")})`:`(${Nt(e.type)}...)`;var e;})).join(" | "),A=a.map((t=>Nt(t.type))).join(", ");e.error(`Expected arguments of type ${t}, but found (${A}) instead.`);}return null}static register(t,e){Te.definitions=e;for(const A in e)t[A]=Te;}}var Re=Te;const Le=8192;function Pe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1]);}function He(t,e){return !(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Oe(t,e){const A=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return [Math.round(A*i*Le),Math.round(r*i*Le)]}function De(t,e,A){const r=t[0]-e[0],i=t[1]-e[1],n=t[0]-A[0],s=t[1]-A[1];return r*s-n*i==0&&r*n<=0&&i*s<=0}function Ne(t,e){let A=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(De(t,a[e],a[e+1]))return !1;(i=a[e])[1]>(r=t)[1]!=(n=a[e+1])[1]>r[1]&&r[0]<(n[0]-i[0])*(r[1]-i[1])/(n[1]-i[1])+i[0]&&(A=!A);}}var r,i,n;return A}function ke(t,e){for(let A=0;A<e.length;A++)if(Ne(t,e[A]))return !0;return !1}function Ve(t,e,A,r){const i=r[0]-A[0],n=r[1]-A[1],s=(t[0]-A[0])*n-i*(t[1]-A[1]),a=(e[0]-A[0])*n-i*(e[1]-A[1]);return s>0&&a<0||s<0&&a>0}function Ge(t,e,A,r){return 0!=(i=[r[0]-A[0],r[1]-A[1]])[0]*(n=[e[0]-t[0],e[1]-t[1]])[1]-i[1]*n[0]&&!(!Ve(t,e,A,r)||!Ve(A,r,t,e));var i,n;}function Ke(t,e,A){for(const r of A)for(let A=0;A<r.length-1;++A)if(Ge(t,e,r[A],r[A+1]))return !0;return !1}function ze(t,e){for(let A=0;A<t.length;++A)if(!Ne(t[A],e))return !1;for(let A=0;A<t.length-1;++A)if(Ke(t[A],t[A+1],e))return !1;return !0}function Xe(t,e){for(let A=0;A<e.length;A++)if(ze(t,e[A]))return !0;return !1}function qe(t,e,A){const r=[];for(let i=0;i<t.length;i++){const n=[];for(let r=0;r<t[i].length;r++){const s=Oe(t[i][r],A);Pe(e,s),n.push(s);}r.push(n);}return r}function je(t,e,A){const r=[];for(let i=0;i<t.length;i++){const n=qe(t[i],e,A);r.push(n);}return r}function Ye(t,e,A,r){if(t[0]<A[0]||t[0]>A[2]){const e=.5*r;let i=t[0]-A[0]>e?-r:A[0]-t[0]>e?r:0;0===i&&(i=t[0]-A[2]>e?-r:A[2]-t[0]>e?r:0),t[0]+=i;}Pe(e,t);}function We(t,e,A,r){const i=Math.pow(2,r.z)*Le,n=[r.x*Le,r.y*Le],s=[];for(const r of t)if(r.length)for(let t=0;t<r.length;t++){let a;a=r[t].x?[r[t].x+n[0],r[t].y+n[1]]:[r[t]+n[0],r[t]+n[1]],Ye(a,e,A,i),s.push(a);}else for(const t of r){const r=[t.x+n[0],t.y+n[1]];Ye(r,e,A,i),s.push(r);}return s}function Ze(t,e,A,r){const i=Math.pow(2,r.z)*Le,n=[r.x*Le,r.y*Le],s=[];for(const A of t){const t=[];if(A.length)for(let r=0;r<A.length;r++){const i=[A[r][0]+n[0],A[r][1]+n[1]];Pe(e,i),t.push(i);}else for(const r of A){const A=[r.x+n[0],r.y+n[1]];Pe(e,A),t.push(A);}s.push(t);}if(e[2]-e[0]<=i/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)Ye(r,e,A,i);}var a;return s}class Je{constructor(t,e){this.type=St,this.geojson=t,this.geometries=e;}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ye(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const A=e.features[t].geometry.type;if("Polygon"===A||"MultiPolygon"===A)return new Je(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Je(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Je(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const A=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const n=qe(e.coordinates,r,i),s=We(t.geometry(),A,r,i);if(!He(A,r))return !1;for(const t of s)if(!Ne(t,n))return !1}if("MultiPolygon"===e.type){const n=je(e.coordinates,r,i),s=We(t.geometry(),A,r,i);if(!He(A,r))return !1;for(const t of s)if(!ke(t,n))return !1}return !0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const A=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const n=qe(e.coordinates,r,i),s=Ze(t.geometry(),A,r,i);if(!He(A,r))return !1;for(const t of s)if(!ze(t,n))return !1}if("MultiPolygon"===e.type){const n=je(e.coordinates,r,i),s=Ze(t.geometry(),A,r,i);if(!He(A,r))return !1;for(const t of s)if(!Xe(t,n))return !1}return !0}(t,this.geometries)}return !1}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["within",this.geojson]}}var $e=Je;function tA(t){if(t instanceof Re){if("get"===t.name&&1===t.args.length)return !1;if("feature-state"===t.name)return !1;if("has"===t.name&&1===t.args.length)return !1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return !1;if(/^filter-/.test(t.name))return !1}if(t instanceof $e)return !1;let e=!0;return t.eachChild((t=>{e&&!tA(t)&&(e=!1);})),e}function eA(t){if(t instanceof Re&&"feature-state"===t.name)return !1;let e=!0;return t.eachChild((t=>{e&&!eA(t)&&(e=!1);})),e}function AA(t,e){if(t instanceof Re&&e.indexOf(t.name)>=0)return !1;let A=!0;return t.eachChild((t=>{A&&!AA(t,e)&&(A=!1);})),A}class rA{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e;}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const A=t[1];return e.scope.has(A)?new rA(A,e.scope.get(A)):e.error(`Unknown variable "${A}". Make sure "${A}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["var",this.name]}}var iA=rA;class nA{constructor(t,e=[],A,r=new Ft,i=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=i,this.expectedType=A;}parse(t,e,A,r,i={}){return e?this.concat(e,A,r)._parse(t,i):this._parse(t,i)}_parse(t,e){if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=t[0];if("string"!=typeof A)return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[A];if(r){let A=r.parse(t,this);if(!A)return null;if(this.expectedType){const t=this.expectedType,r=A.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind||"value"!==r.kind)if("array"===t.kind&&"value"===r.kind)e.omitTypeAnnotations||(A=new Ue(t,A));else if("color"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(this.expectedType,A.type))return null}else e.omitTypeAnnotations||(A=new Qe(t,[A]));else e.omitTypeAnnotations||(A=new _e(t,[A]));}if(!(A instanceof we)&&aA(A)){const t=new Se;try{A=new we(A.type,A.evaluate(t));}catch(t){return this.error(t.message),null}}return A}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,A){const r="number"==typeof t?this.path.concat(t):this.path,i=A?this.scope.concat(A):this.scope;return new nA(this.registry,r,e||null,i,this.errors)}error(t,...e){const A=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new bt(A,t));}checkSubtype(t,e){const A=Vt(t,e);return A&&this.error(A),A}}var sA=nA;function aA(t){if(t instanceof iA)return aA(t.boundExpression);if(t instanceof Re&&"error"===t.name)return !1;if(t instanceof re)return !1;if(t instanceof $e)return !1;const e=t instanceof Qe||t instanceof _e||t instanceof Ue;let A=!0;return t.eachChild((t=>{A=e?A&&aA(t):A&&t instanceof we;})),!!A&&tA(t)&&AA(t,["zoom","heatmap-density","line-progress","is-supported-script"])}function oA(t,e){let A,r,i=0,n=t.length-1,s=0;for(;i<=n;){if(s=Math.floor((i+n)/2),A=t[s],r=t[s+1],e===A||e>A&&e<r)return s;if(A<e)i=s+1;else {if(!(A>e))throw new xe("Input is not a number.");n=s-1;}}return Math.max(s-1,0)}class hA{constructor(t,e,A){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of A)this.labels.push(t),this.outputs.push(e);}static parse(t,e){let[,A,...r]=t;if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(A=e.parse(A,1,Qt),!A)return null;const i=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType),r.unshift(-1/0);for(let t=0;t<r.length;t+=2){const A=r[t],s=r[t+1],a=t+1,o=t+2;if("number"!=typeof A)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=A)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const h=e.parse(s,o,n);if(!h)return null;n=n||h.type,i.push([A,h]);}return new hA(n,A,i)}evaluate(t){const e=this.labels,A=this.outputs;if(1===e.length)return A[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return A[0].evaluate(t);const i=e.length;return r>=e[i-1]?A[i-1].evaluate(t):A[oA(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e);}possibleOutputs(){return [].concat(...this.outputs.map((t=>t.possibleOutputs())))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var lA=hA;function cA(t,e,A){return t*(1-A)+e*A}var uA=Object.freeze({__proto__:null,number:cA,color:function(t,e,A){return new ee(cA(t.r,e.r,A),cA(t.g,e.g,A),cA(t.b,e.b,A),cA(t.a,e.a,A))},array:function(t,e,A){const r=t.map(((t,r)=>cA(t,e[r],A)));return r}});class pA{constructor(t,e,A,r){this.type=t,this.interpolation=e,this.input=A,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e);}static interpolationFactor(t,e,A,r){let i=0;if("exponential"===t.name)i=dA(e,t.base,A,r);else if("linear"===t.name)i=dA(e,1,A,r);else if("cubic-bezier"===t.name){const n=t.controlPoints;i=new a(n[0],n[1],n[2],n[3]).solve(dA(e,1,A,r));}return i}static parse(t,e){let[,A,r,...i]=t;if(!Array.isArray(A)||0===A.length)return e.error("Expected an interpolation type expression.",1);if("linear"===A[0])A={name:"linear"};else if("exponential"===A[0]){const t=A[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:t};}else {if("cubic-bezier"!==A[0])return e.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const t=A.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:t};}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Qt),!r)return null;const n=[];let s=null;e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType);for(let t=0;t<i.length;t+=2){const A=i[t],r=i[t+1],a=t+3,o=t+4;if("number"!=typeof A)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=A)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',a);const h=e.parse(r,o,s);if(!h)return null;s=s||h.type,n.push([A,h]);}return "number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new pA(s,A,r,n):e.error(`Type ${Nt(s)} is not interpolatable.`)}evaluate(t){const e=this.labels,A=this.outputs;if(1===e.length)return A[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return A[0].evaluate(t);const i=e.length;if(r>=e[i-1])return A[i-1].evaluate(t);const n=oA(e,r),s=pA.interpolationFactor(this.interpolation,r,e[n],e[n+1]),a=A[n].evaluate(t),o=A[n+1].evaluate(t);return uA[this.type.kind.toLowerCase()](a,o,s)}eachChild(t){t(this.input);for(const e of this.outputs)t(e);}possibleOutputs(){return [].concat(...this.outputs.map((t=>t.possibleOutputs())))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=["interpolate",t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function dA(t,e,A,r){const i=r-A,n=t-A;return 0===i?0:1===e?n/i:(Math.pow(e,n)-1)/(Math.pow(e,i)-1)}var fA=pA;class yA{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let A=null;const r=e.expectedType;r&&"value"!==r.kind&&(A=r);const i=[];for(const r of t.slice(1)){const t=e.parse(r,1+i.length,A,void 0,{omitTypeAnnotations:!0});if(!t)return null;A=A||t.type,i.push(t);}const n=r&&i.some((t=>Vt(r,t.type)));return new yA(n?Lt:A,i)}evaluate(t){let e,A=null,r=0;for(const i of this.args)if(r++,A=i.evaluate(t),A&&A instanceof de&&!A.available&&(e||(e=A.name),A=null,r===this.args.length&&(A=e)),null!==A)break;return A}eachChild(t){this.args.forEach(t);}possibleOutputs(){return [].concat(...this.args.map((t=>t.possibleOutputs())))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize());})),t}}var gA=yA;class mA{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e;}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result);}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const A=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const n=e.parse(t[r+1],r+1);if(!n)return null;A.push([i,n]);}const r=e.parse(t[t.length-1],t.length-1,void 0,A);return r?new mA(A,r):null}possibleOutputs(){return this.result.possibleOutputs()}serialize(){const t=["let"];for(const[e,A]of this.bindings)t.push(e,A.serialize());return t.push(this.result.serialize()),t}}var BA=mA;class wA{constructor(t,e,A){this.type=t,this.index=e,this.input=A;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const A=e.parse(t[1],1,Qt),r=e.parse(t[2],2,Dt(e.expectedType||Lt));return A&&r?new wA(r.type.itemType,A,r):null}evaluate(t){const e=this.index.evaluate(t),A=this.input.evaluate(t);if(e<0)throw new xe(`Array index out of bounds: ${e} < 0.`);if(e>=A.length)throw new xe(`Array index out of bounds: ${e} > ${A.length-1}.`);if(e!==Math.floor(e))throw new xe(`Array index must be an integer, but found ${e} instead.`);return A[e]}eachChild(t){t(this.index),t(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["at",this.index.serialize(),this.input.serialize()]}}var xA=wA;class CA{constructor(t,e,A,r,i,n){this.inputType=t,this.type=e,this.input=A,this.cases=r,this.outputs=i,this.otherwise=n;}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let A,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const i={},n=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const o=t[s+1];Array.isArray(a)||(a=[a]);const h=e.concat(s);if(0===a.length)return h.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return h.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return h.error("Numeric branch labels must be integer values.");if(A){if(h.checkSubtype(A,ge(t)))return null}else A=ge(t);if(void 0!==i[String(t)])return h.error("Branch labels must be unique.");i[String(t)]=n.length;}const l=e.parse(o,s,r);if(!l)return null;r=r||l.type,n.push(l);}const s=e.parse(t[1],1,Lt);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(A,s.type)?null:new CA(A,r,s,i,n,a):null}evaluate(t){const e=this.input.evaluate(t);return (ge(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise);}possibleOutputs(){return [].concat(...this.outputs.map((t=>t.possibleOutputs()))).concat(this.otherwise.possibleOutputs())}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),A=[],r={};for(const t of e){const e=r[this.cases[t]];void 0===e?(r[this.cases[t]]=A.length,A.push([this.cases[t],[t]])):A[e][1].push(t);}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,r]of A){if(1===r.length)t.push(i(r[0]));else {const e=r.map(i);t.push(e);}t.push(this.outputs[e].serialize());}return t.push(this.otherwise.serialize()),t}}var EA=CA;class _A{constructor(t,e,A){this.type=t,this.branches=e,this.otherwise=A;}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let A;e.expectedType&&"value"!==e.expectedType.kind&&(A=e.expectedType);const r=[];for(let i=1;i<t.length-1;i+=2){const n=e.parse(t[i],i,St);if(!n)return null;const s=e.parse(t[i+1],i+1,A);if(!s)return null;r.push([n,s]),A=A||s.type;}const i=e.parse(t[t.length-1],t.length-1,A);return i?new _A(A,r,i):null}evaluate(t){for(const[e,A]of this.branches)if(e.evaluate(t))return A.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,A]of this.branches)t(e),t(A);t(this.otherwise);}possibleOutputs(){return [].concat(...this.branches.map((([t,e])=>e.possibleOutputs()))).concat(this.otherwise.possibleOutputs())}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize());})),t}}var vA=_A;class bA{constructor(t){this.type=Ot,this.input=t;}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const A=e.parse(t[1],1,It);return A?new bA(A):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),A=de.fromString(e);return A&&t.availableImages&&(A.available=t.availableImages.indexOf(e)>-1),A}eachChild(t){t(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["image",this.input.serialize()]}}class UA{constructor(t,e,A){this.type=Qt,this.needle=t,this.haystack=e,this.fromIndex=A;}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const A=e.parse(t[1],1,Lt),r=e.parse(t[2],2,Lt);if(!A||!r)return null;if(!Gt(A.type,[St,It,Qt,Mt,Lt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(A.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Qt);return i?new UA(A,r,i):null}return new UA(A,r)}evaluate(t){const e=this.needle.evaluate(t),A=this.haystack.evaluate(t);if(!Kt(e,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(ge(e))} instead.`);if(!Kt(A,["string","array"]))throw new xe(`Expected second argument to be of type array or string, but found ${Nt(ge(A))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return A.indexOf(e,r)}return A.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return ["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return ["index-of",this.needle.serialize(),this.haystack.serialize()]}}var FA=UA;function MA(t,e){return "=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function QA(t,e,A,r){return 0===r.compare(e,A)}function IA(t,e,A){const r="=="!==t&&"!="!==t;return class i{constructor(t,e,A){this.type=St,this.lhs=t,this.rhs=e,this.collator=A,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind;}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const A=t[0];let n=e.parse(t[1],1,Lt);if(!n)return null;if(!MA(A,n.type))return e.concat(1).error(`"${A}" comparisons are not supported for type '${Nt(n.type)}'.`);let s=e.parse(t[2],2,Lt);if(!s)return null;if(!MA(A,s.type))return e.concat(2).error(`"${A}" comparisons are not supported for type '${Nt(s.type)}'.`);if(n.type.kind!==s.type.kind&&"value"!==n.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Nt(n.type)}' and '${Nt(s.type)}'.`);r&&("value"===n.type.kind&&"value"!==s.type.kind?n=new _e(s.type,[n]):"value"!==n.type.kind&&"value"===s.type.kind&&(s=new _e(n.type,[s])));let a=null;if(4===t.length){if("string"!==n.type.kind&&"string"!==s.type.kind&&"value"!==n.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Pt),!a)return null}return new i(n,s,a)}evaluate(i){const n=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const e=ge(n),A=ge(s);if(e.kind!==A.kind||"string"!==e.kind&&"number"!==e.kind)throw new xe(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${A.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=ge(n),A=ge(s);if("string"!==t.kind||"string"!==A.kind)return e(i,n,s)}return this.collator?A(i,n,s,this.collator.evaluate(i)):e(i,n,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator);}possibleOutputs(){return [void 0]}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize());})),e}}}const SA=IA("==",(function(t,e,A){return e===A}),QA),TA=IA("!=",(function(t,e,A){return e!==A}),(function(t,e,A,r){return !QA(0,e,A,r)})),RA=IA("<",(function(t,e,A){return e<A}),(function(t,e,A,r){return r.compare(e,A)<0})),LA=IA(">",(function(t,e,A){return e>A}),(function(t,e,A,r){return r.compare(e,A)>0})),PA=IA("<=",(function(t,e,A){return e<=A}),(function(t,e,A,r){return r.compare(e,A)<=0})),HA=IA(">=",(function(t,e,A){return e>=A}),(function(t,e,A,r){return r.compare(e,A)>=0}));class OA{constructor(t){this.type=Qt,this.input=t;}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const A=e.parse(t[1],1);return A?"array"!==A.type.kind&&"string"!==A.type.kind&&"value"!==A.type.kind?e.error(`Expected argument of type string or array, but found ${Nt(A.type)} instead.`):new OA(A):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new xe(`Expected value to be of type string or array, but found ${Nt(ge(e))} instead.`)}eachChild(t){t(this.input);}possibleOutputs(){return [void 0]}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize());})),t}}var DA=OA;class NA{constructor(t,e,A,r){this.type=t,this.input=e,this.beginIndex=A,this.endIndex=r;}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const A=e.parse(t[1],1,Lt),r=e.parse(t[2],2,Qt);if(!A||!r)return null;if(!Gt(A.type,[Dt(Lt),It,Lt]))return e.error(`Expected first argument to be of type array or string, but found ${Nt(A.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Qt);return i?new NA(A.type,A,r,i):null}return new NA(A.type,A,r)}evaluate(t){const e=this.input.evaluate(t),A=this.beginIndex.evaluate(t);if(!Kt(e,["string","array"]))throw new xe(`Expected first argument to be of type array or string, but found ${Nt(ge(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(A,r)}return e.slice(A)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return ["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return ["slice",this.input.serialize(),this.beginIndex.serialize()]}}var kA=NA;class VA{constructor(t,e,A,r,i){this.type=It,this.number=t,this.locale=e,this.currency=A,this.minFractionDigits=r,this.maxFractionDigits=i;}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const A=e.parse(t[1],1,Qt);if(!A)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=e.parse(r.locale,1,It),!i))return null;let n=null;if(r.currency&&(n=e.parse(r.currency,1,It),!n))return null;let s=null;if(r["min-fraction-digits"]&&(s=e.parse(r["min-fraction-digits"],1,Qt),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=e.parse(r["max-fraction-digits"],1,Qt),!a)?null:new VA(A,i,n,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits);}possibleOutputs(){return [void 0]}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class GA{constructor(t,e){this.type=St,this.needle=t,this.haystack=e;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const A=e.parse(t[1],1,Lt),r=e.parse(t[2],2,Lt);return A&&r?Gt(A.type,[St,It,Qt,Mt,Lt])?new GA(A,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(A.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),A=this.haystack.evaluate(t);if(!A)return !1;if(!Kt(e,["boolean","string","number","null"]))throw new xe(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(ge(e))} instead.`);if(!Kt(A,["string","array"]))throw new xe(`Expected second argument to be of type array or string, but found ${Nt(ge(A))} instead.`);return A.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack);}possibleOutputs(){return [void 0]}serialize(){return ["in",this.needle.serialize(),this.haystack.serialize()]}}var KA=GA;class zA{constructor(t){this.type=Ht,this.sections=t;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const A=t[1];if(!Array.isArray(A)&&"object"==typeof A)return e.error("First argument must be an image or text section.");const r=[];let i=!1;for(let A=1;A<=t.length-1;++A){const n=t[A];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Qt),!t))return null;let A=null;if(n["text-font"]&&(A=e.parse(n["text-font"],1,Dt(It)),!A))return null;let s=null;if(n["text-color"]&&(s=e.parse(n["text-color"],1,Tt),!s))return null;const a=r[r.length-1];a.scale=t,a.font=A,a.textColor=s;}else {const n=e.parse(t[A],1,Lt);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null});}}return new zA(r)}evaluate(t){return new pe(this.sections.map((e=>{const A=e.content.evaluate(t);return ge(A)===Ot?new ue("",A,null,null,null):new ue(me(A),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor);}possibleOutputs(){return [void 0]}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const A={};e.scale&&(A["font-scale"]=e.scale.serialize()),e.font&&(A["text-font"]=e.font.serialize()),e.textColor&&(A["text-color"]=e.textColor.serialize()),t.push(A);}return t}}const XA={"==":SA,"!=":TA,">":LA,"<":RA,">=":HA,"<=":PA,array:Ue,at:xA,boolean:_e,case:vA,coalesce:gA,collator:re,format:zA,image:bA,in:KA,"index-of":FA,interpolate:fA,"interpolate-hcl":fA,"interpolate-lab":fA,length:DA,let:BA,literal:we,match:EA,number:_e,"number-format":VA,object:_e,slice:kA,step:lA,string:_e,"to-boolean":Qe,"to-color":Qe,"to-number":Qe,"to-string":Qe,var:iA,within:$e};function qA(t,[e,A,r,i]){e=e.evaluate(t),A=A.evaluate(t),r=r.evaluate(t);const n=i?i.evaluate(t):1,s=fe(e,A,r,n);if(s)throw new xe(s);return new ee(e/255*n,A/255*n,r/255*n,n)}function jA(t,e){return t in e}function YA(t,e){const A=e[t];return void 0===A?null:A}function WA(t){return {type:t}}Re.register(XA,{error:[{kind:"error"},[It],(t,[e])=>{throw new xe(e.evaluate(t))}],typeof:[It,[Lt],(t,[e])=>Nt(ge(e.evaluate(t)))],"to-rgba":[Dt(Qt,4),[Tt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Tt,[Qt,Qt,Qt],qA],rgba:[Tt,[Qt,Qt,Qt,Qt],qA],has:{type:St,overloads:[[[It],(t,[e])=>jA(e.evaluate(t),t.properties())],[[It,Rt],(t,[e,A])=>jA(e.evaluate(t),A.evaluate(t))]]},get:{type:Lt,overloads:[[[It],(t,[e])=>YA(e.evaluate(t),t.properties())],[[It,Rt],(t,[e,A])=>YA(e.evaluate(t),A.evaluate(t))]]},"feature-state":[Lt,[It],(t,[e])=>YA(e.evaluate(t),t.featureState||{})],properties:[Rt,[],t=>t.properties()],"geometry-type":[It,[],t=>t.geometryType()],id:[Lt,[],t=>t.id()],zoom:[Qt,[],t=>t.globals.zoom],"heatmap-density":[Qt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qt,[],t=>t.globals.lineProgress||0],accumulated:[Lt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Qt,WA(Qt),(t,e)=>{let A=0;for(const r of e)A+=r.evaluate(t);return A}],"*":[Qt,WA(Qt),(t,e)=>{let A=1;for(const r of e)A*=r.evaluate(t);return A}],"-":{type:Qt,overloads:[[[Qt,Qt],(t,[e,A])=>e.evaluate(t)-A.evaluate(t)],[[Qt],(t,[e])=>-e.evaluate(t)]]},"/":[Qt,[Qt,Qt],(t,[e,A])=>e.evaluate(t)/A.evaluate(t)],"%":[Qt,[Qt,Qt],(t,[e,A])=>e.evaluate(t)%A.evaluate(t)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(t,[e,A])=>Math.pow(e.evaluate(t),A.evaluate(t))],sqrt:[Qt,[Qt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qt,[Qt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qt,[Qt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qt,[Qt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qt,[Qt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qt,[Qt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qt,[Qt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qt,WA(Qt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Qt,WA(Qt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Qt,[Qt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qt,[Qt],(t,[e])=>{const A=e.evaluate(t);return A<0?-Math.round(-A):Math.round(A)}],floor:[Qt,[Qt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qt,[Qt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[St,[It,Lt],(t,[e,A])=>t.properties()[e.value]===A.value],"filter-id-==":[St,[Lt],(t,[e])=>t.id()===e.value],"filter-type-==":[St,[It],(t,[e])=>t.geometryType()===e.value],"filter-<":[St,[It,Lt],(t,[e,A])=>{const r=t.properties()[e.value],i=A.value;return typeof r==typeof i&&r<i}],"filter-id-<":[St,[Lt],(t,[e])=>{const A=t.id(),r=e.value;return typeof A==typeof r&&A<r}],"filter->":[St,[It,Lt],(t,[e,A])=>{const r=t.properties()[e.value],i=A.value;return typeof r==typeof i&&r>i}],"filter-id->":[St,[Lt],(t,[e])=>{const A=t.id(),r=e.value;return typeof A==typeof r&&A>r}],"filter-<=":[St,[It,Lt],(t,[e,A])=>{const r=t.properties()[e.value],i=A.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[St,[Lt],(t,[e])=>{const A=t.id(),r=e.value;return typeof A==typeof r&&A<=r}],"filter->=":[St,[It,Lt],(t,[e,A])=>{const r=t.properties()[e.value],i=A.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[St,[Lt],(t,[e])=>{const A=t.id(),r=e.value;return typeof A==typeof r&&A>=r}],"filter-like":[St,[It,Lt],(t,[e,A])=>t.properties()[e.value].indexOf(A.value)>=0],"filter-id-like":[St,[Lt],(t,[e])=>t.id().indexOf(e.value)>=0],"filter-type-like":[St,[It],(t,[e])=>t.geometryType().indexOf(e.value)>=0],"filter-start":[St,[It,Lt],(t,[e,A])=>0===t.properties()[e.value].indexOf(A.value)],"filter-id-start":[St,[Lt],(t,[e])=>0===t.id().indexOf(e.value)],"filter-type-start":[St,[It],(t,[e])=>0===t.geometryType().indexOf(e.value)],"filter-end":[St,[It,Lt],(t,[e,A])=>{const r=t.properties()[e.value],i=A.value;return r.slice(-i.length)===i}],"filter-id-end":[St,[Lt],(t,[e])=>{const A=t.id(),r=e.value;return A.slice(-r.length)===r}],"filter-type-end":[St,[It],(t,[e])=>{const A=t.geometryType(),r=e.value;return A.slice(-r.length)===r}],"filter-has":[St,[Lt],(t,[e])=>e.value in t.properties()],"filter-has-id":[St,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[St,[Dt(It)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-type-arrin":[St,[Dt(It)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-arrin":[St,[It,Dt(Lt)],(t,[e,A])=>function(t,e,A,r){for(;A<=r;){if(!t)return !1;if(t.indexOf(e[A])>-1)return !0;A+=1;}return !1}(t.properties()[e.value],A.value,0,A.value.length-1)],"filter-id-in":[St,[Dt(Lt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[St,[It,Dt(Lt)],(t,[e,A])=>A.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[St,[It,Dt(Lt)],(t,[e,A])=>function(t,e,A,r){for(;A<=r;){const i=A+r>>1;if(e[i]===t)return !0;e[i]>t?r=i-1:A=i+1;}return !1}(t.properties()[e.value],A.value,0,A.value.length-1)],all:{type:St,overloads:[[[St,St],(t,[e,A])=>e.evaluate(t)&&A.evaluate(t)],[WA(St),(t,e)=>{for(const A of e)if(!A.evaluate(t))return !1;return !0}]]},any:{type:St,overloads:[[[St,St],(t,[e,A])=>e.evaluate(t)||A.evaluate(t)],[WA(St),(t,e)=>{for(const A of e)if(A.evaluate(t))return !0;return !1}]]},"!":[St,[St],(t,[e])=>!e.evaluate(t)],"is-supported-script":[St,[It],(t,[e])=>{const A=t.globals&&t.globals.isSupportedScript;return !A||A(e.evaluate(t))}],upcase:[It,[It],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[It,[It],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[It,WA(Lt),(t,e)=>e.map((e=>me(e.evaluate(t)))).join("")],"resolved-locale":[It,[Pt],(t,[e])=>e.evaluate(t).resolvedLocale()]});var ZA=XA;function JA(t){return {result:"success",value:t}}function $A(t){return {result:"error",value:t}}function tr(t){return "data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function er(t){return !!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ar(t){return !!t.expression&&t.expression.interpolated}const rr=.95047,ir=1.08883,nr=4/29,sr=6/29,ar=3*sr*sr,or=Math.PI/180,hr=180/Math.PI;function lr(t){return t>.008856451679035631?Math.pow(t,1/3):t/ar+nr}function cr(t){return t>sr?t*t*t:ar*(t-nr)}function ur(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function pr(t){return (t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function dr(t){const e=pr(t.r),A=pr(t.g),r=pr(t.b),i=lr((.4124564*e+.3575761*A+.1804375*r)/rr),n=lr((.2126729*e+.7151522*A+.072175*r)/1);return {l:116*n-16,a:500*(i-n),b:200*(n-lr((.0193339*e+.119192*A+.9503041*r)/ir)),alpha:t.a}}function fr(t){let e=(t.l+16)/116,A=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*cr(e),A=rr*cr(A),r=ir*cr(r),new ee(ur(3.2404542*A-1.5371385*e-.4985314*r),ur(-.969266*A+1.8760108*e+.041556*r),ur(.0556434*A-.2040259*e+1.0572252*r),t.alpha)}function yr(t,e,A){const r=e-t;return t+A*(r>180||r<-180?r-360*Math.round(r/360):r)}const gr={forward:dr,reverse:fr,interpolate:function(t,e,A){return {l:cA(t.l,e.l,A),a:cA(t.a,e.a,A),b:cA(t.b,e.b,A),alpha:cA(t.alpha,e.alpha,A)}}},mr={forward:function(t){const{l:e,a:A,b:r}=dr(t),i=Math.atan2(r,A)*hr;return {h:i<0?i+360:i,c:Math.sqrt(A*A+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*or,A=t.c;return fr({l:t.l,a:Math.cos(e)*A,b:Math.sin(e)*A,alpha:t.alpha})},interpolate:function(t,e,A){return {h:yr(t.h,e.h,A),c:cA(t.c,e.c,A),l:cA(t.l,e.l,A),alpha:cA(t.alpha,e.alpha,A)}}};var Br=Object.freeze({__proto__:null,lab:gr,hcl:mr});function wr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function xr(t){return "object"==typeof t&&null!==t&&!Array.isArray(t)}function Cr(t){return t}function Er(t,e){const A="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],i=r||!(r||void 0!==t.property),n=t.type||(Ar(e)?"exponential":"interval");if(A&&((t=Ct({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],ee.parse(t[1])]))),t.default=ee.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Br[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,o;if("exponential"===n)s=Ur;else if("interval"===n)s=br;else if("categorical"===n){s=vr,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];o=typeof t.stops[0][0];}else {if("identity"!==n)throw new Error(`Unknown function type "${n}"`);s=Fr;}if(r){const A={},r=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],n=i[0].zoom;void 0===A[n]&&(A[n]={zoom:n,type:t.type,property:t.property,default:t.default,stops:[]},r.push(n)),A[n].stops.push([i[0].value,i[1]]);}const i=[];for(const t of r)i.push([A[t].zoom,Er(A[t],e)]);return {kind:"composite",interpolationFactor:fA.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:i.map((t=>t[0])),evaluate:({zoom:A},r)=>Ur({stops:i,base:t.base},e,A).evaluate(A,r)}}return i?{kind:"camera",interpolationFactor:"exponential"===n?fA.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==t.base?t.base:1}):()=>0,zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:A})=>s(t,e,A,a,o)}:{kind:"source",evaluate(A,r){const i=r&&r.properties?r.properties[t.property]:void 0;return void 0===i?_r(t.default,e.default):s(t,e,i,a,o)}}}function _r(t,e,A){return void 0!==t?t:void 0!==e?e:void 0!==A?A:void 0}function vr(t,e,A,r,i){return _r(typeof A===i?r[A]:void 0,t.default,e.default)}function br(t,e,A){if("number"!==wr(A))return _r(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(A<=t.stops[0][0])return t.stops[0][1];if(A>=t.stops[r-1][0])return t.stops[r-1][1];const i=Mr(t.stops,A);return t.stops[i][1]}function Ur(t,e,A){const r=void 0!==t.base?t.base:1;if("number"!==wr(A))return _r(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(A<=t.stops[0][0])return t.stops[0][1];if(A>=t.stops[i-1][0])return t.stops[i-1][1];const n=Mr(t.stops,A),s=function(t,e,A,r){const i=r-A,n=t-A;return 0===i?0:1===e?n/i:(Math.pow(e,n)-1)/(Math.pow(e,i)-1)}(A,r,t.stops[n][0],t.stops[n+1][0]),a=t.stops[n][1],o=t.stops[n+1][1];let h=uA[e.type]||Cr;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Br[t.colorSpace];h=(t,A)=>e.reverse(e.interpolate(e.forward(t),e.forward(A),s));}return "function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),A=o.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==A)return h(e,A,s)}}:h(a,o,s)}function Fr(t,e,A){return "color"===e.type?"x-color"!==e.units&&(A=ee.parse(A)):"formatted"===e.type?A=pe.fromString(A.toString()):"resolvedImage"===e.type?A=de.fromString(A.toString()):wr(A)===e.type||"enum"===e.type&&e.values[A]||(A=void 0),_r(A,t.default,e.default)}function Mr(t,e){let A,r,i=0,n=t.length-1,s=0;for(;i<=n;){if(s=Math.floor((i+n)/2),A=t[s][0],r=t[s+1][0],e===A||e>A&&e<r)return s;A<e?i=s+1:A>e&&(n=s-1);}return Math.max(s-1,0)}class Qr{constructor(t,e){this.expression=t,this._warningHistory={},this._defaultValue=function(t){return "color"===t.type&&xr(t.default)?new ee(0,0,0,0):"color"===t.type?ee.parse(t.default)||null:void 0===t.default?null:t.default}(e),"enum"===e.type&&(this._enumValues=e.values);}evaluateWithoutErrorHandling(t,e,A){return this._evaluator||(this._evaluator=new Se),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=A,this.expression.evaluate(this._evaluator)}evaluate(t,e,A,r,i,n){this._evaluator||(this._evaluator=new Se),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=A,this._evaluator.canonical=r,this._evaluator.availableImages=i,this._evaluator.formattedSection=n;try{const t=this.expression.evaluate(this._evaluator);if(null==t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new xe(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Ir(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ZA}function Sr(t,e){const A=new sA(ZA,[],e?function(t){const e={color:Tt,string:It,number:Qt,enum:It,boolean:St};return "array"===t.type?Dt(e[t.value]||Lt,t.length):e[t.type]||null}(e):void 0),r=A.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?JA(new Qr(r,e)):$A(A.errors)}class Tr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!eA(e.expression);}evaluateWithoutErrorHandling(t,e,A,r,i,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,A,r,i,n)}evaluate(t,e,A,r,i,n){return this._styleExpression.evaluate(t,e,A,r,i,n)}}class Rr{constructor(t,e,A){this.kind=t,this.zoomStops=A.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!eA(e.expression),A instanceof fA&&(this._interpolationType=A.interpolation);}evaluateWithoutErrorHandling(t,e,A,r,i,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,A,r,i,n)}evaluate(t,e,A,r,i,n){return this._styleExpression.evaluate(t,e,A,r,i,n)}interpolationFactor(t,e,A){return this._interpolationType?fA.interpolationFactor(this._interpolationType,t,e,A):0}}function Lr(t,e){if("error"===(t=Sr(t,e)).result)return t;const A=t.value.expression,r=tA(A);if(!r&&!tr(e))return $A([new bt("","data expressions not supported")]);const i=AA(A,["zoom"]);if(!i&&!er(e))return $A([new bt("","zoom expressions not supported")]);const n=Or(A);return n||i?n instanceof bt?$A([n]):n instanceof fA&&!Ar(e)?$A([new bt("",'"interpolate" expressions cannot be used with this property')]):JA(n?new Rr(r?"camera":"composite",t.value,n):new Tr(r?"constant":"source",t.value)):$A([new bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pr{constructor(t,e){this._parameters=t,this._specification=e,Ct(this,Er(this._parameters,this._specification));}static deserialize(t){return new Pr(t._parameters,t._specification)}static serialize(t){return {_parameters:t._parameters,_specification:t._specification}}}function Hr(t,e){if(xr(t))return new Pr(t,e);if(Ir(t)){const A=Lr(t,e);if("error"===A.result)throw new Error(A.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return A.value}{let A=t;return "string"==typeof t&&"color"===e.type&&(A=ee.parse(t)),{kind:"constant",evaluate:()=>A}}}function Or(t){let e=null;if(t instanceof BA)e=Or(t.result);else if(t instanceof gA){for(const A of t.args)if(e=Or(A),e)break}else (t instanceof lA||t instanceof fA)&&t.input instanceof Re&&"zoom"===t.input.name&&(e=t);return e instanceof bt||t.eachChild((t=>{const A=Or(t);A instanceof bt?e=A:!e&&A?e=new bt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&A&&e!==A&&(e=new bt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));})),e}function Dr(t){const e=t.key,A=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},n=t.style,s=t.styleSpec;let a=[];const o=wr(A);if("object"!==o)return [new wt(e,A,`object expected, ${o} found`)];for(const t in A){const o=t.split(".")[0],h=r[o]||r["*"];let l;if(i[o])l=i[o];else if(r[o])l=pi;else if(i["*"])l=i["*"];else {if(!r["*"]){a.push(new wt(e,A[t],`unknown property "${t}"`));continue}l=pi;}a=a.concat(l({key:(e?`${e}.`:e)+t,value:A[t],valueSpec:h,style:n,styleSpec:s,object:A,objectKey:t},A));}for(const t in r)i[t]||r[t].required&&void 0===r[t].default&&void 0===A[t]&&a.push(new wt(e,A,`missing required property "${t}"`));return a}function Nr(t){const e=t.value,A=t.valueSpec,r=t.style,i=t.styleSpec,n=t.key,s=t.arrayElementValidator||pi;if("array"!==wr(e))return [new wt(n,e,`array expected, ${wr(e)} found`)];if(A.length&&e.length!==A.length)return [new wt(n,e,`array length ${A.length} expected, length ${e.length} found`)];if(A["min-length"]&&e.length<A["min-length"])return [new wt(n,e,`array length at least ${A["min-length"]} expected, length ${e.length} found`)];let a={type:A.value};i.$version<7&&(a.function=A.function),"object"===wr(A.value)&&(a=A.value);let o=[];for(let t=0;t<e.length;t++)o=o.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:r,styleSpec:i,key:`${n}[${t}]`}));return o}function kr(t){const e=t.key,A=t.value,r=t.valueSpec,i=wr(A);return "number"!==i?[new wt(e,A,`number expected, ${i} found`)]:"minimum"in r&&A<r.minimum?[new wt(e,A,`${A} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&A>r.maximum?[new wt(e,A,`${A} is greater than the maximum value ${r.maximum}`)]:[]}function Vr(t){const e=t.valueSpec,A=Et(t.value.type);let r,i,n,s={};const a="categorical"!==A&&void 0===t.value.property,o=!a,h="array"===wr(t.value.stops)&&"array"===wr(t.value.stops[0])&&"object"===wr(t.value.stops[0][0]),l=Dr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===A)return [new wt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(Nr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:c})),"array"===wr(r)&&0===r.length&&e.push(new wt(t.key,r,"array must have at least one stop")),e},default:function(t){return pi({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return "identity"===A&&a&&l.push(new wt(t.key,t.value,'missing required property "property"')),"identity"===A||t.value.stops||l.push(new wt(t.key,t.value,'missing required property "stops"')),"exponential"===A&&t.valueSpec.expression&&!Ar(t.valueSpec)&&l.push(new wt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(o&&!tr(t.valueSpec)?l.push(new wt(t.key,t.value,"property functions not supported")):a&&!er(t.valueSpec)&&l.push(new wt(t.key,t.value,"zoom functions not supported"))),"categorical"!==A&&!h||void 0!==t.value.property||l.push(new wt(t.key,t.value,'"property" property is required')),l;function c(t){let A=[];const r=t.value,a=t.key;if("array"!==wr(r))return [new wt(a,r,`array expected, ${wr(r)} found`)];if(2!==r.length)return [new wt(a,r,`array length 2 expected, length ${r.length} found`)];if(h){if("object"!==wr(r[0]))return [new wt(a,r,`object expected, ${wr(r[0])} found`)];if(void 0===r[0].zoom)return [new wt(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return [new wt(a,r,"object stop key must have value")];if(n&&n>Et(r[0].zoom))return [new wt(a,r[0].zoom,"stop zoom values must appear in ascending order")];Et(r[0].zoom)!==n&&(n=Et(r[0].zoom),i=void 0,s={}),A=A.concat(Dr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:kr,value:u}}));}else A=A.concat(u({key:`${a}[0]`,value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return A.concat(pi({key:`${a}[1]`,value:r[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function u(t,n){const a=wr(t.value),o=Et(t.value),h=null!==t.value?t.value:n;if(r){if(a!==r)return [new wt(t.key,h,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return [new wt(t.key,h,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==A){let r=`number expected, ${a} found`;return tr(e)&&void 0===A&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new wt(t.key,h,r)]}return "categorical"!==A||"number"!==a||isFinite(o)&&Math.floor(o)===o?"categorical"!==A&&"number"===a&&void 0!==i&&o<i?[new wt(t.key,h,"stop domain values must appear in ascending order")]:(i=o,"categorical"===A&&o in s?[new wt(t.key,h,"stop domain values must be unique")]:(s[o]=!0,[])):[new wt(t.key,h,`integer expected, found ${o}`)]}}function Gr(t){const e=("property"===t.expressionContext?Lr:Sr)(_t(t.value),t.valueSpec);return "error"===e.result?e.value.map((e=>new wt(`${t.key}${e.key}`,t.value,e.message))):"property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==e.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new wt(t.key,t.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:"property"!==t.expressionContext||"layout"!==t.propertyType||eA(e.value._styleExpression.expression)?[]:[new wt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')]}function Kr(t){const e=t.key,A=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Et(A))&&i.push(new wt(e,A,`expected one of [${r.values.join(", ")}], ${JSON.stringify(A)} found`)):-1===Object.keys(r.values).indexOf(Et(A))&&i.push(new wt(e,A,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(A)} found`)),i}function zr(t){if(!0===t||!1===t)return !0;if(!Array.isArray(t)||0===t.length)return !1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":case"!arrin":case"arrin":case"like":case"!like":return !1;case"==":case"!=":case">":case">=":case"<":case"<=":case"like":case"start":case"end":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!zr(e)&&"boolean"!=typeof e)return !1;return !0;default:return !0}}const Xr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qr(t){if(!t)return ()=>!0;zr(t)||(t=Yr(t));const e=Sr(t,Xr);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return (t,A,r)=>e.value.evaluate(t,A,{},r)}function jr(t,e){return t<e?-1:t>e?1:0}function Yr(t){if(!t)return !0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Wr(t[1],t[2],"=="):"!="===e?ei(Wr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Wr(t[1],t[2],e):"any"===e?(A=t.slice(1),["any"].concat(A.map(Yr))):"all"===e?["all"].concat(t.slice(1).map(Yr)):"none"===e?["all"].concat(t.slice(1).map(Yr).map(ei)):"in"===e?Zr(t[1],t.slice(2)):"!in"===e?ei(Zr(t[1],t.slice(2))):"has"===e?ti(t[1]):"!has"===e?ei(ti(t[1])):"arrin"===e?Jr(t[1],t.slice(2)):"!arrin"===e?ei(Jr(t[1],t.slice(2))):"like"===e?$r(t[1],t.slice(2)):"!like"===e?ei($r(t[1],t.slice(2))):"within"!==e||t;var A;}function Wr(t,e,A){switch(t){case"$type":return [`filter-type-${A}`,e];case"$id":return [`filter-id-${A}`,e];default:return [`filter-${A}`,t,e]}}function Zr(t,e){if(0===e.length)return !1;switch(t){case"$type":return ["filter-type-in",["literal",e]];case"$id":return ["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(jr)]]:["filter-in-small",t,["literal",e]]}}function Jr(t,e){return 0!==e.length&&("$type"===t?["filter-type-arrin",["literal",e]]:["filter-arrin",t,["literal",e]])}function $r(t,e){return 0!==e.length&&("$type"===t?["filter-type-like",["literal",e]]:["filter-like",t,["literal",e]])}function ti(t){switch(t){case"$type":return !0;case"$id":return ["filter-has-id"];default:return ["filter-has",t]}}function ei(t){return ["!",t]}function Ai(t){return zr(_t(t.value))?Gr(Ct({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ri(t)}function ri(t){const e=t.value,A=t.key;if("array"!==wr(e))return [new wt(A,e,`array expected, ${wr(e)} found`)];const r=t.styleSpec;let i,n=[];if(e.length<1)return [new wt(A,e,"filter array must have at least 1 element")];switch(n=n.concat(Kr({key:`${A}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),Et(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Et(e[1])&&n.push(new wt(A,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&n.push(new wt(A,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=wr(e[1]),"string"!==i&&n.push(new wt(`${A}[1]`,e[1],`string expected, ${i} found`)));for(let s=2;s<e.length;s++)i=wr(e[s]),"$type"===Et(e[1])?n=n.concat(Kr({key:`${A}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&n.push(new wt(`${A}[${s}]`,e[s],`string, number, or boolean expected, ${i} found`));break;case"like":case"!like":e.length>=2&&(i=wr(e[1]),"string"!==i&&n.push(new wt(`${A}[1]`,e[1],`string expected, ${i} found`)));for(let s=2;s<e.length;s++)i=wr(e[s]),"$type"===Et(e[1])?n=n.concat(Kr({key:`${A}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&n.push(new wt(`${A}[${s}]`,e[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)n=n.concat(ri({key:`${A}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=wr(e[1]),2!==e.length?n.push(new wt(A,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==i&&n.push(new wt(`${A}[1]`,e[1],`string expected, ${i} found`));break;case"within":i=wr(e[1]),2!==e.length?n.push(new wt(A,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==i&&n.push(new wt(`${A}[1]`,e[1],`object expected, ${i} found`));}return n}function ii(t,e){const A=t.key,r=t.style,i=t.styleSpec,n=t.value,s=t.objectKey,a=i[`${e}_${t.layerType}`];if(!a)return [];const o=s.match(/^(.*)-transition$/);if("paint"===e&&o&&a[o[1]]&&a[o[1]].transition)return pi({key:A,value:n,valueSpec:i.transition,style:r,styleSpec:i});const h=t.valueSpec||a[s];if(!h)return [new wt(A,n,`unknown property "${s}"`)];let l;if("string"===wr(n)&&tr(h)&&!h.tokens&&(l=/^{([^}]+)}$/.exec(n)))return [new wt(A,n,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(l[1])} }\`.`)];const c=[];return "symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&c.push(new wt(A,n,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&xr(_t(n))&&"identity"===Et(n.type)&&c.push(new wt(A,n,'"text-font" does not support identity functions'))),c.concat(pi({key:t.key,value:n,valueSpec:h,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:s}))}function ni(t){return ii(t,"paint")}function si(t){return ii(t,"layout")}function ai(t){let e=[];const A=t.value,r=t.key,i=t.style,n=t.styleSpec;A.type||A.ref||e.push(new wt(r,A,'either "type" or "ref" is required'));let s=Et(A.type);const a=Et(A.ref);if(A.id){const n=Et(A.id);for(let s=0;s<t.arrayIndex;s++){const t=i.layers[s];Et(t.id)===n&&e.push(new wt(r,A.id,`duplicate layer id "${A.id}", previously used at line ${t.id.__line__}`));}}if("ref"in A){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in A&&e.push(new wt(r,A[t],`"${t}" is prohibited for ref layers`));})),i.layers.forEach((e=>{Et(e.id)===a&&(t=e);})),t?t.ref?e.push(new wt(r,A.ref,"ref cannot reference another ref layer")):s=Et(t.type):e.push(new wt(r,A.ref,`ref layer "${a}" not found`));}else if("background"!==s)if(A.source){const t=i.sources&&i.sources[A.source],n=t&&Et(t.type);t?"vector"===n&&"raster"===s?e.push(new wt(r,A.source,`layer "${A.id}" requires a raster source`)):"raster"===n&&"raster"!==s?e.push(new wt(r,A.source,`layer "${A.id}" requires a vector source`)):"vector"!==n||A["source-layer"]?"line"!==s||!A.paint||!A.paint["line-gradient"]||"geojson"===n&&t.lineMetrics||e.push(new wt(r,A,`layer "${A.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new wt(r,A,`layer "${A.id}" must specify a "source-layer"`)):e.push(new wt(r,A.source,`source "${A.source}" not found`));}else e.push(new wt(r,A,'missing required property "source"'));return e=e.concat(Dr({key:r,value:A,valueSpec:n.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pi({key:`${r}.type`,value:A.type,valueSpec:n.layer.type,style:t.style,styleSpec:t.styleSpec,object:A,objectKey:"type"}),filter:Ai,layout:t=>Dr({layer:A,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>si(Ct({layerType:s},t))}}),paint:t=>Dr({layer:A,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ni(Ct({layerType:s},t))}})}})),e}const oi={promoteId:function({key:t,value:e}){if("string"===getType(e))return validateString({key:t,value:e});{const A=[];for(const r in e)A.push(...validateString({key:`${t}.${r}`,value:e[r]}));return A}}};function hi(t){const e=t.value,A=t.key,r=t.styleSpec,i=t.style;if(!e.type)return [new wt(A,e,'"type" is required')];const n=Et(e.type);let s=[];switch(n){case"vector":case"raster":case"raster-dem":if(s=s.concat(Dr({key:A,value:e,valueSpec:r[`source_${n.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:oi})),"url"in e)for(const t in e)["type","url","tileSize"].indexOf(t)<0&&s.push(new wt(`${A}.${t}`,e[t],`a source with a "url" property may not include a "${t}" property`));return s;case"geojson":return Dr({key:A,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:oi});case"video":return Dr({key:A,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Dr({key:A,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return s.push(new wt(A,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),s;case"sphere-image":case"3d-model":case"3d-tiles":return [];default:return Kr({key:`${A}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function li(t){const e=t.value,A=t.styleSpec,r=A.light,i=t.style;let n=[];const s=wr(e);if(void 0===e)return n;if("object"!==s)return n=n.concat([new wt("light",e,`object expected, ${s} found`)]),n;for(const t in e){const s=t.match(/^(.*)-transition$/);n=n.concat(s&&r[s[1]]&&r[s[1]].transition?pi({key:t,value:e[t],valueSpec:A.transition,style:i,styleSpec:A}):r[t]?pi({key:t,value:e[t],valueSpec:r[t],style:i,styleSpec:A}):[new wt(t,e[t],`unknown property "${t}"`)]);}return n}function ci(t){const e=t.value,A=t.key,r=wr(e);return "string"!==r?[new wt(A,e,`string expected, ${r} found`)]:[]}const ui={"*":()=>[],any:()=>[],array:Nr,boolean:function(t){const e=t.value,A=t.key,r=wr(e);return "boolean"!==r?[new wt(A,e,`boolean expected, ${r} found`)]:[]},number:kr,color:function(t){const e=t.key,A=t.value,r=wr(A);return "string"!==r?[new wt(e,A,`color expected, ${r} found`)]:null===$t(A)?[new wt(e,A,`color expected, "${A}" found`)]:[]},constants:xt,enum:Kr,filter:Ai,function:Vr,layer:ai,object:Dr,source:hi,light:li,string:ci,formatted:function(t){return 0===ci(t).length?[]:Gr(t)},resolvedImage:function(t){return 0===ci(t).length?[]:Gr(t)}};function pi(t){const e=t.value,A=t.valueSpec,r=t.styleSpec;if(A.expression&&xr(Et(e)))return Vr(t);if(A.expression&&Ir(_t(e)))return Gr(t);if(A.type&&ui[A.type])return ui[A.type](t);{const e=Dr(Ct({},t,{valueSpec:A.type?r[A.type]:A}));return e||T("not valid"),e}}function di(t){const e=t.value,A=t.key,r=ci(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new wt(A,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new wt(A,e,'"glyphs" url must include a "{range}" token'))),r}function fi(t,e){let A=[];return A=A.concat(pi({key:"",value:t,valueSpec:(e=e||Bt).$root,styleSpec:e,style:t,objectElementValidators:{glyphs:di,"*":()=>[]}})),t.constants&&(A=A.concat(xt({key:"constants",value:t.constants,style:t,styleSpec:e}))),yi(A)}function yi(t){return [].concat(t).sort(((t,e)=>t.line-e.line))}function gi(t){return function(){return yi(t.apply(this,arguments))}}fi.source=gi(hi),fi.light=gi(li),fi.layer=gi(ai),fi.filter=gi(Ai),fi.paintProperty=gi(ni),fi.layoutProperty=gi(si);const mi=fi,Bi=fi.light,wi=fi.paintProperty,xi=fi.layoutProperty;function Ci(t,e){let A=!1;if(e&&e.length)for(const r of e)t.fire(new gt(new Error(r.message))),A=!0;return A}var Ei=_i;function _i(t,e,A){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(A=i[2]);for(var n=0;n<this.d*this.d;n++){var s=i[3+n],a=i[3+n+1];r.push(s===a?null:i.subarray(s,a));}var o=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],o),this.bboxes=i.subarray(o),this.insert=this._insertReadonly;}else {this.d=e+2*A;for(var h=0;h<this.d*this.d;h++)r.push([]);this.keys=[],this.bboxes=[];}this.n=e,this.extent=t,this.padding=A,this.scale=e/t,this.uid=0;var l=A/e*t;this.min=-l,this.max=t+l;}_i.prototype.insert=function(t,e,A,r,i){this._forEachCell(e,A,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(A),this.bboxes.push(r),this.bboxes.push(i);},_i.prototype._insertReadonly=function(){throw "Cannot insert into a GridIndex created from an ArrayBuffer."},_i.prototype._insertCell=function(t,e,A,r,i,n){this.cells[i].push(n);},_i.prototype.query=function(t,e,A,r,i){var n=this.min,s=this.max;if(t<=n&&e<=n&&s<=A&&s<=r&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,A,r,this._queryCell,a,{},i),a},_i.prototype._queryCell=function(t,e,A,r,i,n,s,a){var o=this.cells[i];if(null!==o)for(var h=this.keys,l=this.bboxes,c=0;c<o.length;c++){var u=o[c];if(void 0===s[u]){var p=4*u;(a?a(l[p+0],l[p+1],l[p+2],l[p+3]):t<=l[p+2]&&e<=l[p+3]&&A>=l[p+0]&&r>=l[p+1])?(s[u]=!0,n.push(h[u])):s[u]=!1;}}},_i.prototype._forEachCell=function(t,e,A,r,i,n,s,a){for(var o=this._convertToCellCoord(t),h=this._convertToCellCoord(e),l=this._convertToCellCoord(A),c=this._convertToCellCoord(r),u=o;u<=l;u++)for(var p=h;p<=c;p++){var d=this.d*p+u;if((!a||a(this._convertFromCellCoord(u),this._convertFromCellCoord(p),this._convertFromCellCoord(u+1),this._convertFromCellCoord(p+1)))&&i.call(this,t,e,A,r,d,n,s,a))return}},_i.prototype._convertFromCellCoord=function(t){return (t-this.padding)/this.scale},_i.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},_i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,A=0,r=0;r<this.cells.length;r++)A+=this.cells[r].length;var i=new Int32Array(e+A+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var n=e,s=0;s<t.length;s++){var a=t[s];i[3+s]=n,i.set(a,n),n+=a.length;}return i[3+t.length]=n,i.set(this.keys,n),i[3+t.length+1]=n+=this.keys.length,i.set(this.bboxes,n),n+=this.bboxes.length,i.buffer};const{ImageData:vi,ImageBitmap:bi}=A,Ui={};function Fi(t,e,A={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ui[t]={klass:e,omit:A.omit||[],shallow:A.shallow||[]};}Fi("Object",Object),Ei.serialize=function(t,e){const A=t.toArrayBuffer();return e&&e.push(A),A},Ei.deserialize=function(t){return new Ei(t)},Fi("Grid",Ei),Fi("Color",ee),Fi("Error",Error),Fi("StylePropertyFunction",Pr),Fi("StyleExpression",Qr,{omit:["_evaluator"]}),Fi("ZoomDependentExpression",Rr),Fi("ZoomConstantExpression",Tr),Fi("CompoundExpression",Re,{omit:["_evaluate"]});for(const t in ZA)ZA[t]._classRegistryKey||Fi(`Expression_${t}`,ZA[t]);function Mi(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Qi(t){return bi&&t instanceof bi}function Ii(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof A.Blob)return t;if(Mi(t)||Qi(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const A=t;return e&&e.push(A.buffer),A}if(t instanceof vi)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const A=[];for(const r of t)A.push(Ii(r,e));return A}if("object"==typeof t){const A=t.constructor,r=A._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");const i={};if(A.serialize)i._serialized=A.serialize(t,e);else {for(const A in t){if(!t.hasOwnProperty(A))continue;if(Ui[r].omit.indexOf(A)>=0)continue;const n=t[A];i[A]=Ui[r].shallow.indexOf(A)>=0?n:Ii(n,e);}t instanceof Error&&(i.message=t.message);}return {name:r,properties:i}}throw new Error("can't serialize object of type "+typeof t)}function Si(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Mi(t)||Qi(t)||ArrayBuffer.isView(t)||t instanceof vi||t instanceof A.Blob)return t;if(Array.isArray(t))return t.map((t=>Si(t)));if("object"==typeof t){const{name:e,properties:A}=t;if(!e)throw new Error("can't deserialize object of anonymous class");const{klass:r}=Ui[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(A._serialized);const i=Object.create(r.prototype);for(const t of Object.keys(A))i[t]=Ui[e].shallow.indexOf(t)>=0?A[t]:Si(A[t]);return i}throw new Error("can't deserialize object of type "+typeof t)}class Ti{constructor(){this.first=!0;}update(t,e){const A=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=A,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=A,!0):(this.lastFloorZoom>A?(this.lastIntegerZoom=A+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<A&&(this.lastIntegerZoom=A,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=A,!0))}}const Ri="deferred",Li="loading",Pi="loaded";let Hi=null,Oi="unavailable",Di=null;const Ni=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Oi="error"),Hi&&Hi(t);};function ki(){Vi.fire(new yt("pluginStateChange",{pluginStatus:Oi,pluginURL:Di}));}const Vi=new mt,Gi=function(){return Oi},Ki=function(){if(Oi!==Ri||!Di)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Oi=Li,ki(),Di&&ht({url:Di},(t=>{t?Ni(t):(Oi=Pi,ki());}));},zi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Oi===Pi||null!=zi.applyArabicShaping,isLoading:()=>Oi===Li,setState(t){Oi=t.pluginStatus,Di=t.pluginURL;},isParsed:()=>null!=zi.applyArabicShaping&&null!=zi.processBidirectionalText&&null!=zi.processStyledBidirectionalText,getPluginURL:()=>Di};class Xi{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ti,this.transition={});}isSupportedScript(t){return function(t,e){for(const A of t)if(!le(A.charCodeAt(0),e))return !1;return !0}(t,zi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),A=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*A}:{fromScale:.5,toScale:1,t:1-(1-A)*e}}}function qi(t,e,A){var r=2*Math.PI*6378137/256/Math.pow(2,A);return [t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}var ji=8192;class Yi{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]));}setNorthEast(t){return this._ne=t instanceof Zi?new Zi(t.lng,t.lat):Zi.convert(t),this}setSouthWest(t){return this._sw=t instanceof Zi?new Zi(t.lng,t.lat):Zi.convert(t),this}extend(t){const e=this._sw,A=this._ne;let r,i;if(t instanceof Zi)r=t,i=t;else {if(!(t instanceof Yi))return Array.isArray(t)?t.every(Array.isArray)?this.extend(Yi.convert(t)):this.extend(Zi.convert(t)):this;if(r=t._sw,i=t._ne,!r||!i)return this}return e||A?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),A.lng=Math.max(i.lng,A.lng),A.lat=Math.max(i.lat,A.lat)):(this._sw=new Zi(r.lng,r.lat),this._ne=new Zi(i.lng,i.lat)),this}getCenter(){return new Zi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Zi(this.getWest(),this.getNorth())}getSouthEast(){return new Zi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return [this._sw.toArray(),this._ne.toArray()]}toString(){return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return !(this._sw&&this._ne)}contains(t){const{lng:e,lat:A}=Zi.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=A&&A<=this._ne.lat&&r}static convert(t){return !t||t instanceof Yi?t:new Yi(t)}}const Wi=$.TRANSFORM.R;class Zi{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zi(C(this.lng,-180,180),this.lat)}toArray(){return [this.lng,this.lat]}toString(){return `LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,A=this.lat*e,r=t.lat*e,i=Math.sin(A)*Math.sin(r)+Math.cos(A)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Wi*Math.acos(Math.min(i,1))}toBounds(t=0){const e=360*t/40075017,A=e/Math.cos(Math.PI/180*this.lat);return new Yi(new Zi(this.lng-A,this.lat-e),new Zi(this.lng+A,this.lat+e))}static convert(t){if(t instanceof Zi)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Zi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Zi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ji=2*Math.PI*Wi;function $i(t){return Ji*Math.cos(t*Math.PI/180)}function tn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class en{constructor(t,e,A=0){this.x=+t,this.y=+e,this.z=+A;}static fromLngLat(t,e=0){const A=Zi.convert(t);return new en((180+A.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A.lat*Math.PI/360)))/360,function(t,e){return t/$i(e)}(e,A.lat))}toLngLat(){return new Zi(360*this.x-180,tn(this.y))}toAltitude(){return this.z*$i(tn(this.y))}meterInMercatorCoordinateUnits(){return 1/Ji*(t=tn(this.y),1/Math.cos(t*Math.PI/180));var t;}}class An{constructor(t,e,A,r){this.z=t,this.x=e,this.y=A,this.key=sn(0,t,e,A);}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}terrainUrl(t,e,A){let r="tms"===A?Math.pow(2,this.z)-this.y-1:this.y;r=Math.floor(r/Math.pow(2,e));const i=Math.floor(this.x/Math.pow(2,e)),n=this.z-e;return t[(i+r)%t.length].replace("{prefix}",(i%16).toString(16)+(r%16).toString(16)).replace(/\{z\}/g,String(n)).replace(/\{x\}/g,String(i)).replace(/\{y\}/g,String(r)).replace(/\{m\}/g,String(Math.floor(i/16))).replace(/\{n\}/g,String(Math.floor(r/16))).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}url(t,e){const A=function(t,e,A){var r=qi(256*t,256*(e=Math.pow(2,A)-e-1),A),i=qi(256*(t+1),256*(e+1),A);return r[0]+","+r[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),r=function(t,e,A){let r,i="";for(let n=t;n>0;n--)r=1<<n-1,i+=(e&r?1:0)+(A&r?2:0);return i}(this.z,this.x,this.y),i="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(this.x)).replace(/\{y\}/g,String(i)).replace(/\{m\}/g,String(Math.floor(this.x/16))).replace(/\{n\}/g,String(Math.floor(i/16))).replace("{quadkey}",r).replace("{bbox-epsg-3857}",A).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}_getC(){return this.z>6?`C${Math.floor(Math.floor(this.x/(1<<this.z-5)))}`:"C0"}_getR(){return this.z>6?`R${Math.floor(Math.floor(this.y/(1<<this.z-5)))}`:"R0"}toRealCoord(t){const e="tms"===t?Math.pow(2,this.z)-this.y-1:this.y;return {x:this.x,y:e,z:this.z}}getTilePoint(t){return new l((t.x-this.x)*ji,(t.y-this.y)*ji)}}class rn{constructor(t,e){this.wrap=t,this.canonical=e,this.key=sn(0,e.z,e.x,e.y);}}class nn{constructor(t,e,A,r,i,n){this.projection=n?"LATLON":"MERCATOR",this.overscaledZ=t,this.wrap=e,this.canonical=new An(A,+r,+i,this.projection),this.key=sn(0,t,r,i);}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}static getParentTileId(t){return new nn(t.overscaledZ-1,0,t.canonical.z-1,Math.floor(t.canonical.x/2),Math.floor(t.canonical.y/2))}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new nn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nn(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}isChildOf(t){const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return [new nn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,A=2*this.canonical.x,r=2*this.canonical.y;return [new nn(e,this.wrap,e,A,r),new nn(e,this.wrap,e,A+1,r),new nn(e,this.wrap,e,A,r+1),new nn(e,this.wrap,e,A+1,r+1)]}isLessThan(t){return "string"!=typeof t&&(this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y)))}wrapped(){return new nn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new nn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rn(this.wrap,this.canonical)}toString(){return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}toCoordinate(){return new h(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)}getTilePoint(t){return this.canonical.getTilePoint(new en(t.x-this.wrap,t.y))}}function sn(t,e,A,r){return `${e}_${A}_${r}`}Fi("CanonicalTileID",An),Fi("OverscaledTileID",nn,{omit:["posMatrix"]});class an{constructor(t,e){this.property=t,this.value=e,this.expression=Hr(void 0===e?t.specification.default:e,t.specification);}isDataDriven(){return "source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,A){return this.property.possiblyEvaluate(this,t,e,A)}}class on{constructor(t){this.property=t,this.value=new an(t,void 0);}transitioned(t,e){return new ln(this.property,this.value,e,_({},t.transition,this.transition),t.now)}untransitioned(){return new ln(this.property,this.value,null,{},0)}}class hn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues);}getValue(t){return I(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new on(this._values[t].property)),this._values[t].value=new an(this._values[t].property,null===e?void 0:I(e));}getTransition(t){return I(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new on(this._values[t].property)),this._values[t].transition=I(e)||void 0;}serialize(){const t={};for(const e of Object.keys(this._values)){const A=this.getValue(e);void 0!==A&&(t[e]=A);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r);}return t}transitioned(t,e){const A=new cn(this._properties);for(const r of Object.keys(this._values))A._values[r]=this._values[r].transitioned(t,e._values[r]);return A}untransitioned(){const t=new cn(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class ln{constructor(t,e,A,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=A);}possiblyEvaluate(t,e,A){const r=t.now||0,i=this.value.possiblyEvaluate(t,e,A),n=this.prior;if(n){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return n.possiblyEvaluate(t,e,A);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(n.possiblyEvaluate(t,e,A),i,p(s))}}return i}}class cn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues);}possiblyEvaluate(t,e,A){const r=new dn(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,A);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return !0;return !1}}class un{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues);}getValue(t){return I(this._values[t].value)}setValue(t,e){this._values[t]=new an(this._values[t].property,null===e?void 0:I(e));}serialize(){const t={};for(const e of Object.keys(this._values)){const A=this.getValue(e);void 0!==A&&(t[e]=A);}return t}possiblyEvaluate(t,e,A){const r=new dn(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,A);return r}}class pn{constructor(t,e,A){this.property=t,this.value=e,this.parameters=A;}isConstant(){return "constant"===this.value.kind}constantOr(t){return "constant"===this.value.kind?this.value.value:t}evaluate(t,e,A,r){return this.property.evaluate(this.value,this.parameters,t,e,A,r)}}class dn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues);}get(t){return this._values[t]}}class fn{constructor(t){this.specification=t;}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,A){const r=uA[this.specification.type];return r?r(t,e,A):t}}class yn{constructor(t,e){this.specification=t,this.overrides=e;}possiblyEvaluate(t,e,A,r){return new pn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},A,r)}:t.expression,e)}interpolate(t,e,A){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new pn(this,{kind:"constant",value:void 0},t.parameters);const r=uA[this.specification.type];return r?new pn(this,{kind:"constant",value:r(t.value.value,e.value.value,A)},t.parameters):t}evaluate(t,e,A,r,i,n){return "constant"===t.kind?t.value:t.evaluate(e,A,r,i,n)}}class gn extends yn{possiblyEvaluate(t,e,A,r){if(void 0===t.value)return new pn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},A,r),n="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,s=this._calculate(n,n,n,e);return new pn(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const A=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new pn(this,{kind:"constant",value:A},e)}return new pn(this,t.expression,e)}evaluate(t,e,A,r,i,n){if("source"===t.kind){const s=t.evaluate(e,A,r,i,n);return this._calculate(s,s,s,e)}return "composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},A,r),t.evaluate({zoom:Math.floor(e.zoom)},A,r),t.evaluate({zoom:Math.floor(e.zoom)+1},A,r),e):t.value}_calculate(t,e,A,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:A,to:e}}interpolate(t){return t}}class mn{constructor(t){this.specification=t;}possiblyEvaluate(t,e,A,r){if(void 0!==t.value){if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},A,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new Xi(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Xi(Math.floor(e.zoom),e)),t.expression.evaluate(new Xi(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,A,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:A,to:e}}interpolate(t){return t}}class Bn{constructor(t){this.specification=t;}possiblyEvaluate(t,e,A,r){return !!t.expression.evaluate(e,null,{},A,r)}interpolate(){return !1}}class wn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const A=t[e];A.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new an(A,void 0),i=this.defaultTransitionablePropertyValues[e]=new on(A);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({});}}}Fi("DataDrivenProperty",yn),Fi("DataConstantProperty",fn),Fi("CrossFadedDataDrivenProperty",gn),Fi("CrossFadedProperty",mn),Fi("ColorRampProperty",Bn);var xn=Object.freeze({TERRAIN:0,MINEMAP_3D_TILE:1,BOTH:2,SINGULARIZATION:3,NONE:4,ALL:5,IGNORECLASSIFICATION:6,NUMBER_OF_CLASSIFICATION_TYPES:6});const Cn="-transition";class En extends mt{constructor(t,e){if(super(),this.id=t.id,this._featureFilter=()=>!0,"custom"!==t.type){if(this.metadata=t.metadata,this.type=t.type,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.visibility="visible",this.depthTest=t["depth-test"]||!1,this.shadowCenter=t["shadow-center"],"background"!==t.type&&"panorama"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e&&e.layout&&(this._unevaluatedLayout=new un(e.layout)),e&&e.paint){this._transitionablePaint=new hn(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}t.clipGround&&(this.clipGround=!0),"3d-model"!==t.type&&"3d-tiles"!==t.type&&"extrusion"!==t.type||(this.usePBR=null!=t.usePBR?t.usePBR:Bt.layer.usePBR.default,this.phongLight=t.phongLight?t.phongLight:Bt.layer.phongLight.default,this.phongLightConfig=Object.assign({Ambient:Bt.phongLightConfig.Ambient.default,Diffuse:Bt.phongLightConfig.Diffuse.default,SpecularColor:Bt.phongLightConfig.SpecularColor.default,Shininess:Bt.phongLightConfig.Shininess.default},t.phongLightConfig)),"circle"!==t.type&&"line"!==t.type&&"fill"!==t.type&&"3d-model"!==t.type||(this.classificationType=t.classificationType),this.useLayerPosition=!1;}}getLayoutProperty(t){return "visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,A){null!=e&&this._validate(xi,`layers.${this.id}.layout.${t}`,t,e,A)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible");}getPaintProperty(t){return F(t,Cn)?this._transitionablePaint.getTransition(t.slice(0,-Cn.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,A){if(null!=e&&this._validate(wi,`layers.${this.id}.paint.${t}`,t,e,A))return !1;if(F(t,Cn))return this._transitionablePaint.setTransition(t.slice(0,-Cn.length),e||void 0),!1;{const A=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);const r=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),r||A}}_handleSpecialPaintPropertyUpdate(t){}isHidden(t){return !!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint);}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e);}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,_original_style:this._original_style,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize(),enableQuery:this.enableQuery,vectorRenderInSpace:this.vectorRenderInSpace,classificationType:this.classificationType};return "none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),Q(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,A,r,i){return (!i||!1!==i.validate)&&Ci(this,t.call(mi,{key:e,layerType:this.type,objectKey:A,value:r,styleSpec:Bt,style:{glyphs:!0,sprite:!0}}))}hasOffscreenPass(){return !1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof pn&&tr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return !0}return !1}clearPick(){}}var _n={paint:new wn({"background-color":new fn(Bt.paint_background["background-color"]),"background-pattern":new mn(Bt.paint_background["background-pattern"]),"background-pattern-fixed":new fn(Bt.paint_background["background-pattern-fixed"]),"background-opacity":new fn(Bt.paint_background["background-opacity"])})},vn={paint:new wn({"raster-opacity":new fn(Bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new fn(Bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new fn(Bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new fn(Bt.paint_raster["raster-brightness-max"]),"raster-saturation":new fn(Bt.paint_raster["raster-saturation"]),"raster-contrast":new fn(Bt.paint_raster["raster-contrast"]),"raster-resampling":new fn(Bt.paint_raster["raster-resampling"]),"raster-fade-duration":new fn(Bt.paint_raster["raster-fade-duration"])})};const bn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Un{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;}}class Fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0);}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());}clear(){this.length=0;}resize(t){this.reserve(t),this.length=t;}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e);}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Mn(t,e=1){let A=0,r=0;return {members:t.map((t=>{const i=bn[t.type].BYTES_PER_ELEMENT,n=A=Qn(A,Math.max(e,i)),s=t.components||1;return r=Math.max(r,i),A+=i*s,{name:t.name,type:t.type,components:s,offset:n}})),size:Qn(A,Math.max(r,e)),alignment:e}}function Qn(t,e){return Math.ceil(t/e)*e}class In extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e){const A=this.length;this.resize(A+1);const r=2*A;return this.int16[r+0]=t,this.int16[r+1]=e,A}emplace(t,e,A){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=A,t}}In.prototype.bytesPerElement=4,Fi("StructArrayLayout2i4",In);class Sn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,A,r){const i=this.length;this.resize(i+1);const n=4*i;return this.int16[n+0]=t,this.int16[n+1]=e,this.int16[n+2]=A,this.int16[n+3]=r,i}emplace(t,e,A,r,i){const n=4*t;return this.int16[n+0]=e,this.int16[n+1]=A,this.int16[n+2]=r,this.int16[n+3]=i,t}}Sn.prototype.bytesPerElement=8,Fi("StructArrayLayout4i8",Sn);class Tn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i){const n=this.length;this.resize(n+1);const s=5*n;return this.float32[s+0]=t,this.float32[s+1]=e,this.float32[s+2]=A,this.float32[s+3]=r,this.float32[s+4]=i,n}emplace(t,e,A,r,i,n){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=A,this.float32[s+2]=r,this.float32[s+3]=i,this.float32[s+4]=n,t}}Tn.prototype.bytesPerElement=20,Fi("StructArrayLayout5f20",Tn);class Rn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a){const o=this.length;this.resize(o+1);const h=8*o;return this.float32[h+0]=t,this.float32[h+1]=e,this.float32[h+2]=A,this.float32[h+3]=r,this.float32[h+4]=i,this.float32[h+5]=n,this.float32[h+6]=s,this.float32[h+7]=a,o}emplace(t,e,A,r,i,n,s,a,o){const h=8*t;return this.float32[h+0]=e,this.float32[h+1]=A,this.float32[h+2]=r,this.float32[h+3]=i,this.float32[h+4]=n,this.float32[h+5]=s,this.float32[h+6]=a,this.float32[h+7]=o,t}}Rn.prototype.bytesPerElement=32,Fi("StructArrayLayout8f32",Rn);class Ln extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i){const n=this.length;this.resize(n+1);const s=4*n,a=16*n;return this.float32[s+0]=t,this.float32[s+1]=e,this.float32[s+2]=A,this.int8[a+12]=r,this.int8[a+13]=i,n}emplace(t,e,A,r,i,n){const s=4*t,a=16*t;return this.float32[s+0]=e,this.float32[s+1]=A,this.float32[s+2]=r,this.int8[a+12]=i,this.int8[a+13]=n,t}}Ln.prototype.bytesPerElement=16,Fi("StructArrayLayout3f2b16",Ln);class Pn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o){const h=this.length;this.resize(h+1);const l=9*h;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=A,this.float32[l+3]=r,this.float32[l+4]=i,this.float32[l+5]=n,this.float32[l+6]=s,this.float32[l+7]=a,this.float32[l+8]=o,h}emplace(t,e,A,r,i,n,s,a,o,h){const l=9*t;return this.float32[l+0]=e,this.float32[l+1]=A,this.float32[l+2]=r,this.float32[l+3]=i,this.float32[l+4]=n,this.float32[l+5]=s,this.float32[l+6]=a,this.float32[l+7]=o,this.float32[l+8]=h,t}}Pn.prototype.bytesPerElement=36,Fi("StructArrayLayout3f3f3f36",Pn);class Hn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l,c){const u=this.length;this.resize(u+1);const p=6*u,d=24*u;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=A,this.int8[d+12]=r,this.int8[d+13]=i,this.uint8[d+16]=n,this.uint8[d+17]=s,this.uint8[d+18]=a,this.uint8[d+19]=o,this.uint8[d+20]=h,this.uint8[d+21]=l,this.uint8[d+22]=c,u}emplace(t,e,A,r,i,n,s,a,o,h,l,c,u){const p=6*t,d=24*t;return this.float32[p+0]=e,this.float32[p+1]=A,this.float32[p+2]=r,this.int8[d+12]=i,this.int8[d+13]=n,this.uint8[d+16]=s,this.uint8[d+17]=a,this.uint8[d+18]=o,this.uint8[d+19]=h,this.uint8[d+20]=l,this.uint8[d+21]=c,this.uint8[d+22]=u,t}}Hn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2b4ub3ub24",Hn);class On extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h){const l=this.length;this.resize(l+1);const c=6*l,u=24*l;return this.float32[c+0]=t,this.float32[c+1]=e,this.float32[c+2]=A,this.uint8[u+12]=r,this.uint8[u+16]=i,this.uint8[u+17]=n,this.uint8[u+18]=s,this.uint8[u+19]=a,this.uint8[u+20]=o,this.uint8[u+21]=h,l}emplace(t,e,A,r,i,n,s,a,o,h,l){const c=6*t,u=24*t;return this.float32[c+0]=e,this.float32[c+1]=A,this.float32[c+2]=r,this.uint8[u+12]=i,this.uint8[u+16]=n,this.uint8[u+17]=s,this.uint8[u+18]=a,this.uint8[u+19]=o,this.uint8[u+20]=h,this.uint8[u+21]=l,t}}On.prototype.bytesPerElement=24,Fi("StructArrayLayout3f1ub4ub2ub24",On);class Dn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l){const c=this.length;this.resize(c+1);const u=7*c,p=28*c,d=14*c;return this.float32[u+0]=t,this.float32[u+1]=e,this.float32[u+2]=A,this.uint8[p+12]=r,this.uint8[p+16]=i,this.uint8[p+17]=n,this.uint8[p+18]=s,this.uint8[p+19]=a,this.uint16[d+10]=o,this.uint16[d+12]=h,this.uint16[d+13]=l,c}emplace(t,e,A,r,i,n,s,a,o,h,l,c){const u=7*t,p=28*t,d=14*t;return this.float32[u+0]=e,this.float32[u+1]=A,this.float32[u+2]=r,this.uint8[p+12]=i,this.uint8[p+16]=n,this.uint8[p+17]=s,this.uint8[p+18]=a,this.uint8[p+19]=o,this.uint16[d+10]=h,this.uint16[d+12]=l,this.uint16[d+13]=c,t}}Dn.prototype.bytesPerElement=28,Fi("StructArrayLayout3f1ub4ub1ui2ui28",Dn);class Nn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A){const r=this.length;this.resize(r+1);const i=3*r;return this.float32[i+0]=t,this.float32[i+1]=e,this.float32[i+2]=A,r}emplace(t,e,A,r){const i=3*t;return this.float32[i+0]=e,this.float32[i+1]=A,this.float32[i+2]=r,t}}Nn.prototype.bytesPerElement=12,Fi("StructArrayLayout3f12",Nn);class kn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h){const l=this.length;this.resize(l+1);const c=6*l,u=24*l,p=12*l;return this.float32[c+0]=t,this.float32[c+1]=e,this.float32[c+2]=A,this.int8[u+12]=r,this.int8[u+13]=i,this.uint8[u+16]=n,this.uint8[u+17]=s,this.uint8[u+18]=a,this.uint8[u+19]=o,this.uint16[p+10]=h,l}emplace(t,e,A,r,i,n,s,a,o,h,l){const c=6*t,u=24*t,p=12*t;return this.float32[c+0]=e,this.float32[c+1]=A,this.float32[c+2]=r,this.int8[u+12]=i,this.int8[u+13]=n,this.uint8[u+16]=s,this.uint8[u+17]=a,this.uint8[u+18]=o,this.uint8[u+19]=h,this.uint16[p+10]=l,t}}kn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2b4ub1ui24",kn);class Vn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i){const n=this.length;this.resize(n+1);const s=4*n,a=8*n;return this.float32[s+0]=t,this.float32[s+1]=e,this.float32[s+2]=A,this.int16[a+6]=r,this.int16[a+7]=i,n}emplace(t,e,A,r,i,n){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=A,this.float32[s+2]=r,this.int16[a+6]=i,this.int16[a+7]=n,t}}Vn.prototype.bytesPerElement=16,Fi("StructArrayLayout3f2i16",Vn);class Gn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l){const c=this.length;this.resize(c+1);const u=6*c,p=24*c,d=12*c;return this.float32[u+0]=t,this.float32[u+1]=e,this.float32[u+2]=A,this.int8[p+12]=r,this.int8[p+13]=i,this.uint8[p+16]=n,this.uint8[p+17]=s,this.uint8[p+18]=a,this.uint8[p+19]=o,this.uint16[d+10]=h,this.uint16[d+11]=l,c}emplace(t,e,A,r,i,n,s,a,o,h,l,c){const u=6*t,p=24*t,d=12*t;return this.float32[u+0]=e,this.float32[u+1]=A,this.float32[u+2]=r,this.int8[p+12]=i,this.int8[p+13]=n,this.uint8[p+16]=s,this.uint8[p+17]=a,this.uint8[p+18]=o,this.uint8[p+19]=h,this.uint16[d+10]=l,this.uint16[d+11]=c,t}}Gn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2b4ub2ui24",Gn);class Kn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e){const A=this.length;this.resize(A+1);const r=2*A;return this.float32[r+0]=t,this.float32[r+1]=e,A}emplace(t,e,A){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=A,t}}Kn.prototype.bytesPerElement=8,Fi("StructArrayLayout2f8",Kn);class zn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.uint32[1*e+0]=t,e}emplace(t,e){return this.uint32[1*t+0]=e,t}}zn.prototype.bytesPerElement=4,Fi("StructArrayLayout1ul4",zn);class Xn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l){const c=this.length;this.resize(c+1);const u=12*c,p=6*c;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=A,this.int16[u+3]=r,this.int16[u+4]=i,this.int16[u+5]=n,this.uint32[p+3]=s,this.uint16[u+8]=a,this.uint16[u+9]=o,this.int16[u+10]=h,this.int16[u+11]=l,c}emplace(t,e,A,r,i,n,s,a,o,h,l,c){const u=12*t,p=6*t;return this.int16[u+0]=e,this.int16[u+1]=A,this.int16[u+2]=r,this.int16[u+3]=i,this.int16[u+4]=n,this.int16[u+5]=s,this.uint32[p+3]=a,this.uint16[u+8]=o,this.uint16[u+9]=h,this.int16[u+10]=l,this.int16[u+11]=c,t}}Xn.prototype.bytesPerElement=24,Fi("StructArrayLayout6i1ul2ui2i24",Xn);class qn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer);}emplaceBack(t,e){const A=this.length;this.resize(A+1);const r=4*A;return this.uint8[r+0]=t,this.uint8[r+1]=e,A}emplace(t,e,A){const r=4*t;return this.uint8[r+0]=e,this.uint8[r+1]=A,t}}qn.prototype.bytesPerElement=4,Fi("StructArrayLayout2ub4",qn);class jn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l,c,u,p){const d=this.length;this.resize(d+1);const f=20*d,y=10*d,g=40*d;return this.int16[f+0]=t,this.int16[f+1]=e,this.uint16[f+2]=A,this.uint16[f+3]=r,this.uint32[y+2]=i,this.uint32[y+3]=n,this.uint32[y+4]=s,this.uint16[f+10]=a,this.uint16[f+11]=o,this.uint16[f+12]=h,this.float32[y+7]=l,this.float32[y+8]=c,this.uint8[g+36]=u,this.uint8[g+37]=p,d}emplace(t,e,A,r,i,n,s,a,o,h,l,c,u,p,d){const f=20*t,y=10*t,g=40*t;return this.int16[f+0]=e,this.int16[f+1]=A,this.uint16[f+2]=r,this.uint16[f+3]=i,this.uint32[y+2]=n,this.uint32[y+3]=s,this.uint32[y+4]=a,this.uint16[f+10]=o,this.uint16[f+11]=h,this.uint16[f+12]=l,this.float32[y+7]=c,this.float32[y+8]=u,this.uint8[g+36]=p,this.uint8[g+37]=d,t}}jn.prototype.bytesPerElement=40,Fi("StructArrayLayout2i2ui3ul3ui2f2ub40",jn);class Yn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.float32[1*e+0]=t,e}emplace(t,e){return this.float32[1*t+0]=e,t}}Yn.prototype.bytesPerElement=4,Fi("StructArrayLayout1f4",Yn);class Wn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,A){const r=this.length;this.resize(r+1);const i=3*r;return this.int16[i+0]=t,this.int16[i+1]=e,this.int16[i+2]=A,r}emplace(t,e,A,r){const i=3*t;return this.int16[i+0]=e,this.int16[i+1]=A,this.int16[i+2]=r,t}}Wn.prototype.bytesPerElement=6,Fi("StructArrayLayout3i6",Wn);class Zn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o){const h=this.length;this.resize(h+1);const l=6*h,c=12*h;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=A,this.int16[c+6]=r,this.int16[c+7]=i,this.uint16[c+8]=n,this.uint16[c+9]=s,this.uint16[c+10]=a,this.uint16[c+11]=o,h}emplace(t,e,A,r,i,n,s,a,o,h){const l=6*t,c=12*t;return this.float32[l+0]=e,this.float32[l+1]=A,this.float32[l+2]=r,this.int16[c+6]=i,this.int16[c+7]=n,this.uint16[c+8]=s,this.uint16[c+9]=a,this.uint16[c+10]=o,this.uint16[c+11]=h,t}}Zn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2i4ui24",Zn);class Jn extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s){const a=this.length;this.resize(a+1);const o=5*a,h=10*a;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=A,this.int16[h+6]=r,this.int16[h+7]=i,this.int16[h+8]=n,this.int16[h+9]=s,a}emplace(t,e,A,r,i,n,s,a){const o=5*t,h=10*t;return this.float32[o+0]=e,this.float32[o+1]=A,this.float32[o+2]=r,this.int16[h+6]=i,this.int16[h+7]=n,this.int16[h+8]=s,this.int16[h+9]=a,t}}Jn.prototype.bytesPerElement=20,Fi("StructArrayLayout3f2i2i20",Jn);class $n extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A,r,i,n,s,a,o,h,l,c){const u=this.length;this.resize(u+1);const p=8*u,d=16*u;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=A,this.int16[d+6]=r,this.int16[d+7]=i,this.uint16[d+8]=n,this.uint16[d+9]=s,this.uint16[d+10]=a,this.uint16[d+11]=o,this.uint16[d+12]=h,this.uint16[d+13]=l,this.uint16[d+14]=c,u}emplace(t,e,A,r,i,n,s,a,o,h,l,c,u){const p=8*t,d=16*t;return this.float32[p+0]=e,this.float32[p+1]=A,this.float32[p+2]=r,this.int16[d+6]=i,this.int16[d+7]=n,this.uint16[d+8]=s,this.uint16[d+9]=a,this.uint16[d+10]=o,this.uint16[d+11]=h,this.uint16[d+12]=l,this.uint16[d+13]=c,this.uint16[d+14]=u,t}}$n.prototype.bytesPerElement=32,Fi("StructArrayLayout3f2i7ui32",$n);class ts extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A){const r=this.length;this.resize(r+1);const i=4*r;return this.uint32[2*r+0]=t,this.uint16[i+2]=e,this.uint16[i+3]=A,r}emplace(t,e,A,r){const i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=A,this.uint16[i+3]=r,t}}ts.prototype.bytesPerElement=8,Fi("StructArrayLayout1ul2ui8",ts);class es extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,A){const r=this.length;this.resize(r+1);const i=3*r;return this.uint16[i+0]=t,this.uint16[i+1]=e,this.uint16[i+2]=A,r}emplace(t,e,A,r){const i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=A,this.uint16[i+2]=r,t}}es.prototype.bytesPerElement=6,Fi("StructArrayLayout3ui6",es);class As extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e){const A=this.length;this.resize(A+1);const r=2*A;return this.uint16[r+0]=t,this.uint16[r+1]=e,A}emplace(t,e,A){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=A,t}}As.prototype.bytesPerElement=4,Fi("StructArrayLayout2ui4",As);class rs extends Fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,A,r){const i=this.length;this.resize(i+1);const n=4*i;return this.float32[n+0]=t,this.float32[n+1]=e,this.float32[n+2]=A,this.float32[n+3]=r,i}emplace(t,e,A,r,i){const n=4*t;return this.float32[n+0]=e,this.float32[n+1]=A,this.float32[n+2]=r,this.float32[n+3]=i,t}}rs.prototype.bytesPerElement=16,Fi("StructArrayLayout4f16",rs);class is extends Un{get anchorPointX(){return this._structArray.int16[this._pos2+0]}set anchorPointX(t){this._structArray.int16[this._pos2+0]=t;}get anchorPointY(){return this._structArray.int16[this._pos2+1]}set anchorPointY(t){this._structArray.int16[this._pos2+1]=t;}get x1(){return this._structArray.int16[this._pos2+2]}set x1(t){this._structArray.int16[this._pos2+2]=t;}get y1(){return this._structArray.int16[this._pos2+3]}set y1(t){this._structArray.int16[this._pos2+3]=t;}get x2(){return this._structArray.int16[this._pos2+4]}set x2(t){this._structArray.int16[this._pos2+4]=t;}get y2(){return this._structArray.int16[this._pos2+5]}set y2(t){this._structArray.int16[this._pos2+5]=t;}get featureIndex(){return this._structArray.uint32[this._pos4+3]}set featureIndex(t){this._structArray.uint32[this._pos4+3]=t;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}set sourceLayerIndex(t){this._structArray.uint16[this._pos2+8]=t;}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}set bucketIndex(t){this._structArray.uint16[this._pos2+9]=t;}get radius(){return this._structArray.int16[this._pos2+10]}set radius(t){this._structArray.int16[this._pos2+10]=t;}get signedDistanceFromAnchor(){return this._structArray.int16[this._pos2+11]}set signedDistanceFromAnchor(t){this._structArray.int16[this._pos2+11]=t;}get anchorPoint(){return new l(this.anchorPointX,this.anchorPointY)}}is.prototype.size=24;class ns extends Xn{get(t){return new is(this,t)}}Fi("CollisionBoxArray",ns);class ss extends Un{get anchorX(){return this._structArray.int16[this._pos2+0]}set anchorX(t){this._structArray.int16[this._pos2+0]=t;}get anchorY(){return this._structArray.int16[this._pos2+1]}set anchorY(t){this._structArray.int16[this._pos2+1]=t;}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}set glyphStartIndex(t){this._structArray.uint16[this._pos2+2]=t;}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}set numGlyphs(t){this._structArray.uint16[this._pos2+3]=t;}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}set vertexStartIndex(t){this._structArray.uint32[this._pos4+2]=t;}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}set lineStartIndex(t){this._structArray.uint32[this._pos4+3]=t;}get lineLength(){return this._structArray.uint32[this._pos4+4]}set lineLength(t){this._structArray.uint32[this._pos4+4]=t;}get segment(){return this._structArray.uint16[this._pos2+10]}set segment(t){this._structArray.uint16[this._pos2+10]=t;}get lowerSize(){return this._structArray.uint16[this._pos2+11]}set lowerSize(t){this._structArray.uint16[this._pos2+11]=t;}get upperSize(){return this._structArray.uint16[this._pos2+12]}set upperSize(t){this._structArray.uint16[this._pos2+12]=t;}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}set lineOffsetX(t){this._structArray.float32[this._pos4+7]=t;}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}set lineOffsetY(t){this._structArray.float32[this._pos4+8]=t;}get writingMode(){return this._structArray.uint8[this._pos1+36]}set writingMode(t){this._structArray.uint8[this._pos1+36]=t;}get hidden(){return this._structArray.uint8[this._pos1+37]}set hidden(t){this._structArray.uint8[this._pos1+37]=t;}}ss.prototype.size=40;class as extends jn{get(t){return new ss(this,t)}}Fi("PlacedSymbolArray",as);class os extends Un{get offsetX(){return this._structArray.float32[this._pos4+0]}set offsetX(t){this._structArray.float32[this._pos4+0]=t;}}os.prototype.size=4;class hs extends Yn{getoffsetX(t){return this.float32[1*t+0]}get(t){return new os(this,t)}}Fi("GlyphOffsetArray",hs);class ls extends Un{get x(){return this._structArray.int16[this._pos2+0]}set x(t){this._structArray.int16[this._pos2+0]=t;}get y(){return this._structArray.int16[this._pos2+1]}set y(t){this._structArray.int16[this._pos2+1]=t;}get tileUnitDistanceFromAnchor(){return this._structArray.int16[this._pos2+2]}set tileUnitDistanceFromAnchor(t){this._structArray.int16[this._pos2+2]=t;}}ls.prototype.size=6;class cs extends Wn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}get(t){return new ls(this,t)}}Fi("SymbolLineVertexArray",cs);class us extends Un{get featureIndex(){return this._structArray.uint32[this._pos4+0]}set featureIndex(t){this._structArray.uint32[this._pos4+0]=t;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}set sourceLayerIndex(t){this._structArray.uint16[this._pos2+2]=t;}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}set bucketIndex(t){this._structArray.uint16[this._pos2+3]=t;}}us.prototype.size=8;class ps extends ts{get(t){return new us(this,t)}}Fi("FeatureIndexArray",ps);const ds=Mn([{name:"a_pos",components:3,type:"Float32"}],4),{members:fs}=ds;class ys{constructor(t){this.segments=t||[];}prepareSegment(t,e,A){let r=this.segments[this.segments.length-1];return t>ys.MAX_VERTEX_ARRAY_LENGTH&&T(`Max vertices per segment is ${ys.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>ys.MAX_VERTEX_ARRAY_LENGTH)&&(r={vertexOffset:e.length,primitiveOffset:A.length,vertexLength:0,primitiveLength:0},this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy();}}ys.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fi("SegmentVector",ys);const gs=function(t,e){return 256*(t=x(Math.floor(t),0,255))+x(Math.floor(e),0,255)};function ms(t){return t.length?[gs(t[0],t[1]),gs(t[2],t[3])]:[gs(255*t.r,255*t.g),gs(255*t.b,255*t.a)]}class Bs{constructor(t,e,A){this.value=t,this.name=e,this.type=A,this.statistics={max:-1/0};}defines(){return [`#define HAS_UNIFORM_u_${this.name}`]}populatePaintArray(){}updatePaintArray(){}upload(){}destroy(){}setUniforms(t,e,A,r){const i=r.constantOr(this.value),n=t.gl;"color"===this.type?n.uniform4f(e.uniforms[`u_${this.name}`],i.r,i.g,i.b,i.a):n.uniform1f(e.uniforms[`u_${this.name}`],i);}}class ws{constructor(t,e,A){this.expression=t,this.name=e,this.type=A,this.statistics={max:-1/0};const r="color"===A?Kn:Yn;this.paintVertexAttributes=[{name:`a_${e}`,type:"Float32",components:"color"===A?2:1,offset:0}],this.paintVertexArray=new r;}defines(){return []}populatePaintArray(t,e,A,r,i){const n=this.paintVertexArray,s=n.length;n.reserve(t);const a=this.expression.evaluate(new Xi(0),e,{},r,[],i);if("color"===this.type){const e=ms(a);for(let A=s;A<t;A++)n.emplaceBack(e[0],e[1]);}else {for(let e=s;e<t;e++)n.emplaceBack(a);this.statistics.max=Math.max(this.statistics.max,a);}}updatePaintArray(t,e,A,r){const i=this.paintVertexArray,n=this.expression.evaluate({zoom:0},A,r);if("color"===this.type){const A=ms(n);for(let r=t;r<e;r++)i.emplace(r,A[0],A[1]);}else {for(let A=t;A<e;A++)i.emplace(A,n);this.statistics.max=Math.max(this.statistics.max,n);}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}setUniforms(t,e){t.gl.uniform1f(e.uniforms[`a_${this.name}_t`],0);}}class xs{constructor(t,e,A,r,i){this.expression=t,this.name=e,this.type=A,this.useIntegerZoom=r,this.zoom=i,this.statistics={max:-1/0};const n="color"===A?rs:Kn;this.paintVertexAttributes=[{name:`a_${e}`,type:"Float32",components:"color"===A?4:2,offset:0}],this.paintVertexArray=new n;}defines(){return []}populatePaintArray(t,e,A,r,i){const n=this.paintVertexArray,s=n.length;n.reserve(t);const a=this.expression.evaluate(new Xi(this.zoom),e,{},r,[],i),o=this.expression.evaluate(new Xi(this.zoom+1),e,{},r,[],i);if("color"===this.type){const e=ms(a),A=ms(o);for(let r=s;r<t;r++)n.emplaceBack(e[0],e[1],A[0],A[1]);}else {for(let e=s;e<t;e++)n.emplaceBack(a,o);this.statistics.max=Math.max(this.statistics.max,a,o);}}updatePaintArray(t,e,A,r){const i=this.paintVertexArray,n=this.expression.evaluate({zoom:this.zoom},A,r),s=this.expression.evaluate({zoom:this.zoom+1},A,r);if("color"===this.type){const A=ms(n),r=ms(s);for(let n=t;n<e;n++)i.emplace(n,A[0],A[1],r[0],r[1]);}else {for(let A=t;A<e;A++)i.emplace(A,n,s);this.statistics.max=Math.max(this.statistics.max,n,s);}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}interpolationFactor(t){return this.expression.interpolationFactor(this.useIntegerZoom?Math.floor(t):t,this.zoom,this.zoom+1)}setUniforms(t,e,A){t.gl.uniform1f(e.uniforms[`a_${this.name}_t`],this.interpolationFactor(A.zoom));}}class Cs{constructor(){this.binders={},this.cacheKey="",this._buffers=[],this._idMap={},this._bufferOffset=0;}static createDynamic(t,e,A){const r=new Cs,i=[];for(const n in t.paint._values){if(!A(n))continue;const s=t.paint.get(n);if(!(s instanceof pn&&tr(s.property.specification)))continue;const a=_s(n,t.type),o=s.property.specification.type,h=s.property.useIntegerZoom;"constant"===s.value.kind?(r.binders[n]=new Bs(s.value,a,o),i.push(`/u_${a}`)):"source"===s.value.kind?(r.binders[n]=new ws(s.value,a,o),i.push(`/a_${a}`)):(r.binders[n]=new xs(s.value,a,o,h,e),i.push(`/z_${a}`));}return r.cacheKey=i.sort().join(""),r}populatePaintArrays(t,e,A,r,i,n){for(const A in this.binders)this.binders[A].populatePaintArray(t,e,r,i,n);if(e.id){const r=String(e.id);this._idMap[r]=this._idMap[r]||[],this._idMap[r].push({index:A,start:this._bufferOffset,end:t});}this._bufferOffset=t;}updatePaintArrays(t,e,A){let r=!1;for(const i in t){const n=this._idMap[i];if(!n)continue;const s=t[i];for(const t of n){const i=e.feature(t.index);for(const e in this.binders){const n=this.binders[e];if(!(n instanceof Bs)&&!0===n.expression.isStateDependent){const a=A.paint.get(e);n.expression=a.value,n.updatePaintArray(t.start,t.end,i,s),r=!0;}}}}return r}defines(){const t=[];for(const e in this.binders)t.push.apply(t,this.binders[e].defines());return t}setUniforms(t,e,A,r){for(const i in this.binders)this.binders[i].setUniforms(t,e,r,A.get(i));}getPaintVertexBuffers(){return this._buffers}upload(t){for(const e in this.binders)this.binders[e].upload(t);const e=[];for(const t in this.binders){const A=this.binders[t];(A instanceof ws||A instanceof xs)&&A.paintVertexBuffer&&e.push(A.paintVertexBuffer);}this._buffers=e;}destroy(){for(const t in this.binders)this.binders[t].destroy();}}class Es{constructor(t,e,A,r=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=Cs.createDynamic(i,A,r),this.programConfigurations[i.id].layoutAttributes=t;this.needsUpload=!1;}populatePaintArrays(t,e,A,r,i,n){for(const s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(t,e,A,r,i,n);this.needsUpload=!0;}updatePaintArrays(t,e,A){for(const r of A)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,e,r)||this.needsUpload;}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1;}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy();}}function _s(t,e){return {"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth","line-border-width":"borderwidth","line-border-opacity":"borderopacity","line-border-color":"bordercolor"}[t]||t.replace(`${e.replace("3d-","")}-`,"").replace(/-/g,"_")}Fi("ConstantBinder",Bs),Fi("SourceExpressionBinder",ws),Fi("CompositeExpressionBinder",xs),Fi("ProgramConfiguration",Cs,{omit:["_buffers"]}),Fi("ProgramConfigurationSet",Es);const vs={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function bs(t){const e=ji/t.extent,A=t.loadGeometry();for(let t=0;t<A.length;t++){const r=A[t];for(let t=0;t<r.length;t++){const A=r[t];A.x=Math.round(A.x*e),A.y=Math.round(A.y*e),(A.x<vs.min||A.x>vs.max||A.y<vs.min||A.y>vs.max)&&T("Geometry exceeds allowed extent, reduce your vector tile buffer size");}}return A}var Us=Ms,Fs=Ms;function Ms(t,e,A){A=A||2;var r,i,n,s,a,o,h,l=e&&e.length,c=l?e[0]*A:t.length,u=Qs(t,0,c,A,!0),p=[];if(!u||u.next===u.prev)return p;if(l&&(u=function(t,e,A,r){var i,n,s,a=[];for(i=0,n=e.length;i<n;i++)(s=Qs(t,e[i]*r,i<n-1?e[i+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(ks(s));for(a.sort(Hs),i=0;i<a.length;i++)A=Os(a[i],A);return A}(t,e,u,A)),t.length>80*A){r=n=t[0],i=s=t[1];for(var d=A;d<c;d+=A)(a=t[d])<r&&(r=a),(o=t[d+1])<i&&(i=o),a>n&&(n=a),o>s&&(s=o);h=0!==(h=Math.max(n-r,s-i))?32767/h:0;}return Ss(u,p,A,r,i,h,0),p}function Qs(t,e,A,r,i){var n,s;if(i===ta(t,e,A,r)>0)for(n=e;n<A;n+=r)s=Zs(n,t[n],t[n+1],s);else for(n=A-r;n>=e;n-=r)s=Zs(n,t[n],t[n+1],s);return s&&zs(s,s.next)&&(Js(s),s=s.next),s}function Is(t,e){if(!t)return t;e||(e=t);var A,r=t;do{if(A=!1,r.steiner||!zs(r,r.next)&&0!==Ks(r.prev,r,r.next))r=r.next;else {if(Js(r),(r=e=r.prev)===r.next)break;A=!0;}}while(A||r!==e);return e}function Ss(t,e,A,r,i,n,s){if(t){!s&&n&&function(t,e,A,r){var i=t;do{0===i.z&&(i.z=Ns(i.x,i.y,e,A,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,A,r,i,n,s,a,o,h=1;do{for(A=t,t=null,n=null,s=0;A;){for(s++,r=A,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(o=h;a>0||o>0&&r;)0!==a&&(0===o||!r||A.z<=r.z)?(i=A,A=A.nextZ,a--):(i=r,r=r.nextZ,o--),n?n.nextZ=i:t=i,i.prevZ=n,n=i;A=r;}n.nextZ=null,h*=2;}while(s>1)}(i);}(t,r,i,n);for(var a,o,h=t;t.prev!==t.next;)if(a=t.prev,o=t.next,n?Rs(t,r,i,n):Ts(t))e.push(a.i/A|0),e.push(t.i/A|0),e.push(o.i/A|0),Js(t),t=o.next,h=o.next;else if((t=o)===h){s?1===s?Ss(t=Ls(Is(t),e,A),e,A,r,i,n,2):2===s&&Ps(t,e,A,r,i,n):Ss(Is(t),e,A,r,i,n,1);break}}}function Ts(t){var e=t.prev,A=t,r=t.next;if(Ks(e,A,r)>=0)return !1;for(var i=e.x,n=A.x,s=r.x,a=e.y,o=A.y,h=r.y,l=i<n?i<s?i:s:n<s?n:s,c=a<o?a<h?a:h:o<h?o:h,u=i>n?i>s?i:s:n>s?n:s,p=a>o?a>h?a:h:o>h?o:h,d=r.next;d!==e;){if(d.x>=l&&d.x<=u&&d.y>=c&&d.y<=p&&Vs(i,a,n,o,s,h,d.x,d.y)&&Ks(d.prev,d,d.next)>=0)return !1;d=d.next;}return !0}function Rs(t,e,A,r){var i=t.prev,n=t,s=t.next;if(Ks(i,n,s)>=0)return !1;for(var a=i.x,o=n.x,h=s.x,l=i.y,c=n.y,u=s.y,p=a<o?a<h?a:h:o<h?o:h,d=l<c?l<u?l:u:c<u?c:u,f=a>o?a>h?a:h:o>h?o:h,y=l>c?l>u?l:u:c>u?c:u,g=Ns(p,d,e,A,r),m=Ns(f,y,e,A,r),B=t.prevZ,w=t.nextZ;B&&B.z>=g&&w&&w.z<=m;){if(B.x>=p&&B.x<=f&&B.y>=d&&B.y<=y&&B!==i&&B!==s&&Vs(a,l,o,c,h,u,B.x,B.y)&&Ks(B.prev,B,B.next)>=0)return !1;if(B=B.prevZ,w.x>=p&&w.x<=f&&w.y>=d&&w.y<=y&&w!==i&&w!==s&&Vs(a,l,o,c,h,u,w.x,w.y)&&Ks(w.prev,w,w.next)>=0)return !1;w=w.nextZ;}for(;B&&B.z>=g;){if(B.x>=p&&B.x<=f&&B.y>=d&&B.y<=y&&B!==i&&B!==s&&Vs(a,l,o,c,h,u,B.x,B.y)&&Ks(B.prev,B,B.next)>=0)return !1;B=B.prevZ;}for(;w&&w.z<=m;){if(w.x>=p&&w.x<=f&&w.y>=d&&w.y<=y&&w!==i&&w!==s&&Vs(a,l,o,c,h,u,w.x,w.y)&&Ks(w.prev,w,w.next)>=0)return !1;w=w.nextZ;}return !0}function Ls(t,e,A){var r=t;do{var i=r.prev,n=r.next.next;!zs(i,n)&&Xs(i,r,r.next,n)&&Ys(i,n)&&Ys(n,i)&&(e.push(i.i/A|0),e.push(r.i/A|0),e.push(n.i/A|0),Js(r),Js(r.next),r=t=n),r=r.next;}while(r!==t);return Is(r)}function Ps(t,e,A,r,i,n){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Gs(s,a)){var o=Ws(s,a);return s=Is(s,s.next),o=Is(o,o.next),Ss(s,e,A,r,i,n,0),void Ss(o,e,A,r,i,n,0)}a=a.next;}s=s.next;}while(s!==t)}function Hs(t,e){return t.x-e.x}function Os(t,e){var A=function(t,e){var A,r=e,i=t.x,n=t.y,s=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,A=r.x<r.next.x?r:r.next,a===i))return A}r=r.next;}while(r!==e);if(!A)return null;var o,h=A,l=A.x,c=A.y,u=1/0;r=A;do{i>=r.x&&r.x>=l&&i!==r.x&&Vs(n<c?i:s,n,l,c,n<c?s:i,n,r.x,r.y)&&(o=Math.abs(n-r.y)/(i-r.x),Ys(r,t)&&(o<u||o===u&&(r.x>A.x||r.x===A.x&&Ds(A,r)))&&(A=r,u=o)),r=r.next;}while(r!==h);return A}(t,e);if(!A)return e;var r=Ws(A,t);return Is(r,r.next),Is(A,A.next)}function Ds(t,e){return Ks(t.prev,t,e.prev)<0&&Ks(e.next,t,t.next)<0}function Ns(t,e,A,r,i){return (t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-A)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ks(t){var e=t,A=t;do{(e.x<A.x||e.x===A.x&&e.y<A.y)&&(A=e),e=e.next;}while(e!==t);return A}function Vs(t,e,A,r,i,n,s,a){return (i-s)*(e-a)>=(t-s)*(n-a)&&(t-s)*(r-a)>=(A-s)*(e-a)&&(A-s)*(n-a)>=(i-s)*(r-a)}function Gs(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var A=t;do{if(A.i!==t.i&&A.next.i!==t.i&&A.i!==e.i&&A.next.i!==e.i&&Xs(A,A.next,t,e))return !0;A=A.next;}while(A!==t);return !1}(t,e)&&(Ys(t,e)&&Ys(e,t)&&function(t,e){var A=t,r=!1,i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{A.y>n!=A.next.y>n&&A.next.y!==A.y&&i<(A.next.x-A.x)*(n-A.y)/(A.next.y-A.y)+A.x&&(r=!r),A=A.next;}while(A!==t);return r}(t,e)&&(Ks(t.prev,t,e.prev)||Ks(t,e.prev,e))||zs(t,e)&&Ks(t.prev,t,t.next)>0&&Ks(e.prev,e,e.next)>0)}function Ks(t,e,A){return (e.y-t.y)*(A.x-e.x)-(e.x-t.x)*(A.y-e.y)}function zs(t,e){return t.x===e.x&&t.y===e.y}function Xs(t,e,A,r){var i=js(Ks(t,e,A)),n=js(Ks(t,e,r)),s=js(Ks(A,r,t)),a=js(Ks(A,r,e));return i!==n&&s!==a||!(0!==i||!qs(t,A,e))||!(0!==n||!qs(t,r,e))||!(0!==s||!qs(A,t,r))||!(0!==a||!qs(A,e,r))}function qs(t,e,A){return e.x<=Math.max(t.x,A.x)&&e.x>=Math.min(t.x,A.x)&&e.y<=Math.max(t.y,A.y)&&e.y>=Math.min(t.y,A.y)}function js(t){return t>0?1:t<0?-1:0}function Ys(t,e){return Ks(t.prev,t,t.next)<0?Ks(t,e,t.next)>=0&&Ks(t,t.prev,e)>=0:Ks(t,e,t.prev)<0||Ks(t,t.next,e)<0}function Ws(t,e){var A=new $s(t.i,t.x,t.y),r=new $s(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,A.next=i,i.prev=A,r.next=A,A.prev=r,n.next=r,r.prev=n,r}function Zs(t,e,A,r){var i=new $s(t,e,A);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Js(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function $s(t,e,A){this.i=t,this.x=e,this.y=A,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function ta(t,e,A,r){for(var i=0,n=e,s=A-r;n<A;n+=r)i+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return i}function ea(t,e,A,r,i){Aa(t,e,A||0,r||t.length-1,i||ia);}function Aa(t,e,A,r,i){for(;r>A;){if(r-A>600){var n=r-A+1,s=e-A+1,a=Math.log(n),o=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*o*(n-o)/n)*(s-n/2<0?-1:1);Aa(t,e,Math.max(A,Math.floor(e-s*o/n+h)),Math.min(r,Math.floor(e+(n-s)*o/n+h)),i);}var l=t[e],c=A,u=r;for(ra(t,A,e),i(t[r],l)>0&&ra(t,A,r);c<u;){for(ra(t,c,u),c++,u--;i(t[c],l)<0;)c++;for(;i(t[u],l)>0;)u--;}0===i(t[A],l)?ra(t,A,u):ra(t,++u,r),u<=e&&(A=u+1),e<=u&&(r=u-1);}}function ra(t,e,A){var r=t[e];t[e]=t[A],t[A]=r;}function ia(t,e){return t<e?-1:t>e?1:0}function na(t,e){const A=t.length;if(A<=1)return [t];const r=[];let i,n;for(let e=0;e<A;e++){const A=L(t[e]);0!==A&&(t[e].area=Math.abs(A),void 0===n&&(n=A<0),n===A<0?(i&&r.push(i),i=[t[e]]):i.push(t[e]));}if(i&&r.push(i),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(ea(r[t],e,1,r[t].length-1,sa),r[t]=r[t].slice(0,e));return r}function sa(t,e){return e.area-t.area}function aa(t,e){return t.x===e.x&&(t.x<0||t.x>ji)||t.y===e.y&&(t.y<0||t.y>ji)}function oa(t){return t.every((t=>t.x<0))||t.every((t=>t.x>ji))||t.every((t=>t.y<0))||t.every((t=>t.y>ji))}function ha(t){return !(t.every((t=>t.x>=0))&&t.every((t=>t.x<=ji))&&t.every((t=>t.y>=0))&&t.every((t=>t.y<=ji)))}function la(t,e){return t.x===e.x&&(0===t.x||8192===t.x)||t.y===e.y&&(0===t.y||8192===t.y)}function ca(t){let e=1/0,A=-1/0,r=1/0,i=-1/0;for(const n of t)for(const t of n)e>t.x&&(e=t.x),A<t.x&&(A=t.x),r>t.y&&(r=t.y),i<t.y&&(i=t.y);let n=A-e<512?512:A-e;return n<i-r&&(n=i-r),{minX:e,maxX:A,minY:r,maxY:i,maxLength:n}}Ms.deviation=function(t,e,A,r){var i=e&&e.length,n=Math.abs(ta(t,0,i?e[0]*A:t.length,A));if(i)for(var s=0,a=e.length;s<a;s++)n-=Math.abs(ta(t,e[s]*A,s<a-1?e[s+1]*A:t.length,A));var o=0;for(s=0;s<r.length;s+=3){var h=r[s]*A,l=r[s+1]*A,c=r[s+2]*A;o+=Math.abs((t[h]-t[c])*(t[l+1]-t[h+1])-(t[h]-t[l])*(t[c+1]-t[h+1]));}return 0===n&&0===o?0:Math.abs((o-n)/n)},Ms.flatten=function(t){for(var e=t[0][0].length,A={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var n=0;n<t[i].length;n++)for(var s=0;s<e;s++)A.vertices.push(t[i][n][s]);i>0&&A.holes.push(r+=t[i-1].length);}return A},Us.default=Fs;const ua={LATLON:"LATLON",MERCATOR:"MERCATOR"},pa={R:$.TRANSFORM.R,CIR:$.TRANSFORM.CIR,projectType:"LONLAT",project(t){return new l(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject(t){return new Zi(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize(t,e){return new l(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize(t,e){return new Zi(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:(t,e)=>(180+t)*e/360,latY:(t,e)=>(90-t)/180*e*.5,xLng:(t,e)=>360*t/e-180,yLat:(t,e)=>90-t/(.5*e)*180,tileNumberToLngLat(t,e,A){return new Zi(this.xLng(t[0]*e,A),this.yLat(t[1]*e,A))},lngLatToTileNumber(t,e,A){return [this.lngX(t.lng,A)/e,this.latY(t.lat,A)/e]}},da={R:$.TRANSFORM.R,CIR:$.TRANSFORM.CIR,projectType:"MERCATOR",project(t){return new l(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject(t){return new Zi(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize(t,e){return new l(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize(t,e){return new Zi(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:(t,e)=>(180+t)*e/360,latY:(t,e)=>(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*e/360,xLng:(t,e)=>360*t/e-180,yLat:(t,e)=>360/Math.PI*Math.atan(Math.exp((180-360*t/e)*Math.PI/180))-90,tileNumberToLngLat(t,e,A){return new Zi(this.xLng(t[0]*e,A),this.yLat(t[1]*e,A))},lngLatToTileNumber(t,e,A){return [this.lngX(t.lng,A)/e,this.latY(t.lat,A)/e]}};function fa(t){return t===ua.LATLON?pa:da}function ya(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}function ga(t){return null!=t}const ma=1/Math.PI*180,Ba=1/180*Math.PI,wa={};function xa(t={}){for(const e in t)wa[e]=t[e];return wa}function Ca(t,{precision:e=wa.precision||4}={}){return t=function(t){return Math.round(t/wa.EPSILON)*wa.EPSILON}(t),`${parseFloat(t.toPrecision(e))}`}function Ea(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)||ga(t)&&t.isMathGLClass}function _a(t){return t.clone?t.clone():new Array(...t)}function va(t,e,A){if(Ea(t)){A=A||((r=t).clone?r.clone():new Array(r.length));for(let r=0;r<A.length&&r<t.length;++r)A[r]=e(t[r],r,A);return A}var r;return e(t)}function ba(t){return Fa(t)}function Ua(t){return Ma(t)}function Fa(t,e){return va(t,(t=>t*Ba),e)}function Ma(t,e){return va(t,(t=>t*ma),e)}function Qa(t){return va(t,(t=>Math.sin(t)))}function Ia(t){return va(t,(t=>Math.cos(t)))}function Sa(t){return va(t,(t=>Math.tan(t)))}function Ta(t){return va(t,(t=>Math.asin(t)))}function Ra(t){return va(t,(t=>Math.acos(t)))}function La(t){return va(t,(t=>Math.atan(t)))}function Pa(t,e,A){return va(t,(t=>Math.max(e,Math.min(A,t))))}function Ha(t,e,A){return Ea(t)?t.map(((t,r)=>Ha(t,e[r],A))):A*e+(1-A)*t}function Oa(t,e,A){const r=wa.EPSILON;A&&(wa.EPSILON=A);try{if(t===e)return !0;if(Ea(t)&&Ea(e)){if(t.length!==e.length)return !1;for(let A=0;A<t.length;++A)if(!Oa(t[A],e[A]))return !1;return !0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=wa.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{wa.EPSILON=r;}}function Da(t,e){if(t===e)return !0;if(t&&"object"==typeof t&&e&&"object"==typeof e){if(t.constructor!==e.constructor)return !1;if(t.exactEquals)return t.exactEquals(e)}if(Ea(t)&&Ea(e)){if(t.length!==e.length)return !1;for(let A=0;A<t.length;++A)if(!Da(t[A],e[A]))return !1;return !0}return !1}function Na(t,e){const A=wa.EPSILON;let r;wa.EPSILON=t;try{r=e();}finally{wa.EPSILON=A;}return r}wa.EPSILON=1e-12,wa.debug=!1,wa.precision=4,wa.printTypes=!1,wa.printDegrees=!1,wa.printRowMajor=!0;class ka extends Array{get isMathGLClass(){return !0}get ELEMENTS(){return 0}clone(){return (new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let A=0;A<this.ELEMENTS;++A)this[A]=t[A+e];return this.check()}to(t){return t===this?this:Ea(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let A=0;A<this.ELEMENTS;++A)t[e+A]=this[A];return t}toFloat32Array(){return new Float32Array(this.toArray())}toString(){return this.formatString(wa)}formatString(t){let e="";for(let A=0;A<this.ELEMENTS;++A)e+=(A>0?", ":"")+Ca(this[A],t);return `${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return !1;for(let e=0;e<this.ELEMENTS;++e)if(!Oa(this[e],t[e]))return !1;return !0}exactEquals(t){if(!t||this.length!==t.length)return !1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return !1;return !0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,A){void 0===A&&(A=e,e=t,t=this);for(let r=0;r<this.ELEMENTS;++r){const i=t[r];this[r]=i+A*(e[r]-i);}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let A=0;A<this.ELEMENTS;++A)this[A]=Math.min(Math.max(this[A],t[A]),e[A]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);if(null!=t.x)return this[0]*=t.x,this[1]*=t.y,this[2]*=t.z,this.check();for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let A=0;A<this.ELEMENTS;++A)this[A]=Math.min(Math.max(this[A],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(wa.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function Va(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${t}`);return t}function Ga(t,e,A=""){if(wa.debug&&!function(t,e){if(t.length!==e)return !1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return !1;return !0}(t,e))throw new Error(`math.gl: ${A} some fields set to invalid numbers'`);return t}const Ka={};function za(t,e){Ka[t]||(Ka[t]=!0,console.warn(`${t} has been removed in version ${e}, see upgrade guide for more information`));}class Xa extends ka{get ELEMENTS(){return 0}copy(t){return this}get x(){return this[0]}set x(t){this[0]=Va(t);}get y(){return this[1]}set y(t){this[1]=Va(t);}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let A=0;A<this.ELEMENTS;++A){const r=this[A]-t[A];e+=r*r;}return Va(e)}dot(t){let e=0;for(let A=0;A<this.ELEMENTS;++A)e+=this[A]*t[A];return Va(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Va(this[t])}setComponent(t,e){return this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var qa=1e-6,ja="undefined"!=typeof Float32Array?Float32Array:Array;function Ya(t,e){if(t===e){var A=e[1];t[1]=e[2],t[2]=A;}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Wa(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=A*n-i*r;return s?(t[0]=n*(s=1/s),t[1]=-r*s,t[2]=-i*s,t[3]=A*s,t):null}function Za(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=A[0],o=A[1],h=A[2],l=A[3];return t[0]=r*a+n*o,t[1]=i*a+s*o,t[2]=r*h+n*l,t[3]=i*h+s*l,t}function Ja(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=Math.sin(A),o=Math.cos(A);return t[0]=r*o+n*a,t[1]=i*o+s*a,t[2]=r*-a+n*o,t[3]=i*-a+s*o,t}function $a(t,e,A){var r=e[1],i=e[2],n=e[3],s=A[0],a=A[1];return t[0]=e[0]*s,t[1]=r*s,t[2]=i*a,t[3]=n*a,t}function to(t,e){if(t===e){var A=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=A,t[5]=e[7],t[6]=r,t[7]=i;}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function eo(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],h=e[7],l=e[8],c=l*s-a*h,u=-l*n+a*o,p=h*n-s*o,d=A*c+r*u+i*p;return d?(t[0]=c*(d=1/d),t[1]=(-l*r+i*h)*d,t[2]=(a*r-i*s)*d,t[3]=u*d,t[4]=(l*A-i*o)*d,t[5]=(-a*A+i*n)*d,t[6]=p*d,t[7]=(-h*A+r*o)*d,t[8]=(s*A-r*n)*d,t):null}function Ao(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=A[0],p=A[1],d=A[2],f=A[3],y=A[4],g=A[5],m=A[6],B=A[7],w=A[8];return t[0]=u*r+p*s+d*h,t[1]=u*i+p*a+d*l,t[2]=u*n+p*o+d*c,t[3]=f*r+y*s+g*h,t[4]=f*i+y*a+g*l,t[5]=f*n+y*o+g*c,t[6]=m*r+B*s+w*h,t[7]=m*i+B*a+w*l,t[8]=m*n+B*o+w*c,t}function ro(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=A[0],p=A[1];return t[0]=r,t[1]=i,t[2]=n,t[3]=s,t[4]=a,t[5]=o,t[6]=u*r+p*s+h,t[7]=u*i+p*a+l,t[8]=u*n+p*o+c,t}function io(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=Math.sin(A),p=Math.cos(A);return t[0]=p*r+u*s,t[1]=p*i+u*a,t[2]=p*n+u*o,t[3]=p*s-u*r,t[4]=p*a-u*i,t[5]=p*o-u*n,t[6]=h,t[7]=l,t[8]=c,t}function no(t,e,A){var r=A[0],i=A[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function so(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=A+A,a=r+r,o=i+i,h=A*s,l=r*s,c=r*a,u=i*s,p=i*a,d=i*o,f=n*s,y=n*a,g=n*o;return t[0]=1-c-d,t[3]=l-g,t[6]=u+y,t[1]=l+g,t[4]=1-h-d,t[7]=p-f,t[2]=u-y,t[5]=p+f,t[8]=1-h-c,t}function ao(t,e){if(t===e){var A=e[1],r=e[2],i=e[3],n=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=A,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a;}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function oo(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],h=e[7],l=e[8],c=e[9],u=e[10],p=e[11],d=e[12],f=e[13],y=e[14],g=e[15],m=A*a-r*s,B=A*o-i*s,w=A*h-n*s,x=r*o-i*a,C=r*h-n*a,E=i*h-n*o,_=l*f-c*d,v=l*y-u*d,b=l*g-p*d,U=c*y-u*f,F=c*g-p*f,M=u*g-p*y,Q=m*M-B*F+w*U+x*b-C*v+E*_;return Q?(t[0]=(a*M-o*F+h*U)*(Q=1/Q),t[1]=(i*F-r*M-n*U)*Q,t[2]=(f*E-y*C+g*x)*Q,t[3]=(u*C-c*E-p*x)*Q,t[4]=(o*b-s*M-h*v)*Q,t[5]=(A*M-i*b+n*v)*Q,t[6]=(y*w-d*E-g*B)*Q,t[7]=(l*E-u*w+p*B)*Q,t[8]=(s*F-a*b+h*_)*Q,t[9]=(r*b-A*F-n*_)*Q,t[10]=(d*C-f*w+g*m)*Q,t[11]=(c*w-l*C-p*m)*Q,t[12]=(a*v-s*U-o*_)*Q,t[13]=(A*U-r*v+i*_)*Q,t[14]=(f*B-d*x-y*m)*Q,t[15]=(l*x-c*B+u*m)*Q,t):null}function ho(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],p=e[10],d=e[11],f=e[12],y=e[13],g=e[14],m=e[15],B=A[0],w=A[1],x=A[2],C=A[3];return t[0]=B*r+w*a+x*c+C*f,t[1]=B*i+w*o+x*u+C*y,t[2]=B*n+w*h+x*p+C*g,t[3]=B*s+w*l+x*d+C*m,t[4]=(B=A[4])*r+(w=A[5])*a+(x=A[6])*c+(C=A[7])*f,t[5]=B*i+w*o+x*u+C*y,t[6]=B*n+w*h+x*p+C*g,t[7]=B*s+w*l+x*d+C*m,t[8]=(B=A[8])*r+(w=A[9])*a+(x=A[10])*c+(C=A[11])*f,t[9]=B*i+w*o+x*u+C*y,t[10]=B*n+w*h+x*p+C*g,t[11]=B*s+w*l+x*d+C*m,t[12]=(B=A[12])*r+(w=A[13])*a+(x=A[14])*c+(C=A[15])*f,t[13]=B*i+w*o+x*u+C*y,t[14]=B*n+w*h+x*p+C*g,t[15]=B*s+w*l+x*d+C*m,t}function lo(t,e,A){var r,i,n,s,a,o,h,l,c,u,p,d,f=A[0],y=A[1],g=A[2];return e===t?(t[12]=e[0]*f+e[4]*y+e[8]*g+e[12],t[13]=e[1]*f+e[5]*y+e[9]*g+e[13],t[14]=e[2]*f+e[6]*y+e[10]*g+e[14],t[15]=e[3]*f+e[7]*y+e[11]*g+e[15]):(i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],p=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=n,t[3]=s,t[4]=a,t[5]=o,t[6]=h,t[7]=l,t[8]=c,t[9]=u,t[10]=p,t[11]=d,t[12]=r*f+a*y+c*g+e[12],t[13]=i*f+o*y+u*g+e[13],t[14]=n*f+h*y+p*g+e[14],t[15]=s*f+l*y+d*g+e[15]),t}function co(t,e,A){var r=A[0],i=A[1],n=A[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function uo(t,e,A,r){var i,n,s,a,o,h,l,c,u,p,d,f,y,g,m,B,w,x,C,E,_,v,b,U,F=r[0],M=r[1],Q=r[2],I=Math.hypot(F,M,Q);return I<qa?null:(F*=I=1/I,M*=I,Q*=I,i=Math.sin(A),n=Math.cos(A),o=e[1],h=e[2],l=e[3],u=e[5],p=e[6],d=e[7],y=e[9],g=e[10],m=e[11],C=F*M*(s=1-n)-Q*i,E=M*M*s+n,_=Q*M*s+F*i,v=F*Q*s+M*i,b=M*Q*s-F*i,U=Q*Q*s+n,t[0]=(a=e[0])*(B=F*F*s+n)+(c=e[4])*(w=M*F*s+Q*i)+(f=e[8])*(x=Q*F*s-M*i),t[1]=o*B+u*w+y*x,t[2]=h*B+p*w+g*x,t[3]=l*B+d*w+m*x,t[4]=a*C+c*E+f*_,t[5]=o*C+u*E+y*_,t[6]=h*C+p*E+g*_,t[7]=l*C+d*E+m*_,t[8]=a*v+c*b+f*U,t[9]=o*v+u*b+y*U,t[10]=h*v+p*b+g*U,t[11]=l*v+d*b+m*U,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function po(t,e,A){var r=Math.sin(A),i=Math.cos(A),n=e[4],s=e[5],a=e[6],o=e[7],h=e[8],l=e[9],c=e[10],u=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*i+h*r,t[5]=s*i+l*r,t[6]=a*i+c*r,t[7]=o*i+u*r,t[8]=h*i-n*r,t[9]=l*i-s*r,t[10]=c*i-a*r,t[11]=u*i-o*r,t}function fo(t,e,A){var r=Math.sin(A),i=Math.cos(A),n=e[0],s=e[1],a=e[2],o=e[3],h=e[8],l=e[9],c=e[10],u=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i-h*r,t[1]=s*i-l*r,t[2]=a*i-c*r,t[3]=o*i-u*r,t[8]=n*r+h*i,t[9]=s*r+l*i,t[10]=a*r+c*i,t[11]=o*r+u*i,t}function yo(t,e,A){var r=Math.sin(A),i=Math.cos(A),n=e[0],s=e[1],a=e[2],o=e[3],h=e[4],l=e[5],c=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*i+h*r,t[1]=s*i+l*r,t[2]=a*i+c*r,t[3]=o*i+u*r,t[4]=h*i-n*r,t[5]=l*i-s*r,t[6]=c*i-a*r,t[7]=u*i-o*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var go=function(t,e,A,r,i){var n,s=1/Math.tan(e/2);return t[0]=s/A,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(n=1/(r-i)),t[14]=2*i*r*n):(t[10]=-1,t[14]=-2*r),t};function mo(t,e){var A=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],p=t[11],d=t[12],f=t[13],y=t[14],g=t[15],m=e[0],B=e[1],w=e[2],x=e[3],C=e[4],E=e[5],_=e[6],v=e[7],b=e[8],U=e[9],F=e[10],M=e[11],Q=e[12],I=e[13],S=e[14],T=e[15];return Math.abs(A-m)<=qa*Math.max(1,Math.abs(A),Math.abs(m))&&Math.abs(r-B)<=qa*Math.max(1,Math.abs(r),Math.abs(B))&&Math.abs(i-w)<=qa*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-x)<=qa*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-C)<=qa*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-E)<=qa*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-_)<=qa*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(h-v)<=qa*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-b)<=qa*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-U)<=qa*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-F)<=qa*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(p-M)<=qa*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-Q)<=qa*Math.max(1,Math.abs(d),Math.abs(Q))&&Math.abs(f-I)<=qa*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(y-S)<=qa*Math.max(1,Math.abs(y),Math.abs(S))&&Math.abs(g-T)<=qa*Math.max(1,Math.abs(g),Math.abs(T))}function Bo(){var t=new ja(3);return ja!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wo(t){return Math.hypot(t[0],t[1],t[2])}function xo(t,e,A){var r=new ja(3);return r[0]=t,r[1]=e,r[2]=A,r}function Co(t,e,A){return t[0]=e[0]+A[0],t[1]=e[1]+A[1],t[2]=e[2]+A[2],t}function Eo(t,e){var A=e[0],r=e[1],i=e[2],n=A*A+r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function _o(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vo(t,e,A){var r=e[0],i=e[1],n=e[2],s=A[0],a=A[1],o=A[2];return t[0]=i*o-n*a,t[1]=n*s-r*o,t[2]=r*a-i*s,t}function bo(t,e,A){var r=e[0],i=e[1],n=e[2],s=A[3]*r+A[7]*i+A[11]*n+A[15];return t[0]=(A[0]*r+A[4]*i+A[8]*n+A[12])/(s=s||1),t[1]=(A[1]*r+A[5]*i+A[9]*n+A[13])/s,t[2]=(A[2]*r+A[6]*i+A[10]*n+A[14])/s,t}function Uo(t,e,A){var r=e[0],i=e[1],n=e[2];return t[0]=r*A[0]+i*A[3]+n*A[6],t[1]=r*A[1]+i*A[4]+n*A[7],t[2]=r*A[2]+i*A[5]+n*A[8],t}function Fo(t,e,A){var r=A[0],i=A[1],n=A[2],s=e[0],a=e[1],o=e[2],h=i*o-n*a,l=n*s-r*o,c=r*a-i*s,u=i*c-n*l,p=n*h-r*c,d=r*l-i*h,f=2*A[3];return l*=f,c*=f,p*=2,d*=2,t[0]=s+(h*=f)+(u*=2),t[1]=a+l+p,t[2]=o+c+d,t}function Mo(t,e,A,r){var i=[],n=[];return i[0]=e[0]-A[0],i[1]=e[1]-A[1],i[2]=e[2]-A[2],n[0]=i[0],n[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),n[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=n[0]+A[0],t[1]=n[1]+A[1],t[2]=n[2]+A[2],t}function Qo(t,e,A,r){var i=[],n=[];return i[0]=e[0]-A[0],i[1]=e[1]-A[1],i[2]=e[2]-A[2],n[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),n[1]=i[1],n[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=n[0]+A[0],t[1]=n[1]+A[1],t[2]=n[2]+A[2],t}function Io(t,e,A,r){var i=[],n=[];return i[0]=e[0]-A[0],i[1]=e[1]-A[1],i[2]=e[2]-A[2],n[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),n[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),n[2]=i[2],t[0]=n[0]+A[0],t[1]=n[1]+A[1],t[2]=n[2]+A[2],t}var So=wo;function To(t,e,A){return t[0]=e[0]*A,t[1]=e[1]*A,t[2]=e[2]*A,t[3]=e[3]*A,t}function Ro(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3];return t[0]=A[0]*r+A[4]*i+A[8]*n+A[12]*s,t[1]=A[1]*r+A[5]*i+A[9]*n+A[13]*s,t[2]=A[2]*r+A[6]*i+A[10]*n+A[14]*s,t[3]=A[3]*r+A[7]*i+A[11]*n+A[15]*s,t}function Lo(t,e,A){var r=e[0],i=e[1],n=e[2],s=A[0],a=A[1],o=A[2],h=A[3],l=h*r+a*n-o*i,c=h*i+o*r-s*n,u=h*n+s*i-a*r,p=-s*r-a*i-o*n;return t[0]=l*h+p*-s+c*-o-u*-a,t[1]=c*h+p*-a+u*-s-l*-o,t[2]=u*h+p*-o+l*-a-c*-s,t[3]=e[3],t}function Po(){var t=new ja(4);return ja!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ho(t,e,A){A*=.5;var r=Math.sin(A);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(A),t}function Oo(t,e,A){var r=e[0],i=e[1],n=e[2],s=e[3],a=A[0],o=A[1],h=A[2],l=A[3];return t[0]=r*l+s*a+i*h-n*o,t[1]=i*l+s*o+n*a-r*h,t[2]=n*l+s*h+r*o-i*a,t[3]=s*l-r*a-i*o-n*h,t}Bo(),function(){var t;t=new ja(4),ja!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0);}();var Do,No,ko,Vo,Go=To,Ko=(Do=Bo(),No=xo(1,0,0),ko=xo(0,1,0),function(t,e,A){var r=_o(e,A);return r<-.999999?(vo(Do,No,e),So(Do)<1e-6&&vo(Do,ko,e),Eo(Do,Do),Ho(t,Do,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(vo(Do,e,A),t[0]=Do[0],t[1]=Do[1],t[2]=Do[2],t[3]=1+r,function(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=A*A+r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=A*s,t[1]=r*s,t[2]=i*s,t[3]=n*s,t}(t,t))});function zo(t,e,A){return t[0]=e[0]+A[0],t[1]=e[1]+A[1],t}function Xo(t,e,A,r){var i=e[0],n=e[1];return t[0]=i+r*(A[0]-i),t[1]=n+r*(A[1]-n),t}function qo(t,e,A){var r=e[0],i=e[1];return t[0]=A[0]*r+A[2]*i,t[1]=A[1]*r+A[3]*i,t}function jo(t,e,A){var r=e[0],i=e[1];return t[0]=A[0]*r+A[2]*i+A[4],t[1]=A[1]*r+A[3]*i+A[5],t}function Yo(t,e,A){var r=e[0],i=e[1];return t[0]=A[0]*r+A[3]*i+A[6],t[1]=A[1]*r+A[4]*i+A[7],t}function Wo(t,e,A){var r=e[0],i=e[1];return t[0]=A[0]*r+A[4]*i+A[12],t[1]=A[1]*r+A[5]*i+A[13],t}function Zo(t,e,A){const r=e[0],i=e[1],n=A[3]*r+A[7]*i||1;return t[0]=(A[0]*r+A[4]*i)/n,t[1]=(A[1]*r+A[5]*i)/n,t}function Jo(t,e,A){const r=e[0],i=e[1],n=e[2],s=A[3]*r+A[7]*i+A[11]*n||1;return t[0]=(A[0]*r+A[4]*i+A[8]*n)/s,t[1]=(A[1]*r+A[5]*i+A[9]*n)/s,t[2]=(A[2]*r+A[6]*i+A[10]*n)/s,t}function $o(t,e,A){const r=e[0],i=e[1];return t[0]=A[0]*r+A[2]*i,t[1]=A[1]*r+A[3]*i,t[2]=e[2],t}function th(t,e,A){const r=e[0],i=e[1];return t[0]=A[0]*r+A[2]*i,t[1]=A[1]*r+A[3]*i,t[2]=e[2],t[3]=e[3],t}function eh(t,e,A){const r=e[0],i=e[1],n=e[2];return t[0]=A[0]*r+A[3]*i+A[6]*n,t[1]=A[1]*r+A[4]*i+A[7]*n,t[2]=A[2]*r+A[5]*i+A[8]*n,t[3]=e[3],t}Po(),Po(),Vo=new ja(9),ja!=Float32Array&&(Vo[1]=0,Vo[2]=0,Vo[3]=0,Vo[5]=0,Vo[6]=0,Vo[7]=0),Vo[0]=1,Vo[4]=1,Vo[8]=1,function(){var t=new ja(2);ja!=Float32Array&&(t[0]=0,t[1]=0);}();class Ah extends Xa{constructor(t=0,e=0){super(2),Ea(t)&&1===arguments.length?this.copy(t):(wa.debug&&(Va(t),Va(e)),this[0]=t,this[1]=e);}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return wa.debug&&(Va(t.x),Va(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}rotate(t,e,A){const r=t[0]-e[0],i=t[1]-e[1],n=Math.sin(A),s=Math.cos(A);return this[0]=r*s-i*n+e[0],this[1]=r*n+i*s+e[1],this.check()}transform(t,e){return e?this.transformAsPoint(t,e):this.transformAsPoint(t)}transformAsPoint(t,e){return e?(Wo(e,this,t),e.check()):(Wo(this,this,t),this.check())}transformAsVector(t,e){return e?(Zo(e,this,t),e.check()):(Zo(this,this,t),this.check())}transformByMatrix3(t,e){return e?(Yo(e,this,t),e.check()):(Yo(e,this,t),this.check())}transformByMatrix2x3(t,e){return e?(jo(e,this,t),e.check()):(jo(this,this,t),this.check())}transformByMatrix2(t,e){return e?(qo(e,this,t),e.check()):(qo(this,this,t),this.check())}perp(){const t=this.x;return this.x=this.y,this.y=-t,this.check()}}Fi("Vector2",Ah,{omit:["math.gl"]});const rh=[0,0,0],ih={};class nh extends Xa{static get ZERO(){return ih.ZERO=ih.ZERO||Object.freeze(new nh(0,0,0,0))}constructor(t=0,e=0,A=0){super(-0,-0,-0),1===arguments.length&&Ea(t)?this.copy(t):(wa.debug&&(Va(t),Va(e),Va(A)),this[0]=t,this[1]=e,this[2]=A);}set(t,e,A){return this[0]=t,this[1]=e,this[2]=A,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return wa.debug&&(Va(t.x),Va(t.y),Va(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Va(t);}angle(t,e){return function(t,e){var A=t[0],r=t[1],i=t[2],n=e[0],s=e[1],a=e[2],o=Math.sqrt(A*A+r*r+i*i)*Math.sqrt(n*n+s*s+a*a),h=o&&_o(t,e)/o;return Math.acos(Math.min(Math.max(h,-1),1))}(e||this,t)}cross(t,e){return e?(vo(e,this,t),e.check()):(vo(this,this,t),this.check())}rotateX({radians:t,origin:e=rh,result:A}){return A?(Mo(A,this,e,t),A.check()):(Mo(this,this,e,t),this.check())}rotateY({radians:t,origin:e=rh,result:A}){return A?(Qo(A,this,e,t),A.check()):(Qo(this,this,e,t),this.check())}rotateZ({radians:t,origin:e=rh,result:A}){return A?(Io(A,this,e,t),A.check()):(Io(this,this,e,t),this.check())}transform(t){return this.transformAsPoint(t)}transformAsPoint(t,e){return e?(bo(e,this,t),e.check()):(bo(this,this,t),this.check())}transformAsVector(t,e){return e?(Jo(e,this,t),e.check()):(Jo(this,this,t),this.check())}transformByMatrix3(t,e){return e?(Uo(e,this,t),e.check()):(Uo(this,this,t),this.check())}transformByMatrix2(t,e){return e?($o(e,this,t),e.check()):($o(this,this,t),this.check())}transformByQuaternion(t,e){return e?(Fo(e,this,t),e.check()):(Fo(this,this,t),this.check())}applyMatrix3(t){const e=this[0],A=this[1],r=this[2],i=t.elements;return this[0]=i[0]*e+i[3]*A+i[6]*r,this[1]=i[1]*e+i[4]*A+i[7]*r,this[2]=i[2]*e+i[5]*A+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this[0],A=this[1],r=this[2],i=t.elements,n=1/(i[3]*e+i[7]*A+i[11]*r+i[15]);return this[0]=(i[0]*e+i[4]*A+i[8]*r+i[12])*n,this[1]=(i[1]*e+i[5]*A+i[9]*r+i[13])*n,this[2]=(i[2]*e+i[6]*A+i[10]*r+i[14])*n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this[0],A=this[1],r=this[2],i=t.elements;return this[0]=i[0]*e+i[4]*A+i[8]*r,this[1]=i[1]*e+i[5]*A+i[9]*r,this[2]=i[2]*e+i[6]*A+i[10]*r,this.normalize()}clampLength(t,e){const A=this.len();return this.divideScalar(A||1).multiplyScalar(Math.max(t,Math.min(e,A)))}floor(){return this[0]=Math.floor(this[0]),this[1]=Math.floor(this[1]),this[2]=Math.floor(this[2]),this}ceil(){return this[0]=Math.ceil(this[0]),this[1]=Math.ceil(this[1]),this[2]=Math.ceil(this[2]),this}round(){return this[0]=Math.round(this[0]),this[1]=Math.round(this[1]),this[2]=Math.round(this[2]),this}roundToZero(){return this[0]=this[0]<0?Math.ceil(this[0]):Math.floor(this[0]),this[1]=this[1]<0?Math.ceil(this[1]):Math.floor(this[1]),this[2]=this[2]<0?Math.ceil(this[2]):Math.floor(this[2]),this}manhattanLength(){return Math.abs(this[0])+Math.abs(this[1])+Math.abs(this[2])}setLength(t){return this.normalize().multiplyScalar(t)}lerpVectors(t,e,A){return this[0]=t[0]+(e[0]-t[0])*A,this[1]=t[1]+(e[1]-t[1])*A,this[2]=t[2]+(e[2]-t[2])*A,this}crossVectors(t,e){const A=t[0],r=t[1],i=t[2],n=e[0],s=e[1],a=e[2];return this[0]=r*a-i*s,this[1]=i*n-A*a,this[2]=A*s-r*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const A=t.dot(this)/e;return this.copy(t).multiplyScalar(A)}projectOnPlane(t){return (new nh).copy(this).projectOnVector(t),this.sub(new nh)}reflect(t){return this.sub((new nh).copy(t).multiplyScalar(2*this.dot(t)))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this[0]-t[0],A=this[1]-t[1],r=this[2]-t[2];return e*e+A*A+r*r}manhattanDistanceTo(t){return Math.abs(this[0]-t[0])+Math.abs(this[1]-t[1])+Math.abs(this[2]-t[2])}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,A){const r=Math.sin(e)*t;return this[0]=r*Math.sin(A),this[1]=Math.cos(e)*t,this[2]=r*Math.cos(A),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,A){return this[0]=t*Math.sin(e),this[1]=A,this[2]=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this[0]=e[12],this[1]=e[13],this[2]=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).len(),A=this.setFromMatrixColumn(t,1).len(),r=this.setFromMatrixColumn(t,2).len();return this[0]=e,this[1]=A,this[2]=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t[0]===this[0]&&t[1]===this[1]&&t[2]===this[2]}random(){return this[0]=Math.random(),this[1]=Math.random(),this[2]=Math.random(),this}}Fi("Vector3",nh,{omit:["math.gl"]});const sh={};class ah extends Xa{static get ZERO(){return sh.ZERO=sh.ZERO||Object.freeze(new ah(0,0,0,0))}constructor(t=0,e=0,A=0,r=0){super(-0,-0,-0,-0),Ea(t)&&1===arguments.length?this.copy(t):(wa.debug&&(Va(t),Va(e),Va(A),Va(r)),this[0]=t,this[1]=e,this[2]=A,this[3]=r);}set(t,e,A,r){return this[0]=t,this[1]=e,this[2]=A,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return wa.debug&&(Va(t.x),Va(t.y),Va(t.z),Va(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Va(t);}get w(){return this[3]}set w(t){this[3]=Va(t);}transform(t,e){return e?(Ro(e,this,t),e.check()):(Ro(this,this,t),this.check())}transformByMatrix3(t,e){return e?(eh(e,this,t),e.check()):(eh(this,this,t),this.check())}transformByMatrix2(t,e){return e?(th(e,this,t),e.check()):(th(this,this,t),this.check())}transformByQuaternion(t,e){return e?(Lo(e,this,t),e.check()):(Lo(this,this,t),this.check())}applyMatrix4(t){return t.transform(this,this),this}}Fi("Vector4",ah,{omit:["math.gl"]});class oh extends ka{get ELEMENTS(){return 0}get RANK(){return 0}toString(){let t="[";if(wa.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let A=0;A<this.RANK;++A)t+=` ${this[A*this.RANK+e]}`;}else {t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`;}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,A){return this[e*this.RANK+t]=Va(A),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const A=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[A+t];return e}setColumn(t,e){const A=t*this.RANK;for(let t=0;t<this.RANK;++t)this[A+t]=e[t];return this}toFloat32Array(){return new Float32Array(this.toArray())}}const hh=Object.freeze([1,0,0,1]),lh=Object.freeze([0,0,0,0]),ch=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL1ROW0:2,COL1ROW1:3}),uh={};class ph extends oh{static get IDENTITY(){return uh.IDENTITY=uh.IDENTITY||Object.freeze(new ph(hh)),uh.IDENTITY}static get ZERO(){return uh.ZERO=uh.ZERO||Object.freeze(new ph(lh)),uh.ZERO}get ELEMENTS(){return 4}get RANK(){return 2}get INDICES(){return ch}constructor(t){super(-0,-0,-0,-0),1===arguments.length&&Ea(t)?this.copy(t):this.identity();}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,A,r){return this[0]=t,this[1]=e,this[2]=A,this[3]=r,this.check()}setRowMajor(t,e,A,r){return this[0]=t,this[1]=A,this[2]=e,this[3]=r,this.check()}determinant(){return function(t){return t[0]*t[3]-t[2]*t[1]}(this)}identity(){return this.copy(hh)}transpose(t){return t?(Ya(t,this),t.check()):(Ya(this,this),this.check())}invert(t){return t?(Wa(t,this),t.check()):(Wa(this,this),this.check())}multiplyLeft(t,e){return e?(Za(e,t,this),e.check()):(Za(this,t,this),this.check())}multiplyRight(t,e){return e?(Za(e,this,t),e.check()):(Za(this,this,t),this.check())}rotate(t,e){return e?(Ja(e,this,t),e.check()):(Ja(this,this,t),this.check())}scale(t,e){return e?(Ea(t)?$a(e,this,t):$a(e,this,[t,t,t]),e.check()):(Ea(t)?$a(this,this,t):$a(this,this,[t,t,t]),this.check())}transform(t,e){switch(t.length){case 2:e=Yo(e||[-0,-0],t,this);break;case 3:e=Uo(e||[-0,-0,-0],t,this);break;case 4:e=eh(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ga(e,t.length),e}transformVector(t,e){return za("Matrix2.transformVector"),this.transform(t,e)}transformVector2(t,e){return za("Matrix2.transformVector"),this.transform(t,e)}transformVector3(t,e){return za("Matrix2.transformVector"),this.transform(t,e)}}Fi("Matrix2",ph,{omit:["math.gl"]});const dh=Object.freeze([1,0,0,0,1,0,0,0,1]),fh=Object.freeze([0,0,0,0,0,0,0,0,0]),yh=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),gh={};class mh extends oh{static get IDENTITY(){return gh.IDENTITY=gh.IDENTITY||Object.freeze(new mh(dh)),gh.IDENTITY}static get ZERO(){return gh.ZERO=gh.ZERO||Object.freeze(new mh(fh)),gh.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return yh}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Ea(t)?this.copy(t):this.identity();}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}set(t,e,A,r,i,n,s,a,o){return this[0]=t,this[1]=e,this[2]=A,this[3]=r,this[4]=i,this[5]=n,this[6]=s,this[7]=a,this[8]=o,this.check()}setRowMajor(t,e,A,r,i,n,s,a,o){return this[0]=t,this[1]=r,this[2]=s,this[3]=e,this[4]=i,this[5]=a,this[6]=A,this[7]=n,this[8]=o,this.check()}determinant(){return function(t){var e=t[3],A=t[4],r=t[5],i=t[6],n=t[7],s=t[8];return t[0]*(s*A-r*n)+t[1]*(-s*e+r*i)+t[2]*(n*e-A*i)}(this)}identity(){return this.copy(dh)}fromQuaternion(t,e){return e?(so(e,t),e.check()):(so(this,t),this.check())}transpose(t){return t?(to(t,this),t.check()):(to(this,this),this.check())}invert(t){return t?(eo(t,this),t.check()):(eo(this,this),this.check())}multiplyLeft(t,e){return e?(Ao(e,t,this),e.check()):(Ao(this,t,this),this.check())}multiplyRight(t,e){return e?(Ao(e,this,t),e.check()):(Ao(this,this,t),this.check())}rotate(t,e){return e?(io(e,this,t),e.check()):(io(this,this,t),this.check())}scale(t,e){return e?(Ea(t)?no(e,this,t):no(e,this,[t,t,t]),e.check()):(Ea(t)?no(this,this,t):no(this,this,[t,t,t]),this.check())}translate(t,e){return e?(ro(e,this,t),e.check()):(ro(this,this,t),this.check())}transform(t,e){switch(t.length){case 2:e=Yo(e||[-0,-0],t,this);break;case 3:e=Uo(e||[-0,-0,-0],t,this);break;case 4:e=eh(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ga(e,t.length),e}transformVector(t,e){return za("Matrix3.transformVector"),this.transform(t,e)}transformVector2(t,e){return za("Matrix3.transformVector"),this.transform(t,e)}transformVector3(t,e){return za("Matrix3.transformVector"),this.transform(t,e)}}Fi("Matrix3",mh,{omit:["math.gl"]});const Bh=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),wh=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),xh=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Ch={};class Eh extends oh{static get IDENTITY(){return Ch.IDENTITY=Ch.IDENTITY||Object.freeze(new Eh(Bh)),Ch.IDENTITY}static get ZERO(){return Ch.ZERO=Ch.ZERO||Object.freeze(new Eh(wh)),Ch.ZERO}static multiply(t,e,A){if(!t||!e||!A)throw new Error("multiply error para");return ho(t,e,A),t.check()}get INDICES(){return xh}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Ea(t)?this.copy(t):this.identity();}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,A,r,i,n,s,a,o,h,l,c,u,p,d,f){return this[0]=t,this[1]=e,this[2]=A,this[3]=r,this[4]=i,this[5]=n,this[6]=s,this[7]=a,this[8]=o,this[9]=h,this[10]=l,this[11]=c,this[12]=u,this[13]=p,this[14]=d,this[15]=f,this.check()}setRowMajor(t,e,A,r,i,n,s,a,o,h,l,c,u,p,d,f){return this[0]=t,this[1]=i,this[2]=o,this[3]=u,this[4]=e,this[5]=n,this[6]=h,this[7]=p,this[8]=A,this[9]=s,this[10]=l,this[11]=d,this[12]=r,this[13]=a,this[14]=c,this[15]=f,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Bh)}fromQuaternion(t){return function(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=A+A,a=r+r,o=i+i,h=A*s,l=r*s,c=r*a,u=i*s,p=i*a,d=i*o,f=n*s,y=n*a,g=n*o;t[0]=1-c-d,t[1]=l+g,t[2]=u-y,t[3]=0,t[4]=l-g,t[5]=1-h-d,t[6]=p+f,t[7]=0,t[8]=u+y,t[9]=p-f,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1;}(this,t),this.check()}frustum({left:t,right:e,bottom:A,top:r,near:i,far:n}){return n===1/0?Eh._computeInfinitePerspectiveOffCenter(this,t,e,A,r,i):function(t,e,A,r,i,n,s){var a=1/(A-e),o=1/(i-r),h=1/(n-s);t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*o,t[6]=0,t[7]=0,t[8]=(A+e)*a,t[9]=(i+r)*o,t[10]=(s+n)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n*2*h,t[15]=0;}(this,t,e,A,r,i,n),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,A,r,i,n){const s=2*n/(i-r),a=(A+e)/(A-e),o=(i+r)/(i-r),h=-2*n;return t[0]=2*n/(A-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=a,t[9]=o,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}lookAt(t,e,A){return 1===arguments.length&&({eye:t,center:e,up:A}=t),function(t,e,A,r){var i,n,s,a,o,h,l,c,u,p,d=e[0],f=e[1],y=e[2],g=r[0],m=r[1],B=r[2],w=A[0],x=A[1],C=A[2];Math.abs(d-w)<qa&&Math.abs(f-x)<qa&&Math.abs(y-C)<qa?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1;}(t):(l=d-w,c=f-x,u=y-C,i=m*(u*=p=1/Math.hypot(l,c,u))-B*(c*=p),n=B*(l*=p)-g*u,s=g*c-m*l,(p=Math.hypot(i,n,s))?(i*=p=1/p,n*=p,s*=p):(i=0,n=0,s=0),a=c*s-u*n,o=u*i-l*s,h=l*n-c*i,(p=Math.hypot(a,o,h))?(a*=p=1/p,o*=p,h*=p):(a=0,o=0,h=0),t[0]=i,t[1]=a,t[2]=l,t[3]=0,t[4]=n,t[5]=o,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=u,t[11]=0,t[12]=-(i*d+n*f+s*y),t[13]=-(a*d+o*f+h*y),t[14]=-(l*d+c*f+u*y),t[15]=1);}(this,t,e=e||[0,0,0],A=A||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:A,top:r,near:i=.1,far:n=500}){return function(t,e,A,r,i,n,s){var a=1/(e-A),o=1/(r-i),h=1/(n-s);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+A)*a,t[13]=(i+r)*o,t[14]=(s+n)*h,t[15]=1;}(this,t,e,A,r,i,n),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:A=1,near:r=.1,far:i=500}){if(t>2*Math.PI)throw Error("radians");const n=A*Math.tan(t/2),s=n*e;return (new Eh).ortho({left:-s,right:s,bottom:-n,top:n,near:r,far:i})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:A=1,near:r=.1,far:i=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return go(this,t,A,r,i),this.check()}determinant(){return function(t){var e=t[0],A=t[1],r=t[2],i=t[3],n=t[4],s=t[5],a=t[6],o=t[7],h=t[8],l=t[9],c=t[10],u=t[11],p=t[12],d=t[13],f=t[14],y=t[15];return (e*s-A*n)*(c*y-u*f)-(e*a-r*n)*(l*y-u*d)+(e*o-i*n)*(l*f-c*d)+(A*a-r*s)*(h*y-u*p)-(A*o-i*s)*(h*f-c*p)+(r*o-i*a)*(h*d-l*p)}(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const A=this.getScale(e||[-0,-0,-0]),r=1/A[0],i=1/A[1],n=1/A[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*n,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const A=this.getScale(e||[-0,-0,-0]),r=1/A[0],i=1/A[1],n=1/A[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*n,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*n,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*n,t}transpose(t){return t?(ao(t,this),t.check()):(ao(this,this),this.check())}invert(t){return t?(oo(t,this),t.check()):(oo(this,this),this.check())}multiplyLeft(t,e){return e?(ho(e,t,this),e.check()):(ho(this,t,this),this.check())}multiplyRight(t,e){return e?(ho(e,this,t),e.check()):(ho(this,this,t),this.check())}rotateX(t,e){return e?(po(e,this,t),e.check()):(po(this,this,t),this.check())}rotateY(t,e){return e?(fo(e,this,t),e.check()):(fo(this,this,t),this.check())}rotateZ(t,e){return e?(yo(e,this,t),e.check()):(yo(this,this,t),this.check())}rotateXYZ([t,e,A]){return this.rotateX(t).rotateY(e).rotateZ(A)}rotateAxis(t,e,A){return A?(uo(A,this,t,e),A.check()):(uo(this,this,t,e),this.check())}scale(t,e){return e?(co(e,this,"number"!=typeof t?t:[t,t,t]),e.check()):(co(this,this,"number"!=typeof t?t:[t,t,t]),this.check())}translate(t,e){return e?(lo(e,this,t),e.check()):(lo(this,this,t),this.check())}transform(t,e){return 4===t.length?(Ga(e=Ro(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:A}=t.toArray();switch(A){case 2:e=Wo(e||[-0,-0],t,this);break;case 3:e=bo(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ga(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=Zo(e||[-0,-0],t,this);break;case 3:e=Jo(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ga(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,A){return this.identity().translate([t,e,A])}transformPoint(t,e){return za("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return za("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return za("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}Eh.fromRotationTranslation=function(t,e,A){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=0,A[4]=t[3],A[5]=t[4],A[6]=t[5],A[7]=0,A[8]=t[6],A[9]=t[7],A[10]=t[8],A[11]=0,A[12]=e.x,A[13]=e.y,A[14]=e.z,A[15]=1,A},Fi("Matrix4",Eh,{omit:["math.gl"]});const _h=[0,0,0,1];class vh extends ka{constructor(t=0,e=0,A=0,r=1){super(-0,-0,-0,-0),Ea(t)&&1===arguments.length?this.copy(t):this.set(t,e,A,r);}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,A,r){return this[0]=t,this[1]=e,this[2]=A,this[3]=r,this.check()}fromMatrix3(t){return function(t,e){var A,r=e[0]+e[4]+e[8];if(r>0)A=Math.sqrt(r+1),t[3]=.5*A,t[0]=(e[5]-e[7])*(A=.5/A),t[1]=(e[6]-e[2])*A,t[2]=(e[1]-e[3])*A;else {var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var n=(i+1)%3,s=(i+2)%3;A=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1),t[i]=.5*A,t[3]=(e[3*n+s]-e[3*s+n])*(A=.5/A),t[n]=(e[3*n+i]+e[3*i+n])*A,t[s]=(e[3*s+i]+e[3*i+s])*A;}}(this,t),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1;}(this),this.check()}fromAxisRotation(t,e){return Ho(this,t,e),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Va(t);}get y(){return this[1]}set y(t){this[1]=Va(t);}get z(){return this[2]}set z(t){this[2]=Va(t);}get w(){return this[3]}set w(t){this[3]=Va(t);}len(){return function(t){return Math.hypot(t[0],t[1],t[2],t[3])}(this)}lengthSquared(){return function(t){var e=t[0],A=t[1],r=t[2],i=t[3];return e*e+A*A+r*r+i*i}(this)}dot(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(this,t)}getAxisAngle(){const t=[],e=function(t,e){var A=2*Math.acos(e[3]),r=Math.sin(A/2);return r>qa?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),A}(t,this);return {axis:t,angle:e}}rotationTo(t,e){return Ko(this,t,e),this.check()}add(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return function(t,e,A){t[0]=e[0]+A[0],t[1]=e[1]+A[1],t[2]=e[2]+A[2],t[3]=e[3]+A[3];}(this,this,t),this.check()}calculateW(){return function(t,e){var A=e[0],r=e[1],i=e[2];t[0]=A,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-A*A-r*r-i*i));}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3];}(this,this),this.check()}invert(){return function(t,e){var A=e[0],r=e[1],i=e[2],n=e[3],s=A*A+r*r+i*i+n*n,a=s?1/s:0;t[0]=-A*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a;}(this,this),this.check()}lerp(t,e,A){return function(t,e,A,r){var i=e[0],n=e[1],s=e[2],a=e[3];t[0]=i+r*(A[0]-i),t[1]=n+r*(A[1]-n),t[2]=s+r*(A[2]-s),t[3]=a+r*(A[3]-a);}(this,t,e,A),this.check()}multiplyRight(t,e){return Oo(this,this,t),this.check()}multiplyLeft(t,e){return Oo(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,A){A*=.5;var r=e[0],i=e[1],n=e[2],s=e[3],a=Math.sin(A),o=Math.cos(A);t[0]=r*o+s*a,t[1]=i*o+n*a,t[2]=n*o-i*a,t[3]=s*o-r*a;}(this,this,t),this.check()}rotateY(t){return function(t,e,A){A*=.5;var r=e[0],i=e[1],n=e[2],s=e[3],a=Math.sin(A),o=Math.cos(A);t[0]=r*o-n*a,t[1]=i*o+s*a,t[2]=n*o+r*a,t[3]=s*o-i*a;}(this,this,t),this.check()}rotateZ(t){return function(t,e,A){A*=.5;var r=e[0],i=e[1],n=e[2],s=e[3],a=Math.sin(A),o=Math.cos(A);t[0]=r*o+i*a,t[1]=i*o-r*a,t[2]=n*o+s*a,t[3]=s*o-n*a;}(this,this,t),this.check()}scale(t){return Go(this,this,t),this.check()}slerp(t,e,A){switch(arguments.length){case 1:({start:t=_h,target:e,ratio:A}=arguments[0]);break;case 2:[e,A]=arguments,t=this;}return function(t,e,A,r){var i,n,s,a,o,h=e[0],l=e[1],c=e[2],u=e[3],p=A[0],d=A[1],f=A[2],y=A[3];(n=h*p+l*d+c*f+u*y)<0&&(n=-n,p=-p,d=-d,f=-f,y=-y),1-n>qa?(i=Math.acos(n),s=Math.sin(i),a=Math.sin((1-r)*i)/s,o=Math.sin(r*i)/s):(a=1-r,o=r),t[0]=a*h+o*p,t[1]=a*l+o*d,t[2]=a*c+o*f,t[3]=a*u+o*y;}(this,t,e,A),this.check()}transformVector4(t,e=t){return Lo(e,t,this),Ga(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t,e){return this.multiplyLeft(t,e)}multiply(t,e){return this.multiplyRight(t,e)}}Fi("Quaternion",vh,{omit:["math.gl"]});var bh={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI};const Uh=1e-6;class Fh{constructor({phi:t=0,theta:e=0,radius:A=1,bearing:r,pitch:i,altitude:n,radiusScale:s=6371e3}={}){this.phi=t,this.theta=e,this.radius=A||n||1,this.radiusScale=s||1,void 0!==r&&(this.bearing=r),void 0!==i&&(this.pitch=i),this.check();}toString(){return this.formatString(wa)}formatString({printTypes:t=!1}){const e=Ca;return `${t?"Spherical":""}[rho:${e(this.radius)},theta:${e(this.theta)},phi:${e(this.phi)}]`}equals(t){return Oa(this.radius,t.radius)&&Oa(this.theta,t.theta)&&Oa(this.phi,t.phi)}exactEquals(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}get bearing(){return 180-Ma(this.phi)}set bearing(t){this.phi=Math.PI-Fa(t);}get pitch(){return Ma(this.theta)}set pitch(t){this.theta=Fa(t);}get longitude(){return Ma(this.phi)}get latitude(){return Ma(this.theta)}get lng(){return Ma(this.phi)}get lat(){return Ma(this.theta)}get z(){return (this.radius-1)*this.radiusScale}set(t,e,A){return this.radius=t,this.phi=e,this.theta=A,this.check()}clone(){return (new Fh).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}fromLngLatZ([t,e,A]){this.radius=1+A/this.radiusScale,this.phi=Fa(e),this.theta=Fa(t);}fromVector3(t){return this.radius=wo(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Pa(t[2]/this.radius,-1,1))),this.check()}toVector3(){return new nh(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Uh,Math.min(Math.PI-Uh,this.phi)),this}check(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}const Mh="Unknown Euler angle order",Qh=.99999;class Ih extends ka{static get ZYX(){return 0}static get YXZ(){return 1}static get XZY(){return 2}static get ZXY(){return 3}static get YZX(){return 4}static get XYZ(){return 5}static get RollPitchYaw(){return 0}static get DefaultOrder(){return Ih.ZYX}static get RotationOrders(){return ["ZYX","YXZ","XZY","ZXY","YZX","XYZ"]}static rotationOrder(t){return Ih.RotationOrders[t]}get ELEMENTS(){return 4}constructor(t=0,e=0,A=0,r=Ih.DefaultOrder){super(-0,-0,-0,-0),arguments.length>0&&Ea(arguments[0])?this.fromVector3(...arguments):this.set(t,e,A,r);}fromQuaternion(t){const[e,A,r,i]=t,n=A*A,s=-2*(n+r*r)+1,a=2*(e*A+i*r);let o=-2*(e*r-i*A);o=o>1?1:o,o=o<-1?-1:o;const h=Math.atan2(2*(A*r+i*e),-2*(e*e+n)+1),l=Math.asin(o),c=Math.atan2(a,s);return new Ih(h,l,c,Ih.RollPitchYaw)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=Number.isFinite(t[3])||this.order,this.check()}set(t=0,e=0,A=0,r){return this[0]=t,this[1]=e,this[2]=A,this[3]=Number.isFinite(r)?r:this[3],this.check()}validate(){return (t=this[3])>=0&&t<6&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2]);var t;}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}toArray4(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}toVector3(t=[-0,-0,-0]){return t[0]=this[0],t[1]=this[1],t[2]=this[2],t}get x(){return this[0]}set x(t){this[0]=Va(t);}get y(){return this[1]}set y(t){this[1]=Va(t);}get z(){return this[2]}set z(t){this[2]=Va(t);}get alpha(){return this[0]}set alpha(t){this[0]=Va(t);}get beta(){return this[1]}set beta(t){this[1]=Va(t);}get gamma(){return this[2]}set gamma(t){this[2]=Va(t);}get phi(){return this[0]}set phi(t){this[0]=Va(t);}get theta(){return this[1]}set theta(t){this[1]=Va(t);}get psi(){return this[2]}set psi(t){this[2]=Va(t);}get roll(){return this[0]}set roll(t){this[0]=Va(t);}get pitch(){return this[1]}set pitch(t){this[1]=Va(t);}get yaw(){return this[2]}set yaw(t){this[2]=Va(t);}get order(){return this[3]}set order(t){this[3]=function(t){if(t<0&&t>=6)throw new Error(Mh);return t}(t);}fromVector3(t,e){return this.set(t[0],t[1],t[2],Number.isFinite(e)?e:this[3])}fromArray(t,e=0){return this[0]=t[0+e],this[1]=t[1+e],this[2]=t[2+e],void 0!==t[3]&&(this[3]=t[3]),this.check()}fromRollPitchYaw(t,e,A){return this.set(t,e,A,Ih.ZYX)}fromRotationMatrix(t,e=Ih.DefaultOrder){return this._fromRotationMatrix(t,e),this.check()}getRotationMatrix(t){return this._getRotationMatrix(t)}getQuaternion(){const t=new vh;switch(this[4]){case Ih.XYZ:return t.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case Ih.YXZ:return t.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case Ih.ZXY:return t.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case Ih.ZYX:return t.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case Ih.YZX:return t.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case Ih.XZY:return t.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(Mh)}}_fromRotationMatrix(t,e=Ih.DefaultOrder){const A=t.elements,r=A[0],i=A[4],n=A[8],s=A[1],a=A[5],o=A[9],h=A[2],l=A[6],c=A[10];switch(e=e||this[3]){case Ih.XYZ:this[1]=Math.asin(Pa(n,-1,1)),Math.abs(n)<Qh?(this[0]=Math.atan2(-o,c),this[2]=Math.atan2(-i,r)):(this[0]=Math.atan2(l,a),this[2]=0);break;case Ih.YXZ:this[0]=Math.asin(-Pa(o,-1,1)),Math.abs(o)<Qh?(this[1]=Math.atan2(n,c),this[2]=Math.atan2(s,a)):(this[1]=Math.atan2(-h,r),this[2]=0);break;case Ih.ZXY:this[0]=Math.asin(Pa(l,-1,1)),Math.abs(l)<Qh?(this[1]=Math.atan2(-h,c),this[2]=Math.atan2(-i,a)):(this[1]=0,this[2]=Math.atan2(s,r));break;case Ih.ZYX:this[1]=Math.asin(-Pa(h,-1,1)),Math.abs(h)<Qh?(this[0]=Math.atan2(l,c),this[2]=Math.atan2(s,r)):(this[0]=0,this[2]=Math.atan2(-i,a));break;case Ih.YZX:this[2]=Math.asin(Pa(s,-1,1)),Math.abs(s)<Qh?(this[0]=Math.atan2(-o,a),this[1]=Math.atan2(-h,r)):(this[0]=0,this[1]=Math.atan2(n,c));break;case Ih.XZY:this[2]=Math.asin(-Pa(i,-1,1)),Math.abs(i)<Qh?(this[0]=Math.atan2(l,a),this[1]=Math.atan2(n,r)):(this[0]=Math.atan2(-o,c),this[1]=0);break;default:throw new Error(Mh)}return this[3]=e,this}_getRotationMatrix(t){const e=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],A=this.x,r=this.y,i=this.z,n=Math.cos(A),s=Math.cos(r),a=Math.cos(i),o=Math.sin(A),h=Math.sin(r),l=Math.sin(i);switch(this[3]){case Ih.XYZ:{const t=n*a,A=n*l,r=o*a,i=o*l;e[0]=s*a,e[4]=-s*l,e[8]=h,e[1]=A+r*h,e[5]=t-i*h,e[9]=-o*s,e[2]=i-t*h,e[6]=r+A*h,e[10]=n*s;break}case Ih.YXZ:{const t=s*a,A=s*l,r=h*a,i=h*l;e[0]=t+i*o,e[4]=r*o-A,e[8]=n*h,e[1]=n*l,e[5]=n*a,e[9]=-o,e[2]=A*o-r,e[6]=i+t*o,e[10]=n*s;break}case Ih.ZXY:{const t=s*a,A=s*l,r=h*a,i=h*l;e[0]=t-i*o,e[4]=-n*l,e[8]=r+A*o,e[1]=A+r*o,e[5]=n*a,e[9]=i-t*o,e[2]=-n*h,e[6]=o,e[10]=n*s;break}case Ih.ZYX:{const t=n*a,A=n*l,r=o*a,i=o*l;e[0]=s*a,e[4]=r*h-A,e[8]=t*h+i,e[1]=s*l,e[5]=i*h+t,e[9]=A*h-r,e[2]=-h,e[6]=o*s,e[10]=n*s;break}case Ih.YZX:{const t=n*s,A=n*h,r=o*s,i=o*h;e[0]=s*a,e[4]=i-t*l,e[8]=r*l+A,e[1]=l,e[5]=n*a,e[9]=-o*a,e[2]=-h*a,e[6]=A*l+r,e[10]=t-i*l;break}case Ih.XZY:{const t=n*s,A=n*h,r=o*s,i=o*h;e[0]=s*a,e[4]=-l,e[8]=h*a,e[1]=t*l+i,e[5]=n*a,e[9]=A*l-r,e[2]=r*l-A,e[6]=o*a,e[10]=i*l+t;break}default:throw new Error(Mh)}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}toQuaternion(){const t=Math.cos(.5*this.yaw),e=Math.sin(.5*this.yaw),A=Math.cos(.5*this.roll),r=Math.sin(.5*this.roll),i=Math.cos(.5*this.pitch),n=Math.sin(.5*this.pitch);return new vh(t*r*i-e*A*n,t*A*n+e*r*i,e*A*i-t*r*n,t*A*i+e*r*n)}}class Sh{constructor({x:t=0,y:e=0,z:A=0,roll:r=0,pitch:i=0,yaw:n=0,position:s,orientation:a}={}){this.position=Ea(s)&&3===s.length?new nh(s):new nh(t,e,A),this.orientation=Ea(a)&&4===a.length?new Ih(a,a[3]):new Ih(r,i,n,Ih.RollPitchYaw);}get x(){return this.position.x}set x(t){this.position.x=t;}get y(){return this.position.y}set y(t){this.position.y=t;}get z(){return this.position.z}set z(t){this.position.z=t;}get roll(){return this.orientation.roll}set roll(t){this.orientation.roll=t;}get pitch(){return this.orientation.pitch}set pitch(t){this.orientation.pitch=t;}get yaw(){return this.orientation.yaw}set yaw(t){this.orientation.yaw=t;}getPosition(){return this.position}getOrientation(){return this.orientation}equals(t){return !!t&&this.position.equals(t.position)&&this.orientation.equals(t.orientation)}exactEquals(t){return !!t&&this.position.exactEquals(t.position)&&this.orientation.exactEquals(t.orientation)}getTransformationMatrix(){const t=Math.sin(this.roll),e=Math.sin(this.pitch),A=Math.sin(this.yaw),r=Math.cos(this.roll),i=Math.cos(this.pitch),n=Math.cos(this.yaw);return (new Eh).setRowMajor(n*i,-A*r+n*e*t,A*t+n*e*r,this.x,A*i,n*r+A*e*t,-n*t+A*e*r,this.y,-e,i*t,i*r,this.z,0,0,0,1)}getTransformationMatrixFromPose(t){return (new Eh).multiplyRight(this.getTransformationMatrix()).multiplyRight(t.getTransformationMatrix().invert())}getTransformationMatrixToPose(t){return (new Eh).multiplyRight(t.getTransformationMatrix()).multiplyRight(this.getTransformationMatrix().invert())}}const Th="undefined"!=typeof self&&self,Rh="undefined"!=typeof window&&window;("undefined"!=typeof global&&global||Th||Rh).mathgl={config:wa};var Lh=Object.freeze({__proto__:null,Vector2:Ah,Vector3:nh,Vector4:ah,Matrix2:ph,Matrix3:mh,Matrix4:Eh,Quaternion:vh,config:wa,configure:xa,formatValue:Ca,isArray:Ea,clone:_a,equals:Oa,exactEquals:Da,toRadians:ba,toDegrees:Ua,radians:Fa,degrees:Ma,sin:Qa,cos:Ia,tan:Sa,asin:Ta,acos:Ra,atan:La,clamp:Pa,lerp:Ha,withEpsilon:Na,checkNumber:Va,_MathUtils:bh,SphericalCoordinates:Fh,Pose:Sh,Euler:Ih,assert:ya,_SphericalCoordinates:Fh,_Pose:Sh,_Euler:Ih});const Ph=6378137,Hh=6378137,Oh=6356752.314245179,Dh={radii:[Ph,Hh,Oh],radiiSquared:[40680631590769,40680631590769,40408299984661.445],oneOverRadii:[1/Ph,1/Hh,1/Oh],oneOverRadiiSquared:[1/40680631590769,1/40680631590769,1/40408299984661.445],maximumRadius:Math.max(Ph,Hh,Oh),centerToleranceSquared:.1},Nh=t=>t,kh=new nh,Vh=new nh,Gh=new nh,Kh=new nh,zh=new nh,Xh={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qh={east:new nh,north:new nh,up:new nh,west:new nh,south:new nh,down:new nh},jh=new nh,Yh=new nh,Wh=new nh;function Zh(t,e,A,r,i,n){let s,a,o;const h=zh.copy(i);if(Oa(h.x,0,1e-14)&&Oa(h.y,0,1e-14)){const t=Math.sign(h.z);s=jh.fromArray(Xh[e]),"east"!==e&&"west"!==e&&s.scale(t),a=Yh.fromArray(Xh[A]),"east"!==A&&"west"!==A&&a.scale(t),o=Wh.fromArray(Xh[r]),"east"!==r&&"west"!==r&&o.scale(t);}else {const{up:i,east:n,north:l}=qh;n.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,i),l.copy(i).cross(n);const{down:c,west:u,south:p}=qh;c.copy(i).scale(-1),u.copy(n).scale(-1),p.copy(l).scale(-1),s=qh[e],a=qh[A],o=qh[r];}return n[0]=s.x,n[1]=s.y,n[2]=s.z,n[3]=0,n[4]=a.x,n[5]=a.y,n[6]=a.z,n[7]=0,n[8]=o.x,n[9]=o.y,n[10]=o.z,n[11]=0,n[12]=h.x,n[13]=h.y,n[14]=h.z,n[15]=1,n}const Jh=new nh,$h=new nh,tl=new nh,el=new nh,Al=new nh,rl=new nh;let il;class nl{static get WGS84(){return il=il||new nl(Ph,Hh,Oh),il}constructor(t=0,e=0,A=0){this.radii=new nh(t,e,A),this.radiiSquared=new nh(t*t,e*e,A*A),this.radiiToTheFourth=new nh(t*t*t*t,e*e*e*e,A*A*A*A),this.oneOverRadii=new nh(0===t?0:1/t,0===e?0:1/e,0===A?0:1/A),this.oneOverRadiiSquared=new nh(0===t?0:1/(t*t),0===e?0:1/(e*e),0===A?0:1/(A*A)),this.minimumRadius=Math.min(t,e,A),this.maximumRadius=Math.max(t,e,A),this.centerToleranceSquared=bh.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this);}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const A=$h,r=tl,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,A),r.copy(this.radiiSquared).scale(A);const n=Math.sqrt(A.dot(r));return r.scale(1/n),A.scale(i),r.add(A),r.to(e)}cartesianToCartographic(t,e=[0,0,0]){rl.from(t);const A=this.scaleToGeodeticSurface(rl,el);if(!A)return;const r=this.geodeticSurfaceNormal(A,$h),i=Al;return i.copy(rl).subtract(A),function(t,e,A=Nh){return Ea(e)?(e[0]=A(t[0]),e[1]=A(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=A(t[0]),e.latitude=A(t[1]),e.height=t[2]):(e.x=A(t[0]),e.y=A(t[1]),e.z=t[2]),e}([Math.atan2(r.y,r.x),Math.asin(r.z),Math.sign(_o(i,rl))*wo(i)],e,wa._cartographicRadians?Nh:Ua)}eastNorthUpToFixedFrame(t,e=new Eh){return Zh(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,A,r,i=new Eh){return Zh(this,t,e,A,r,i)}geocentricSurfaceNormal(t,e=[0,0,0]){return Jh.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const A=function(t,e=kh){return function(t,e,A=Nh){return Ea(t)?(e[0]=A(t[0]),e[1]=A(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=A(t.longitude),e[1]=A(t.latitude),e[2]=t.height):(e[0]=A(t.x),e[1]=A(t.y),e[2]=t.z),e}(t,e,wa._cartographicRadians?Nh:ba)}(t),r=A[0],i=A[1],n=Math.cos(i);return Jh.set(n*Math.cos(r),n*Math.sin(r),Math.sin(i)).normalize(),Jh.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return Jh.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,A=new nh){const{oneOverRadii:r,oneOverRadiiSquared:i,centerToleranceSquared:n}=e;Vh.from(t);const s=t.x,a=t.y,o=t.z,h=r.x,l=r.y,c=r.z,u=s*s*h*h,p=a*a*l*l,d=o*o*c*c;let f=u+p+d;0===f&&(f=1);const y=Math.sqrt(1/f);if(!Number.isFinite(y))return;const g=Gh;if(g.copy(t).scale(y),f<n)return g.to(A);const m=i.x,B=i.y,w=i.z,x=Kh;x.set(g.x*m*2,g.y*B*2,g.z*w*2);let C,E,_,v,b=(1-y)*t.len()/(.5*x.len()),U=0;do{b-=U,C=1/(1+b*m),E=1/(1+b*B),_=1/(1+b*w);const t=C*C,e=E*E,A=_*_;v=u*t+p*e+d*A-1,U=v/(-2*(u*(t*C)*m+p*(e*E)*B+d*(A*_)*w));}while(Math.abs(v)>bh.EPSILON12);return Vh.scale([C,E,_]).to(A)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){el.from(t);const A=el.x,r=el.y,i=el.z,n=this.oneOverRadiiSquared,s=1/Math.sqrt(A*A*n.x+r*r*n.y+i*i*n.z);return el.multiplyScalar(s).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return el.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return el.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,A=[0,0,0]){el.from(t);const r=el.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-e))return el.set(0,0,r).to(A)}}const sl=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),al=new nh,ol=new nh;class hl{constructor(t=[0,0,0],e=[0,0,0],A=null){A=A||al.copy(t).add(e).scale(.5),this.center=new nh(A),this.halfDiagonal=new nh(e).subtract(this.center),this.minimum=new nh(t),this.maximum=new nh(e);}clone(){return new hl(this.minimum,this.maximum,this.center)}equals(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,A=ol.from(t.normal),r=e.x*Math.abs(A.x)+e.y*Math.abs(A.y)+e.z*Math.abs(A.z),i=this.center.dot(A)+t.distance;return i-r>0?sl.INSIDE:i+r<0?sl.OUTSIDE:sl.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=al.from(t).subtract(this.center),{halfDiagonal:A}=this;let r,i=0;return r=Math.abs(e.x)-A.x,r>0&&(i+=r*r),r=Math.abs(e.y)-A.y,r>0&&(i+=r*r),r=Math.abs(e.z)-A.z,r>0&&(i+=r*r),i}}const ll=new nh,cl=new nh;class ul{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new nh,this.fromCenterRadius(t,e);}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=ll.from(e),this.center=(new nh).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new ul(this.center,this.radius)}union(t){const e=this.center,A=this.radius,r=t.radius,i=ll.copy(t.center).subtract(e),n=i.magnitude();if(A>=n+r)return this.clone();if(r>=n+A)return t.clone();const s=.5*(A+n+r);return cl.copy(i).scale((-A+s)/n).add(e),this.center.copy(cl),this.radius=s,this}expand(t){const e=(t=ll.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){var A=e[4],r=e[5],i=e[6],n=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(A,r,i),t[2]=Math.hypot(n,s,a),t}(ll,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=(t=ll.from(t)).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.radius,A=t.normal.dot(this.center)+t.distance;return A<-e?sl.OUTSIDE:A<e?sl.INTERSECTING:sl.INSIDE}}const pl=new nh,dl=new nh,fl=new nh,yl=new nh,gl=new nh,ml=new nh,Bl=new nh;class wl{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=(new nh).from(t),this.halfAxes=new mh(e);}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),A=this.halfAxes.getColumn(2);return [new nh(t).len(),new nh(e).len(),new nh(A).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),A=this.halfAxes.getColumn(2),r=new nh(t).normalize(),i=new nh(e).normalize(),n=new nh(A).normalize();return (new vh).fromMatrix3(new mh([...r,...i,...n]))}fromCenterHalfSizeQuaternion(t,e,A){const r=new vh(A),i=(new mh).fromQuaternion(r);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],this.center=(new nh).from(t),this.halfAxes=i,this}clone(){return new wl(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new ul){const e=this.halfAxes,A=e.getColumn(0,fl),r=e.getColumn(1,yl),i=e.getColumn(2,gl),n=pl.copy(A).add(r).add(i);return t.center.copy(this.center),t.radius=n.magnitude(),t}getBoundingMaximum(t=1){const e=this.center.x,A=this.center.y,r=this.center.z,i=new nh(this.halfAxes[0],this.halfAxes[1],this.halfAxes[2]).scale(t),n=new nh(this.halfAxes[3],this.halfAxes[4],this.halfAxes[5]).scale(t),s=new nh(this.halfAxes[6],this.halfAxes[7],this.halfAxes[8]).scale(t);return {boundingMaxValue:new nh(e+i.x+i.y+i.z,A+n.x+n.y+n.z,r+s.x+s.y+s.z),boundingMinValue:new nh(e-i.x-i.y-i.z,A-n.x-n.y-n.z,r-s.x-s.y-s.z)}}intersectPlane(t){const e=this.center,A=t.normal,r=this.halfAxes,i=A.x,n=A.y,s=A.z,a=Math.abs(i*r[0]+n*r[1]+s*r[2])+Math.abs(i*r[3]+n*r[4]+s*r[5])+Math.abs(i*r[6]+n*r[7]+s*r[8]),o=A.dot(e)+t.distance;return o<=-a?sl.OUTSIDE:o>=a?sl.INSIDE:sl.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=dl.from(t).subtract(this.center),A=this.halfAxes,r=A.getColumn(0,fl),i=A.getColumn(1,yl),n=A.getColumn(2,gl),s=r.magnitude(),a=i.magnitude(),o=n.magnitude();r.normalize(),i.normalize(),n.normalize();let h,l=0;return h=Math.abs(e.dot(r))-s,h>0&&(l+=h*h),h=Math.abs(e.dot(i))-a,h>0&&(l+=h*h),h=Math.abs(e.dot(n))-o,h>0&&(l+=h*h),l}computePlaneDistances(t,e,A=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const n=this.center,s=this.halfAxes,a=s.getColumn(0,fl),o=s.getColumn(1,yl),h=s.getColumn(2,gl),l=ml.copy(a).add(o).add(h).add(n),c=Bl.copy(l).subtract(t);let u=e.dot(c);return r=Math.min(u,r),i=Math.max(u,i),l.copy(n).add(a).add(o).subtract(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),l.copy(n).add(a).subtract(o).add(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),l.copy(n).add(a).subtract(o).subtract(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),n.copy(l).subtract(a).add(o).add(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),n.copy(l).subtract(a).add(o).subtract(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),n.copy(l).subtract(a).subtract(o).add(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),n.copy(l).subtract(a).subtract(o).subtract(h),c.copy(l).subtract(t),u=e.dot(c),r=Math.min(u,r),i=Math.max(u,i),A[0]=r,A[1]=i,A}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,fl);e.transformAsPoint(t);const A=this.halfAxes.getColumn(1,yl);A.transformAsPoint(t);const r=this.halfAxes.getColumn(2,gl);return r.transformAsPoint(t),this.halfAxes=new mh([...e,...A,...r]),this}getTransform(){throw new Error("not implemented")}}const xl=new nh,Cl=new nh;class El{constructor(t=[0,0,1],e=0){this.normal=new nh,this.distance=-0,this.fromNormalDistance(t,e);}fromNormalDistance(t,e){return this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=xl.from(t),this.normal.from(e).normalize();const A=-this.normal.dot(t);return this.distance=A,this}fromCoefficients(t,e,A,r){return this.normal.set(t,e,A),this.distance=r,this}clone(t){return new El(this.normal,this.distance)}equals(t){return Oa(this.distance,t.distance)&&Oa(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Cl.copy(this.normal).transformAsVector(t).normalize(),A=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(A,e)}projectPointOntoPlane(t,e=[0,0,0]){t=xl.from(t);const A=this.getPointDistance(t),r=Cl.copy(this.normal).scale(A);return t.subtract(r).to(e)}}const _l=[new nh([1,0,0]),new nh([0,1,0]),new nh([0,0,1])],vl=new nh,bl=new nh;new El(new nh(1,0,0),0);class Ul{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(t=[]){this.planes=t;}fromBoundingSphere(t){this.planes.length=2*_l.length;const e=t.center,A=t.radius;let r=0;for(const t of _l){let i=this.planes[r],n=this.planes[r+1];i||(i=this.planes[r]=new El),n||(n=this.planes[r+1]=new El);const s=vl.copy(t).scale(-A).add(e);t.dot(s),i.fromPointNormal(s,t);const a=vl.copy(t).scale(A).add(e),o=bl.copy(t).negate();o.dot(a),n.fromPointNormal(a,o),r+=2;}return this}computeVisibility(t){let e=sl.INSIDE;for(const A of this.planes)switch(t.intersectPlane(A)){case sl.OUTSIDE:return sl.OUTSIDE;case sl.INTERSECTING:e=sl.INTERSECTING;}return e}computeVisibilityWithPlaneMask(t,e){if(e===Ul.MASK_OUTSIDE||e===Ul.MASK_INSIDE)return e;let A=Ul.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const n=i<31?1<<i:0;if(i<31&&0==(e&n))continue;const s=t.intersectPlane(r[i]);if(s===sl.OUTSIDE)return Ul.MASK_OUTSIDE;s===sl.INTERSECTING&&(A|=n);}return A}}const Fl=new nh,Ml=new nh,Ql=new nh,Il=new nh,Sl=new nh;class Tl{constructor(t={}){t={near:1,far:5e8,...t},this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this._cullingVolume=new Ul([new El,new El,new El,new El,new El,new El]),this._perspectiveMatrix=new Eh,this._infinitePerspective=new Eh;}clone(){return new Tl({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Tl&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return Rl(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return Rl(this),this._infinitePerspective}computeCullingVolume(t,e,A){const r=this._cullingVolume.planes;A=Fl.copy(A).normalize();const i=Ml.copy(e).cross(A).normalize(),n=Ql.copy(e).multiplyByScalar(this.near).add(t),s=Il.copy(e).multiplyByScalar(this.far).add(t);let a=Sl;return a.copy(i).multiplyByScalar(this.left).add(n).subtract(t).cross(A),r[0].fromPointNormal(t,a),a.copy(i).multiplyByScalar(this.right).add(n).subtract(t).cross(A).negate(),r[1].fromPointNormal(t,a),a.copy(A).multiplyByScalar(this.bottom).add(n).subtract(t).cross(i).negate(),r[2].fromPointNormal(t,a),a.copy(A).multiplyByScalar(this.top).add(n).subtract(t).cross(i),r[3].fromPointNormal(t,a),a=(new nh).copy(e),r[4].fromPointNormal(n,a),a.negate(),r[5].fromPointNormal(s,a),this._cullingVolume}getPixelDimensions(t,e,A,r){Rl(this);const i=1/this.near;let n=this.top*i;const s=2*A*n/e;return n=this.right*i,r.x=2*A*n/t,r.y=s,r}}function Rl(t){const{top:e,bottom:A,right:r,left:i,near:n,far:s}=t;e===t._top&&A===t._bottom&&i===t._left&&r===t._right&&n===t._near&&s===t._far||(t._left=i,t._right=r,t._top=e,t._bottom=A,t._near=n,t._far=s,t._perspectiveMatrix=(new Eh).frustum({left:i,right:r,bottom:A,top:e,near:n,far:s}),t._infinitePerspective=(new Eh).frustum({left:i,right:r,bottom:A,top:e,near:n,far:1/0}));}class Ll{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new Tl,this.fov=t.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset;}clone(){return new Ll({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return null!=t&&t instanceof Ll&&(Pl(this),Pl(t),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return Pl(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return Pl(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return Pl(this),this._fovy}get sseDenominator(){return Pl(this),this._sseDenominator}computeCullingVolume(t,e,A){return Pl(this),this._offCenterFrustum.computeCullingVolume(t,e,A)}getPixelDimensions(t,e,A,r){return Pl(this),this._offCenterFrustum.getPixelDimensions(t,e,A,r)}}function Pl(t){const e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset);}const Hl=new nh,Ol=new nh,Dl=new nh,Nl=new nh,kl=new nh,Vl=new nh,Gl=new nh,Kl=new nh,zl=new nh,Xl=new nh,ql=new nh,jl=new nh,Yl=new mh,Wl=new mh,Zl=new mh,Jl=new mh,$l=new mh;function tc(t,e={}){const A=bh.EPSILON20;let r=0,i=0;const n=Wl,s=Zl;n.identity(),s.copy(t);const a=A*function(t){let e=0;for(let A=0;A<9;++A){const r=t[A];e+=r*r;}return Math.sqrt(e)}(s);for(;i<10&&rc(s)>a;)ic(s,Jl),$l.copy(Jl).transpose(),s.multiplyRight(Jl),s.multiplyLeft($l),n.multiplyRight(Jl),++r>2&&(++i,r=0);return e.unitary=n.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}const ec=[1,0,0],Ac=[2,2,1];function rc(t){let e=0;for(let A=0;A<3;++A){const r=t[Yl.getElementIndex(Ac[A],ec[A])];e+=2*r*r;}return Math.sqrt(e)}function ic(t,e){const A=bh.EPSILON15;let r=0,i=1;for(let e=0;e<3;++e){const A=Math.abs(t[Yl.getElementIndex(Ac[e],ec[e])]);A>r&&(i=e,r=A);}const n=ec[i],s=Ac[i];let a=1,o=0;if(Math.abs(t[Yl.getElementIndex(s,n)])>A){const e=(t[Yl.getElementIndex(s,s)]-t[Yl.getElementIndex(n,n)])/2/t[Yl.getElementIndex(s,n)];let A;A=e<0?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),a=1/Math.sqrt(1+A*A),o=A*a;}return mh.IDENTITY.to(e),e[Yl.getElementIndex(n,n)]=e[Yl.getElementIndex(s,s)]=a,e[Yl.getElementIndex(s,n)]=o,e[Yl.getElementIndex(n,s)]=-o,e}const nc=new nh,sc=new nh,ac=new nh,oc=new nh,hc=new nh,lc=new mh,cc={diagonal:new mh,unitary:new mh};var uc=Object.freeze({__proto__:null,INTERSECTION:sl,AxisAlignedBoundingBox:hl,BoundingSphere:ul,OrientedBoundingBox:wl,CullingVolume:Ul,Plane:El,_PerspectiveOffCenterFrustum:Tl,_PerspectiveFrustum:Ll,makeBoundingSphereFromPoints:function(t,e=new ul){if(!t||0===t.length)return e.fromCenterRadius([0,0,0],0);const A=Gl.copy(t[0]),r=Hl.copy(A),i=Ol.copy(A),n=Dl.copy(A),s=Nl.copy(A),a=kl.copy(A),o=Vl.copy(A);for(const e of t){A.copy(e);const t=A.x,h=A.y,l=A.z;t<r.x&&r.copy(A),t>s.x&&s.copy(A),h<i.y&&i.copy(A),h>a.y&&a.copy(A),l<n.z&&n.copy(A),l>o.z&&o.copy(A);}const h=Kl.copy(s).subtract(r).magnitudeSquared(),l=Kl.copy(a).subtract(i).magnitudeSquared(),c=Kl.copy(o).subtract(n).magnitudeSquared();let u=r,p=s,d=h;l>d&&(d=l,u=i,p=a),c>d&&(d=c,u=n,p=o);const f=zl;f.x=.5*(u.x+p.x),f.y=.5*(u.y+p.y),f.z=.5*(u.z+p.z);let y=Kl.copy(p).subtract(f).magnitudeSquared(),g=Math.sqrt(y);const m=Xl;m.x=r.x,m.y=i.y,m.z=n.z;const B=ql;B.x=s.x,B.y=a.y,B.z=o.z;const w=jl.copy(m).add(B).multiplyByScalar(.5);let x=0;for(const e of t){A.copy(e);const t=Kl.copy(A).subtract(w).magnitude();t>x&&(x=t);const r=Kl.copy(A).subtract(f).magnitudeSquared();if(r>y){const t=Math.sqrt(r);g=.5*(g+t),y=g*g;const e=t-g;f.x=(g*f.x+e*A.x)/t,f.y=(g*f.y+e*A.y)/t,f.z=(g*f.z+e*A.z)/t;}}return g<x?(f.to(e.center),e.radius=g):(w.to(e.center),e.radius=x),e},makeAxisAlignedBoundingBoxFromPoints:function(t,e=new hl){if(!t||0===t.length)return e.minimum.set(0,0,0),e.maximum.set(0,0,0),e.center.set(0,0,0),e.halfDiagonal.set(0,0,0),e;let A=t[0][0],r=t[0][1],i=t[0][2],n=t[0][0],s=t[0][1],a=t[0][2];for(const e of t){const t=e[0],o=e[1],h=e[2];A=Math.min(t,A),n=Math.max(t,n),r=Math.min(o,r),s=Math.max(o,s),i=Math.min(h,i),a=Math.max(h,a);}return e.minimum.set(A,r,i),e.maximum.set(n,s,a),e.center.copy(e.minimum).add(e.maximum).scale(.5),e.halfDiagonal.copy(e.maximum).subtract(e.center),e},makeOrientedBoundingBoxFromPoints:function(t,e=new wl){if(!t||0===t.length)return e.halfAxes=new mh([0,0,0,0,0,0,0,0,0]),e.center=new nh,e;const A=t.length,r=new nh(0,0,0);for(const e of t)r.add(e);const i=1/A;r.multiplyByScalar(i);let n=0,s=0,a=0,o=0,h=0,l=0;for(const e of t){const t=nc.copy(e).subtract(r);n+=t.x*t.x,s+=t.x*t.y,a+=t.x*t.z,o+=t.y*t.y,h+=t.y*t.z,l+=t.z*t.z;}n*=i,s*=i,a*=i,o*=i,h*=i,l*=i;const c=lc;c[0]=n,c[1]=s,c[2]=a,c[3]=s,c[4]=o,c[5]=h,c[6]=a,c[7]=h,c[8]=l;const{unitary:u}=tc(c,cc),p=e.halfAxes.copy(u);let d=p.getColumn(0,ac),f=p.getColumn(1,oc),y=p.getColumn(2,hc),g=-Number.MAX_VALUE,m=-Number.MAX_VALUE,B=-Number.MAX_VALUE,w=Number.MAX_VALUE,x=Number.MAX_VALUE,C=Number.MAX_VALUE;for(const e of t)nc.copy(e),g=Math.max(nc.dot(d),g),m=Math.max(nc.dot(f),m),B=Math.max(nc.dot(y),B),w=Math.min(nc.dot(d),w),x=Math.min(nc.dot(f),x),C=Math.min(nc.dot(y),C);d=d.multiplyByScalar(.5*(w+g)),f=f.multiplyByScalar(.5*(x+m)),y=y.multiplyByScalar(.5*(C+B)),e.center.copy(d).add(f).add(y);const E=sc.set(g-w,m-x,B-C).multiplyByScalar(.5),_=new mh([E[0],0,0,0,E[1],0,0,0,E[2]]);return e.halfAxes.multiplyRight(_),e},computeEigenDecomposition:tc,Intersect:sl,INTERSECT:sl});const pc=[9,-18,-88,0,96,90,0,0,-60,-20,-9,18,8,0,-96,30,0,0,60,-20,9,-88,-18,90,96,0,-20,-60,0,0,186,-42,-42,-150,-96,-150,60,60,60,60,54,162,-78,30,-24,-90,-60,60,-60,60,-9,-32,18,30,24,0,20,-60,0,0,-9,8,18,30,-96,0,-20,60,0,0,54,-78,162,-90,-24,30,60,-60,60,-60,-54,78,78,90,144,90,-60,-60,-60,-60,9,-8,-18,-30,-24,0,20,60,0,0,-9,18,-32,0,24,30,0,0,-60,20,9,-18,-8,0,-24,-30,0,0,60,20],dc=[0,0,-131,0,138,144,0,0,-102,-31,0,0,7,0,-138,42,0,0,102,-31,62,0,-31,0,0,-62,0,0,0,31,124,0,-62,0,0,-124,0,0,0,62,124,0,-62,0,0,-124,0,0,0,62,62,0,-31,0,0,-62,0,0,0,31,0,0,45,0,-183,-9,0,93,18,0,0,0,216,0,33,87,0,-93,12,-93,0,0,156,0,153,99,0,-93,-12,-93,0,0,-45,0,-3,9,0,93,-18,0,0,0,-55,0,48,42,0,0,-84,31,0,0,-7,0,-48,-42,0,0,84,31],fc=[18,-36,-122,0,120,135,0,0,-84,-31,-18,36,-2,0,-120,51,0,0,84,-31,36,-165,-27,93,147,-9,0,-93,18,0,210,45,-111,-93,-57,-192,0,93,12,93,162,141,-75,-93,-129,-180,0,93,-12,93,-36,-21,27,93,39,9,0,-93,-18,0,0,0,62,0,0,31,0,0,0,-31,0,0,124,0,0,62,0,0,0,-62,0,0,124,0,0,62,0,0,0,-62,0,0,62,0,0,31,0,0,0,-31,-18,36,-64,0,66,51,0,0,-102,31,18,-36,2,0,-66,-51,0,0,102,31];class yc{constructor(t){this.options=t,this._v00=0,this._v01=0,this._v10=0,this._v11=0,this._t=[],this._ix=this.options._width,this._iy=this.options._height;}getHeight(t,e){if(t=Math.abs(t)>90?NaN:t,isNaN(t)||isNaN(e))return NaN;const A=function(t,e){let A=gc(t,e=Math.abs(e));return 2*Math.abs(A)===e?A-=gc(t,2*e)-A:2*Math.abs(A)>e&&(A+=A<0?e:-e),A}(e,360);let r=(e=-180!==A?A:180)*this.options._rlonres,i=-t*this.options._rlatres,n=Math.floor(r),s=Math.min(Math.round((this.options._height-1)/2-1),Math.floor(i));r-=n,i-=s,s+=(this.options._height-1)/2,n+=n<0?this.options._width:n>=this.options._width?-this.options._width:0;let a=0,o=0,h=0,l=0,c=new Array(10);if(n!==this._ix||s!==this._iy)if(this.options.cubic){const t=[this._rawval(n,s-1),this._rawval(n+1,s-1),this._rawval(n-1,s),this._rawval(n,s),this._rawval(n+1,s),this._rawval(n+2,s),this._rawval(n-1,s+1),this._rawval(n,s+1),this._rawval(n+1,s+1),this._rawval(n+2,s+1),this._rawval(n,s+2),this._rawval(n+1,s+2)];let e=dc;0!==s&&(e=s===this.options._height-2?fc:pc);let A=372;0!==s&&(A=s===this.options._height-2?372:240);for(let r=0;r<10;++r){c[r]=0;for(let A=0;A<12;++A)c[r]+=t[A]*e[10*A+r];c[r]/=A;}}else a=this._rawval(n,s),o=this._rawval(n+1,s),h=this._rawval(n,s+1),l=this._rawval(n+1,s+1);else this.options.cubic?c=this._t:(a=this._v00,o=this._v01,h=this._v10,l=this._v11);if(!this.options.cubic){const t=this.options._offset+this.options._scale*((1-i)*((1-r)*a+r*o)+i*((1-r)*h+r*l));return this._ix=n,this._iy=s,this._v00=a,this._v01=o,this._v10=h,this._v11=l,t}let u=c[0]+r*(c[1]+r*(c[3]+r*c[6]))+i*(c[2]+r*(c[4]+r*c[7])+i*(c[5]+r*c[8]+i*c[9]));return u=this.options._offset+this.options._scale*u,this._ix=n,this._iy=s,this._t=c,u}_rawval(t,e){t<0?t+=this.options._width:t>=this.options._width&&(t-=this.options._width),(e<0||e>=this.options._height)&&(e=e<0?-e:2*(this.options._height-1)-e,t+=(t<this.options._width/2?1:-1)*this.options._width/2);const A=this.options._datastart+2*(e*this.options._swidth+t);return this.options.data[A]<<8|this.options.data[A+1]}}function gc(t,e){return t-Math.floor(t/e)*e}function mc(t){let e="";for(const A of t)e+=String.fromCharCode(A);return e}var Bc=Object.freeze({__proto__:null,parsePGM:function(t,e){const A=function*(t){let e=0;do{const A=t.indexOf(10,e);if(-1!==A){const r=t.subarray(e,A);e=A+1,yield {offset:e,line:mc(r)};}else {const A=t.subarray(e,t.length);e=t.length,yield {offset:e,line:mc(A)};}}while(e<t.length);return {offset:e,line:""}}(t);let r=A.next();if(r.done||"P5"!==r.value.line)throw new Error("Geoid model file: File not in PGM format");let i=Number.MAX_VALUE,n=0,s=-1,a=-1,o="NONE",h="UNKNOWN",l=0,c=0,u=null,p=null;do{r=A.next();const t=r.value.line;if(t.length){if("#"!==t[0]){let e=t.split(" ");if(e=e.filter((t=>""!==t)),l=parseInt(e[0],10),c=parseInt(e[1],10),!l||!c)throw new Error("Geoid model file: Error reading raster size");break}{const A=t.split(" "),r=A[1];if("#"!==A[0]||!r)continue;const l=A.length>2?A.slice(2):[];if("Description"===r)o=l.join(" ");else if("DateTime"===r)h=l.join(" ");else if("Offset"===r){if(!A[2])throw new Error("Geoid model file: Error reading offset");i=parseInt(A[2],10);}else if("Scale"===r){if(!A[2])throw new Error("Geoid model file: Error reading scale");n=parseFloat(A[2]);}else r===(e.cubic?"MaxCubicError":"MaxBilinearError")?isFinite(parseFloat(A[2]))&&(s=parseFloat(A[2])):r===(e.cubic?"RMSCubicError":"RMSBilinearError")&&isFinite(parseFloat(A[2]))&&(a=parseFloat(A[2]));}}}while(!r.done);r=A.next();const d=parseInt(r.value.line,10);if(r.done)throw new Error("Geoid model file: Error reading maxval");if(65535!==d)throw new Error("Geoid model file: Incorrect value of maxval");if(u=r.value.offset,p=l,i===Number.MAX_VALUE)throw new Error("Geoid model file: Offset not set");if(0===n)throw new Error("Geoid model file: Scale not set");if(n<0)throw new Error("Geoid model file: Scale must be positive");if(c<2||l<2)throw new Error("Geoid model file: Raster size too small");if(1&l)throw new Error("Geoid model file: Raster width is odd");if(!(1&c))throw new Error("Geoid model file: Raster height is even");return new yc({cubic:e.cubic,_width:l,_height:c,_rlonres:l/360,_rlatres:(c-1)/180,_offset:i,_scale:n,_swidth:p,_datastart:u,_maxerror:s,_rmserror:a,_description:o,_datetime:h,data:t})},Geoid:yc}),wc=Object.freeze({__proto__:null,Ellipsoid:nl,isWGS84:function(t){if(!t)return !1;kh.from(t);const{oneOverRadiiSquared:e,centerToleranceSquared:A}=Dh;return Math.abs(t[0]*t[0]*e[0]+t[1]*t[1]*e[1]+t[2]*t[2]*e[2]-1)<A}}),xc=Object.freeze({__proto__:null,Vector2:Ah,Vector3:nh,Vector4:ah,Matrix2:ph,Matrix3:mh,Matrix4:Eh,Quaternion:vh,config:wa,configure:xa,formatValue:Ca,isArray:Ea,clone:_a,equals:Oa,exactEquals:Da,toRadians:ba,toDegrees:Ua,radians:Fa,degrees:Ma,sin:Qa,cos:Ia,tan:Sa,asin:Ta,acos:Ra,atan:La,clamp:Pa,lerp:Ha,withEpsilon:Na,checkNumber:Va,_MathUtils:bh,SphericalCoordinates:Fh,Pose:Sh,Euler:Ih,assert:ya,_SphericalCoordinates:Fh,_Pose:Sh,_Euler:Ih});function Cc(t,e,A={}){return Ec(t,A)!==e&&(function(t,e){const{start:A=0,end:r=t.length,size:i=2}=e,n=(r-A)/i,s=Math.floor(n/2);for(let e=0;e<s;++e){const r=A+e*i,s=A+(n-1-e)*i;for(let e=0;e<i;++e){const A=t[r+e];t[r+e]=t[s+e],t[s+e]=A;}}}(t,A),!0)}function Ec(t,e={}){return Math.sign(_c(t,e))}function _c(t,e={}){const{start:A=0,end:r=t.length}=e,i=e.size||2;let n=0;for(let e=A,s=r-i;e<r;e+=i)n+=(t[e]-t[s])*(t[e+1]+t[s+1]),s=e;return n/2}function vc(t,e,A={}){const{start:r=0,end:i=t.length,size:n=2,isClosed:s}=A,a=(i-r)/n;for(let A=0;A<a-1;++A)e(t[r+A*n],t[r+A*n+1],t[r+(A+1)*n],t[r+(A+1)*n+1],A,A+1);const o=r+(a-1)*n;s||Oa(t[r],t[o])&&Oa(t[r+1],t[o+1])||e(t[o],t[o+1],t[r],t[r+1],a-1,0);}function bc(t,e={}){const{start:A=0,end:r=t.length}=e;let i=0;for(let e=A,n=r-1;e<r;++e)i+=(t[e][0]-t[n][0])*(t[e][1]+t[n][1]),n=e;return i/2}class Uc{constructor(t,e={}){this.points=t,this.isFlatArray=!Ea(t[0]),this.options={start:e.start||0,end:e.end||t.length,size:e.size||2,isClosed:e.isClosed},Object.freeze(this);}getSignedArea(){return this.isFlatArray?_c(this.points,this.options):bc(this.points,this.options)}getArea(){return Math.abs(this.getSignedArea())}getWindingDirection(){return Math.sign(this.getSignedArea())}forEachSegment(t){this.isFlatArray?vc(this.points,((e,A,r,i,n,s)=>{t([e,A],[r,i],n,s);}),this.options):function(t,e,A={}){const{start:r=0,end:i=t.length,isClosed:n}=A;for(let A=r;A<i-1;++A)e(t[A],t[A+1],A,A+1);n||Oa(t[i-1],t[0])||e(t[i-1],t[0],i-1,0);}(this.points,t,this.options);}modifyWindingDirection(t){return this.isFlatArray?Cc(this.points,t,this.options):function(t,e,A={}){const r=function(t,e={}){return Math.sign(bc(t,e))}(t,A);return r!==e&&(t.reverse(),!0)}(this.points,t,this.options)}}function Fc(t,e,A,r,i,n){let s,a;if(void 0===n&&(n=_c(t,{start:e,end:A,size:r})),i===n<0)for(s=e;s<A;s+=r)a=Yc(s,t[s],t[s+1],a);else for(s=A-r;s>=e;s-=r)a=Yc(s,t[s],t[s+1],a);return a&&Gc(a,a.next)&&(Wc(a),a=a.next),a}function Mc(t,e){if(!t)return t;e||(e=t);let A,r=t;do{if(A=!1,r.steiner||!Gc(r,r.next)&&0!==Vc(r.prev,r,r.next))r=r.next;else {if(Wc(r),r=e=r.prev,r===r.next)break;A=!0;}}while(A||r!==e);return e}function Qc(t,e,A,r,i,n,s){if(!t)return;!s&&n&&function(t,e,A,r){let i=t;do{null===i.z&&(i.z=Oc(i.x,i.y,e,A,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,A,r,i,n,s,a,o,h=1;do{for(i=t,t=null,o=null,r=0;i;){for(r++,s=i,n=0,A=0;A<h&&(n++,s=s.nextZ,s);A++);for(a=h;n>0||a>0&&s;)0!==n&&(0===a||!s||i.z<=s.z)?(e=i,i=i.nextZ,n--):(e=s,s=s.nextZ,a--),o?o.nextZ=e:t=e,e.prevZ=o,o=e;i=s;}o.nextZ=null,h*=2;}while(r>1)}(i);}(t,r,i,n);let a,o,h=t;for(;t.prev!==t.next;)if(a=t.prev,o=t.next,n?Sc(t,r,i,n):Ic(t))e.push(a.i/A),e.push(t.i/A),e.push(o.i/A),Wc(t),t=o.next,h=o.next;else if((t=o)===h){s?1===s?Qc(t=Tc(Mc(t),e,A),e,A,r,i,n,2):2===s&&Rc(t,e,A,r,i,n):Qc(Mc(t),e,A,r,i,n,1);break}}function Ic(t){const e=t.prev,A=t,r=t.next;if(Vc(e,A,r)>=0)return !1;let i=t.next.next;for(;i!==t.prev;){if(Nc(e.x,e.y,A.x,A.y,r.x,r.y,i.x,i.y)&&Vc(i.prev,i,i.next)>=0)return !1;i=i.next;}return !0}function Sc(t,e,A,r){const i=t.prev,n=t,s=t.next;if(Vc(i,n,s)>=0)return !1;const a=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,o=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,h=Oc(i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,e,A,r),l=Oc(a,o,e,A,r);let c=t.prevZ,u=t.nextZ;for(;c&&c.z>=h&&u&&u.z<=l;){if(c!==t.prev&&c!==t.next&&Nc(i.x,i.y,n.x,n.y,s.x,s.y,c.x,c.y)&&Vc(c.prev,c,c.next)>=0)return !1;if(c=c.prevZ,u!==t.prev&&u!==t.next&&Nc(i.x,i.y,n.x,n.y,s.x,s.y,u.x,u.y)&&Vc(u.prev,u,u.next)>=0)return !1;u=u.nextZ;}for(;c&&c.z>=h;){if(c!==t.prev&&c!==t.next&&Nc(i.x,i.y,n.x,n.y,s.x,s.y,c.x,c.y)&&Vc(c.prev,c,c.next)>=0)return !1;c=c.prevZ;}for(;u&&u.z<=l;){if(u!==t.prev&&u!==t.next&&Nc(i.x,i.y,n.x,n.y,s.x,s.y,u.x,u.y)&&Vc(u.prev,u,u.next)>=0)return !1;u=u.nextZ;}return !0}function Tc(t,e,A){let r=t;do{const i=r.prev,n=r.next.next;!Gc(i,n)&&Kc(i,r,r.next,n)&&qc(i,n)&&qc(n,i)&&(e.push(i.i/A),e.push(r.i/A),e.push(n.i/A),Wc(r),Wc(r.next),r=t=n),r=r.next;}while(r!==t);return Mc(r)}function Rc(t,e,A,r,i,n){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&kc(s,t)){let a=jc(s,t);return s=Mc(s,s.next),a=Mc(a,a.next),Qc(s,e,A,r,i,n),void Qc(a,e,A,r,i,n)}t=t.next;}s=s.next;}while(s!==t)}function Lc(t,e){return t.x-e.x}function Pc(t,e){if(e=function(t,e){let A=e;const r=t.x,i=t.y;let n,s=-1/0;do{if(i<=A.y&&i>=A.next.y&&A.next.y!==A.y){const t=A.x+(i-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(t<=r&&t>s){if(s=t,t===r){if(i===A.y)return A;if(i===A.next.y)return A.next}n=A.x<A.next.x?A:A.next;}}A=A.next;}while(A!==e);if(!n)return null;if(r===s)return n;const a=n,o=n.x,h=n.y;let l,c=1/0;A=n;do{r>=A.x&&A.x>=o&&r!==A.x&&Nc(i<h?r:s,i,o,h,i<h?s:r,i,A.x,A.y)&&(l=Math.abs(i-A.y)/(r-A.x),qc(A,t)&&(l<c||l===c&&(A.x>n.x||A.x===n.x&&Hc(n,A)))&&(n=A,c=l)),A=A.next;}while(A!==a);return n}(t,e),e){const A=jc(e,t);Mc(e,e.next),Mc(A,A.next);}}function Hc(t,e){return Vc(t.prev,t,e.prev)<0&&Vc(e.next,t,t.next)<0}function Oc(t,e,A,r,i){return (t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-A)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Dc(t){let e=t,A=t;do{(e.x<A.x||e.x===A.x&&e.y<A.y)&&(A=e),e=e.next;}while(e!==t);return A}function Nc(t,e,A,r,i,n,s,a){return (i-s)*(e-a)-(t-s)*(n-a)>=0&&(t-s)*(r-a)-(A-s)*(e-a)>=0&&(A-s)*(n-a)-(i-s)*(r-a)>=0}function kc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let A=t;do{if(A.i!==t.i&&A.next.i!==t.i&&A.i!==e.i&&A.next.i!==e.i&&Kc(A,A.next,t,e))return !0;A=A.next;}while(A!==t);return !1}(t,e)&&(qc(t,e)&&qc(e,t)&&function(t,e){let A=t,r=!1;const i=(t.x+e.x)/2,n=(t.y+e.y)/2;do{A.y>n!=A.next.y>n&&A.next.y!==A.y&&i<(A.next.x-A.x)*(n-A.y)/(A.next.y-A.y)+A.x&&(r=!r),A=A.next;}while(A!==t);return r}(t,e)&&(Vc(t.prev,t,e.prev)||Vc(t,e.prev,e))||Gc(t,e)&&Vc(t.prev,t,t.next)>0&&Vc(e.prev,e,e.next)>0)}function Vc(t,e,A){return (e.y-t.y)*(A.x-e.x)-(e.x-t.x)*(A.y-e.y)}function Gc(t,e){return t.x===e.x&&t.y===e.y}function Kc(t,e,A,r){const i=Xc(Vc(t,e,A)),n=Xc(Vc(t,e,r)),s=Xc(Vc(A,r,t)),a=Xc(Vc(A,r,e));return i!==n&&s!==a||!(0!==i||!zc(t,A,e))||!(0!==n||!zc(t,r,e))||!(0!==s||!zc(A,t,r))||!(0!==a||!zc(A,e,r))}function zc(t,e,A){return e.x<=Math.max(t.x,A.x)&&e.x>=Math.min(t.x,A.x)&&e.y<=Math.max(t.y,A.y)&&e.y>=Math.min(t.y,A.y)}function Xc(t){return t>0?1:t<0?-1:0}function qc(t,e){return Vc(t.prev,t,t.next)<0?Vc(t,e,t.next)>=0&&Vc(t,t.prev,e)>=0:Vc(t,e,t.prev)<0||Vc(t,t.next,e)<0}function jc(t,e){const A=new Zc(t.i,t.x,t.y),r=new Zc(e.i,e.x,e.y),i=t.next,n=e.prev;return t.next=e,e.prev=t,A.next=i,i.prev=A,r.next=A,A.prev=r,n.next=r,r.prev=n,r}function Yc(t,e,A,r){const i=new Zc(t,e,A);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Wc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function Zc(t,e,A){this.i=t,this.x=e,this.y=A,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function Jc(t,e){const A=e.length,r=t.length;if(r>0){let i=!0;for(let n=0;n<A;n++)if(t[r-A+n]!==e[n]){i=!1;break}if(i)return !1}for(let i=0;i<A;i++)t[r+i]=e[i];return !0}function $c(t,e){const A=e.length;for(let r=0;r<A;r++)t[r]=e[r];}function tu(t,e,A,r,i=[]){const n=r+e*A;for(let e=0;e<A;e++)i[e]=t[n+e];return i}function eu(t,e,A,r,i=[]){let n,s;if(8&A)n=(r[3]-t[1])/(e[1]-t[1]),s=3;else if(4&A)n=(r[1]-t[1])/(e[1]-t[1]),s=1;else if(2&A)n=(r[2]-t[0])/(e[0]-t[0]),s=2;else {if(!(1&A))return null;n=(r[0]-t[0])/(e[0]-t[0]),s=0;}for(let A=0;A<t.length;A++)i[A]=(1&s)===A?r[s]:n*(e[A]-t[A])+t[A];return i}function Au(t,e){let A=0;return t[0]<e[0]?A|=1:t[0]>e[2]&&(A|=2),t[1]<e[1]?A|=4:t[1]>e[3]&&(A|=8),A}function ru(t,e={}){const{size:A=2,broken:r=!1,gridResolution:i=10,gridOffset:n=[0,0],startIndex:s=0,endIndex:a=t.length}=e,o=(a-s)/A;let h=[];const l=[h],c=tu(t,0,A,s);let u,p;const d=au(c,i,n,[]),f=[];Jc(h,c);for(let e=1;e<o;e++){for(u=tu(t,e,A,s,u),p=Au(u,d);p;){eu(c,u,p,d,f);const t=Au(f,d);t&&(eu(c,f,t,d,f),p=t),Jc(h,f),$c(c,f),ou(d,i,p),r&&h.length>A&&(h=[],l.push(h),Jc(h,c)),p=Au(u,d);}Jc(h,u),$c(c,u);}return r?l:l[0]}function iu(t,e){for(let A=0;A<e.length;A++)t.push(e[A]);return t}function nu(t,e,A={}){if(!t.length)return [];const{size:r=2,gridResolution:i=10,gridOffset:n=[0,0],edgeTypes:s=!1}=A,a=[],o=[{pos:t,types:s&&new Array(t.length/r).fill(1),holes:e||[]}],h=[[],[]];let l=[];for(;o.length;){const{pos:t,types:e,holes:A}=o.shift();hu(t,r,A[0]||t.length,h),l=au(h[0],i,n,l);const c=Au(h[1],l);if(c){let i=su(t,e,r,0,A[0]||t.length,l,c);const n={pos:i[0].pos,types:i[0].types,holes:[]},a={pos:i[1].pos,types:i[1].types,holes:[]};o.push(n,a);for(let o=0;o<A.length;o++)i=su(t,e,r,A[o],A[o+1]||t.length,l,c),i[0]&&(n.holes.push(n.pos.length),n.pos=iu(n.pos,i[0].pos),s&&(n.types=iu(n.types,i[0].types))),i[1]&&(a.holes.push(a.pos.length),a.pos=iu(a.pos,i[1].pos),s&&(a.types=iu(a.types,i[1].types)));}else {const r={positions:t};s&&(r.edgeTypes=e),A.length&&(r.holeIndices=A),a.push(r);}}return a}function su(t,e,A,r,i,n,s){const a=(i-r)/A,o=[],h=[],l=[],c=[],u=[];let p,d,f;const y=tu(t,a-1,A,r);let g=Math.sign(8&s?y[1]-n[3]:y[0]-n[2]),m=e&&e[a-1],B=0,w=0;for(let i=0;i<a;i++)p=tu(t,i,A,r,p),d=Math.sign(8&s?p[1]-n[3]:p[0]-n[2]),f=e&&e[r/A+i],d&&g&&g!==d&&(eu(y,p,s,n,u),Jc(o,u)&&l.push(m),Jc(h,u)&&c.push(m)),d<=0?(Jc(o,p)&&l.push(f),B-=d):l.length&&(l[l.length-1]=0),d>=0?(Jc(h,p)&&c.push(f),w+=d):c.length&&(c[c.length-1]=0),$c(y,p),g=d,m=f;return [B?{pos:o,types:e&&l}:null,w?{pos:h,types:e&&c}:null]}function au(t,e,A,r){const i=Math.floor((t[0]-A[0])/e)*e+A[0],n=Math.floor((t[1]-A[1])/e)*e+A[1];return r[0]=i,r[1]=n,r[2]=i+e,r[3]=n+e,r}function ou(t,e,A){8&A?(t[1]+=e,t[3]+=e):4&A?(t[1]-=e,t[3]-=e):2&A?(t[0]+=e,t[2]+=e):1&A&&(t[0]-=e,t[2]-=e);}function hu(t,e,A,r){let i=1/0,n=-1/0,s=1/0,a=-1/0;for(let r=0;r<A;r+=e){const e=t[r],A=t[r+1];i=e<i?e:i,n=e>n?e:n,s=A<s?A:s,a=A>a?A:a;}return r[0][0]=i,r[0][1]=s,r[1][0]=n,r[1][1]=a,r}function lu(t,e,A,r){let i=-1,n=-1;for(let s=A+1;s<r;s+=e){const e=Math.abs(t[s]);e>i&&(i=e,n=s-1);}return n}function cu(t,e,A,r,i=85.051129){const n=t[A],s=t[r-e];if(Math.abs(n-s)>180){const r=tu(t,0,e,A);r[0]+=360*Math.round((s-n)/360),Jc(t,r),r[1]=Math.sign(r[1])*i,Jc(t,r),r[0]=n,Jc(t,r);}}function uu(t,e,A,r){let i,n=t[0];for(let s=A;s<r;s+=e){i=t[s];const e=i-n;(e>180||e<-180)&&(i-=360*Math.round(e/360)),t[s]=n=i;}}function pu(t,e){let A;const r=t.length/e;for(let i=0;i<r&&(A=t[i*e],(A+180)%360==0);i++);const i=360*-Math.round(A/360);if(0!==i)for(let A=0;A<r;A++)t[A*e]+=i;}var du=Object.freeze({__proto__:null,Polygon:Uc,getPolygonSignedArea:_c,getPolygonWindingDirection:Ec,forEachSegmentInPolygon:vc,modifyPolygonWindingDirection:Cc,WINDING:{CLOCKWISE:1,COUNTER_CLOCKWISE:-1},earcut:function(t,e,A,r){A=A||2;const i=e&&e.length,n=i?e[0]*A:t.length;let s=Fc(t,0,n,A,!0,r&&r[0]);const a=[];if(!s||s.next===s.prev)return a;let o,h,l,c,u,p,d;if(i&&(s=function(t,e,A,r,i){const n=[];let s,a,o,h,l;for(s=0,a=e.length;s<a;s++)o=e[s]*r,h=s<a-1?e[s+1]*r:t.length,l=Fc(t,o,h,r,!1,i&&i[s+1]),l===l.next&&(l.steiner=!0),n.push(Dc(l));for(n.sort(Lc),s=0;s<n.length;s++)Pc(n[s],A),A=Mc(A,A.next);return A}(t,e,s,A,r)),t.length>80*A){c=h=t[0],u=l=t[1];for(let e=A;e<n;e+=A)p=t[e],d=t[e+1],p<c&&(c=p),d<u&&(u=d),p>h&&(h=p),d>l&&(l=d);o=Math.max(h-c,l-u),o=0!==o?1/o:0;}return Qc(s,a,A,c,u,o),a},clipPolygon:function(t,e,A={}){const{size:r=2,endIndex:i=t.length}=A;let n,s,a,o,h,{startIndex:l=0}=A,c=(i-l)/r;for(let A=1;A<=8;A*=2){n=[],a=tu(t,c-1,r,l,a),h=!(Au(a,e)&A);for(let i=0;i<c;i++)s=tu(t,i,r,l,s),o=!(Au(s,e)&A),o!==h&&Jc(n,eu(a,s,A,e)),o&&Jc(n,s),$c(a,s),h=o;if(t=n,l=0,c=n.length/r,!c)break}return n},clipPolyline:function(t,e,A={}){const{size:r=2,startIndex:i=0,endIndex:n=t.length}=A,s=(n-i)/r,a=[];let o,h,l,c,u=[],p=-1;for(let A=1;A<s;A++){for(o=tu(t,A-1,r,i,o),h=tu(t,A,r,i,h),p<0&&(p=Au(o,e)),l=c=Au(h,e);;){if(!(p|l)){Jc(u,o),l!==c?(Jc(u,h),A<s-1&&(a.push(u),u=[])):A===s-1&&Jc(u,h);break}if(p&l)break;p?(eu(o,h,p,e,o),p=Au(o,e)):(eu(o,h,l,e,h),l=Au(h,e));}p=c;}return u.length&&a.push(u),a},cutPolygonByGrid:nu,cutPolylineByGrid:ru,cutPolylineByMercatorBounds:function(t,e={}){const{size:A=2,startIndex:r=0,endIndex:i=t.length,normalize:n=!0}=e,s=t.slice(r,i);uu(s,A,0,i-r);const a=ru(s,{size:A,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(n)for(const t of a)pu(t,A);return a},cutPolygonByMercatorBounds:function(t,e,A={}){const{size:r=2,normalize:i=!0,edgeTypes:n=!1}=A;e=e||[];const s=[],a=[];let o=0,h=0;for(let i=0;i<=e.length;i++){const n=e[i]||t.length,l=h,c=lu(t,r,o,n);for(let e=c;e<n;e++)s[h++]=t[e];for(let e=o;e<c;e++)s[h++]=t[e];uu(s,r,l,h),cu(s,r,l,h,A.maxLatitude),o=n,a[i]=h;}a.pop();const l=nu(s,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:n});if(i)for(const t of l)pu(t.positions,r);return l},_Polygon:Uc}),fu=6378137,yu=.0066943799901413165,gu=484813681109536e-20,mu=Math.PI/2,Bu=1e-10,wu=.017453292519943295,xu=57.29577951308232,Cu=Math.PI/4,Eu=2*Math.PI,_u=3.14159265359,vu={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},bu={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Uu=/[\s_\-\/\(\)]/g;function Fu(t,e){if(t[e])return t[e];for(var A,r=Object.keys(t),i=e.toLowerCase().replace(Uu,""),n=-1;++n<r.length;)if((A=r[n]).toLowerCase().replace(Uu,"")===i)return t[A]}function Mu(t){var e,A,r,i={},n=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var A=e.split("=");return A.push(!0),t[A[0].toLowerCase()]=A[1],t}),{}),s={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t);},lat_0:function(t){i.lat0=t*wu;},lat_1:function(t){i.lat1=t*wu;},lat_2:function(t){i.lat2=t*wu;},lat_ts:function(t){i.lat_ts=t*wu;},lon_0:function(t){i.long0=t*wu;},lon_1:function(t){i.long1=t*wu;},lon_2:function(t){i.long2=t*wu;},alpha:function(t){i.alpha=parseFloat(t)*wu;},gamma:function(t){i.rectified_grid_angle=parseFloat(t);},lonc:function(t){i.longc=t*wu;},x_0:function(t){i.x0=parseFloat(t);},y_0:function(t){i.y0=parseFloat(t);},k_0:function(t){i.k0=parseFloat(t);},k:function(t){i.k0=parseFloat(t);},a:function(t){i.a=parseFloat(t);},b:function(t){i.b=parseFloat(t);},r_a:function(){i.R_A=!0;},zone:function(t){i.zone=parseInt(t,10);},south:function(){i.utmSouth=!0;},towgs84:function(t){i.datum_params=t.split(",").map((function(t){return parseFloat(t)}));},to_meter:function(t){i.to_meter=parseFloat(t);},units:function(t){i.units=t;var e=Fu(bu,t);e&&(i.to_meter=e.to_meter);},from_greenwich:function(t){i.from_greenwich=t*wu;},pm:function(t){var e=Fu(vu,t);i.from_greenwich=(e||parseFloat(t))*wu;},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t;},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(i.axis=t);},approx:function(){i.approx=!0;}};for(e in n)A=n[e],e in s?"function"==typeof(r=s[e])?r(A):i[r]=A:i[e]=A;return "string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var Qu=/\s/,Iu=/[A-Za-z]/,Su=/[A-Za-z84_]/,Tu=/[,\]]/,Ru=/[\d\.E\-\+]/;function Lu(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1;}function Pu(t,e,A){Array.isArray(e)&&(A.unshift(e),e=null);var r=A.reduce((function(t,e){return Hu(e,t),t}),e?{}:t);e&&(t[e]=r);}function Hu(t,e){if(Array.isArray(t)){var A=t.shift();if("PARAMETER"===A&&(A=t.shift()),1===t.length)return Array.isArray(t[0])?(e[A]={},void Hu(t[0],e[A])):void(e[A]=t[0]);if(t.length)if("TOWGS84"!==A){if("AXIS"===A)return A in e||(e[A]=[]),void e[A].push(t);var r;switch(Array.isArray(A)||(e[A]={}),A){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[A]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&Hu(t[2],e[A]));case"SPHEROID":case"ELLIPSOID":return e[A]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&Hu(t[3],e[A]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void Pu(e,A,t);default:for(r=-1;++r<t.length;)if(!Array.isArray(t[r]))return Hu(t,e[A]);return Pu(e,A,t)}}else e[A]=t;else e[A]=!0;}else e[t]=!0;}function Ou(t){return .017453292519943295*t}function Du(t){var e=new Lu(t).output(),A=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",A]);var i={};return Hu(e,i),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):t.projName="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION,t.AXIS){for(var e="",A=0,r=t.AXIS.length;A<r;++A){var i=[t.AXIS[A][0].toLowerCase(),t.AXIS[A][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?e+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?e+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?e+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(e+="w");}2===e.length&&(e+="u"),3===e.length&&(t.axis=e);}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var n=t.GEOGCS;function s(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(n=t),n&&(t.datumCode=n.DATUM?n.DATUM.name.toLowerCase():n.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),n.DATUM&&n.DATUM.SPHEROID&&(t.ellps=n.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=n.DATUM.SPHEROID.a,t.rf=parseFloat(n.DATUM.SPHEROID.rf,10)),n.DATUM&&n.DATUM.TOWGS84&&(t.datum_params=n.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ou],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ou],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",Ou],["lat0","latitude_of_origin",Ou],["lat0","standard_parallel_1",Ou],["lat1","standard_parallel_1",Ou],["lat2","standard_parallel_2",Ou],["azimuth","Azimuth"],["alpha","azimuth",Ou],["srsCode","name"]].forEach((function(e){return function(t,e){var A=e[0],r=e[1];!(A in t)&&r in t&&(t[A]=t[r],3===e.length&&(t[A]=e[2](t[A])));}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=Ou(t.lat1>0?90:-90),t.lat_ts=t.lat1);}(i),i}function Nu(t){var e=this;if(2===arguments.length){var A=arguments[1];Nu[t]="string"==typeof A?"+"===A.charAt(0)?Mu(arguments[1]):Du(arguments[1]):A;}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?Nu.apply(e,t):Nu(t);}));if("string"==typeof t){if(t in Nu)return Nu[t]}else "EPSG"in t?Nu["EPSG:"+t.EPSG]=t:"ESRI"in t?Nu["ESRI:"+t.ESRI]=t:"IAU2000"in t?Nu["IAU2000:"+t.IAU2000]=t:console.log(t);return}}Lu.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Qu.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++];}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},Lu.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(Tu.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Lu.prototype.afterItem=function(t){return ","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Lu.prototype.number=function(t){if(!Ru.test(t)){if(Tu.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t;},Lu.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5;},Lu.prototype.keyword=function(t){if(Su.test(t))this.word+=t;else {if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=1)}if(!Tu.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t);}},Lu.prototype.neutral=function(t){if(Iu.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Ru.test(t))return this.word=t,void(this.state=3);if(!Tu.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t);},Lu.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)},function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"];}(Nu);var ku=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Vu=["3857","900913","3785","102113"];function Gu(t,e){var A,r;if(t=t||{},!e)return t;for(r in e)void 0!==(A=e[r])&&(t[r]=A);return t}function Ku(t,e,A){var r=t*e;return A/Math.sqrt(1-r*r)}function zu(t){return t<0?-1:1}function Xu(t){return Math.abs(t)<=_u?t:t-zu(t)*Eu}function qu(t,e,A){var r=t*A;return r=Math.pow((1-r)/(1+r),.5*t),Math.tan(.5*(mu-e))/r}function ju(t,e){for(var A,r,i=.5*t,n=mu-2*Math.atan(e),s=0;s<=15;s++)if(A=t*Math.sin(n),n+=r=mu-2*Math.atan(e*Math.pow((1-A)/(1+A),i))-n,Math.abs(r)<=1e-10)return n;return -9999}function Yu(t){return t}var Wu=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):Ku(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1);},forward:function(t){var e,A,r=t.x,i=t.y;if(i*xu>90&&i*xu<-90&&r*xu>180&&r*xu<-180)return null;if(Math.abs(Math.abs(i)-mu)<=Bu)return null;if(this.sphere)e=this.x0+this.a*this.k0*Xu(r-this.long0),A=this.y0+this.a*this.k0*Math.log(Math.tan(Cu+.5*i));else {var n=Math.sin(i),s=qu(this.e,i,n);e=this.x0+this.a*this.k0*Xu(r-this.long0),A=this.y0-this.a*this.k0*Math.log(s);}return t.x=e,t.y=A,t},inverse:function(t){var e,A,r=t.x-this.x0,i=t.y-this.y0;if(this.sphere)A=mu-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else {var n=Math.exp(-i/(this.a*this.k0));if(-9999===(A=ju(this.e,n)))return null}return e=Xu(this.long0+r/(this.a*this.k0)),t.x=e,t.y=A,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Yu,inverse:Yu,names:["longlat","identity"]}],Zu={},Ju=[];function $u(t,e){var A=Ju.length;return t.names?(Ju[A]=t,t.names.forEach((function(t){Zu[t.toLowerCase()]=A;})),this):(console.log(e),!0)}var tp={start:function(){Wu.forEach($u);},add:$u,get:function(t){if(!t)return !1;var e=t.toLowerCase();return void 0!==Zu[e]&&Ju[Zu[e]]?Ju[Zu[e]]:void 0}},ep={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Ap=ep.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};ep.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var rp={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},ip={};function np(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:ip[t]||null,isNull:!1}}function sp(t){return t/3600*Math.PI/180}function ap(t,e,A){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,A)))}function op(t){return t.map((function(t){return [sp(t.longitudeShift),sp(t.latitudeShift)]}))}function hp(t,e,A){return {name:ap(t,e+8,e+16).trim(),parent:ap(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,A),upperLatitude:t.getFloat64(e+88,A),lowerLongitude:t.getFloat64(e+104,A),upperLongitude:t.getFloat64(e+120,A),latitudeInterval:t.getFloat64(e+136,A),longitudeInterval:t.getFloat64(e+152,A),gridNodeCount:t.getInt32(e+168,A)}}function lp(t,e,A,r){for(var i=e+176,n=[],s=0;s<A.gridNodeCount;s++){var a={latitudeShift:t.getFloat32(i+16*s,r),longitudeShift:t.getFloat32(i+16*s+4,r),latitudeAccuracy:t.getFloat32(i+16*s+8,r),longitudeAccuracy:t.getFloat32(i+16*s+12,r)};n.push(a);}return n}function cp(t,e){if(!(this instanceof cp))return new cp(t);e=e||function(t){if(t)throw t};var A=function(t){if(!function(t){return "string"==typeof t}(t))return t;if(function(t){return t in Nu}(t))return Nu[t];if(function(t){return ku.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=Du(t);if(function(t){var e=Fu(t,"authority");if(e){var A=Fu(e,"epsg");return A&&Vu.indexOf(A)>-1}}(e))return Nu["EPSG:3857"];var A=function(t){var e=Fu(t,"extension");if(e)return Fu(e,"proj4")}(e);return A?Mu(A):e}return function(t){return "+"===t[0]}(t)?Mu(t):void 0}(t);if("object"==typeof A){var r=cp.projections.get(A.projName);if(r){if(A.datumCode&&"none"!==A.datumCode){var i=Fu(rp,A.datumCode);i&&(A.datum_params=A.datum_params||(i.towgs84?i.towgs84.split(","):null),A.ellps=i.ellipse,A.datumName=i.datumName?i.datumName:A.datumCode);}A.k0=A.k0||1,A.axis=A.axis||"enu",A.ellps=A.ellps||"wgs84",A.lat1=A.lat1||A.lat0;var n=function(t,e,A,r,i){if(!t){var n=Fu(ep,r);n||(n=Ap),t=n.a,e=n.b,A=n.rf;}return A&&!e&&(e=(1-1/A)*t),(0===A||Math.abs(t-e)<Bu)&&(i=!0,e=t),{a:t,b:e,rf:A,sphere:i}}(A.a,A.b,A.rf,A.ellps,A.sphere),s=function(t,e,A,r){var i=t*t,n=e*e,s=(i-n)/i,a=0;return r?(i=(t*=1-s*(.16666666666666666+s*(.04722222222222222+.022156084656084655*s)))*t,s=0):a=Math.sqrt(s),{es:s,e:a,ep2:(i-n)/n}}(n.a,n.b,0,A.R_A),a=function(t){return void 0===t?null:t.split(",").map(np)}(A.nadgrids),o=A.datum||function(t,e,A,r,i,n,s){var a={};return a.datum_type=void 0===t||"none"===t?5:4,e&&(a.datum_params=e.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=1),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=2,a.datum_params[3]*=gu,a.datum_params[4]*=gu,a.datum_params[5]*=gu,a.datum_params[6]=a.datum_params[6]/1e6+1))),s&&(a.datum_type=3,a.grids=s),a.a=A,a.b=r,a.es=i,a.ep2=n,a}(A.datumCode,A.datum_params,n.a,n.b,s.es,s.ep2,a);Gu(this,A),Gu(this,r),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=o,this.init(),e(null,this);}else e(t);}else e(t);}function up(t,e,A){var r,i,n,s=t.x,a=t.y,o=t.z?t.z:0;if(a<-mu&&a>-1.001*mu)a=-mu;else if(a>mu&&a<1.001*mu)a=mu;else {if(a<-mu)return {x:-1/0,y:-1/0,z:t.z};if(a>mu)return {x:1/0,y:1/0,z:t.z}}return s>Math.PI&&(s-=2*Math.PI),i=Math.sin(a),n=Math.cos(a),{x:((r=A/Math.sqrt(1-e*(i*i)))+o)*n*Math.cos(s),y:(r+o)*n*Math.sin(s),z:(r*(1-e)+o)*i}}function pp(t,e,A,r){var i,n,s,a,o,h,l,c,u,p,d,f,y,g,m,B=t.x,w=t.y,x=t.z?t.z:0;if(i=Math.sqrt(B*B+w*w),n=Math.sqrt(B*B+w*w+x*x),i/A<1e-12){if(g=0,n/A<1e-12)return m=-r,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(w,B);s=x/n,c=(a=i/n)*(1-e)*(o=1/Math.sqrt(1-e*(2-e)*a*a)),u=s*o,y=0;do{y++,h=e*(l=A/Math.sqrt(1-e*u*u))/(l+(m=i*c+x*u-l*(1-e*u*u))),f=(d=s*(o=1/Math.sqrt(1-h*(2-h)*a*a)))*c-(p=a*(1-h)*o)*u,c=p,u=d;}while(f*f>1e-24&&y<30);return {x:g,y:Math.atan(d/Math.abs(p)),z:m}}function dp(t){return 1===t||2===t}function fp(t,e,A){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var r={x:-A.x,y:A.y},i={x:Number.NaN,y:Number.NaN},n=[],s=0;s<t.grids.length;s++){var a=t.grids[s];if(n.push(a.name),a.isNull){i=r;break}if(null!==a.grid){var o=a.grid.subgrids[0],h=(Math.abs(o.del[1])+Math.abs(o.del[0]))/1e4;if(!(o.ll[1]-h>r.y||o.ll[0]-h>r.x||o.ll[1]+(o.lim[1]-1)*o.del[1]+h<r.y||o.ll[0]+(o.lim[0]-1)*o.del[0]+h<r.x||(i=yp(r,e,o),isNaN(i.x))))break}else if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*xu+" "+r.y*xu+" tried: '"+n+"'"),-1):(A.x=-i.x,A.y=i.y,0)}function yp(t,e,A){var r={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return r;var i={x:t.x,y:t.y};i.x-=A.ll[0],i.y-=A.ll[1],i.x=Xu(i.x-Math.PI)+Math.PI;var n=gp(i,A);if(e){if(isNaN(n.x))return r;n.x=i.x-n.x,n.y=i.y-n.y;var s,a,o=9;do{if(a=gp(n,A),isNaN(a.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}n.x+=(s={x:i.x-(a.x+n.x),y:i.y-(a.y+n.y)}).x,n.y+=s.y;}while(o--&&Math.abs(s.x)>1e-12&&Math.abs(s.y)>1e-12);if(o<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=Xu(n.x+A.ll[0]),r.y=n.y+A.ll[1];}else isNaN(n.x)||(r.x=t.x+n.x,r.y=t.y+n.y);return r}function gp(t,e){var A,r={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(r.x),n=Math.floor(r.y),s=r.x-1*i,a=r.y-1*n,o={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return o;if(n<0||n>=e.lim[1])return o;var h=e.cvs[A=n*e.lim[0]+i][0],l=e.cvs[A][1];A++;var c=e.cvs[A][0],u=e.cvs[A][1],p=e.cvs[A+=e.lim[0]][0],d=e.cvs[A][1];A--;var f=e.cvs[A][1],y=s*a,g=s*(1-a),m=(1-s)*(1-a),B=(1-s)*a;return o.x=m*h+g*c+B*e.cvs[A][0]+y*p,o.y=m*l+g*u+B*f+y*d,o}function mp(t,e,A){var r,i,n,s=A.x,a=A.y,o=A.z||0,h={};for(n=0;n<3;n++)if(!e||2!==n||void 0!==A.z)switch(0===n?(r=s,i=-1!=="ew".indexOf(t.axis[n])?"x":"y"):1===n?(r=a,i=-1!=="ns".indexOf(t.axis[n])?"y":"x"):(r=o,i="z"),t.axis[n]){case"e":case"n":h[i]=r;break;case"w":case"s":h[i]=-r;break;case"u":void 0!==A[i]&&(h.z=r);break;case"d":void 0!==A[i]&&(h.z=-r);break;default:return null}return h}function Bp(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function wp(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function xp(t,e,A,r){var i;if(Array.isArray(A)&&(A=Bp(A)),function(t){wp(t.x),wp(t.y);}(A),t.datum&&e.datum&&function(t,e){return (1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode||(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode}(t,e)&&(A=xp(t,i=new cp("WGS84"),A,r),t=i),r&&"enu"!==t.axis&&(A=mp(t,!1,A)),"longlat"===t.projName)A={x:A.x*wu,y:A.y*wu,z:A.z||0};else if(t.to_meter&&(A={x:A.x*t.to_meter,y:A.y*t.to_meter,z:A.z||0}),!(A=t.inverse(A)))return;if(t.from_greenwich&&(A.x+=t.from_greenwich),A=function(t,e,A){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:2!==t.datum_type||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return A;if(5===t.datum_type||5===e.datum_type)return A;var r=t.a,i=t.es;if(3===t.datum_type){if(0!==fp(t,!1,A))return;r=fu,i=yu;}var n=e.a,s=e.b,a=e.es;return 3===e.datum_type&&(n=fu,s=6356752.314,a=yu),i!==a||r!==n||dp(t.datum_type)||dp(e.datum_type)?(A=up(A,i,r),dp(t.datum_type)&&(A=function(t,e,A){if(1===e)return {x:t.x+A[0],y:t.y+A[1],z:t.z+A[2]};if(2===e){var r=A[3],i=A[4],n=A[5],s=A[6];return {x:s*(t.x-n*t.y+i*t.z)+A[0],y:s*(n*t.x+t.y-r*t.z)+A[1],z:s*(-i*t.x+r*t.y+t.z)+A[2]}}}(A,t.datum_type,t.datum_params)),dp(e.datum_type)&&(A=function(t,e,A){if(1===e)return {x:t.x-A[0],y:t.y-A[1],z:t.z-A[2]};if(2===e){var r=A[3],i=A[4],n=A[5],s=A[6],a=(t.x-A[0])/s,o=(t.y-A[1])/s,h=(t.z-A[2])/s;return {x:a+n*o-i*h,y:-n*a+o+r*h,z:i*a-r*o+h}}}(A,e.datum_type,e.datum_params)),A=pp(A,a,n,s),3!==e.datum_type||0===fp(e,!0,A)?A:void 0):A}(t.datum,e.datum,A))return e.from_greenwich&&(A={x:A.x-e.from_greenwich,y:A.y,z:A.z||0}),"longlat"===e.projName?A={x:A.x*xu,y:A.y*xu,z:A.z||0}:(A=e.forward(A),e.to_meter&&(A={x:A.x/e.to_meter,y:A.y/e.to_meter,z:A.z||0})),r&&"enu"!==e.axis?mp(e,!0,A):A}(cp.projections=tp).start();var Cp=cp("WGS84");function Ep(t,e,A,r){var i,n,s;return Array.isArray(A)?(i=xp(t,e,A,r)||{x:NaN,y:NaN},A.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(A.splice(3)):[i.x,i.y,A[2]].concat(A.splice(3)):[i.x,i.y].concat(A.splice(2)):[i.x,i.y]):(n=xp(t,e,A,r),2===(s=Object.keys(A)).length||s.forEach((function(r){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===r||"y"===r||"z"===r)return}else if("x"===r||"y"===r)return;n[r]=A[r];})),n)}function _p(t){return t instanceof cp?t:t.oProj?t.oProj:cp(t)}function vp(t,e,A){t=_p(t);var r,i=!1;return void 0===e?(e=t,t=Cp,i=!0):(void 0!==e.x||Array.isArray(e))&&(A=e,e=t,t=Cp,i=!0),e=_p(e),A?Ep(t,e,A):(r={forward:function(A,r){return Ep(t,e,A,r)},inverse:function(A,r){return Ep(e,t,A,r)}},i&&(r.oProj=e),r)}var bp="AJSAJS",Up="AFAFAF",Fp=65,Mp=73,Qp=79,Ip={forward:Sp,inverse:function(t){var e=Pp(Op(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:Tp};function Sp(t,e){return e=e||5,function(t,e){var A,r,i,n,s,a,o,h,l,c,u,p="00000"+t.easting,d="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(l=t.easting,c=t.northing,u=Hp(t.zoneNumber),A=Math.floor(l/1e5),r=Math.floor(c/1e5)%20,n=bp.charCodeAt(i=u-1),s=Up.charCodeAt(i),h=!1,(a=n+A-1)>90&&(a=a-90+Fp-1,h=!0),(a===Mp||n<Mp&&a>Mp||(a>Mp||n<Mp)&&h)&&a++,(a===Qp||n<Qp&&a>Qp||(a>Qp||n<Qp)&&h)&&++a===Mp&&a++,a>90&&(a=a-90+Fp-1),(o=s+r)>86?(o=o-86+Fp-1,h=!0):h=!1,(o===Mp||s<Mp&&o>Mp||(o>Mp||s<Mp)&&h)&&o++,(o===Qp||s<Qp&&o>Qp||(o>Qp||s<Qp)&&h)&&++o===Mp&&o++,o>86&&(o=o-86+Fp-1),String.fromCharCode(a)+String.fromCharCode(o))+p.substr(p.length-5,e)+d.substr(d.length-5,e)}(function(t){var e,A,r,i,n,s,a,o=t.lat,h=t.lon,l=6378137,c=.9996,u=Rp(o),p=Rp(h);a=Math.floor((h+180)/6)+1,180===h&&(a=60),o>=56&&o<64&&h>=3&&h<12&&(a=32),o>=72&&o<84&&(h>=0&&h<9?a=31:h>=9&&h<21?a=33:h>=21&&h<33?a=35:h>=33&&h<42&&(a=37)),s=Rp(6*(a-1)-180+3),e=.006739496752268451,A=l/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),r=Math.tan(u)*Math.tan(u),i=e*Math.cos(u)*Math.cos(u);var d,f,y=c*A*((n=Math.cos(u)*(p-s))+(1-r+i)*n*n*n/6+(5-18*r+r*r+72*i-58*e)*n*n*n*n*n/120)+5e5,g=c*(l*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u))+A*Math.tan(u)*(n*n/2+(5-r+9*i+4*i*i)*n*n*n*n/24+(61-58*r+r*r+600*i-2.2240339282485886)*n*n*n*n*n*n/720));return o<0&&(g+=1e7),{northing:Math.round(g),easting:Math.round(y),zoneNumber:a,zoneLetter:(d=o,f="Z",84>=d&&d>=72?f="X":72>d&&d>=64?f="W":64>d&&d>=56?f="V":56>d&&d>=48?f="U":48>d&&d>=40?f="T":40>d&&d>=32?f="S":32>d&&d>=24?f="R":24>d&&d>=16?f="Q":16>d&&d>=8?f="P":8>d&&d>=0?f="N":0>d&&d>=-8?f="M":-8>d&&d>=-16?f="L":-16>d&&d>=-24?f="K":-24>d&&d>=-32?f="J":-32>d&&d>=-40?f="H":-40>d&&d>=-48?f="G":-48>d&&d>=-56?f="F":-56>d&&d>=-64?f="E":-64>d&&d>=-72?f="D":-72>d&&d>=-80&&(f="C"),f)}}({lat:t[1],lon:t[0]}),e)}function Tp(t){var e=Pp(Op(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Rp(t){return t*(Math.PI/180)}function Lp(t){return t/Math.PI*180}function Pp(t){var e=t.northing,A=t.easting,r=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var n,s,a,o,h,l,c,u,p,d=.9996,f=6378137,y=.00669438,g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=A-5e5,B=e;r<"N"&&(B-=1e7),c=6*(i-1)-180+3,n=.006739496752268451,p=(u=B/d/6367449.145945056)+(3*g/2-27*g*g*g/32)*Math.sin(2*u)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*u)+151*g*g*g/96*Math.sin(6*u),s=f/Math.sqrt(1-y*Math.sin(p)*Math.sin(p)),a=Math.tan(p)*Math.tan(p),o=n*Math.cos(p)*Math.cos(p),h=.99330562*f/Math.pow(1-y*Math.sin(p)*Math.sin(p),1.5),l=m/(s*d);var w=p-s*Math.tan(p)/h*(l*l/2-(5+3*a+10*o-4*o*o-9*n)*l*l*l*l/24+(61+90*a+298*o+45*a*a-1.6983531815716497-3*o*o)*l*l*l*l*l*l/720);w=Lp(w);var x,C=(l-(1+2*a+o)*l*l*l/6+(5-2*o+28*a-3*o*o+8*n+24*a*a)*l*l*l*l*l/120)/Math.cos(p);if(C=c+Lp(C),t.accuracy){var E=Pp({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});x={top:E.lat,right:E.lon,bottom:w,left:C};}else x={lat:w,lon:C};return x}function Hp(t){var e=t%6;return 0===e&&(e=6),e}function Op(t){if(t&&0===t.length)throw "MGRSPoint coverting from nothing";for(var e,A=t.length,r=null,i="",n=0;!/[A-Z]/.test(e=t.charAt(n));){if(n>=2)throw "MGRSPoint bad conversion from: "+t;i+=e,n++;}var s=parseInt(i,10);if(0===n||n+3>A)throw "MGRSPoint bad conversion from: "+t;var a=t.charAt(n++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw "MGRSPoint zone letter "+a+" not handled: "+t;r=t.substring(n,n+=2);for(var o=Hp(s),h=function(t,e){for(var A=bp.charCodeAt(e-1),r=1e5,i=!1;A!==t.charCodeAt(0);){if(++A===Mp&&A++,A===Qp&&A++,A>90){if(i)throw "Bad character: "+t;A=Fp,i=!0;}r+=1e5;}return r}(r.charAt(0),o),l=function(t,e){if(t>"V")throw "MGRSPoint given invalid Northing "+t;for(var A=Up.charCodeAt(e-1),r=0,i=!1;A!==t.charCodeAt(0);){if(++A===Mp&&A++,A===Qp&&A++,A>86){if(i)throw "Bad character: "+t;A=Fp,i=!0;}r+=1e5;}return r}(r.charAt(1),o);l<Dp(a);)l+=2e6;var c=A-n;if(c%2!=0)throw "MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var u,p,d,f=c/2,y=0,g=0;return f>0&&(u=1e5/Math.pow(10,f),p=t.substring(n,n+f),y=parseFloat(p)*u,d=t.substring(n+f),g=parseFloat(d)*u),{easting:y+h,northing:g+l,zoneLetter:a,zoneNumber:s,accuracy:u}}function Dp(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1;}if(e>=0)return e;throw "Invalid zone letter: "+t}function Np(t,e,A){if(!(this instanceof Np))return new Np(t,e,A);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0;}else this.x=t,this.y=e,this.z=A||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint");}Np.fromMGRS=function(t){return new Np(Tp(t))},Np.prototype.toMGRS=function(t){return Sp([this.x,this.y],t)};var kp=.046875,Vp=.01953125,Gp=.01068115234375;function Kp(t){var e=[];e[0]=1-t*(.25+t*(kp+t*(Vp+t*Gp))),e[1]=t*(.75-t*(kp+t*(Vp+t*Gp)));var A=t*t;return e[2]=A*(.46875-t*(.013020833333333334+.007120768229166667*t)),e[3]=(A*=t)*(.3645833333333333-.005696614583333333*t),e[4]=A*t*.3076171875,e}function zp(t,e,A,r){return r[0]*t-(A*=e)*(r[1]+(e*=e)*(r[2]+e*(r[3]+e*r[4])))}function Xp(t,e,A){for(var r=1/(1-e),i=t,n=20;n;--n){var s=Math.sin(i),a=1-e*s*s;if(i-=a=(zp(i,s,Math.cos(i),A)-t)*(a*Math.sqrt(a))*r,Math.abs(a)<Bu)return i}return i}var qp={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Kp(this.es),this.ml0=zp(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en));},forward:function(t){var e,A,r,i=t.y,n=Xu(t.x-this.long0),s=Math.sin(i),a=Math.cos(i);if(this.es){var o=a*n,h=Math.pow(o,2),l=this.ep2*Math.pow(a,2),c=Math.pow(l,2),u=Math.abs(a)>Bu?Math.tan(i):0,p=Math.pow(u,2),d=Math.pow(p,2);e=1-this.es*Math.pow(s,2),o/=Math.sqrt(e);var f=zp(i,s,a,this.en);A=this.a*(this.k0*o*(1+h/6*(1-p+l+h/20*(5-18*p+d+14*l-58*p*l+h/42*(61+179*d-d*p-479*p)))))+this.x0,r=this.a*(this.k0*(f-this.ml0+s*n*o/2*(1+h/12*(5-p+9*l+4*c+h/30*(61+d-58*p+270*l-330*p*l+h/56*(1385+543*d-d*p-3111*p))))))+this.y0;}else {var y=a*Math.sin(n);if(Math.abs(Math.abs(y)-1)<Bu)return 93;if(A=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,r=a*Math.cos(n)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(r))>=1){if(y-1>Bu)return 93;r=0;}else r=Math.acos(r);i<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0;}return t.x=A,t.y=r,t},inverse:function(t){var e,A,r,i,n=1/this.a*(t.x-this.x0),s=1/this.a*(t.y-this.y0);if(this.es)if(A=Xp(e=this.ml0+s/this.k0,this.es,this.en),Math.abs(A)<mu){var a=Math.sin(A),o=Math.cos(A),h=Math.abs(o)>Bu?Math.tan(A):0,l=this.ep2*Math.pow(o,2),c=Math.pow(l,2),u=Math.pow(h,2),p=Math.pow(u,2);e=1-this.es*Math.pow(a,2);var d=n*Math.sqrt(e)/this.k0,f=Math.pow(d,2);r=A-(e*=h)*f/(1-this.es)*.5*(1-f/12*(5+3*u-9*l*u+l-4*c-f/30*(61+90*u-252*l*u+45*p+46*l-f/56*(1385+3633*u+4095*p+1574*p*u)))),i=Xu(this.long0+d*(1-f/6*(1+2*u+l-f/20*(5+28*u+24*p+8*l*u+6*l-f/42*(61+662*u+1320*p+720*p*u))))/o);}else r=mu*zu(s),i=0;else {var y=Math.exp(n/this.k0),g=.5*(y-1/y),m=Math.cos(this.lat0+s/this.k0);e=Math.sqrt((1-Math.pow(m,2))/(1+Math.pow(g,2))),r=Math.asin(e),s<0&&(r=-r),i=0===g&&0===m?0:Xu(Math.atan2(g,m)+this.long0);}return t.x=i,t.y=r,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function jp(t){var e=Math.exp(t);return (e-1/e)/2}function Yp(t,e){t=Math.abs(t),e=Math.abs(e);var A=Math.max(t,e),r=Math.min(t,e)/(A||1);return A*Math.sqrt(1+Math.pow(r,2))}function Wp(t,e){for(var A,r=2*Math.cos(2*e),i=t.length-1,n=t[i],s=0;--i>=0;)A=r*n-s+t[i],s=n,n=A;return e+A*Math.sin(2*e)}function Zp(t,e,A){for(var r,i,n=Math.sin(e),s=Math.cos(e),a=jp(A),o=function(t){var e=Math.exp(t);return (e+1/e)/2}(A),h=2*s*o,l=-2*n*a,c=t.length-1,u=t[c],p=0,d=0,f=0;--c>=0;)r=d,i=p,u=h*(d=u)-r-l*(p=f)+t[c],f=l*d-i+h*p;return [(h=n*o)*u-(l=s*a)*f,h*f+l*u]}var Jp={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(qp.init.apply(this),this.forward=qp.forward,this.inverse=qp.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),A=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),this.cgb[1]=(A*=e)*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=A*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),this.cgb[2]=(A*=e)*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=A*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),this.cgb[3]=(A*=e)*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=A*(1237/630+e*(e*(-24832/14175)-2.4)),this.cgb[4]=(A*=e)*(4174/315+e*(-144838/6237)),this.cbg[4]=A*(-734/315+e*(109598/31185)),this.cgb[5]=(A*=e)*(601676/22275),this.cbg[5]=A*(444337/155925),A=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+A*(1/4+A*(1/64+A/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=A*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=A*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),this.utg[2]=(A*=e)*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=A*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),this.utg[3]=(A*=e)*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=A*(49561/161280+e*(-179/168+e*(6601661/7257600))),this.utg[4]=(A*=e)*(-4583/161280+e*(108847/3991680)),this.gtu[4]=A*(34729/80640+e*(-3418889/1995840)),this.utg[5]=(A*=e)*(-20648693/638668800),this.gtu[5]=.6650675310896665*A;var r=Wp(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(t,e){for(var A,r=2*Math.cos(e),i=t.length-1,n=t[i],s=0;--i>=0;)A=r*n-s+t[i],s=n,n=A;return Math.sin(e)*A}(this.gtu,2*r));},forward:function(t){var e=Xu(t.x-this.long0),A=t.y;A=Wp(this.cbg,A);var r=Math.sin(A),i=Math.cos(A),n=Math.sin(e),s=Math.cos(e);A=Math.atan2(r,s*i),e=Math.atan2(n*i,Yp(r,i*s)),e=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,A=e-1;return 0===A?t:t*Math.log(e)/A}(e*(1+e/(Yp(1,e)+1))),t<0?-e:e}(Math.tan(e));var a,o,h=Zp(this.gtu,2*A,2*e);return A+=h[0],e+=h[1],Math.abs(e)<=2.623395162778?(a=this.a*(this.Qn*e)+this.x0,o=this.a*(this.Qn*A+this.Zb)+this.y0):(a=1/0,o=1/0),t.x=a,t.y=o,t},inverse:function(t){var e,A,r=1/this.a*(t.x-this.x0),i=1/this.a*(t.y-this.y0);if(i=(i-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var n=Zp(this.utg,2*i,2*r);i+=n[0],r+=n[1],r=Math.atan(jp(r));var s=Math.sin(i),a=Math.cos(i),o=Math.sin(r),h=Math.cos(r);i=Math.atan2(s*h,Yp(o,h*a)),e=Xu((r=Math.atan2(o,h*a))+this.long0),A=Wp(this.cgb,i);}else e=1/0,A=1/0;return t.x=e,t.y=A,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},$p={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(Xu(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*wu,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Jp.init.apply(this),this.forward=Jp.forward,this.inverse=Jp.inverse;},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function td(t,e){return Math.pow((1-t)/(1+t),e)}var ed={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Cu)/(Math.pow(Math.tan(.5*this.lat0+Cu),this.C)*td(this.e*t,this.ratexp));},forward:function(t){var e=t.x,A=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*A+Cu),this.C)*td(this.e*Math.sin(A),this.ratexp))-mu,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,A=t.y,r=Math.pow(Math.tan(.5*A+Cu)/this.K,1/this.C),i=20;i>0&&(A=2*Math.atan(r*td(this.e*Math.sin(t.y),-.5*this.e))-mu,!(Math.abs(A-t.y)<1e-14));--i)t.y=A;return i?(t.x=e,t.y=A,t):null},names:["gauss"]},Ad={init:function(){ed.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"));},forward:function(t){var e,A,r,i;return t.x=Xu(t.x-this.long0),ed.forward.apply(this,[t]),e=Math.sin(t.y),A=Math.cos(t.y),r=Math.cos(t.x),t.x=(i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*A*r))*A*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*A*r),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,A,r,i,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Math.sqrt(t.x*t.x+t.y*t.y)){var s=2*Math.atan2(n,this.R2);e=Math.sin(s),A=Math.cos(s),i=Math.asin(A*this.sinc0+t.y*e*this.cosc0/n),r=Math.atan2(t.x*e,n*this.cosc0*A-t.y*this.sinc0*e);}else i=this.phic0,r=0;return t.x=r,t.y=i,ed.inverse.apply(this,[t]),t.x=Xu(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},rd={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Bu&&(this.k0=.5*(1+zu(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Bu&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Bu&&(this.k0=.5*this.cons*Ku(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/qu(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ku(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-mu,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0));},forward:function(t){var e,A,r,i,n,s,a=t.x,o=t.y,h=Math.sin(o),l=Math.cos(o),c=Xu(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=Bu&&Math.abs(o+this.lat0)<=Bu?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*h+this.coslat0*l*Math.cos(c)),t.x=this.a*e*l*Math.sin(c)+this.x0,t.y=this.a*e*(this.coslat0*h-this.sinlat0*l*Math.cos(c))+this.y0,t):(A=2*Math.atan(this.ssfn_(o,h,this.e))-mu,i=Math.cos(A),r=Math.sin(A),Math.abs(this.coslat0)<=Bu?(n=qu(this.e,o*this.con,this.con*h),t.x=this.x0+(s=2*this.a*this.k0*n/this.cons)*Math.sin(a-this.long0),t.y=this.y0-this.con*s*Math.cos(a-this.long0),t):(Math.abs(this.sinlat0)<Bu?(e=2*this.a*this.k0/(1+i*Math.cos(c)),t.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*i*Math.cos(c))),t.y=e*(this.cosX0*r-this.sinX0*i*Math.cos(c))+this.y0),t.x=e*i*Math.sin(c)+this.x0,t))},inverse:function(t){var e,A,r,i;t.x-=this.x0,t.y-=this.y0;var n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var s=2*Math.atan(n/(2*this.a*this.k0));return e=this.long0,A=this.lat0,n<=Bu?(t.x=e,t.y=A,t):(A=Math.asin(Math.cos(s)*this.sinlat0+t.y*Math.sin(s)*this.coslat0/n),e=Math.abs(this.coslat0)<Bu?Xu(this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y)):Xu(this.long0+Math.atan2(t.x*Math.sin(s),n*this.coslat0*Math.cos(s)-t.y*this.sinlat0*Math.sin(s))),t.x=e,t.y=A,t)}if(Math.abs(this.coslat0)<=Bu){if(n<=Bu)return A=this.lat0,t.x=e=this.long0,t.y=A,t;t.x*=this.con,t.y*=this.con,A=this.con*ju(this.e,n*this.cons/(2*this.a*this.k0)),e=this.con*Xu(this.con*this.long0+Math.atan2(t.x,-1*t.y));}else r=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=Bu?i=this.X0:(i=Math.asin(Math.cos(r)*this.sinX0+t.y*Math.sin(r)*this.cosX0/n),e=Xu(this.long0+Math.atan2(t.x*Math.sin(r),n*this.cosX0*Math.cos(r)-t.y*this.sinX0*Math.sin(r)))),A=-1*ju(this.e,Math.tan(.5*(mu+i)));return t.x=e,t.y=A,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,A){return e*=A,Math.tan(.5*(mu+t))*Math.pow((1-e)/(1+e),.5*A)}},id={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),A=this.a,r=1/this.rf,i=2*r-Math.pow(r,2),n=this.e=Math.sqrt(i);this.R=this.k0*A*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),o=Math.log((1+n*e)/(1-n*e));this.K=s-this.alpha*a+this.alpha*n/2*o;},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),A=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=2*(Math.atan(Math.exp(-this.alpha*(e+A)+this.K))-Math.PI/4),i=this.alpha*(t.x-this.lambda0),n=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(i))),s=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(i));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*n+this.x0,t},inverse:function(t){for(var e=(t.x-this.x0)/this.R,A=2*(Math.atan(Math.exp((t.y-this.y0)/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(A)+Math.sin(this.b0)*Math.cos(A)*Math.cos(e)),i=Math.atan(Math.sin(e)/(Math.cos(this.b0)*Math.cos(e)-Math.sin(this.b0)*Math.tan(A))),n=this.lambda0+i/this.alpha,s=0,a=r,o=-1e3,h=0;Math.abs(a-o)>1e-7;){if(++h>20)return;s=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(a))/2)),o=a,a=2*Math.atan(Math.exp(s))-Math.PI/2;}return t.x=n,t.y=a,t},names:["somerc"]},nd=1e-7,sd={init:function(){var t,e,A,r,i,n,s,a,o,h,l,c,u,p=0,d=0,f=0,y=0,g=0,m=0,B=0;this.no_off=(u="object"==typeof(c=this).PROJECTION?Object.keys(c.PROJECTION)[0]:c.PROJECTION,"no_uoff"in c||"no_off"in c||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(u)),this.no_rot="no_rot"in this;var w=!1;"alpha"in this&&(w=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),w&&(B=this.alpha),x&&(p=this.rectified_grid_angle*wu),w||x)d=this.longc;else if(f=this.long1,g=this.lat1,y=this.long2,m=this.lat2,Math.abs(g-m)<=nd||(t=Math.abs(g))<=nd||Math.abs(t-mu)<=nd||Math.abs(Math.abs(this.lat0)-mu)<=nd||Math.abs(Math.abs(m)-mu)<=nd)throw new Error;var C=1-this.es;e=Math.sqrt(C),Math.abs(this.lat0)>Bu?(a=Math.sin(this.lat0),A=Math.cos(this.lat0),t=1-this.es*a*a,this.B=A*A,this.B=Math.sqrt(1+this.es*this.B*this.B/C),this.A=this.B*this.k0*e/t,(i=(r=this.B*e/(A*Math.sqrt(t)))*r-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=r,this.E*=Math.pow(qu(this.e,this.lat0,a),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=i=1),w||x?(w?(l=Math.asin(Math.sin(B)/r),x||(p=B)):(l=p,B=Math.asin(r*Math.sin(l))),this.lam0=d-Math.asin(.5*(i-1/i)*Math.tan(l))/this.B):(n=Math.pow(qu(this.e,g,Math.sin(g)),this.B),s=Math.pow(qu(this.e,m,Math.sin(m)),this.B),i=this.E/n,o=(s-n)/(s+n),h=((h=this.E*this.E)-s*n)/(h+s*n),(t=f-y)<-Math.pi?y-=Eu:t>Math.pi&&(y+=Eu),this.lam0=Xu(.5*(f+y)-Math.atan(h*Math.tan(.5*this.B*(f-y))/o)/this.B),l=Math.atan(2*Math.sin(this.B*Xu(f-this.lam0))/(i-1/i)),p=B=Math.asin(r*Math.sin(l))),this.singam=Math.sin(l),this.cosgam=Math.cos(l),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(B))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*l,this.v_pole_n=this.ArB*Math.log(Math.tan(Cu-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(Cu+i));},forward:function(t){var e,A,r,i,n,s,a,o,h={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-mu)>Bu){if(e=.5*((n=this.E/Math.pow(qu(this.e,t.y,Math.sin(t.y)),this.B))-(s=1/n)),A=.5*(n+s),i=Math.sin(this.B*t.x),r=(e*this.singam-i*this.cosgam)/A,Math.abs(Math.abs(r)-1)<Bu)throw new Error;o=.5*this.ArB*Math.log((1-r)/(1+r)),s=Math.cos(this.B*t.x),a=Math.abs(s)<nd?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,s);}else o=t.y>0?this.v_pole_n:this.v_pole_s,a=this.ArB*t.y;return this.no_rot?(h.x=a,h.y=o):(h.x=o*this.cosrot+(a-=this.u_0)*this.sinrot,h.y=a*this.cosrot-o*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(t){var e,A,r,i,n,s,a,o={};if(t.x=1/this.a*(t.x-this.x0),t.y=1/this.a*(t.y-this.y0),this.no_rot?(A=t.y,e=t.x):(A=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((r=Math.exp(-this.BrA*A))-1/r),n=.5*(r+1/r),a=((s=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/n,Math.abs(Math.abs(a)-1)<Bu)o.x=0,o.y=a<0?-mu:mu;else {if(o.y=this.E/Math.sqrt((1+a)/(1-a)),o.y=ju(this.e,Math.pow(o.y,1/this.B)),o.y===1/0)throw new Error;o.x=-this.rB*Math.atan2(i*this.cosgam-s*this.singam,Math.cos(this.BrA*e));}return o.x+=this.lam0,o},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},ad={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Bu)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),A=Math.cos(this.lat1),r=Ku(this.e,e,A),i=qu(this.e,this.lat1,e),n=Math.sin(this.lat2),s=Math.cos(this.lat2),a=Ku(this.e,n,s),o=qu(this.e,this.lat2,n),h=qu(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Bu?Math.log(r/a)/Math.log(i/o):e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic");}},forward:function(t){var e=t.x,A=t.y;Math.abs(2*Math.abs(A)-Math.PI)<=Bu&&(A=zu(A)*(mu-2e-10));var r,i,n=Math.abs(Math.abs(A)-mu);if(n>Bu)r=qu(this.e,A,Math.sin(A)),i=this.a*this.f0*Math.pow(r,this.ns);else {if((n=A*this.ns)<=0)return null;i=0;}var s=this.ns*Xu(e-this.long0);return t.x=this.k0*(i*Math.sin(s))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(s))+this.y0,t},inverse:function(t){var e,A,r,i,n,s=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+a*a),A=1):(e=-Math.sqrt(s*s+a*a),A=-1);var o=0;if(0!==e&&(o=Math.atan2(A*s,A*a)),0!==e||this.ns>0){if(A=1/this.ns,r=Math.pow(e/(this.a*this.f0),A),-9999===(i=ju(this.e,r)))return null}else i=-mu;return n=Xu(o/this.ns+this.long0),t.x=n,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},od={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq;},forward:function(t){var e,A,r,i,n,s,a,o=t.y,h=Xu(t.x-this.long0);return e=Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.alfa*this.e/2),A=2*(Math.atan(this.k*Math.pow(Math.tan(o/2+this.s45),this.alfa)/e)-this.s45),r=-h*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(A)+Math.sin(this.ad)*Math.cos(A)*Math.cos(r)),n=Math.asin(Math.cos(A)*Math.sin(r)/Math.cos(i)),s=this.n*n,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=a*Math.cos(s)/1,t.x=a*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,A,r,i,n,s,a,o=t.x;t.x=t.y,t.y=o,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),A=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(e)),t.x=this.long0-A/this.alfa,s=e,a=0;var h=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(a=1),s=t.y,h+=1;}while(0===a&&h<15);return h>=15?null:t},names:["Krovak","krovak"]};function hd(t,e,A,r,i){return t*i-e*Math.sin(2*i)+A*Math.sin(4*i)-r*Math.sin(6*i)}function ld(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function cd(t){return .375*t*(1+.25*t*(1+.46875*t))}function ud(t){return .05859375*t*t*(1+.75*t)}function pd(t){return t*t*t*(35/3072)}function dd(t,e,A){var r=e*A;return t/Math.sqrt(1-r*r)}function fd(t){return Math.abs(t)<mu?t:t-zu(t)*Math.PI}function yd(t,e,A,r,i){var n,s;n=t/e;for(var a=0;a<15;a++)if(n+=s=(t-(e*n-A*Math.sin(2*n)+r*Math.sin(4*n)-i*Math.sin(6*n)))/(e-2*A*Math.cos(2*n)+4*r*Math.cos(4*n)-6*i*Math.cos(6*n)),Math.abs(s)<=1e-10)return n;return NaN}var gd={init:function(){this.sphere||(this.e0=ld(this.es),this.e1=cd(this.es),this.e2=ud(this.es),this.e3=pd(this.es),this.ml0=this.a*hd(this.e0,this.e1,this.e2,this.e3,this.lat0));},forward:function(t){var e,A,r=t.x,i=t.y;if(r=Xu(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(r)),A=this.a*(Math.atan2(Math.tan(i),Math.cos(r))-this.lat0);else {var n=Math.sin(i),s=Math.cos(i),a=dd(this.a,this.e,n),o=Math.tan(i)*Math.tan(i),h=r*Math.cos(i),l=h*h,c=this.es*s*s/(1-this.es);e=a*h*(1-l*o*(1/6-(8-o+8*c)*l/120)),A=this.a*hd(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+a*n/s*l*(.5+(5-o+6*c)*l/24);}return t.x=e+this.x0,t.y=A+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,A,r=t.x/this.a,i=t.y/this.a;if(this.sphere){var n=i+this.lat0;e=Math.asin(Math.sin(n)*Math.cos(r)),A=Math.atan2(Math.tan(r),Math.cos(n));}else {var s=yd(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-mu)<=Bu)return t.x=this.long0,t.y=mu,i<0&&(t.y*=-1),t;var a=dd(this.a,this.e,Math.sin(s)),o=a*a*a/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(s),2),l=r*this.a/a,c=l*l;e=s-a*Math.tan(s)/o*l*l*(.5-(1+3*h)*l*l/24),A=l*(1-c*(h/3+(1+3*h)*h*c/15))/Math.cos(s);}return t.x=Xu(A+this.long0),t.y=fd(e),t},names:["Cassini","Cassini_Soldner","cass"]};function md(t,e){var A;return t>1e-7?(1-t*t)*(e/(1-(A=t*e)*A)-.5/t*Math.log((1-A)/(1+A))):2*e}var Bd={init:function(){var t,e=Math.abs(this.lat0);if(this.mode=Math.abs(e-mu)<Bu?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Bu?this.EQUIT:this.OBLIQ,this.es>0)switch(this.qp=md(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,A=[];return A[0]=.3333333333333333*t,A[0]+=.17222222222222222*(e=t*t),A[1]=.06388888888888888*e,A[0]+=.10257936507936508*(e*=t),A[1]+=.0664021164021164*e,A[2]=.016415012942191543*e,A}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=md(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0));},forward:function(t){var e,A,r,i,n,s,a,o,h,l,c=t.x,u=t.y;if(c=Xu(c-this.long0),this.sphere){if(n=Math.sin(u),l=Math.cos(u),r=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((A=this.mode===this.EQUIT?1+l*r:1+this.sinph0*n+this.cosph0*l*r)<=Bu)return null;e=(A=Math.sqrt(2/A))*l*Math.sin(c),A*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*l*r;}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(u+this.lat0)<Bu)return null;A=Cu-.5*u,e=(A=2*(this.mode===this.S_POLE?Math.cos(A):Math.sin(A)))*Math.sin(c),A*=r;}}else {switch(a=0,o=0,h=0,r=Math.cos(c),i=Math.sin(c),n=Math.sin(u),s=md(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=s/this.qp,o=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:h=1+this.sinb1*a+this.cosb1*o*r;break;case this.EQUIT:h=1+o*r;break;case this.N_POLE:h=mu+u,s=this.qp-s;break;case this.S_POLE:h=u-mu,s=this.qp+s;}if(Math.abs(h)<Bu)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),A=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*a-this.sinb1*o*r):(h=Math.sqrt(2/(1+o*r)))*a*this.ymf,e=this.xmf*h*o*i;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(h=Math.sqrt(s))*i,A=r*(this.mode===this.S_POLE?h:-h)):e=A=0;}}return t.x=this.a*e+this.x0,t.y=this.a*A+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,A,r,i,n,s,a,o,h,l,c=t.x/this.a,u=t.y/this.a;if(this.sphere){var p,d=0,f=0;if((A=.5*(p=Math.sqrt(c*c+u*u)))>1)return null;switch(A=2*Math.asin(A),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(f=Math.sin(A),d=Math.cos(A)),this.mode){case this.EQUIT:A=Math.abs(p)<=Bu?0:Math.asin(u*f/p),c*=f,u=d*p;break;case this.OBLIQ:A=Math.abs(p)<=Bu?this.lat0:Math.asin(d*this.sinph0+u*f*this.cosph0/p),c*=f*this.cosph0,u=(d-Math.sin(A)*this.sinph0)*p;break;case this.N_POLE:u=-u,A=mu-A;break;case this.S_POLE:A-=mu;}e=0!==u||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,u):0;}else {if(a=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,u*=this.dd,(s=Math.sqrt(c*c+u*u))<Bu)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*s/this.rq),r=Math.cos(i),c*=i=Math.sin(i),this.mode===this.OBLIQ?(n=this.qp*(a=r*this.sinb1+u*i*this.cosb1/s),u=s*this.cosb1*r-u*this.sinb1*i):(n=this.qp*(a=u*i/s),u=s*r);}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),!(n=c*c+u*u))return t.x=this.long0,t.y=this.lat0,t;a=1-n/this.qp,this.mode===this.S_POLE&&(a=-a);}e=Math.atan2(c,u),l=(o=Math.asin(a))+o,A=o+(h=this.apa)[0]*Math.sin(l)+h[1]*Math.sin(l+l)+h[2]*Math.sin(l+l+l);}return t.x=Xu(this.long0+e),t.y=A,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function wd(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var xd={init:function(){Math.abs(this.lat1+this.lat2)<Bu||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ku(this.e3,this.sin_po,this.cos_po),this.qs1=md(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ku(this.e3,this.sin_po,this.cos_po),this.qs2=md(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=md(this.e3,this.sin_po),this.ns0=Math.abs(this.lat1-this.lat2)>Bu?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0);},forward:function(t){var e=t.x,A=t.y;this.sin_phi=Math.sin(A),this.cos_phi=Math.cos(A);var r=md(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,n=this.ns0*Xu(e-this.long0),s=i*Math.sin(n)+this.x0,a=this.rh-i*Math.cos(n)+this.y0;return t.x=s,t.y=a,t},inverse:function(t){var e,A,r,i,n;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),A=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),A=-1),r=0,0!==e&&(r=Math.atan2(A*t.x,A*t.y)),A=e*this.ns0/this.a,n=this.sphere?Math.asin((this.c-A*A)/(2*this.ns0)):this.phi1z(this.e3,(this.c-A*A)/this.ns0),i=Xu(r/this.ns0+this.long0),t.x=i,t.y=n,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var A,r,i,n,s=wd(.5*e);if(t<Bu)return s;for(var a=t*t,o=1;o<=25;o++)if(s+=n=.5*(i=1-(r=t*(A=Math.sin(s)))*r)*i/Math.cos(s)*(e/(1-a)-A/i+.5/t*Math.log((1-r)/(1+r))),Math.abs(n)<=1e-7)return s;return null}},Cd={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1;},forward:function(t){var e,A,r,i,n,s,a,o=t.y;return r=Xu(t.x-this.long0),e=Math.sin(o),A=Math.cos(o),i=Math.cos(r),(n=this.sin_p14*e+this.cos_p14*A*i)>0||Math.abs(n)<=Bu?(s=this.x0+1*this.a*A*Math.sin(r)/n,a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*A*i)/n):(s=this.x0+this.infinity_dist*A*Math.sin(r),a=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*A*i)),t.x=s,t.y=a,t},inverse:function(t){var e,A,r,i,n,s;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),A=Math.sin(i),s=wd((r=Math.cos(i))*this.sin_p14+t.y*A*this.cos_p14/e),n=Math.atan2(t.x*A,e*this.cos_p14*r-t.y*this.sin_p14*A),n=Xu(this.long0+n)):(s=this.phic0,n=0),t.x=n,t.y=s,t},names:["gnom"]},Ed={init:function(){this.sphere||(this.k0=Ku(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)));},forward:function(t){var e,A,r=t.y,i=Xu(t.x-this.long0);if(this.sphere)e=this.x0+this.a*i*Math.cos(this.lat_ts),A=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else {var n=md(this.e,Math.sin(r));e=this.x0+this.a*this.k0*i,A=this.y0+this.a*n*.5/this.k0;}return t.x=e,t.y=A,t},inverse:function(t){var e,A;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=Xu(this.long0+t.x/this.a/Math.cos(this.lat_ts)),A=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(A=function(t,e){var A=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-A)<1e-6)return e<0?-1*mu:mu;for(var r,i,n,s,a=Math.asin(.5*e),o=0;o<30;o++)if(i=Math.sin(a),n=Math.cos(a),s=t*i,a+=r=Math.pow(1-s*s,2)/(2*n)*(e/(1-t*t)-i/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),Math.abs(r)<=1e-10)return a;return NaN}(this.e,2*t.y*this.k0/this.a),e=Xu(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=A,t},names:["cea"]},_d={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts);},forward:function(t){var e=t.y,A=Xu(t.x-this.long0),r=fd(e-this.lat0);return t.x=this.x0+this.a*A*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.y;return t.x=Xu(this.long0+(t.x-this.x0)/(this.a*this.rc)),t.y=fd(this.lat0+(e-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},vd={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ld(this.es),this.e1=cd(this.es),this.e2=ud(this.es),this.e3=pd(this.es),this.ml0=this.a*hd(this.e0,this.e1,this.e2,this.e3,this.lat0);},forward:function(t){var e,A,r,i=t.y,n=Xu(t.x-this.long0);if(r=n*Math.sin(i),this.sphere)Math.abs(i)<=Bu?(e=this.a*n,A=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(i),A=this.a*(fd(i-this.lat0)+(1-Math.cos(r))/Math.tan(i)));else if(Math.abs(i)<=Bu)e=this.a*n,A=-1*this.ml0;else {var s=dd(this.a,this.e,Math.sin(i))/Math.tan(i);e=s*Math.sin(r),A=this.a*hd(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*(1-Math.cos(r));}return t.x=e+this.x0,t.y=A+this.y0,t},inverse:function(t){var e,A,r,i,n,s,a,o,h;if(r=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=Bu)e=Xu(r/this.a+this.long0),A=0;else {var l;for(a=r*r/this.a/this.a+(s=this.lat0+i/this.a)*s,o=s,n=20;n;--n)if(o+=h=-1*(s*(o*(l=Math.tan(o))+1)-o-.5*(o*o+a)*l)/((o-s)/l-1),Math.abs(h)<=Bu){A=o;break}e=Xu(this.long0+Math.asin(r*Math.tan(o)/this.a)/Math.sin(A));}else if(Math.abs(i+this.ml0)<=Bu)A=0,e=Xu(this.long0+r/this.a);else {var c,u,p,d,f;for(a=r*r/this.a/this.a+(s=(this.ml0+i)/this.a)*s,o=s,n=20;n;--n)if(f=this.e*Math.sin(o),c=Math.sqrt(1-f*f)*Math.tan(o),u=this.a*hd(this.e0,this.e1,this.e2,this.e3,o),p=this.e0-2*this.e1*Math.cos(2*o)+4*this.e2*Math.cos(4*o)-6*this.e3*Math.cos(6*o),o-=h=(s*(c*(d=u/this.a)+1)-d-.5*c*(d*d+a))/(this.es*Math.sin(2*o)*(d*d+a-2*s*d)/(4*c)+(s-d)*(c*p-2/Math.sin(2*o))-p),Math.abs(h)<=Bu){A=o;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(A),2))*Math.tan(A),e=Xu(this.long0+Math.asin(r*c/this.a)/Math.sin(A));}return t.x=e,t.y=A,t},names:["Polyconic","poly"]},bd={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013;},forward:function(t){var e,A=(t.y-this.lat0)/gu*1e-5,r=t.x-this.long0,i=1,n=0;for(e=1;e<=10;e++)n+=this.A[e]*(i*=A);var s,a=n,o=r,h=1,l=0,c=0,u=0;for(e=1;e<=6;e++)s=l*a+h*o,c=c+this.B_re[e]*(h=h*a-l*o)-this.B_im[e]*(l=s),u=u+this.B_im[e]*h+this.B_re[e]*l;return t.x=u*this.a+this.x0,t.y=c*this.a+this.y0,t},inverse:function(t){var e,A,r=(t.y-this.y0)/this.a,i=(t.x-this.x0)/this.a,n=1,s=0,a=0,o=0;for(e=1;e<=6;e++)A=s*r+n*i,a=a+this.C_re[e]*(n=n*r-s*i)-this.C_im[e]*(s=A),o=o+this.C_im[e]*n+this.C_re[e]*s;for(var h=0;h<this.iterations;h++){var l,c=a,u=o,p=r,d=i;for(e=2;e<=6;e++)l=u*a+c*o,p+=(e-1)*(this.B_re[e]*(c=c*a-u*o)-this.B_im[e]*(u=l)),d+=(e-1)*(this.B_im[e]*c+this.B_re[e]*u);c=1,u=0;var f=this.B_re[1],y=this.B_im[1];for(e=2;e<=6;e++)l=u*a+c*o,f+=e*(this.B_re[e]*(c=c*a-u*o)-this.B_im[e]*(u=l)),y+=e*(this.B_im[e]*c+this.B_re[e]*u);var g=f*f+y*y;a=(p*f+d*y)/g,o=(d*f-p*y)/g;}var m=a,B=o,w=1,x=0;for(e=1;e<=9;e++)x+=this.D[e]*(w*=m);var C=this.lat0+x*gu*1e5;return t.x=this.long0+B,t.y=C,t},names:["New_Zealand_Map_Grid","nzmg"]},Ud={init:function(){},forward:function(t){var e=t.y,A=Xu(t.x-this.long0),r=this.x0+this.a*A,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return t.x=r,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=Xu(this.long0+t.x/this.a),A=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=A,t},names:["Miller_Cylindrical","mill"]},Fd={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Kp(this.es);},forward:function(t){var e,A,r=t.x,i=t.y;if(r=Xu(r-this.long0),this.sphere){if(this.m)for(var n=this.n*Math.sin(i),s=20;s;--s){var a=(this.m*i+Math.sin(i)-n)/(this.m+Math.cos(i));if(i-=a,Math.abs(a)<Bu)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*r*(this.m+Math.cos(i)),A=this.a*this.C_y*i;}else {var o=Math.sin(i),h=Math.cos(i);A=this.a*zp(i,o,h,this.en),e=this.a*r*h/Math.sqrt(1-this.es*o*o);}return t.x=e,t.y=A,t},inverse:function(t){var e,A,r;return t.x-=this.x0,A=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,A/=this.C_x*(this.m+Math.cos(e)),this.m?e=wd((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=wd(Math.sin(e)/this.n)),A=Xu(A+this.long0),e=fd(e)):(e=Xp(t.y/this.a,this.es,this.en),(r=Math.abs(e))<mu?(r=Math.sin(e),A=Xu(this.long0+t.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)))):r-Bu<mu&&(A=this.long0)),t.x=A,t.y=e,t},names:["Sinusoidal","sinu"]},Md={init:function(){},forward:function(t){for(var e=t.y,A=Xu(t.x-this.long0),r=e,i=Math.PI*Math.sin(e);;){var n=-(r+Math.sin(r)-i)/(1+Math.cos(r));if(r+=n,Math.abs(n)<Bu)break}r/=2,Math.PI/2-Math.abs(e)<Bu&&(A=0);var s=.900316316158*this.a*A*Math.cos(r)+this.x0,a=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=s,t.y=a,t},inverse:function(t){var e,A;t.x-=this.x0,t.y-=this.y0,A=t.y/(1.4142135623731*this.a),Math.abs(A)>.999999999999&&(A=.999999999999),e=Math.asin(A);var r=Xu(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),A=(2*e+Math.sin(2*e))/Math.PI,Math.abs(A)>1&&(A=1);var i=Math.asin(A);return t.x=r,t.y=i,t},names:["Mollweide","moll"]},Qd={init:function(){Math.abs(this.lat1+this.lat2)<Bu||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ld(this.es),this.e1=cd(this.es),this.e2=ud(this.es),this.e3=pd(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ku(this.e,this.sinphi,this.cosphi),this.ml1=hd(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Bu?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ku(this.e,this.sinphi,this.cosphi),this.ml2=hd(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=hd(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0));},forward:function(t){var e,A=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else {var i=hd(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-i);}var n=this.ns*Xu(A-this.long0),s=this.x0+e*Math.sin(n),a=this.y0+this.rh-e*Math.cos(n);return t.x=s,t.y=a,t},inverse:function(t){var e,A,r,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(A=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(A=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var n=0;return 0!==A&&(n=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=Xu(this.long0+n/this.ns),r=fd(this.g-A/this.a),t.x=i,t.y=r,t):(r=yd(this.g-A/this.a,this.e0,this.e1,this.e2,this.e3),i=Xu(this.long0+n/this.ns),t.x=i,t.y=r,t)},names:["Equidistant_Conic","eqdc"]},Id={init:function(){this.R=this.a;},forward:function(t){var e,A,r=t.y,i=Xu(t.x-this.long0);Math.abs(r)<=Bu&&(e=this.x0+this.R*i,A=this.y0);var n=wd(2*Math.abs(r/Math.PI));(Math.abs(i)<=Bu||Math.abs(Math.abs(r)-mu)<=Bu)&&(e=this.x0,A=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var s=.5*Math.abs(Math.PI/i-i/Math.PI),a=s*s,o=Math.sin(n),h=Math.cos(n),l=h/(o+h-1),c=l*(2/o-1),u=c*c,p=Math.PI*this.R*(s*(l-u)+Math.sqrt(a*(l-u)*(l-u)-(u+a)*(l*l-u)))/(u+a);i<0&&(p=-p),e=this.x0+p;var d=a+l;return p=Math.PI*this.R*(c*d-s*Math.sqrt((u+a)*(a+1)-d*d))/(u+a),A=r>=0?this.y0+p:this.y0-p,t.x=e,t.y=A,t},inverse:function(t){var e,A,r,i,n,s,a,o,h,l,c,u;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,n=(r=t.x/c)*r+(i=t.y/c)*i,c=3*(i*i/(o=-2*(s=-Math.abs(i)*(1+n))+1+2*i*i+n*n)+(2*(a=s-2*i*i+r*r)*a*a/o/o/o-9*s*a/o/o)/27)/(h=(s-a*a/3/o)/o)/(l=2*Math.sqrt(-h/3)),Math.abs(c)>1&&(c=c>=0?1:-1),u=Math.acos(c)/3,A=t.y>=0?(-l*Math.cos(u+Math.PI/3)-a/3/o)*Math.PI:-(-l*Math.cos(u+Math.PI/3)-a/3/o)*Math.PI,e=Math.abs(r)<Bu?this.long0:Xu(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(r*r-i*i)+n*n))/2/r),t.x=e,t.y=A,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Sd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0);},forward:function(t){var e,A,r,i,n,s,a,o,h,l,c,u,p,d,f,y,g,m,B,w,x,C,E=t.x,_=t.y,v=Math.sin(t.y),b=Math.cos(t.y),U=Xu(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Bu?(t.x=this.x0+this.a*(mu-_)*Math.sin(U),t.y=this.y0-this.a*(mu-_)*Math.cos(U),t):Math.abs(this.sin_p12+1)<=Bu?(t.x=this.x0+this.a*(mu+_)*Math.sin(U),t.y=this.y0+this.a*(mu+_)*Math.cos(U),t):(m=this.sin_p12*v+this.cos_p12*b*Math.cos(U),g=(y=Math.acos(m))?y/Math.sin(y):1,t.x=this.x0+this.a*g*b*Math.sin(U),t.y=this.y0+this.a*g*(this.cos_p12*v-this.sin_p12*b*Math.cos(U)),t):(e=ld(this.es),A=cd(this.es),r=ud(this.es),i=pd(this.es),Math.abs(this.sin_p12-1)<=Bu?(n=this.a*hd(e,A,r,i,mu),s=this.a*hd(e,A,r,i,_),t.x=this.x0+(n-s)*Math.sin(U),t.y=this.y0-(n-s)*Math.cos(U),t):Math.abs(this.sin_p12+1)<=Bu?(n=this.a*hd(e,A,r,i,mu),s=this.a*hd(e,A,r,i,_),t.x=this.x0+(n+s)*Math.sin(U),t.y=this.y0+(n+s)*Math.cos(U),t):(a=v/b,o=dd(this.a,this.e,this.sin_p12),h=dd(this.a,this.e,v),l=Math.atan((1-this.es)*a+this.es*o*this.sin_p12/(h*b)),B=0===(c=Math.atan2(Math.sin(U),this.cos_p12*Math.tan(l)-this.sin_p12*Math.cos(U)))?Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.abs(Math.abs(c)-Math.PI)<=Bu?-Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.asin(Math.sin(U)*Math.cos(l)/Math.sin(c)),u=this.e*this.sin_p12/Math.sqrt(1-this.es),p=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es),t.x=this.x0+(y=o*B*(1-(w=B*B)*(f=p*p)*(1-f)/6+(x=w*B)/8*(d=u*p)*(1-2*f)+(C=x*B)/120*(f*(4-7*f)-3*u*u*(1-7*f))-C*B/48*d))*Math.sin(c),t.y=this.y0+y*Math.cos(c),t))},inverse:function(t){var e,A,r,i,n,s,a,o,h,l,c,u,p,d,f,y,g,m,B,w,x,C,E;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*mu*this.a)return;return A=e/this.a,r=Math.sin(A),i=Math.cos(A),n=this.long0,Math.abs(e)<=Bu?s=this.lat0:(s=wd(i*this.sin_p12+t.y*r*this.cos_p12/e),a=Math.abs(this.lat0)-mu,n=Math.abs(a)<=Bu?Xu(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)):Xu(this.long0+Math.atan2(t.x*r,e*this.cos_p12*i-t.y*this.sin_p12*r))),t.x=n,t.y=s,t}return o=ld(this.es),h=cd(this.es),l=ud(this.es),c=pd(this.es),Math.abs(this.sin_p12-1)<=Bu?(s=yd(((u=this.a*hd(o,h,l,c,mu))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,o,h,l,c),n=Xu(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=s,t):Math.abs(this.sin_p12+1)<=Bu?(u=this.a*hd(o,h,l,c,mu),s=yd(((e=Math.sqrt(t.x*t.x+t.y*t.y))-u)/this.a,o,h,l,c),n=Xu(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=s,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),f=Math.atan2(t.x,t.y),p=dd(this.a,this.e,this.sin_p12),y=Math.cos(f),B=3*this.es*(1-(m=-(g=this.e*this.cos_p12*y)*g/(1-this.es)))*this.sin_p12*this.cos_p12*y/(1-this.es),C=1-m*(x=(w=e/p)-m*(1+m)*Math.pow(w,3)/6-B*(1+3*m)*Math.pow(w,4)/24)*x/2-w*x*x*x/6,d=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*y),n=Xu(this.long0+Math.asin(Math.sin(f)*Math.sin(x)/Math.cos(d))),E=Math.sin(d),s=Math.atan2((E-this.es*C*this.sin_p12)*Math.tan(d),E*(1-this.es)),t.x=n,t.y=s,t)},names:["Azimuthal_Equidistant","aeqd"]},Td={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0);},forward:function(t){var e,A,r,i,n,s,a,o=t.y;return r=Xu(t.x-this.long0),e=Math.sin(o),A=Math.cos(o),i=Math.cos(r),((n=this.sin_p14*e+this.cos_p14*A*i)>0||Math.abs(n)<=Bu)&&(s=1*this.a*A*Math.sin(r),a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*A*i)),t.x=s,t.y=a,t},inverse:function(t){var e,A,r,i,n,s,a;return t.x-=this.x0,t.y-=this.y0,A=wd((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),r=Math.sin(A),i=Math.cos(A),s=this.long0,Math.abs(e)<=Bu?(a=this.lat0,t.x=s,t.y=a,t):(a=wd(i*this.sin_p14+t.y*r*this.cos_p14/e),n=Math.abs(this.lat0)-mu,Math.abs(n)<=Bu?(s=Xu(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=s,t.y=a,t):(s=Xu(this.long0+Math.atan2(t.x*r,e*this.cos_p14*i-t.y*this.sin_p14*r)),t.x=s,t.y=a,t))},names:["ortho"]};function Rd(t,e,A,r){var i;return t<Bu?(r.value=1,i=0):(i=Math.atan2(e,A),Math.abs(i)<=Cu?r.value=1:i>Cu&&i<=mu+Cu?(r.value=2,i-=mu):i>mu+Cu||i<=-(mu+Cu)?(r.value=3,i=i>=0?i-_u:i+_u):(r.value=4,i+=mu)),i}function Ld(t,e){var A=t+e;return A<-_u?A+=Eu:A>+_u&&(A-=Eu),A}var Pd={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.face=this.lat0>=mu-Cu/2?5:this.lat0<=-(mu-Cu/2)?6:Math.abs(this.long0)<=Cu?1:Math.abs(this.long0)<=mu+Cu?this.long0>0?2:4:3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f);},forward:function(t){var e,A,r,i,n,s,a={x:0,y:0},o={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,A=t.x,5===this.face)i=mu-e,A>=Cu&&A<=mu+Cu?(o.value=1,r=A-mu):A>mu+Cu||A<=-(mu+Cu)?(o.value=2,r=A>0?A-_u:A+_u):A>-(mu+Cu)&&A<=-Cu?(o.value=3,r=A+mu):(o.value=4,r=A);else if(6===this.face)i=mu+e,A>=Cu&&A<=mu+Cu?(o.value=1,r=-A+mu):A<Cu&&A>=-Cu?(o.value=2,r=-A):A<-Cu&&A>=-(mu+Cu)?(o.value=3,r=-A-mu):(o.value=4,r=A>0?-A+_u:-A-_u);else {var h,l,c,u,p,d;2===this.face?A=Ld(A,+mu):3===this.face?A=Ld(A,+_u):4===this.face&&(A=Ld(A,-mu)),u=Math.sin(e),p=Math.cos(e),d=Math.sin(A),h=p*Math.cos(A),l=p*d,c=u,1===this.face?r=Rd(i=Math.acos(h),c,l,o):2===this.face?r=Rd(i=Math.acos(l),c,-h,o):3===this.face?r=Rd(i=Math.acos(-h),c,-l,o):4===this.face?r=Rd(i=Math.acos(-l),c,h,o):(i=r=0,o.value=1);}return s=Math.atan(12/_u*(r+Math.acos(Math.sin(r)*Math.cos(Cu))-mu)),n=Math.sqrt((1-Math.cos(i))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(r))))),2===o.value?s+=mu:3===o.value?s+=_u:4===o.value&&(s+=1.5*_u),a.x=n*Math.cos(s),a.y=n*Math.sin(s),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,t.x=a.x,t.y=a.y,t},inverse:function(t){var e,A,r,i,n,s,a,o,h,l,c,u,p={lam:0,phi:0},d={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,A=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?d.value=1:t.y>=0&&t.y>=Math.abs(t.x)?(d.value=2,e-=mu):t.x<0&&-t.x>=Math.abs(t.y)?(d.value=3,e=e<0?e+_u:e-_u):(d.value=4,e+=mu),h=_u/12*Math.tan(e),n=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),s=Math.atan(n),(a=1-(r=Math.cos(e))*r*(i=Math.tan(A))*i*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?a=-1:a>1&&(a=1),5===this.face)o=Math.acos(a),p.phi=mu-o,p.lam=1===d.value?s+mu:2===d.value?s<0?s+_u:s-_u:3===d.value?s-mu:s;else if(6===this.face)o=Math.acos(a),p.phi=o-mu,p.lam=1===d.value?-s+mu:2===d.value?-s:3===d.value?-s-mu:s<0?-s-_u:-s+_u;else {var f,y,g;h=(f=a)*f,y=(h+=(g=h>=1?0:Math.sqrt(1-h)*Math.sin(s))*g)>=1?0:Math.sqrt(1-h),2===d.value?(h=y,y=-g,g=h):3===d.value?(y=-y,g=-g):4===d.value&&(h=y,y=g,g=-h),2===this.face?(h=f,f=-y,y=h):3===this.face?(f=-f,y=-y):4===this.face&&(h=f,f=y,y=-h),p.phi=Math.acos(-g)-mu,p.lam=Math.atan2(y,f),2===this.face?p.lam=Ld(p.lam,-mu):3===this.face?p.lam=Ld(p.lam,-_u):4===this.face&&(p.lam=Ld(p.lam,+mu));}return 0!==this.es&&(l=p.phi<0?1:0,c=Math.tan(p.phi),u=this.b/Math.sqrt(c*c+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-u*u)/(this.one_minus_f*u)),l&&(p.phi=-p.phi)),p.lam+=this.long0,t.x=p.lam,t.y=p.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Hd=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Od=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Dd=.8487,Nd=1.3523,kd=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Vd={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson";},forward:function(t){var e=Xu(t.x-this.long0),A=Math.abs(t.y),r=Math.floor(11.459155902616464*A);r<0?r=0:r>=18&&(r=17);var i={x:kd(Hd[r],A=xu*(A-.08726646259971647*r))*e,y:kd(Od[r],A)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*Dd+this.x0,i.y=i.y*this.a*Nd+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Dd),y:Math.abs(t.y-this.y0)/(this.a*Nd)};if(e.y>=1)e.x/=Hd[18][0],e.y=t.y<0?-mu:mu;else {var A=Math.floor(18*e.y);for(A<0?A=0:A>=18&&(A=17);;)if(Od[A][0]>e.y)--A;else {if(!(Od[A+1][0]<=e.y))break;++A;}var r=Od[A],i=5*(e.y-r[0])/(Od[A+1][0]-r[0]);i=function(t,e,A,r){for(var i=e;r;--r){var n=t(i);if(i-=n,Math.abs(n)<1e-10)break}return i}((function(t){return (kd(r,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(r,t)}),i,0,100),e.x/=kd(Hd[A],i),e.y=(5*A+i)*wu,t.y<0&&(e.y=-e.y);}return e.x=Xu(e.x+this.long0),e},names:["Robinson","robin"]},Gd={init:function(){this.name="geocent";},forward:function(t){return up(t,this.es,this.a)},inverse:function(t){return pp(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Kd={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},zd={init:function(){if(Object.keys(Kd).forEach(function(t){if(void 0===this[t])this[t]=Kd[t].def;else {if(Kd[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Kd[t].num&&(this[t]=parseFloat(this[t]));}Kd[t].degrees&&(this[t]=this[t]*wu);}.bind(this)),Math.abs(Math.abs(this.lat0)-mu)<Bu?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<Bu?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t);},forward:function(t){t.x-=this.long0;var e,A,r,i,n=Math.sin(t.y),s=Math.cos(t.y),a=Math.cos(t.x);switch(this.mode){case 3:A=this.sinph0*n+this.cosph0*s*a;break;case 2:A=s*a;break;case 1:A=-n;break;case 0:A=n;}switch(e=(A=this.pn1/(this.p-A))*s*Math.sin(t.x),this.mode){case 3:A*=this.cosph0*n-this.sinph0*s*a;break;case 2:A*=n;break;case 0:A*=-s*a;break;case 1:A*=s*a;}return e=(e*this.cg-A*this.sg)*this.cw*(i=1/((r=A*this.cg+e*this.sg)*this.sw*this.h1+this.cw)),A=r*i,t.x=e*this.a,t.y=A*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,A,r,i={x:t.x,y:t.y};t.x=(e=this.pn1*t.x*(r=1/(this.pn1-t.y*this.sw)))*this.cg+(A=this.pn1*t.y*this.cw*r)*this.sg,t.y=A*this.cg-e*this.sg;var n=Yp(t.x,t.y);if(Math.abs(n)<Bu)i.x=0,i.y=t.y;else {var s,a;switch(a=1-n*n*this.pfact,a=(this.p-Math.sqrt(a))/(this.pn1/n+n/this.pn1),s=Math.sqrt(1-a*a),this.mode){case 3:i.y=Math.asin(s*this.sinph0+t.y*a*this.cosph0/n),t.y=(s-this.sinph0*Math.sin(i.y))*n,t.x*=a*this.cosph0;break;case 2:i.y=Math.asin(t.y*a/n),t.y=s*n,t.x*=a;break;case 0:i.y=Math.asin(s),t.y=-t.y;break;case 1:i.y=-Math.asin(s);}i.x=Math.atan2(t.x,t.y);}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]},Xd={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse";}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View");},forward:function(t){var e,A,r,i,n=t.x,s=t.y;if(n-=this.long0,"ellipse"===this.shape){s=Math.atan(this.radius_p2*Math.tan(s));var a=this.radius_p/Yp(this.radius_p*Math.cos(s),Math.sin(s));if(A=a*Math.cos(n)*Math.cos(s),r=a*Math.sin(n)*Math.cos(s),i=a*Math.sin(s),(this.radius_g-A)*A-r*r-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-A,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/Yp(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(r/e),t.y=this.radius_g_1*Math.atan(i/Yp(r,e)));}else "sphere"===this.shape&&(e=Math.cos(s),A=Math.cos(n)*e,r=Math.sin(n)*e,i=Math.sin(s),e=this.radius_g-A,this.flip_axis?(t.x=this.radius_g_1*Math.atan(r/Yp(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(r/e),t.y=this.radius_g_1*Math.atan(i/Yp(r,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,A,r,i,n=-1,s=0,a=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),s=Math.tan(t.x/this.radius_g_1)*Yp(1,a)):(s=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Yp(1,s));var o=a/this.radius_p;if((r=(A=2*this.radius_g*n)*A-4*(e=s*s+o*o+n*n)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-A-Math.sqrt(r))/(2*e),n=this.radius_g+i*n,s*=i,a*=i,t.x=Math.atan2(s,n),t.y=Math.atan(a*Math.cos(t.x)/n),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y));}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(t.y/this.radius_g_1),s=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+a*a)):(s=Math.tan(t.x/this.radius_g_1),a=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+s*s)),(r=(A=2*this.radius_g*n)*A-4*(e=s*s+a*a+n*n)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-A-Math.sqrt(r))/(2*e),n=this.radius_g+i*n,s*=i,a*=i,t.x=Math.atan2(s,n),t.y=Math.atan(a*Math.cos(t.x)/n);}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};vp.defaultDatum="WGS84",vp.Proj=cp,vp.WGS84=new vp.Proj("WGS84"),vp.Point=Np,vp.toPoint=Bp,vp.defs=Nu,vp.nadgrid=function(t,e){var A=new DataView(e),r=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(A),i=function(t,e){return {nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:ap(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(A,r);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var n=function(t,e,A){for(var r=[],i=0;i<e.nSubgrids;i++){var n=hp(t,176,A),s=lp(t,176,n,A),a=Math.round(1+(n.upperLongitude-n.lowerLongitude)/n.longitudeInterval),o=Math.round(1+(n.upperLatitude-n.lowerLatitude)/n.latitudeInterval);r.push({ll:[sp(n.lowerLongitude),sp(n.lowerLatitude)],del:[sp(n.longitudeInterval),sp(n.latitudeInterval)],lim:[a,o],count:n.gridNodeCount,cvs:op(s)});}return r}(A,i,r),s={header:i,subgrids:n};return ip[t]=s,s},vp.transform=xp,vp.mgrs=Ip,vp.version="__VERSION__",function(t){t.Proj.projections.add(qp),t.Proj.projections.add(Jp),t.Proj.projections.add($p),t.Proj.projections.add(Ad),t.Proj.projections.add(rd),t.Proj.projections.add(id),t.Proj.projections.add(sd),t.Proj.projections.add(ad),t.Proj.projections.add(od),t.Proj.projections.add(gd),t.Proj.projections.add(Bd),t.Proj.projections.add(xd),t.Proj.projections.add(Cd),t.Proj.projections.add(Ed),t.Proj.projections.add(_d),t.Proj.projections.add(vd),t.Proj.projections.add(bd),t.Proj.projections.add(Ud),t.Proj.projections.add(Fd),t.Proj.projections.add(Md),t.Proj.projections.add(Qd),t.Proj.projections.add(Id),t.Proj.projections.add(Sd),t.Proj.projections.add(Td),t.Proj.projections.add(Pd),t.Proj.projections.add(Vd),t.Proj.projections.add(Gd),t.Proj.projections.add(zd),t.Proj.projections.add(Xd);}(vp);var qd=Object.freeze({__proto__:null,Proj4Projection:class{static defineProjectionAliases(t){const e=[];for(const A in t)e.push([A,t[A]]);vp.defs(e);}constructor({from:t="WGS84",to:e="WGS84"}){const A=vp(t,e);if(!A)throw new Error("Invalid projection");this.project=A.forward,this.unproject=A.inverse;}}});const jd=Math.PI/180,Yd=23.4397*jd;function Wd(t,e,A){const r=jd*-A,i=jd*e,n=function(t){return function(t){return t/864e5-.5+2440588}(t)-2451545}(t),s=function(t){const e=function(t){const e=t;return e+jd*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e))+102.9372*jd+Math.PI}(jd*(357.5291+.98560028*t));return {declination:Jd(e,0),rightAscension:Zd(e,0)}}(n),a=function(t,e){return jd*(280.147+360.9856235*t)-e}(n,r)-s.rightAscension;return {azimuth:$d(a,i,s.declination),altitude:tf(a,i,s.declination)}}function Zd(t,e){const A=t;return Math.atan2(Math.sin(A)*Math.cos(Yd)-Math.tan(e)*Math.sin(Yd),Math.cos(A))}function Jd(t,e){const A=t;return Math.asin(Math.sin(e)*Math.cos(Yd)+Math.cos(e)*Math.sin(Yd)*Math.sin(A))}function $d(t,e,A){const r=t,i=e,n=A;return Math.atan2(Math.sin(r),Math.cos(r)*Math.sin(i)-Math.tan(n)*Math.cos(i))}function tf(t,e,A){const r=t,i=e,n=A;return Math.asin(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(r))}var ef=Object.freeze({__proto__:null,getSunPosition:Wd,getSunDirection:function(t,e,A){const{azimuth:r,altitude:i}=Wd(t,e,A),n=r+Math.PI;return [-Math.sin(n),Math.cos(n),-Math.sin(i)]}});function Af(t,e){const A=Ro([],e,t);return To(A,A,1/A[3]),A}function rf(t,e){const A=t%e;return A<0?e+A:A}const nf=Math.log2||function(t){return Math.log(t)*Math.LOG2E},sf=Math.PI,af=sf/4,of=sf/180,hf=180/sf,lf=512;function cf(t){return Math.pow(2,t)}function uf(t){return nf(t)}function pf([t,e]){return [lf*(t*of+sf)/(2*sf),lf*(sf+Math.log(Math.tan(af+e*of*.5)))/(2*sf)]}function df([t,e]){const A=t/lf*(2*sf)-sf,r=2*(Math.atan(Math.exp(e/lf*(2*sf)-sf))-af);return [A*hf,r*hf]}function ff({latitude:t,highPrecision:e=!1}){const A={},r=Math.cos(t*of),i=512/360,n=i/r,s=12790407194604047e-21/r;if(A.unitsPerMeter=[s,s,s],A.metersPerUnit=[1/s,1/s,1/s],A.unitsPerDegree=[i,n,s],A.degreesPerUnit=[.703125,1/n,1/s],e){const e=of*Math.tan(t*of)/r,a=12790407194604047e-21*e,o=a/n*s;A.unitsPerDegree2=[0,i*e/2,a],A.unitsPerMeter2=[o,0,o];}return A}function yf({height:t,pitch:e,bearing:A,altitude:r,scale:i,center:n=null}){const s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return lo(s,s,[0,0,-r]),po(s,s,-e*of),yo(s,s,A*of),co(s,s,[i/=t,i,i]),n&&lo(s,s,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],n)),s}function gf({width:t,height:e,fovy:A=Bf(1.5),altitude:r,pitch:i=0,nearZMultiplier:n=1,farZMultiplier:s=1}){void 0!==r&&(A=Bf(r));const a=.5*A*of,o=wf(A),h=i*of,l=Math.sin(a)*o/Math.sin(Math.min(Math.max(Math.PI/2-h-a,.01),Math.PI-.01));return {fov:2*a,aspect:t/e,focalDistance:o,near:n,far:(Math.sin(h)*l+o)*s}}function mf({width:t,height:e,pitch:A,altitude:r,fovy:i,nearZMultiplier:n,farZMultiplier:s}){const{fov:a,aspect:o,near:h,far:l}=gf({width:t,height:e,altitude:r,fovy:i,pitch:A,nearZMultiplier:n,farZMultiplier:s});return go([],a,o,h,l)}function Bf(t){return 2*Math.atan(.5/t)*hf}function wf(t){return .5/Math.tan(.5*t*of)}function xf(t,e){const[A,r,i=0]=t;return Af(e,[A,r,i,1])}function Cf(t,e,A=0){const[r,i,n]=t;if(Number.isFinite(n))return Af(e,[r,i,n,1]);const s=Af(e,[r,i,0,1]),a=Af(e,[r,i,1,1]),o=s[2],h=a[2];return Xo([],s,a,o===h?0:((A||0)-o)/(h-o))}function Ef({width:t,height:e,bounds:A,minExtent:r=0,maxZoom:i=24,padding:n=0,offset:s=[0,0]}){const[[a,o],[h,l]]=A;Number.isFinite(n)&&(n={top:n,bottom:n,left:n,right:n});const c=new Uf({width:t,height:e,longitude:0,latitude:0,zoom:0}),u=c.project([a,l]),p=c.project([h,o]),d=[Math.max(Math.abs(p[0]-u[0]),r),Math.max(Math.abs(p[1]-u[1]),r)],f=[t-n.left-n.right-2*Math.abs(s[0]),e-n.top-n.bottom-2*Math.abs(s[1])],y=f[0]/d[0],g=f[1]/d[1],m=c.unproject([(p[0]+u[0])/2+(n.right-n.left)/2/y,(p[1]+u[1])/2+(n.bottom-n.top)/2/g]),B=Math.min(i,c.zoom+nf(Math.abs(Math.min(y,g))));return {longitude:m[0],latitude:m[1],zoom:B}}const _f=Math.PI/180;function vf(t,e=0){const{width:A,height:r,unproject:i}=t,n={targetZ:e},s=i([0,r],n),a=i([A,r],n);let o,h;return (t.fovy?.5*t.fovy*_f:Math.atan(.5/t.altitude))>(90-t.pitch)*_f-.01?(o=bf(t,0,e),h=bf(t,A,e)):(o=i([0,0],n),h=i([A,0],n)),[s,a,h,o]}function bf(t,e,A){const{pixelUnprojectionMatrix:r}=t,i=Af(r,[e,0,1,1]),n=Af(r,[e,t.height,1,1]),s=df(Xo([],i,n,(A*t.distanceScales.unitsPerMeter[2]-i[2])/(n[2]-i[2])));return s[2]=A,s}class Uf{constructor({width:t,height:e,latitude:A=0,longitude:r=0,zoom:i=0,pitch:n=0,bearing:s=0,altitude:a=null,fovy:o=null,position:h=null,nearZMultiplier:l=.02,farZMultiplier:c=1.01}={width:1,height:1}){t=t||1,e=e||1,null===o&&null===a?o=Bf(a=1.5):null===o?o=Bf(a):null===a&&(a=wf(o));const u=cf(i);a=Math.max(.75,a);const p=ff({longitude:r,latitude:A}),d=pf([r,A]);d[2]=0,h&&Co(d,d,function(t,e,A){return t[0]=e[0]*A[0],t[1]=e[1]*A[1],t[2]=e[2]*A[2],t}([],h,p.unitsPerMeter)),this.projectionMatrix=mf({width:t,height:e,pitch:n,fovy:o,nearZMultiplier:l,farZMultiplier:c}),this.viewMatrix=yf({height:e,scale:u,center:d,pitch:n,bearing:s,altitude:a}),this.width=t,this.height=e,this.scale=u,this.latitude=A,this.longitude=r,this.zoom=i,this.pitch=n,this.bearing=s,this.altitude=a,this.fovy=o,this.center=d,this.meterOffset=h||[0,0,0],this.distanceScales=p,this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this);}_initMatrices(){const{width:t,height:e,projectionMatrix:A,viewMatrix:r}=this,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ho(i,i,A),ho(i,i,r),this.viewProjectionMatrix=i;const n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];co(n,n,[t/2,-e/2,1]),lo(n,n,[1,-1,0]),ho(n,n,i);const s=oo([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=n,this.pixelUnprojectionMatrix=s;}equals(t){return t instanceof Uf&&t.width===this.width&&t.height===this.height&&mo(t.projectionMatrix,this.projectionMatrix)&&mo(t.viewMatrix,this.viewMatrix)}project(t,{topLeft:e=!0}={}){const A=xf(this.projectPosition(t),this.pixelProjectionMatrix),[r,i]=A,n=e?i:this.height-i;return 2===t.length?[r,n]:[r,n,A[2]]}unproject(t,{topLeft:e=!0,targetZ:A}={}){const[r,i,n]=t,s=Cf([r,e?i:this.height-i,n],this.pixelUnprojectionMatrix,A&&A*this.distanceScales.unitsPerMeter[2]),[a,o,h]=this.unprojectPosition(s);return Number.isFinite(n)?[a,o,h]:Number.isFinite(A)?[a,o,A]:[a,o]}projectPosition(t){const[e,A]=pf(t);return [e,A,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(t){const[e,A]=df(t);return [e,A,(t[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(t){return pf(t)}unprojectFlat(t){return df(t)}getMapCenterByLngLatPosition({lngLat:t,pos:e}){const A=Cf(e,this.pixelUnprojectionMatrix),r=zo([],pf(t),function(t,e){return t[0]=-e[0],t[1]=-e[1],t}([],A));return df(zo([],this.center,r))}getLocationAtPoint({lngLat:t,pos:e}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:e})}fitBounds(t,e={}){const{width:A,height:r}=this,{longitude:i,latitude:n,zoom:s}=Ef(Object.assign({width:A,height:r,bounds:t},e));return new Uf({width:A,height:r,longitude:i,latitude:n,zoom:s})}getBounds(t){const e=this.getBoundingRegion(t),A=Math.min(...e.map((t=>t[0]))),r=Math.max(...e.map((t=>t[0])));return [[A,Math.min(...e.map((t=>t[1])))],[r,Math.max(...e.map((t=>t[1])))]]}getBoundingRegion(t={}){return vf(this,t.z||0)}}const Ff=["longitude","latitude","zoom"],Mf={curve:1.414,speed:1.2};function Qf(t,e,A){const r=(A=Object.assign({},Mf,A)).curve,i=t.zoom,n=[t.longitude,t.latitude],s=cf(i),a=[e.longitude,e.latitude],o=cf(e.zoom-i),h=pf(n),l=function(t,e,A){return t[0]=e[0]-A[0],t[1]=e[1]-A[1],t}([],pf(a),h),c=Math.max(t.width,t.height),u=c/o,p=function(t){return Math.hypot(t[0],t[1])}(l)*s,d=Math.max(p,.01),f=r*r,y=(u*u-c*c+f*f*d*d)/(2*c*f*d),g=(u*u-c*c-f*f*d*d)/(2*u*f*d),m=Math.log(Math.sqrt(y*y+1)-y),B=Math.log(Math.sqrt(g*g+1)-g);return {startZoom:i,startCenterXY:h,uDelta:l,w0:c,u1:p,S:(B-m)/r,rho:r,rho2:f,r0:m,r1:B}}var If=Object.freeze({__proto__:null,default:Uf,WebMercatorViewport:Uf,getBounds:vf,fitBounds:Ef,normalizeViewportProps:function({width:t,height:e,longitude:A,latitude:r,zoom:i,pitch:n=0,bearing:s=0}){(A<-180||A>180)&&(A=rf(A+180,360)-180),(s<-180||s>180)&&(s=rf(s+180,360)-180);const a=nf(e/512);if(i<=a)i=a,r=0;else {const t=e/2/Math.pow(2,i),A=df([0,t])[1];if(r<A)r=A;else {const e=df([0,512-t])[1];r>e&&(r=e);}}return {width:t,height:e,longitude:A,latitude:r,zoom:i,pitch:n,bearing:s}},flyToViewport:function(t,e,A,r={}){const i={},{startZoom:n,startCenterXY:s,uDelta:a,w0:o,u1:h,S:l,rho:c,rho2:u,r0:p}=Qf(t,e,r);if(h<.01){for(const r of Ff)i[r]=(d=A)*e[r]+(1-d)*t[r];return i}var d;const f=A*l,y=Math.cosh(p)/Math.cosh(p+c*f),g=o*((Math.cosh(p)*Math.tanh(p+c*f)-Math.sinh(p))/u)/h,m=n+uf(1/y),B=function(t,e,A){return t[0]=e[0]*A,t[1]=e[1]*A,t}([],a,g);zo(B,B,s);const w=df(B);return i.longitude=w[0],i.latitude=w[1],i.zoom=m,i},getFlyToDuration:function(t,e,A={}){A=Object.assign({},Mf,A);const{screenSpeed:r,speed:i,maxDuration:n}=A,{S:s,rho:a}=Qf(t,e,A),o=1e3*s;let h;return h=Number.isFinite(r)?o/(r/a):o/i,Number.isFinite(n)&&h>n?0:h},lngLatToWorld:pf,worldToLngLat:df,worldToPixels:xf,pixelsToWorld:Cf,zoomToScale:cf,scaleToZoom:uf,altitudeToFovy:Bf,fovyToAltitude:wf,getMeterZoom:function({latitude:t}){return uf(4003e4*Math.cos(t*of))-9},getDistanceScales:ff,addMetersToLngLat:function(t,e){const[A,r,i]=t,[n,s,a]=e,{unitsPerMeter:o,unitsPerMeter2:h}=ff({longitude:A,latitude:r,highPrecision:!0}),l=pf(t);l[0]+=n*(o[0]+h[0]*s),l[1]+=s*(o[1]+h[1]*s);const c=df(l),u=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[c[0],c[1],u]:c},getViewMatrix:yf,getProjectionMatrix:mf,getProjectionParameters:gf}),Sf={Core:Lh,Culling:uc,Geoid:Bc,Geospatial:wc,Main:xc,Polygon:du,Proj4:qd,Sun:ef,WebMercator:If};class Tf{constructor(){}}function Rf(t,e,A,r,i,n,s,a,o,h){const l=[];Lf(l,e.tileNumberToLngLat([i,n],s,s*Math.pow(2,a)).toArray(),o),h.emplaceBack(l[0],l[1],l[2],i/A,n/r);}function Lf(t,e,A){const r=e[0]*$.TRANSFORM.DEG_TO_RAD,i=e[1]*$.TRANSFORM.DEG_TO_RAD,n=A*Math.cos(i);return t[0]=n*Math.cos(r),t[1]=n*Math.sin(r),t[2]=A*Math.sin(i),t}function Pf(t,e){const A=e[0],r=e[2],i=e[1],n=Math.sqrt(A*A+r*r+i*i);return t[0]=Math.atan2(i,A)*$.TRANSFORM.RAD_TO_DEG,t[1]=Math.asin(r/n)*$.TRANSFORM.RAD_TO_DEG,t[2]=(n-$.TRANSFORM.R)*$.TRANSFORM.R_ZOOM,t}function Hf(t,e,A,r,i,n,s){const a=Math.pow(2,n),o=r+t/8192,h=i+e/8192,l=fa(s),c=[];return Lf(c,[l.xLng(o,a),l.yLat(h,a)],$.TRANSFORM.R+$.TRANSFORM.R_SCALE*A),c}function Of(t,e,A,r){const i=A,n=t,s=e,a=fa(r);return [a.xLng(n,i),a.yLat(s,i)]}function Df(t,e,A,r){const i=[];return Lf(i,Of(t,e,Math.pow(2,A),r),$.TRANSFORM.R),{out1:i,matrix:(new Eh).translate(i).toArray()}}function Nf(t,e={}){const A=t.cartesianModelMatrix.clone();0===A[12]&&0===A[13]&&0===A[14]&&(A[12]=.001,A[13]=.001,A[14]=.001);let r=Tf.wGS84ENUToNormalEllipsoidENU(A);const i=t.modelMatrix.clone();return i[12]=0,i[13]=0,i[14]=1,e.useRegularEllipsoid&&(r=kf(!0,{location:t.cartographicOrigin},new Eh),t.modelMatrix)?r.multiplyRight(t.modelMatrix):(t.modelMatrix&&r.multiplyRight(i),r)}function kf(t,e,A,r){let i=e.translation||[0,0,0];i=[i[0],i[1],i[2]];let n=[];if(e.location)n=e.location;else if(e._eventedParent){const t=e._eventedParent.tileset3d.root.transform.slice(12,15);n=nl.WGS84.cartesianToCartographic(t),e.location=n;}else n=e.location;if(!n)return A;const s=(new Eh).rotateZ((n[0]+90)*$.TRANSFORM.DEG_TO_RAD),a=(new Eh).rotateX((90-n[1])*$.TRANSFORM.DEG_TO_RAD),o=(new Eh).translate([0,0,r?r+(n[2]||0):$.TRANSFORM.R+(n[2]||0)]),h=t?new Eh:(new Eh).rotateX(Math.PI/2);return A=s.multiplyRight(a).multiplyRight(o).multiplyRight(h),0===i[0]&&0===i[1]&&0===i[2]||A.translate(i),ga(e.rotation)&&(3===e.rotation.length?(e.rotation[0]&&A.rotateX(e.rotation[0]*$.TRANSFORM.DEG_TO_RAD),e.rotation[1]&&A.rotateY(e.rotation[1]*$.TRANSFORM.DEG_TO_RAD),e.rotation[2]&&A.rotateZ(e.rotation[2]*$.TRANSFORM.DEG_TO_RAD)):4===e.rotation.length&&A.multiplyRight((new Eh).fromQuaternion(e.rotation))),!ga(e.scale)||1===e.scale[0]&&1===e.scale[1]&&1===e.scale[2]||A.scale(e.scale),A}function Vf(t,e){const A=e,r=new Eh;return r.translate(A),r.toArray()}function Gf(){return new Eh}function Kf(t,e,A){const r=(new Eh).rotateZ((t[0]+90)*$.TRANSFORM.DEG_TO_RAD),i=(new Eh).rotateX((90-t[1])*$.TRANSFORM.DEG_TO_RAD),n=(new Eh).translate([0,0,$.TRANSFORM.R]);let s;return s=A?new Eh:(new Eh).rotateX(Math.PI/2),r.multiplyRight(i).multiplyRight(n).multiplyRight(s).invert()}function zf(t,e,A){return (1-A)*t+A*e}function Xf(t,e,A,r,i,n){if(i>=e&&n<=A)return t;if(i>A||n<e)return null;const s=[];for(let i=0;i<t.length;i++){const n=t[i],a=n.geometry,o=n.type,h=n.min[r],l=n.max[r];if(h>=e&&l<=A){s.push(n);continue}if(h>A||l<e)continue;const c="Point"===o?qf(a,e,A,r):jf(a,e,A,r,0===r?Jf:$f,"Polygon"===o);c.length&&s.push(Wf(n.tags,o,c,n.id));}return s.length?s:null}function qf(t,e,A,r){const i=[];for(let n=0;n<t.length;n++){const s=t[n],a=s[r];a>=e&&a<=A&&i.push(s);}return i}function jf(t,e,A,r,i,n){const s=[];for(let a=0;a<t.length;a++){let o,h,l,c=0,u=0,p=null,d=[];const f=t[a],y=f.area,g=f.dist,m=f.outer,B=f.length;for(h=0;h<B-1;h++)o=p||f[h],p=f[h+1],c=u||o[r],u=p[r],c<e?u>A?(d.push(i(o,p,e),i(o,p,A)),n||(d=Yf(s,d,y,g,m))):u>=e&&d.push(i(o,p,e)):c>A?u<e?(d.push(i(o,p,A),i(o,p,e)),n||(d=Yf(s,d,y,g,m))):u<=A&&d.push(i(o,p,A)):(d.push(o),u<e?(d.push(i(o,p,e)),n||(d=Yf(s,d,y,g,m))):u>A&&(d.push(i(o,p,A)),n||(d=Yf(s,d,y,g,m))));o=f[B-1],c=o[r],c>=e&&c<=A&&d.push(o),l=d[d.length-1],n&&l&&(d[0][0]!==l[0]||d[0][1]!==l[1])&&d.push(d[0]),Yf(s,d,y,g,m);}return s}function Yf(t,e,A,r,i){return e.length&&(e.area=A,e.dist=r,void 0!==i&&(e.outer=i),t.push(e)),[]}function Wf(t,e,A,r){const i={id:r||null,type:e,geometry:A,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){const e=t.geometry,A=t.min,r=t.max;if(1===t.type)Zf(A,r,e);else for(let t=0;t<e.length;t++)Zf(A,r,e[t]);}(i),i}function Zf(t,e,A){for(let r,i=0;i<A.length;i++)r=A[i],t[0]=Math.min(r[0],t[0]),e[0]=Math.max(r[0],e[0]),t[1]=Math.min(r[1],t[1]),e[1]=Math.max(r[1],e[1]);}function Jf(t,e,A){return [A,(A-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1]]}function $f(t,e,A){return [(A-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],A]}function ty(t,e,A,r,i,n,s){if(!(t>1))return s.push(...n);{const a=Xf(n,e,e+(A-e)/2,0,0,8192),o=Xf(n,e+(A-e)/2,A,0,0,8192);if(a){const n=Xf(a,r,r+(i-r)/2,1,0,8192),o=Xf(a,r+(i-r)/2,i,1,0,8192);n&&ty(t-1,e,e+(A-e)/2,r,r+(i-r)/2,n,s),o&&ty(t-1,e,e+(A-e)/2,r+(i-r)/2,i,o,s);}if(o){const n=Xf(o,r,r+(i-r)/2,1,0,8192),a=Xf(o,r+(i-r)/2,i,1,0,8192);n&&ty(t-1,e+(A-e)/2,A,r,r+(i-r)/2,n,s),a&&ty(t-1,e+(A-e)/2,A,r+(i-r)/2,i,a,s);}}}function ey(t,e,A){if(t&&t.length<=0)return [];const r=[];r.push(new ny(new l(0,0),new l(8192,0))),r.push(new ny(new l(8192,0),new l(8192,8192))),r.push(new ny(new l(8192,8192),new l(0,8192))),r.push(new ny(new l(0,8192),new l(0,0))),e=e||r;let i,n=[],s=[],a=t[t.length-1];for(let e=0;e<t.length;e++)n.push(t[e]);for(const t in e){a=n[n.length-1],i=!Ay(a,e[t]);for(let A=0;A<n.length;A++)Ay(n[A],e[t])?(i&&(i=!1,s.push(iy(a,n[A],e[t].start,e[t].end))),s.push(n[A])):i||(i=!0,s.push(iy(a,n[A],e[t].start,e[t].end))),a=n[A];n=[];for(let t=0;t<s.length;t++)n.push(s[t]);s=[];}return n.push(A?n[0]:n[n.length-1]),n}function Ay(t,e){return !!t&&ry(t,e.start,e.end)>=0}function ry(t,e,A){return (A.x-e.x)*(t.y-e.y)-(A.y-e.y)*(t.x-e.x)}function iy(t,e,A,r){const i=(ry(t,r,A)*e.x-ry(e,r,A)*t.x)/(ry(t,r,A)-ry(e,r,A)),n=(ry(t,r,A)*e.y-ry(e,r,A)*t.y)/(ry(t,r,A)-ry(e,r,A));return new l(i,n)}function ny(t,e){this.start=t,this.end=e;}function sy(t,e,A,r,i){this.properties={},this.extent=A,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,this._version=arguments[5],this._projection=t.projection||"MERCATOR",this.projObj=fa(this._projection),t.readFields(ay,this,e);}function ay(t,e,A){1==t?e.id=A.readVarint():2==t?function(t,e){const A=t.readVarint()+t.pos;for(;t.pos<A;){const A=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[A]=r;}}(A,e):3==t?e.type=A.readVarint():4==t&&(e._geometry=A.pos);}function oy(t){let e=0;for(var A,r,i=0,n=t.length,s=n-1;i<n;s=i++)e+=((r=t[s]).x-(A=t[i]).x)*(A.y+r.y);return e}function hy(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ly,this,e),this.length=this._features.length;}function ly(t,e,A){15===t?e.version=A.readVarint():1===t?e.name=A.readString():5===t?e.extent=A.readVarint():2===t?e._features.push(A.pos):3===t?e._keys.push(A.readString()):4===t&&e._values.push(function(t){let e=null,A=t.readVarint()+t.pos;for(;t.pos<A;){const A=t.readVarint()>>3;e=1===A?t.readString():2===A?t.readFloat():3===A?t.readDouble():4===A?t.readVarint64():5===A?t.readVarint():6===A?t.readSVarint():7===A?t.readBoolean():null;}return e}(A));}function cy(t,e,A){if(3===t){var r=new hy(A,A.readVarint()+A.pos);r.length&&(e[r.name]=r);}}Tf.NormalEllipsoid=new Sf.Geospatial.Ellipsoid(6378137,6378137,6378137),Tf.WGS84=Sf.Geospatial.Ellipsoid.WGS84,Tf.eastNorthUpToFixedFrameByCartesian3InWGS84=function(t){return Tf.WGS84.eastNorthUpToFixedFrame(t)},Tf.eastNorthUpToFixedFrameByCartographicInWGS84=function(){},Tf.cartographicToCartesian3InWGS84=function(t){return Tf.WGS84.cartographicToCartesian(t)},Tf.cartesian3ToCartographicInWGS84=function(t){return Tf.WGS84.cartesianToCartographic(t)},Tf.eastNorthUpToFixedFrameByCartesian3InNormalEllipsoid=function(t){return Tf.NormalEllipsoid.eastNorthUpToFixedFrame(t)},Tf.cartographicToCartesian3InNormalEllipsoid=function(t){return Tf.NormalEllipsoid.cartographicToCartesian(t)},Tf.cartesian3ToCartographicInNormalEllipsoid=function(t){return Tf.NormalEllipsoid.cartesianToCartographic(t)},Tf.wGS84ENUToNormalEllipsoidENU=function(t){const e=Tf.cartesian3ToCartographicInWGS84([t[12],t[13],t[14]]),A=Tf.cartographicToCartesian3InNormalEllipsoid(e);return Tf.eastNorthUpToFixedFrameByCartesian3InNormalEllipsoid(A)},sy.types=["Unknown","Point","LineString","Polygon"],sy.prototype.loadGeometry=function(){const t=this._pbf;t.pos=this._geometry;let e,A=t.readVarint()+t.pos,r=1,i=0,n=0,s=0,a=0,o=[];for(;t.pos<A;){if(i<=0){const e=t.readVarint();r=7&e,i=e>>3;}if(i--,1===r||2===r)n+=t.readSVarint(),s+=t.readSVarint(),this._version>100&&(a+=t.readSVarint()),1===r&&(e&&o.push(e),e=[]),e.push(new l(n,s,a));else {if(7!==r)throw new Error(`unknown command ${r}`);e&&e.push(e[0].clone());}}return e&&o.push(e),o},sy.prototype.bbox=function(){const t=this._pbf;t.pos=this._geometry;let e=t.readVarint()+t.pos,A=1,r=0,i=0,n=0,s=1/0,a=-1/0,o=1/0,h=-1/0;for(;t.pos<e;){if(r<=0){const e=t.readVarint();A=7&e,r=e>>3;}if(r--,1===A||2===A)i+=t.readSVarint(),n+=t.readSVarint(),i<s&&(s=i),i>a&&(a=i),n<o&&(o=n),n>h&&(h=n);else if(7!==A)throw new Error(`unknown command ${A}`)}return [s,o,a,h]},sy.prototype.toGeoJSON=function(t,e,A){let r,i,n=this.extent*Math.pow(2,A),s=this.extent*t,a=this.extent*e,o=this.loadGeometry(),h=sy.types[this.type];const l=this;function c(t){for(let e=0;e<t.length;e++){const A=t[e];t[e]=[l.projObj.xLng(A.x+s,n),l.projObj.yLat(A.y+a,n)];}}switch(this.type){case 1:var u=[];for(r=0;r<o.length;r++)u[r]=o[r][0];o=u,c(o);break;case 2:for(r=0;r<o.length;r++)c(o[r]);break;case 3:for(o=function(t){const e=t.length;if(e<=1)return [t];let A,r,i=[];for(let n=0;n<e;n++){const e=oy(t[n]);0!==e&&(void 0===r&&(r=e<0),r===e<0?(A&&i.push(A),A=[t[n]]):A.push(t[n]));}return A&&i.push(A),i}(o),r=0;r<o.length;r++)for(i=0;i<o[r].length;i++)c(o[r][i]);}1===o.length?o=o[0]:h=`Multi${h}`;const p={type:"Feature",geometry:{type:h,coordinates:o},properties:this.properties};return "id"in this&&(p.id=this.id),p},hy.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sy(this._pbf,e,this.extent,this._keys,this._values,this.version)};var uy={VectorTile:function(t,e,A){t.projection=A,this.layers=t.readFields(cy,{},e);},VectorTileFeature:sy,VectorTileLayer:hy};class py{static getClassificationType(t){}static getMinMaxHeight(t,e,A,r){switch(t.classificationtype){case xn.TERRAIN:t.maxHeight=e,t.minHeight=0;break;case xn.MINEMAP_3D_TILE:t.maxHeight=A.maxHeight,t.minHeight=A.minHeight;break;case xn.BOTH:t.maxHeight=Math.max(A.maxHeight,e),t.minHeight=0;break;case xn.SINGULARIZATION:t.maxHeight=r.maxHeight,t.minHeight=r.minHeight;break;case xn.ALL:t.maxHeight=Math.max(A.maxHeight,e)||1,t.minHeight=-30;break;default:t.maxHeight=0,t.minHeight=0;}}static get3DTileMinMaxHeight(t){}}const dy=500;class fy{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Nn,this.indexArray=new es,this.indexArray2=new As,this.programConfigurations=new Es(fs,t.layers,t.zoom),this.segments=new ys,this.segments2=new ys,this.projection=t.projection||ua.MERCATOR,this.vectorRenderInSpace=!1,this.classificationtype=xn.NONE,this.layers.forEach((t=>{ga(t.classificationType)&&t.classificationType!=xn.NONE&&(this.vectorRenderInSpace=!0,this.classificationtype=t.classificationType);})),this.maxHeight=0,this.minHeight=0;}_getSampleNumber(t){let e=8;return e-=t,e<=0?0:e}_convertGeometryPointToPolygon(t){const e=[];for(let A=0;A<t.length;A++){const r=[];let i=1/0,n=1/0,s=-1/0,a=-1/0;for(let e=0;e<t[A].length;e++){const o=t[A][e].x,h=t[A][e].y;r.push([o,h]),i>o&&(i=o),s<o&&(s=o),n>h&&(n=h),a<h&&(a=h);}e.push({type:"Polygon",geometry:[r],min:[i,n],max:[s,a]});}return e}_convertPolygonToGeometry(t){const e=[];for(let A=0;A<t.length;A++){const r=t[A].geometry.map((t=>t.map((t=>new l(t[0],t[1])))));e.push(...r);}return e}populate(t,e,A,r,i){const n=this.vectorRenderInSpace;this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));const s=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:r,id:i,index:n,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,h={type:r.type,id:i,properties:r.properties,geometry:t?bs(r):[]};if(!this.layers[0]._featureFilter(new Xi(this.zoom),h,A))continue;t||(h.geometry=bs(r));const l=s?s.evaluate(h,{},A,e.availableImages):void 0;a.push({feature:r,sourceLayerIndex:o,index:n,geometry:h.geometry,sortKey:l});}s&&a.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of a){const{feature:s,index:a,sourceLayerIndex:o,geometry:h}=t,l=[],c=this._getSampleNumber(this.z);if(c>1){const t=[];ty(c,0,8192,0,8192,this._convertGeometryPointToPolygon(h),t);const e=this._convertPolygonToGeometry(t);n?this.addExtrusionFeature(s,h,a,l,A,n,r,i):this.addGridedFeature(s,h,e,a,A);}else n?this.addExtrusionFeature(s,h,a,l,A,n,r,i):this.addFeature(s,h,a,A);e.featureIndex.insert(s,h,a,o,this.index);}if(n){if(!this.baseP)return;this.tilePlane.matrix=Vf(0,this.baseP);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fs),this.layoutVertexArray2&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,fs)),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());}calcTDSpacePoint(t){const e=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R);return [e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2]]}addFeature(t,e,A,r){for(const t of na(e,dy)){let e=0;for(const A of t)e+=A.length;const A=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=A.vertexLength,i=[],n=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&n.push(i.length/2);const A=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=A.vertexLength,s=this.calcTDSpacePoint(e[0]);this.layoutVertexArray.emplaceBack(...s),this.indexArray2.emplaceBack(r+e.length-1,r),i.push(e[0].x),i.push(e[0].y);for(let t=1;t<e.length;t++){const A=this.calcTDSpacePoint(e[t]);this.layoutVertexArray.emplaceBack(...A),this.indexArray2.emplaceBack(r+t-1,r+t),i.push(e[t].x),i.push(e[t].y);}A.vertexLength+=e.length,A.primitiveLength+=e.length;}const s=Us(i,n);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);A.vertexLength+=e,A.primitiveLength+=s.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,{},r);}addGridedFeature(t,e,A,r,i){for(const t of na(A,dy)){let e=0;for(const A of t)e+=A.length;const A=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=A.vertexLength,i=[],n=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&n.push(i.length/2);const A=this.calcTDSpacePoint(e[0]);this.layoutVertexArray.emplaceBack(...A),i.push(e[0].x),i.push(e[0].y);for(let t=1;t<e.length;t++){const A=this.calcTDSpacePoint(e[t]);this.layoutVertexArray.emplaceBack(...A),i.push(e[t].x),i.push(e[t].y);}}const s=Us(i,n);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);A.vertexLength+=e,A.primitiveLength+=s.length/3;}this.layoutVertexArray2=new Nn;for(const t of na(e,dy))for(const e of t){if(0===e.length)continue;const t=this.segments2.prepareSegment(e.length,this.layoutVertexArray2,this.indexArray2).vertexLength,A=this.calcTDSpacePoint(e[0]);this.layoutVertexArray2.emplaceBack(...A),this.indexArray2.emplaceBack(t+e.length-1,t);for(let A=1;A<e.length;A++){const r=this.calcTDSpacePoint(e[A]);this.layoutVertexArray2.emplaceBack(...r),this.indexArray2.emplaceBack(t+A-1,t+A);}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},i);}addExtrusionFeature(t,e,A,r,i,n,s,a){py.getMinMaxHeight(this,s,a,void 0);for(const A of na(e,dy)){let e=0,r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t of A)if(0!==t.length&&!oa(t)&&(!ha(t)||(t=ey(t,void 0,n),t[0]))){e+=t.length;for(let e=0;e<t.length;e++){const A=t[e];if(e>=1){const i=t[e-1];if(!aa(A,i)){r.vertexLength+4>ys.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=Hf(A.x,A.y,this.minHeight,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=t);const e=Hf(A.x,A.y,this.maxHeight,this.x,this.y,this.z,this.projection),n=Hf(i.x,i.y,this.minHeight,this.x,this.y,this.z,this.projection),s=Hf(i.x,i.y,this.maxHeight,this.x,this.y,this.z,this.projection),a=this.baseP;this.layoutVertexArray.emplaceBack(t[0]-a[0],t[1]-a[1],t[2]-a[2]),this.layoutVertexArray.emplaceBack(e[0]-a[0],e[1]-a[1],e[2]-a[2]),this.layoutVertexArray.emplaceBack(n[0]-a[0],n[1]-a[1],n[2]-a[2]),this.layoutVertexArray.emplaceBack(s[0]-a[0],s[1]-a[1],s[2]-a[2]);const o=r.vertexLength;this.indexArray.emplaceBack(o,o+2,o+1),this.indexArray.emplaceBack(o+1,o+2,o+3),r.vertexLength+=4,r.primitiveLength+=2;}}}}r.vertexLength+e>ys.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"===uy.VectorTileFeature.types[t.type]&&(yy(r,this.maxHeight,n,!0,A,this,e),yy(r,this.minHeight,n,!1,A,this,e));}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A);}}function yy(t,e,A,r,i,n,s){const a=[],o=[],h=t.vertexLength;for(let t=0;t<i.length;t++){let s=i[t];if(0!==s.length&&!oa(s)&&(!ha(s)||(s=ey(s,void 0,A),s[0]))){t>0&&s!==i[0]&&o.push(a.length/2);for(let t=0;t<s.length;t++){const A=s[t],i=Hf(A.x,A.y,r?e:n.minHeight,n.x,n.y,n.z,n.projection);n.baseP||(n.baseP=i),n.layoutVertexArray.emplaceBack(i[0]-n.baseP[0],i[1]-n.baseP[1],i[2]-n.baseP[2]),a.push(A.x),a.push(A.y);}}}const l=Us(a,o);for(let t=0;t<l.length;t+=3)r?n.indexArray.emplaceBack(h+l[t],h+l[t+2],h+l[t+1]):n.indexArray.emplaceBack(h+l[t],h+l[t+1],h+l[t+2]);t.primitiveLength+=l.length/3,t.vertexLength+=s;}function gy(t,e,A){return !!vy(t,e)||!!Cy(e,t,A)}function my(t,e,A){for(let r=0;r<e.length;r++){const i=e[r];if(t.length>=3)for(let e=0;e<i.length;e++)if(vy(t,i[e]))return !0;if(By(t,i,A))return !0}return !1}function By(t,e,A){if(t.length>1){if(wy(t,e))return !0;for(let r=0;r<e.length;r++)if(Cy(e[r],t,A))return !0}for(let r=0;r<t.length;r++)if(Cy(t[r],e,A))return !0;return !1}function wy(t,e){if(0===t.length||0===e.length)return !1;for(let A=0;A<t.length-1;A++){const r=t[A],i=t[A+1];for(let t=0;t<e.length-1;t++)if(xy(r,i,e[t],e[t+1]))return !0}return !1}function xy(t,e,A,r){return R(t,A,r)!==R(e,A,r)&&R(t,e,A)!==R(t,e,r)}function Cy(t,e,A){const r=A*A;if(1===e.length)return t.distSqr(e[0])<r;for(let A=1;A<e.length;A++)if(Ey(t,e[A-1],e[A])<r)return !0;return !1}function Ey(t,e,A){const r=e.distSqr(A);if(0===r)return t.distSqr(e);const i=((t.x-e.x)*(A.x-e.x)+(t.y-e.y)*(A.y-e.y))/r;return t.distSqr(i<0?e:i>1?A:A.sub(e)._mult(i)._add(e))}function _y(t,e){let A,r,i,n=!1;for(let s=0;s<t.length;s++){A=t[s];for(let t=0,s=A.length-1;t<A.length;s=t++)r=A[t],i=A[s],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(n=!n);}return n}function vy(t,e){let A=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const n=t[r],s=t[i];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(A=!A);}return A}function by(t,e,A){const r=A[0],i=A[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return !1;const n=R(t,e,A[0]);return n!==R(t,e,A[1])||n!==R(t,e,A[2])||n!==R(t,e,A[3])}function Uy(t,e,A){const r=e.paint.get(t).value;return "constant"===r.kind?r.value:A.programConfigurations.get(e.id).binders[t].statistics.max}function Fy(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function My(t,e,A,r,i){if(!e[0]&&!e[1])return t;const n=l.convert(e);"viewport"===A&&n._rotate(-r);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(n._mult(i)));return s}Fi("SphereFillBucket",fy,{omit:["layers"]});const Qy=new wn({"fill-sort-key":new yn(Bt.layout_fill["fill-sort-key"]),dynamic:new fn(Bt.layout_fill.dynamic)});var Iy={paint:new wn({"fill-antialias":new fn(Bt.paint_fill["fill-antialias"]),"fill-opacity":new yn(Bt.paint_fill["fill-opacity"]),"fill-color":new yn(Bt.paint_fill["fill-color"]),"fill-outline-color":new yn(Bt.paint_fill["fill-outline-color"]),"fill-translate":new fn(Bt.paint_fill["fill-translate"]),"fill-translate-anchor":new fn(Bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new mn(Bt.paint_fill["fill-pattern"]),"fill-water":new fn(Bt.paint_fill["fill-water"]),"fill-dynamic-speed":new yn(Bt.paint_fill["fill-dynamic-speed"]),"fill-dynamic-image-url":new mn(Bt.paint_fill["fill-dynamic-image-url"])}),layout:Qy};const Sy=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_extrude",components:2,type:"Uint8"}],4),{members:Ty}=Sy,Ry=Mn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ly}=Ry,Py=uy.VectorTileFeature.types,Hy=63,Oy=Math.cos(Math.PI/180*37.5),Dy=.5,Ny=Math.pow(2,14)/Dy;class ky{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.vectorRenderInSpace=!1,this.layers.forEach((t=>{this.gradients[t.id]={},ga(t.classificationType)&&t.classificationType!=xn.NONE&&(this.vectorRenderInSpace=!0,this.classificationtype=t.classificationType);})),this.layoutVertexArray=new On,this.layoutVertexArray2=new Kn,this.indexArray=new es,this.programConfigurations=new Es(Ty,t.layers,t.zoom),this.segments=new ys,this.maxLineLength=0,this.projection=t.projection||ua.MERCATOR,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.tempVertex=[],this.bottomTempVertex=[],this.bottomTempIndice=[],this.maxHeight=0,this.minHeight=0;}_getSampleNumber(t){let e=8;return e-=t,e<=0?0:e}_convertGeometryPointToLine(t){const e=[];for(let A=0;A<t.length;A++){const r=[];let i=1/0,n=1/0,s=-1/0,a=-1/0;for(let e=0;e<t[A].length;e++){const o=t[A][e].x,h=t[A][e].y;r.push([o,h]),i>o&&(i=o),s<o&&(s=o),n>h&&(n=h),a<h&&(a=h);}e.push({type:"LineString",geometry:[r],min:[i,n],max:[s,a]});}return e}_convertLineToGeometry(t){const e=[];for(let A=0;A<t.length;A++){const r=t[A].geometry.map((t=>t.map((t=>new l(t[0],t[1])))));e.push(...r);}return e}populate(t,e,A,r,i){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));const n=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:e,id:r,index:i,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,o={type:e.type,id:r,properties:e.properties,geometry:t?bs(e):[]};if(!this.layers[0]._featureFilter(new Xi(this.zoom),o,A))continue;t||(o.geometry=bs(e));const h=n?n.evaluate(o,{},A):void 0;s.push({feature:e,sourceLayerIndex:a,index:i,sortKey:h});}n&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of s){const{feature:A,index:n,sourceLayerIndex:s}=t,a=bs(A);let o=this._getSampleNumber(this.z);this.layers[0].paint._values["line-gradient"]&&(o=1);const h=this._convertGeometryPointToLine(a),l=[];3===A.type&&(o=2,A.polygon2Line=!0),ty(o,0,8192,0,8192,h,l);const c=this._convertLineToGeometry(l);this.addFeature(A,c,n,new An(this.z,this.x,this.y),{},r,i),e.featureIndex.insert(A,a,n,s,this.index);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}addFeatures(t,e,A){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,A);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ly)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ty),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutVertexBuffer2&&this.layoutVertexBuffer2.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("minemap_clip_start")&&t.properties.hasOwnProperty("minemap_clip_end"))return {start:+t.properties.minemap_clip_start,end:+t.properties.minemap_clip_end}}addFeature(t,e,A,r,i,n,s){py.getMinMaxHeight(this,n,s,void 0);const a=this.layers[0].layout,o=a.get("line-join").evaluate(t,{}),h=a.get("line-cap"),l=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const A of e)if(this.vectorRenderInSpace){this.tempVertex=[],this.bottomTempVertex=[],this.bottomTempIndice=[];const e=this.addLine(A,t,o,h,l,c);this.tempVertex.push(this.tempVertex[0]),this.addSide(e),this.addBottom(e),this.tempVertex=[],this.bottomTempIndice=[],this.bottomTempVertex=[];}else this.addLine(A,t,o,h,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,i,r);}addLine(t,e,A,r,i,n){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance);}let s="Polygon"===Py[e.type];e.polygon2Line&&(s=!1);let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let o=0;for(;o<a-1&&t[o].equals(t[o+1]);)o++;if(a<(s?3:2))return;"bevel"===A&&(i=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,l=this.segments.prepareSegment(16*a,this.layoutVertexArray,this.indexArray);let c,u,p,d,f;this.e1=this.e2=-1,s&&(c=t[a-2],f=t[o].sub(c)._unit()._perp());for(let e=o;e<a;e++){if(p=e===a-1?s?t[o+1]:void 0:t[e+1],p&&t[e].equals(p))continue;f&&(d=f),c&&(u=c),c=t[e],f=p?p.sub(c)._unit()._perp():d,d=d||f;let y=d.add(f);0===y.x&&0===y.y||y._unit();const g=d.x*f.x+d.y*f.y,m=y.x*f.x+y.y*f.y,B=0!==m?1/m:1/0,w=2*Math.sqrt(2-2*m),x=m<Oy&&u&&p,C=d.x*f.y-d.y*f.x>0;if(x&&e>o){const t=c.dist(u);if(t>2*h){const e=c.sub(c.sub(u)._mult(h/t)._round());this.updateDistance(u,e),this.addCurrentVertex(e,d,0,0,l),u=e;}}const E=u&&p;let _=E?A:s?"butt":r;if(E&&"round"===_&&(B<n?_="miter":B<=2&&(_="fakeround")),"miter"===_&&B>i&&(_="bevel"),"bevel"===_&&(B>2&&(_="flipbevel"),B<i&&(_="miter")),u&&this.updateDistance(u,c),"miter"===_)y._mult(B),this.addCurrentVertex(c,y,0,0,l);else if("flipbevel"===_){if(B>100)y=f.mult(-1);else {const t=B*d.add(f).mag()/d.sub(f).mag();y._perp()._mult(t*(C?-1:1));}this.addCurrentVertex(c,y,0,0,l),this.addCurrentVertex(c,y.mult(-1),0,0,l);}else if("bevel"===_||"fakeround"===_){const t=-Math.sqrt(B*B-1),e=C?t:0,A=C?0:t;if(u&&this.addCurrentVertex(c,d,e,A,l),"fakeround"===_){const t=Math.round(180*w/Math.PI/20);for(let e=1;e<t;e++){let A=e/t;if(.5!==A){const t=A-.5;A+=A*t*(A-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*t*t+(.848013+g*(.215638*g-1.06021)));}const r=f.sub(d)._mult(A)._add(d)._unit()._mult(C?-1:1);this.addHalfVertex(c,r.x,r.y,!1,C,0,l,{x:0,y:0});}}p&&this.addCurrentVertex(c,f,-e,-A,l);}else if("butt"===_)this.addCurrentVertex(c,y,0,0,l);else if("square"===_){const t=u?1:-1;this.addCurrentVertex(c,y,t,t,l);}else "round"===_?(u&&(this.addCurrentVertex(c,d,0,0,l),this.addCurrentVertex(c,d,1,1,l,!0)),p&&(this.addCurrentVertex(c,f,-1,-1,l,!0),this.addCurrentVertex(c,f,0,0,l))):"round-butt"===_&&(u&&(this.addCurrentVertex(c,d,0,0,l),this.addCurrentVertex(c,d,.5,.5,l,!0,.42,.42)),p&&(this.addCurrentVertex(c,f,-.5,-.5,l,!0,-.42,-.42),this.addCurrentVertex(c,f,0,0,l)));if(x&&e<a-1){const t=c.dist(p);if(t>2*h){const e=c.add(p.sub(c)._mult(h/t)._round());this.updateDistance(c,e),this.addCurrentVertex(e,f,0,0,l),c=e;}}}return l}addBottom(t){const e=t.vertexLength,A=this.bottomTempIndice;let r=-1;for(let t=0;t<A.length;t++){const e=A[t];r=r>-1?Math.min(Math.min(Math.min(e.x,e.y),e.z),r):Math.min(Math.min(e.x,e.y),e.z);}for(let i=0;i<A.length;i++){const n=A[i];this.indexArray.emplaceBack(e+n.x-r,e+n.y-r,e+n.z-r),t.primitiveLength++;}const i=this.bottomTempVertex;for(let e=0;e<i.length;e++){const A=i[e],r=(this.lineClips?this.scaledDistance*(Ny-1):this.scaledDistance)*Dy;this.layoutVertexArray.emplaceBack(A.currentVertex.x,A.currentVertex.y,A.currentVertex.z,(A.round?2:0)+(A.up?1:0),Math.round(Hy*A.extrudeX)+128,Math.round(Hy*A.extrudeY)+128,1+(0===A.dir?0:A.dir<0?-1:1)|(63&r)<<2,r>>6,128,128),t.vertexLength++;}}addSide(t){if(this.tempVertex.length<2)return;let e=!0;for(let A=0;A<this.tempVertex.length;A++)if(0===A){const t=this.tempVertex[A];e=!e,this.addSideVertex(t.currentVertex.x,t.currentVertex.y,t.currentVertex.z,t.extrudeX,t.extrudeY,t.round,e,t.dir),this.addSideVertex(t.currentSpaceVertex.x,t.currentSpaceVertex.y,t.currentSpaceVertex.z,t.extrudeX,t.extrudeY,t.round,e,t.dir);}else {e=!e;const r=this.tempVertex[A];this.addSideVertex(r.currentVertex.x,r.currentVertex.y,r.currentVertex.z,r.extrudeX,r.extrudeY,r.round,e,r.dir),this.addSideVertex(r.currentSpaceVertex.x,r.currentSpaceVertex.y,r.currentSpaceVertex.z,r.extrudeX,r.extrudeY,r.round,e,r.dir);const i=t.vertexLength;this.indexArray.emplaceBack(i,i+2,i+1),this.indexArray.emplaceBack(i+1,i+2,i+3),t.vertexLength+=2,t.primitiveLength+=2;}t.vertexLength+=2;}addSideVertex(t,e,A,r,i,n,s,a,o){const h=(this.lineClips?this.scaledDistance*(Ny-1):this.scaledDistance)*Dy;this.layoutVertexArray.emplaceBack(t,e,A,(n?2:0)+(s?1:0),Math.round(Hy*r)+128,Math.round(Hy*i)+128,1+(0===a?0:a<0?-1:1)|(63&h)<<2,h>>6,128,128);}calcTDSpacePoint(t,e){const A=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R+e*$.TRANSFORM.R_SCALE);return new l(A[0]-this.tilePlane.out1[0],A[1]-this.tilePlane.out1[1],A[2]-this.tilePlane.out1[2])}addCurrentVertex(t,e,A,r,i,n=!1,s=0,a=0){const o=e.x+e.y*A,h=e.y-e.x*A,l=e.y*r-e.x,c=-e.y-e.x*r;let u=e.mult(0);u=e.perp().mult(-s);let p=e.mult(0);p=e.perp().mult(-a);const d=this.calcTDSpacePoint(t,this.minHeight);if(this.vectorRenderInSpace){const e=this.calcTDSpacePoint(t,this.maxHeight);this.addHalfVertex(t,o,h,n,!1,A,i,u),this.addHalfVertex(t,l,c,n,!0,-r,i,p),this.tempVertex.push({currentVertex:d,currentSpaceVertex:e,extrudeX:o,extrudeY:h,round:n,up:!1,dir:A}),this.tempVertex.unshift({currentVertex:d,currentSpaceVertex:e,extrudeX:l,extrudeY:c,round:n,up:!0,dir:-r});}else this.addHalfVertex(t,o,h,n,!1,A,i,u),this.addHalfVertex(t,l,c,n,!0,-r,i,p);this.distance>Ny/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,A,r,i,n));}addHalfVertex(t,e,A,r,i,n,s,a){const o=this.lineClips?this.scaledDistance*(Ny-1):this.scaledDistance,h=this.calcTDSpacePoint(t,this.vectorRenderInSpace?this.maxHeight:0),l=this.calcTDSpacePoint(t,this.minHeight),c=o*Dy;this.layoutVertexArray.emplaceBack(h.x,h.y,h.z,(r?2:0)+(i?1:0),Math.round(Hy*e)+128,Math.round(Hy*A)+128,1+(0===n?0:n<0?-1:1)|(63&c)<<2,c>>6,Math.round(Hy*a.x)+128,Math.round(Hy*a.y)+128),this.vectorRenderInSpace&&this.bottomTempVertex.push({currentVertex:l,extrudeX:e,extrudeY:A,round:r,up:i,dir:n}),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const u=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,u,this.e2),s.primitiveLength++,this.vectorRenderInSpace&&this.bottomTempIndice.push({x:this.e1,y:this.e2,z:u})),i?this.e2=u:this.e1=u;}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance;}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance();}}Fi("SphereLineBucket",ky,{omit:["layers","patternFeatures"]});const Vy=new wn({"line-cap":new fn(Bt.layout_line["line-cap"]),"line-join":new yn(Bt.layout_line["line-join"]),"line-miter-limit":new fn(Bt.layout_line["line-miter-limit"]),"line-round-limit":new fn(Bt.layout_line["line-round-limit"]),"line-sort-key":new yn(Bt.layout_line["line-sort-key"]),"border-visibility":new fn(Bt.layout_line["border-visibility"])});var Gy={paint:new wn({"line-opacity":new yn(Bt.paint_line["line-opacity"]),"line-color":new yn(Bt.paint_line["line-color"]),"line-translate":new fn(Bt.paint_line["line-translate"]),"line-translate-anchor":new fn(Bt.paint_line["line-translate-anchor"]),"line-width":new yn(Bt.paint_line["line-width"]),"line-border-width":new yn(Bt.paint_line["line-border-width"]),"line-border-opacity":new yn(Bt.paint_line["line-border-opacity"]),"line-border-color":new yn(Bt.paint_line["line-border-color"]),"line-gap-width":new yn(Bt.paint_line["line-gap-width"]),"line-offset":new yn(Bt.paint_line["line-offset"]),"line-blur":new yn(Bt.paint_line["line-blur"]),"line-dasharray":new mn(Bt.paint_line["line-dasharray"]),"line-pattern":new mn(Bt.paint_line["line-pattern"]),"line-gradient":new Bn(Bt.paint_line["line-gradient"]),"half-render":new fn(Bt.paint_line["half-render"]),"line-normal-direction":new yn(Bt.paint_line["line-normal-direction"])}),layout:Vy};const Ky=new class extends yn{possiblyEvaluate(t,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,A,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,A,r)}}(Gy.paint.properties["line-width"].specification);function zy(t,e){return e>0?e+2*t:t}Ky.useIntegerZoom=!0;const Xy=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:2,type:"Uint16"}],4),{members:qy}=Xy,jy=uy.VectorTileFeature.types,Yy=Math.cos(Math.PI/180*37.5),Wy=Math.pow(2,14)/.5;function Zy(t,e,A,r,i,n,s,a,o){t.emplaceBack(e[0],e[1],e[2],r?1:0,i?1:-1,Math.round(63*A.x)+128,Math.round(63*A.y)+128,1+(0===n?0:n<0?-1:1)|(.5*s&63)<<2,.5*s>>6,a,o);}class Jy{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Gn,this.indexArray=new es,this.programConfigurations=new Es(qy,t.layers,t.zoom),this.segments=new ys,this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));for(const{feature:r,index:i,sourceLayerIndex:n}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),r,A)){const t=bs(r);this.addFeature(r,t,i,A),e.featureIndex.insert(r,t,i,n,this.index);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qy),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r){const i=this.layers[0].layout,n=i.get("airline-join").evaluate(t,{}),s=i.get("airline-cap"),a=i.get("airline-miter-limit"),o=i.get("airline-round-limit"),h=Number(t.properties.link_seq);for(const i of e)this.addLine(i,t,n,s,a,o,A,h,r);}addLine(t,e,A,r,i,n,s,a,o){const h="Polygon"===jy[e.type];let l=t.length;for(;l>=2&&t[l-1].equals(t[l-2]);)l--;let c=0;for(;c<l-1&&t[c].equals(t[c+1]);)c++;if(l<(h?3:2))return;"bevel"===A&&(i=1.05);const u=ji/(512*this.overscaling)*15,p=t[c],d=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;const f=r,y=h?"butt":r;let g,m,B,w,x,C,E,_=!0;this.e1=this.e2=this.e3=-1,h&&(g=t[l-2],x=p.sub(g)._unit()._perp());for(let r=c;r<l;r++){if(a+=1,this.hSeq=0===r?parseFloat(e.properties.start_height):parseFloat(e.properties.end_height),this._count=parseFloat(e.properties.total),B=h&&r===l-1?t[c+1]:t[r+1],B&&t[r].equals(B))continue;x&&(w=x),g&&(m=g),g=t[r],x=B?B.sub(g)._unit()._perp():w,w=w||x;let s=w.add(x);0===s.x&&0===s.y||s._unit();const o=s.x*x.x+s.y*x.y,p=0!==o?1/o:1/0,v=o<Yy&&m&&B;if(v&&r>c){const t=g.dist(m);if(t>2*u){const e=g.sub(g.sub(m)._mult(u/t)._round());this.distance+=e.dist(m),this.addCurrentVertex(e,this.distance,w.mult(1),0,0,!1,d,a),m=e;}}const b=m&&B;let U=b?A:B?f:y;if(b&&"round"===U&&(p<n?U="miter":p<=2&&(U="fakeround")),"miter"===U&&p>i&&(U="bevel"),"bevel"===U&&(p>2&&(U="flipbevel"),p<i&&(U="miter")),m&&(this.distance+=g.dist(m)),"miter"===U)s._mult(p),this.addCurrentVertex(g,this.distance,s,0,0,!1,d,a);else if("flipbevel"===U){if(p>100)s=x.clone().mult(-1);else {const t=w.x*x.y-w.y*x.x>0?-1:1,e=p*w.add(x).mag()/w.sub(x).mag();s._perp()._mult(e*t);}this.addCurrentVertex(g,this.distance,s,0,0,!1,d,a),this.addCurrentVertex(g,this.distance,s.mult(-1),0,0,!1,d,a);}else if("bevel"===U||"fakeround"===U){const t=w.x*x.y-w.y*x.x>0,e=-Math.sqrt(p*p-1);if(t?(E=0,C=e):(C=0,E=e),_||this.addCurrentVertex(g,this.distance,w,C,E,!1,d,a),"fakeround"===U){const e=Math.floor(8*(.5-(o-.5)));let A;for(let r=0;r<e;r++)A=x.mult((r+1)/(e+1))._add(w)._unit(),this.addPieSliceVertex(g,this.distance,A,t,d,a);this.addPieSliceVertex(g,this.distance,s,t,d,a);for(let r=e-1;r>=0;r--)A=w.mult((r+1)/(e+1))._add(x)._unit(),this.addPieSliceVertex(g,this.distance,A,t,d,a);}B&&this.addCurrentVertex(g,this.distance,x,-C,-E,!1,d,a);}else "butt"===U?(_||this.addCurrentVertex(g,this.distance,w,0,0,!1,d,a),B&&this.addCurrentVertex(g,this.distance,x,0,0,!1,d,a)):"square"===U?(_||(this.addCurrentVertex(g,this.distance,w,1,1,!1,d,a),this.e1=this.e2=-1),B&&this.addCurrentVertex(g,this.distance,x,-1,-1,!1,d,a)):"round"===U&&(_||(this.addCurrentVertex(g,this.distance,w,0,0,!1,d,a),this.addCurrentVertex(g,this.distance,w,1,1,!0,d,a),this.e1=this.e2=-1),B&&(this.addCurrentVertex(g,this.distance,x,-1,-1,!0,d,a),this.addCurrentVertex(g,this.distance,x,0,0,!1,d,a)));if(v&&r<l-1){const t=g.dist(B);if(t>2*u){const e=g.add(B.sub(g)._mult(u/t)._round());this.distance+=e.dist(g),this.addCurrentVertex(e,this.distance,x.mult(1),0,0,!1,d,a),g=e;}}_=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},o);}calcTDSpacePoint(t){const e=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R+this.hSeq);return [e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2]]}addCurrentVertex(t,e,A,r,i,n,s,a){let o;const h=this.layoutVertexArray,l=this.indexArray;o=A.clone(),r&&o._sub(A.perp()._mult(r));const c=this.calcTDSpacePoint(t);Zy(h,c,o,n,!1,r,e,a,this._count),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,o=A.mult(-1),i&&o._sub(A.perp()._mult(i)),Zy(h,c,o,n,!0,-i,e,a,this._count),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Wy/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,A,r,i,n,s,a));}addPieSliceVertex(t,e,A,r,i,n){A=A.mult(r?-1:1);const s=this.indexArray;Zy(this.layoutVertexArray,this.calcTDSpacePoint(t),A,!1,r,0,e,n,this._count),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;}}Fi("SphereAirLineBucket",Jy,{omit:["layers"]});const $y=new wn({"airline-cap":new fn(Bt.layout_airline["airline-cap"]),"airline-join":new yn(Bt.layout_airline["airline-join"]),"airline-miter-limit":new fn(Bt.layout_airline["airline-miter-limit"]),"airline-round-limit":new fn(Bt.layout_airline["airline-round-limit"]),"airline-sort-key":new yn(Bt.layout_airline["airline-sort-key"]),"airline-display-mode":new fn(Bt.layout_airline["airline-display-mode"])});var tg={paint:new wn({"airline-opacity":new yn(Bt.paint_airline["airline-opacity"]),"airline-color":new yn(Bt.paint_airline["airline-color"]),"airline-translate":new fn(Bt.paint_airline["airline-translate"]),"airline-translate-anchor":new fn(Bt.paint_airline["airline-translate-anchor"]),"airline-width":new yn(Bt.paint_airline["airline-width"]),"airline-gap-width":new yn(Bt.paint_airline["airline-gap-width"]),"airline-offset":new yn(Bt.paint_airline["airline-offset"]),"airline-blur":new yn(Bt.paint_airline["airline-blur"]),"airline-type":new fn(Bt.paint_airline["airline-type"]),"airline-seg-group":new fn(Bt.paint_airline["airline-seg-group"]),"airline-speed":new fn(Bt.paint_airline["airline-speed"])}),layout:$y};const eg=new class extends yn{possiblyEvaluate(t,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,A,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,A,r)}}(tg.paint.properties["airline-width"].specification);function Ag(t,e){return e>0?e+2*t:t}eg.useIntegerZoom=!0;const rg=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_extra",components:2,type:"Int16"}],4),{members:ig}=rg;function ng(t,e,A,r,i,n){t.emplaceBack(e,A,r,i,n);}class sg{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Vn,this.indexArray=new es,this.segments=new ys,this.programConfigurations=new Es(ig,t.layers,t.zoom),this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){const r=this.layers[0],i=[];let n=null;"circle"===r.type&&(n=r.layout.get("circle-sort-key")),this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));for(const{feature:e,id:r,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,o={type:e.type,id:r,properties:e.properties,geometry:t?bs(e):[]};if(!this.layers[0]._featureFilter(new Xi(this.zoom),e,A))continue;t||(o.geometry=bs(e));const h=n?n.evaluate(o,{},A):void 0;i.push({id:r,properties:e.properties,type:e.type,sourceLayerIndex:a,index:s,geometry:o.geometry,patterns:{},sortKey:h});}n&&i.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of i){const{geometry:i,index:n,sourceLayerIndex:s}=r,a=t[n].feature;this.addFeature(r,i,n,A),e.featureIndex.insert(a,i,n,s,this.index);}this.x=e.x,this.y=e.y,this.z=e.z;}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ig),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}calcTDSpacePoint(t,e){const A=Lf([],Of(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),$.TRANSFORM.R);return [A[0]-this.tilePlane.out1[0],A[1]-this.tilePlane.out1[1],A[2]-this.tilePlane.out1[2]]}addFeature(t,e,A,r){for(const t of e)for(const e of t){const t=e.x,A=e.y;if(t<0||t>=ji||A<0||A>=ji)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),i=r.vertexLength,n=this.calcTDSpacePoint(t,A);ng(this.layoutVertexArray,...n,-1,-1),ng(this.layoutVertexArray,...n,1,-1),ng(this.layoutVertexArray,...n,1,1),ng(this.layoutVertexArray,...n,-1,1),this.indexArray.emplaceBack(i,i+1,i+2),this.indexArray.emplaceBack(i,i+3,i+2),r.vertexLength+=4,r.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,{},r);}}Fi("SphereCircleBucket",sg,{omit:["layers"]});const ag=new wn({"circle-sort-key":new yn(Bt.layout_circle["circle-sort-key"])});var og={paint:new wn({"circle-radius":new yn(Bt.paint_circle["circle-radius"]),"circle-color":new yn(Bt.paint_circle["circle-color"]),"circle-blur":new yn(Bt.paint_circle["circle-blur"]),"circle-opacity":new yn(Bt.paint_circle["circle-opacity"]),"circle-translate":new fn(Bt.paint_circle["circle-translate"]),"circle-translate-anchor":new fn(Bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new fn(Bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new fn(Bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Bt.paint_circle["circle-stroke-opacity"])}),layout:ag};function hg(t,e){const A=new ah([t.x,t.y,0,1]).transform(e);return new l(A[0]/A[3],A[1]/A[3])}const lg=Mn([{name:"a_pos_vec3",components:3,type:"Float32"},{name:"a_extrude",components:2,type:"Int8"}],4),{members:cg}=lg;function ug(t,e,A,r,i,n){t.emplaceBack(e,A,r,i,n);}class pg{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Ln,this.indexArray=new es,this.segments=new ys,this.programConfigurations=new Es(cg,t.layers,t.zoom),this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){this.x=e.x,this.y=e.y,this.z=e.z;for(const{feature:r,index:i,sourceLayerIndex:n}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),r,A)){const t=bs(r);this.addFeature(r,t,i,A),e.featureIndex.insert(r,t,i,n,this.index);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cg),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r){for(const t of e)for(const e of t){const t=e.x,A=e.y,r=Hf(e.x,e.y,this.layers[0].paint.get("heatmap-height"),this.x,this.y,this.z,this.projection);if(t<0||t>=ji||A<0||A>=ji)continue;const i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),n=i.vertexLength;ug(this.layoutVertexArray,r[0],r[1],r[2],-1,-1),ug(this.layoutVertexArray,r[0],r[1],r[2],1,-1),ug(this.layoutVertexArray,r[0],r[1],r[2],1,1),ug(this.layoutVertexArray,r[0],r[1],r[2],-1,1),this.indexArray.emplaceBack(n,n+1,n+2),this.indexArray.emplaceBack(n,n+3,n+2),i.vertexLength+=4,i.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,{},r);}}function dg(t,{width:e,height:A},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*A*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*A*r);return t.width=e,t.height=A,t.data=i,t}function fg(t,{width:e,height:A},r){if(e===t.width&&A===t.height)return;const i=dg({},{width:e,height:A},r);yg(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,A)},r),t.width=e,t.height=A,t.data=i.data;}function yg(t,e,A,r,i,n){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||A.x>t.width-i.width||A.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let o=0;o<i.height;o++){const h=((A.y+o)*t.width+A.x)*n,l=((r.y+o)*e.width+r.x)*n;for(let t=0;t<i.width*n;t++)a[l+t]=s[h+t];}return e}Fi("SphereHeatmapBucket",pg,{omit:["layers"]});class gg{constructor(t,e){dg(this,t,1,e);}resize(t){fg(this,t,1);}clone(){return new gg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,A,r,i){yg(t,e,A,r,i,1);}}class mg{constructor(t,e){dg(this,t,4,e);}resize(t){fg(this,t,4);}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t;}clone(){return new mg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,A,r,i){yg(t,e,A,r,i,4);}}Fi("AlphaImage",gg),Fi("RGBAImage",mg);var Bg={paint:new wn({"heatmap-height":new fn(Bt.paint_heatmap["heatmap-height"]),"heatmap-radius":new yn(Bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new fn(Bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bn(Bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new fn(Bt.paint_heatmap["heatmap-opacity"])})};function wg(t){const e={},A=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new mg({width:A,height:r}),n=(A,r,n)=>{e[t.evaluationKey]=n;const s=t.expression.evaluate(e);i.data[A+r+0]=Math.floor(255*s.r/s.a),i.data[A+r+1]=Math.floor(255*s.g/s.a),i.data[A+r+2]=Math.floor(255*s.b/s.a),i.data[A+r+3]=Math.floor(255*s.a);};if(t.clips)for(let e=0,i=0;e<r;++e,i+=4*A)for(let r=0,s=0;r<A;r++,s+=4){const a=r/(A-1),{start:o,end:h}=t.clips[e];n(i,s,o*(1-a)+h*a);}else for(let t=0,e=0;t<A;t++,e+=4)n(0,e,t/(A-1));return i}const xg=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),Cg=Mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Eg=Mn([{name:"a_placed",components:2,type:"Uint8"}],4);Mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const _g=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vg=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function bg(t,e,A){const r=e.layout.get("text-transform").evaluate(A,{});return "uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),zi.applyArabicShaping&&(t=zi.applyArabicShaping(t)),t}function Ug(t,e,A){return t instanceof pe?(t.sections.forEach((t=>{t.text=bg(t.text,e,A);})),t):bg(t,e,A)}function Fg(t){const e={},A={},r=[];let i=0;function n(e){r.push(t[e]),i++;}function s(t,e,i){const n=A[t];return delete A[t],A[e]=n,r[n].geometry[0].pop(),r[n].geometry[0]=r[n].geometry[0].concat(i[0]),n}function a(t,A,i){const n=e[A];return delete e[A],e[t]=n,r[n].geometry[0].shift(),r[n].geometry[0]=i[0].concat(r[n].geometry[0]),n}function o(t,e,A){const r=A?e[0][e[0].length-1]:e[0][0];return `${t}:${r.x}:${r.y}`}for(let h=0;h<t.length;h++){const l=t[h],c=l.geometry,u=l.text instanceof pe?l.text.toString():l.text;if(!u){n(h);continue}const p=o(u,c),d=o(u,c,!0);if(p in A&&d in e&&A[p]!==e[d]){const t=a(p,d,c),i=s(p,d,r[t].geometry);delete e[p],delete A[d],A[o(u,r[i].geometry,!0)]=i,r[t].geometry=null;}else p in A?s(p,d,c):d in e?a(p,d,c):(n(h),e[p]=i-1,A[d]=i-1);}const h=r.filter((t=>t.geometry));return h}Mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Mg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};class Qg extends l{constructor(t,e,A,r){super(t,e),this.angle=A,void 0!==r&&(this.segment=r);}clone(){return new Qg(this.x,this.y,this.angle,this.segment)}}function Ig(t,e){const{expression:A}=e;if("constant"===A.kind)return {functionType:"constant",layoutSize:A.evaluate(new Xi(t+1))};if("source"===A.kind)return {functionType:"source"};{const r=A.zoomStops;let i=0;for(;i<r.length&&r[i]<=t;)i++;i=Math.max(0,i-1);let n=i;for(;n<r.length&&r[n]<t+1;)n++;n=Math.min(r.length-1,n);const s={min:r[i],max:r[n]};return "composite"===A.kind?{functionType:"composite",zoomRange:s,propertyValue:e.value}:{functionType:"camera",layoutSize:A.evaluate(new Xi(t+1)),zoomRange:s,sizeRange:{min:A.evaluate(new Xi(s.min)),max:A.evaluate(new Xi(s.max))},propertyValue:e.value}}}Fi("Anchor",Qg);const Sg=uy.VectorTileFeature.types,Tg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rg(t,e,A,r,i,n,s){t.emplaceBack(e.x,e.y,e.z,Math.round(32*A),Math.round(32*r),i,n,s?s[0]:0,s?s[1]:0);}function Lg(t,e,A,r){t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A);}class Pg{constructor(t){this.layoutVertexArray=new Zn,this.indexArray=new es,this.programConfigurations=t,this.segments=new ys,this.dynamicLayoutVertexArray=new Nn,this.opacityVertexArray=new zn,this.placedSymbolArray=new as;}upload(t,e,A,r){A&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xg.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Cg.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Tg,!0),this.opacityVertexBuffer.itemSize=1),(A||r)&&this.programConfigurations.upload(t);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}Fi("SphereSymbolBuffers",Pg);class Hg{constructor(t,e,A){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new A,this.segments=new ys,this.collisionVertexArray=new qn;}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Eg.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}Fi("SphereCollisionBuffers",Hg);class Og{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasRTLText=!1;const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ig(this.zoom,e["text-size"]),this.iconSizeData=Ig(this.zoom,e["icon-size"]);const A=this.layers[0].layout,r=A.get("symbol-sort-key"),i=A.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&(A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement")),this.sourceID=t.sourceID,this.projection=t.projection||ua.MERCATOR;}createArrays(){this.text=new Pg(new Es(xg.members,this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Pg(new Es(xg.members,this.layers,this.zoom,(t=>/^icon/.test(t)))),this.collisionBox=new Hg(Jn,_g.members,As),this.collisionCircle=new Hg(Jn,vg.members,es),this.glyphOffsetArray=new hs,this.lineVertexArray=new cs;}calculateGlyphDependencies(t,e,A,r){for(let i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,A&&r){const A=Mg[t.charAt(i)];A&&(e[A.charCodeAt(0)]=!0);}}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));const r=this.layers[0],i=r.layout,n=i.get("text-font"),s=i.get("text-field"),a=i.get("icon-image"),o=("constant"!==s.value.kind||s.value.value.toString().length>0)&&("constant"!==n.value.kind||n.value.value.length>0),h="constant"!==a.value.kind||a.value.value&&a.value.value.length>0,l=i.get("symbol-sort-key");if(this.features=[],!o&&!h)return;const c=e.iconDependencies,u=e.glyphDependencies,p=e.availableImages,d=new Xi(this.zoom);for(const{feature:e,index:s,sourceLayerIndex:a}of t){if(!r._featureFilter(d,e,A))continue;let t,f;if(o){const i=r.getValueAndResolveTokens("text-field",e,A,p),n=pe.factory(i);n.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Gi()||this.hasRTLText&&zi.isParsed())&&(t=Ug(n,r,e));}if(h){const t=r.getValueAndResolveTokens("icon-image",e,A,p);f=t instanceof de?t:de.fromString(t);}if(!t&&!f)continue;const y=this.sortFeaturesByKey?l.evaluate(e,{},A):void 0,g={text:t,icon:f,index:s,sourceLayerIndex:a,geometry:bs(e),properties:e.properties,type:Sg[e.type],sortKey:y};if(void 0!==e.id&&(g.id=e.id),this.features.push(g),f&&f instanceof de&&(c[f.name]=!0),t){const A=n.evaluate(e,{}).join(","),r=u[A]=u[A]||{},s="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");if(t instanceof pe)for(const e of t.sections){const r=ne(t.toString()),i=e.fontStack||A,n=u[i]=u[i]||{};this.calculateGlyphDependencies(e.text,n,s,r);}else {const e=ne(t);this.calculateGlyphDependencies(t,r,s,e);}}}"line"===i.get("symbol-placement")&&(this.features=Fg(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey));}update(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(t,e){const A=this.lineVertexArray.length;if(void 0!==t.segment){let A=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const i={};for(let r=t.segment+1;r<e.length;r++)i[r]={x:e[r].x,y:e[r].y,tileUnitDistanceFromAnchor:A},r<e.length-1&&(A+=e[r+1].dist(e[r]));for(let A=t.segment||0;A>=0;A--)i[A]={x:e[A].x,y:e[A].y,tileUnitDistanceFromAnchor:r},A>0&&(r+=e[A-1].dist(e[A]));for(let t=0;t<e.length;t++){const e=i[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor);}}return {lineStartIndex:A,lineLength:this.lineVertexArray.length-A}}addSymbols(t,e,A,r,i,n,s,a,o,h,l){const c=t.indexArray,u=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,d=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),f=this.glyphOffsetArray.length,y=d.vertexLength;for(const t of e){const e=t.tl,r=t.tr,i=t.bl,s=t.br,o=t.tex,h=d.vertexLength,l=t.glyphOffset[1];let f=0;const y=this.layers[0].layout.get("symbol-height-key")||"symbolHeight";n.properties&&n.properties[y]&&(f=n.properties[y]);const g=this.calcTDSpacePoint(a.x,a.y,f);Rg(u,g,e.x,l+e.y,o.x,o.y,A),Rg(u,g,r.x,l+r.y,o.x+o.w,o.y,A),Rg(u,g,i.x,l+i.y,o.x,o.y+o.h,A),Rg(u,g,s.x,l+s.y,o.x+o.w,o.y+o.h,A),Lg(p,a,0,a),c.emplaceBack(h,h+1,h+2),c.emplaceBack(h+1,h+2,h+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(t.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(a.x,a.y,f,this.glyphOffsetArray.length-f,y,o,h,a.segment,A?A[0]:0,A?A[1]:0,r[0],r[1],s,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,n,n.index,{},l);}_addCollisionDebugVertex(t,e,A,r,i){return e.emplaceBack(0,0),t.emplaceBack(A.x,A.y,A.z,r.x,r.y,Math.round(i.x),Math.round(i.y))}addCollisionDebugVertices(t,e,A,r,i,n,s,a){const o=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),h=o.vertexLength,c=i.layoutVertexArray,u=i.collisionVertexArray,p=this.calcTDSpacePoint(n.x,n.y);if(this._addCollisionDebugVertex(c,u,p,s.anchor,new l(t,e)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(A,e)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(A,r)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(t,r)),o.vertexLength+=4,a){const t=i.indexArray;t.emplaceBack(h,h+1,h+2),t.emplaceBack(h,h+2,h+3),o.primitiveLength+=2;}else {const t=i.indexArray;t.emplaceBack(h,h+1),t.emplaceBack(h+1,h+2),t.emplaceBack(h+2,h+3),t.emplaceBack(h+3,h),o.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const t of this.symbolInstances){t.textCollisionFeature={boxStartIndex:t.textBoxStartIndex,boxEndIndex:t.textBoxEndIndex},t.iconCollisionFeature={boxStartIndex:t.iconBoxStartIndex,boxEndIndex:t.iconBoxEndIndex};for(let e=0;e<2;e++){const A=t[0===e?"textCollisionFeature":"iconCollisionFeature"];if(A)for(let e=A.boxStartIndex;e<A.boxEndIndex;e++){const A=this.collisionBoxArray.get(e),r=A.radius>0;this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,r?this.collisionCircle:this.collisionBox,A.anchorPoint,t,r);}}}}deserializeCollisionBoxes(t,e,A,r,i){const n={};for(let r=e;r<A;r++){const e=t.get(r);if(0===e.radius){n.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},n.textFeatureIndex=e.featureIndex;break}n.textCircles||(n.textCircles=[],n.textFeatureIndex=e.featureIndex),n.textCircles.push(e.anchorPointX,e.anchorPointY,e.radius,e.signedDistanceFromAnchor,1);}for(let e=r;e<i;e++){const A=t.get(e);if(0===A.radius){n.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},n.iconFeatureIndex=A.featureIndex;break}}return n}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(t){if(!this.sortFeaturesByY)return;if(this.sortedAngle===t)return;if(this.sortedAngle=t,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const e=[];for(let t=0;t<this.symbolInstances.length;t++)e.push(t);const A=Math.sin(t),r=Math.cos(t);e.sort(((t,e)=>{const i=this.symbolInstances[t],n=this.symbolInstances[e];return (0|Math.round(A*i.anchor.x+r*i.anchor.y))-(0|Math.round(A*n.anchor.x+r*n.anchor.y))||n.featureIndex-i.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of e){const e=this.symbolInstances[t];this.featureSortOrder.push(e.featureIndex);for(const t of e.placedTextSymbolIndices){const e=this.text.placedSymbolArray.get(t),A=e.vertexStartIndex+4*e.numGlyphs;for(let t=e.vertexStartIndex;t<A;t+=4)this.text.indexArray.emplaceBack(t,t+1,t+2),this.text.indexArray.emplaceBack(t+1,t+2,t+3);}const A=this.icon.placedSymbolArray.get(t);if(A.numGlyphs){const t=A.vertexStartIndex;this.icon.indexArray.emplaceBack(t,t+1,t+2),this.icon.indexArray.emplaceBack(t+1,t+2,t+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(t,e,A){const r=Lf([],Of(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),$.TRANSFORM.R+A);return new l(r[0]-this.tilePlane.out1[0],r[1]-this.tilePlane.out1[1],r[2]-this.tilePlane.out1[2])}}function Dg(t,e){return e.replace(/{([^{}]+)}/g,((e,A)=>A in t?String(t[A]):""))}Fi("SphereSymbolBucket",Og,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),Og.MAX_GLYPHS=65535,Og.addDynamicAttributes=Lg;const Ng=new wn({"symbol-placement":new fn(Bt.layout_symbol["symbol-placement"]),"symbol-spacing":new fn(Bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new fn(Bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new fn(Bt.layout_symbol["symbol-z-order"]),"symbol-height-key":new fn(Bt.layout_symbol["symbol-height-key"]),"icon-allow-overlap":new fn(Bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new fn(Bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new fn(Bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new fn(Bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Bt.layout_symbol["icon-size"]),"icon-text-fit":new fn(Bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fn(Bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Bt.layout_symbol["icon-image"]),"icon-rotate":new yn(Bt.layout_symbol["icon-rotate"]),"icon-padding":new fn(Bt.layout_symbol["icon-padding"]),"icon-keep-upright":new fn(Bt.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Bt.layout_symbol["icon-offset"]),"icon-anchor":new yn(Bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new fn(Bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new fn(Bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new fn(Bt.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Bt.layout_symbol["text-field"]),"text-font":new yn(Bt.layout_symbol["text-font"]),"text-size":new yn(Bt.layout_symbol["text-size"]),"text-max-width":new yn(Bt.layout_symbol["text-max-width"]),"text-line-height":new fn(Bt.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Bt.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Bt.layout_symbol["text-justify"]),"text-anchor":new yn(Bt.layout_symbol["text-anchor"]),"text-max-angle":new fn(Bt.layout_symbol["text-max-angle"]),"text-rotate":new yn(Bt.layout_symbol["text-rotate"]),"text-padding":new fn(Bt.layout_symbol["text-padding"]),"text-keep-upright":new fn(Bt.layout_symbol["text-keep-upright"]),"text-transform":new yn(Bt.layout_symbol["text-transform"]),"text-offset":new yn(Bt.layout_symbol["text-offset"]),"text-allow-overlap":new fn(Bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new fn(Bt.layout_symbol["text-ignore-placement"]),"text-optional":new fn(Bt.layout_symbol["text-optional"])});var kg={paint:new wn({"icon-opacity":new yn(Bt.paint_symbol["icon-opacity"]),"icon-color":new yn(Bt.paint_symbol["icon-color"]),"icon-halo-color":new yn(Bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Bt.paint_symbol["icon-halo-blur"]),"icon-translate":new fn(Bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new fn(Bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(Bt.paint_symbol["text-opacity"]),"text-color":new yn(Bt.paint_symbol["text-color"]),"text-halo-color":new yn(Bt.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Bt.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Bt.paint_symbol["text-halo-blur"]),"text-translate":new fn(Bt.paint_symbol["text-translate"]),"text-translate-anchor":new fn(Bt.paint_symbol["text-translate-anchor"])}),layout:Ng};const Vg=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_ed",components:3,type:"Float32"},{name:"a_st",components:3,type:"Float32"}],4),{members:Gg}=Vg,Kg=[-.34150977713679326,.6888828294625937,.6393837027885438];function zg(t,e,A,r,i,n,s,a,o,h){t.emplaceBack(e,A,r,i,n,s,a,o,h);}class Xg{constructor(t,e){this.featureTrangles=[],this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Pn,this.indexArray=new es,this.programConfigurations=new Es(Gg,t.layers,t.zoom),this.segments=new ys,this.projection=t.projection||ua.MERCATOR,this.enableQuery=e;}populate(t,e,A){this.x=e.x,this.y=e.y,this.z=e.z;for(const{feature:e,index:r}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),e,A)){const t=bs(e),i=[];this.addFeature(e,t,r,i,A),this.enableQuery&&this.featureTrangles.push({feature:e.toGeoJSON(this.x,this.y,this.z),triangles:i});}this.baseP&&(this.matrix=Vf(0,this.baseP));}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gg),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r,i){let n=0;const s=this.layers[0].paint.get("extrusion-height"),a=this.layers[0].paint.get("extrusion-base"),o=this.layers[0].paint.get("extrusion-pattern-factor"),h=a.evaluate(t,{},i)||0;n=s.evaluate(t,{},i)||0;for(const A of na(e,500)){let e=0;for(const t of A)e+=t.length;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of A)if(0!==t.length&&!oa(t))for(let e=0;e<t.length;e++){const A=t[e];if(e>=1){const s=t[e-1];if(la(A,s))continue;if(!aa(A,s)){i.vertexLength+4>ys.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=Hf(A.x,A.y,h,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=t);const e=Hf(A.x,A.y,n,this.x,this.y,this.z,this.projection),a=Hf(s.x,s.y,h,this.x,this.y,this.z,this.projection),l=Hf(s.x,s.y,n,this.x,this.y,this.z,this.projection),c=this.baseP,u=new nh;u.subVectors(e,t);const p=new nh;p.subVectors(a,t);const d=p.cross(u);if(o){zg(this.layoutVertexArray,t[0]-c[0],t[1]-c[1],t[2]-c[2],d[0],d[1],d[2],0,h/5*o[1],0),zg(this.layoutVertexArray,e[0]-c[0],e[1]-c[1],e[2]-c[2],d[0],d[1],d[2],0,n/5*o[1],0);const A=new nh(a).distance(t)*o[0];zg(this.layoutVertexArray,a[0]-c[0],a[1]-c[1],a[2]-c[2],d[0],d[1],d[2],A,h/5*o[1],0),zg(this.layoutVertexArray,l[0]-c[0],l[1]-c[1],l[2]-c[2],d[0],d[1],d[2],A,n/5*o[1],0);}else {zg(this.layoutVertexArray,t[0]-c[0],t[1]-c[1],t[2]-c[2],d[0],d[1],d[2],0,h/5,0),zg(this.layoutVertexArray,e[0]-c[0],e[1]-c[1],e[2]-c[2],d[0],d[1],d[2],0,n/5,0);const A=20*new nh(a).distance(t);zg(this.layoutVertexArray,a[0]-c[0],a[1]-c[1],a[2]-c[2],d[0],d[1],d[2],A,h/5,0),zg(this.layoutVertexArray,l[0]-c[0],l[1]-c[1],l[2]-c[2],d[0],d[1],d[2],A,n/5,0);}const f=i.vertexLength;this.indexArray.emplaceBack(f,f+2,f+1),this.indexArray.emplaceBack(f+1,f+2,f+3),r.push([t,e,a],[e,a,l]),i.vertexLength+=4,i.primitiveLength+=2;}}}if(i.vertexLength+e>ys.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==uy.VectorTileFeature.types[t.type])continue;const s=[],a=[],l=i.vertexLength,c=[];for(const t of A){if(0===t.length)continue;t!==A[0]&&a.push(s.length/2);const e=ca(A);for(let A=0;A<t.length;A++){const r=t[A],i=[(r.x-e.minX)/e.maxLength,(r.y-e.minY)/e.maxLength],a=Hf(r.x,r.y,n,this.x,this.y,this.z,this.projection);c.push(a),this.baseP||(this.baseP=a),zg(this.layoutVertexArray,a[0]-this.baseP[0],a[1]-this.baseP[1],a[2]-this.baseP[2],Kg[0],Kg[1],Kg[2],i[0],i[1],1),s.push(r.x),s.push(r.y);}}const u=Us(s,a);for(let t=0;t<u.length;t+=3)this.indexArray.emplaceBack(l+u[t],l+u[t+2],l+u[t+1]),r.push([c[u[t]],c[u[t+1]],c[u[t+2]]]);i.primitiveLength+=u.length/3,i.vertexLength+=e;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,{},i);}}Fi("SphereExtrusionBucket",Xg,{omit:["layers"]});var qg={paint:new wn({"extrusion-opacity":new yn(Bt.paint_extrusion["extrusion-opacity"]),"extrusion-color":new yn(Bt.paint_extrusion["extrusion-color"]),"extrusion-translate":new fn(Bt.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new fn(Bt.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new mn(Bt.paint_extrusion["extrusion-pattern"]),"extrusion-top-pattern":new mn(Bt.paint_extrusion["extrusion-top-pattern"]),"extrusion-height":new yn(Bt.paint_extrusion["extrusion-height"]),"extrusion-base":new yn(Bt.paint_extrusion["extrusion-base"]),"extrusion-pattern-factor":new fn(Bt.paint_extrusion["extrusion-pattern-factor"]),"extrusion-close-stencil-clip":new fn(Bt.paint_extrusion["extrusion-close-stencil-clip"]),"extrusion-self-bloom":new fn(Bt.paint_extrusion["extrusion-self-bloom"]),"extrusion-bloom-height":new fn(Bt.paint_extrusion["extrusion-bloom-height"]),"extrusion-glow-pure-color-height":new fn(Bt.paint_extrusion["extrusion-glow-pure-color-height"]),"extrusion-glow-width":new fn(Bt.paint_extrusion["extrusion-glow-width"]),"extrusion-glow-speed":new fn(Bt.paint_extrusion["extrusion-glow-speed"])})};const jg=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4),{members:Yg}=jg,Wg=uy.VectorTileFeature.types,Zg=Math.cos(Math.PI/180*37.5),Jg=Math.pow(2,14)/.5;function $g(t,e,A,r,i,n,s,a){t.emplaceBack(e.x,e.y,e.z,r?1:0,i?1:-1,Math.round(63*A.x)+128,Math.round(63*A.y)+128,1+(0===n?0:n<0?-1:1)|(.5*s&63)<<2,.5*s>>6,a);}class tm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new kn,this.indexArray=new es,this.programConfigurations=new Es(Yg,t.layers,t.zoom),this.segments=new ys,this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));for(const{feature:r,index:i,sourceLayerIndex:n}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),r,A)){const t=bs(r);this.addFeature(r,t,i,A),e.featureIndex.insert(r,t,i,n,this.index);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yg),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r){const i=this.layers[0].layout,n=i.get("tracking-join").evaluate(t,{}),s=i.get("tracking-cap"),a=i.get("tracking-miter-limit"),o=i.get("tracking-round-limit"),h=Number(t.properties.link_seq);for(const i of e)this.addLine(i,t,n,s,a,o,A,h,r);}addLine(t,e,A,r,i,n,s,a,o){const h="Polygon"===Wg[e.type];let l=t.length;for(;l>=2&&t[l-1].equals(t[l-2]);)l--;let c=0;for(;c<l-1&&t[c].equals(t[c+1]);)c++;if(l<(h?3:2))return;"bevel"===A&&(i=1.05);const u=ji/(512*this.overscaling)*15,p=t[c],d=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);this.distance=0;const f=r,y=h?"butt":r;let g,m,B,w,x,C,E,_=!0;this.e1=this.e2=this.e3=-1,h&&(g=t[l-2],x=p.sub(g)._unit()._perp());for(let e=c;e<l;e++){if(a+=1,B=h&&e===l-1?t[c+1]:t[e+1],B&&t[e].equals(B))continue;x&&(w=x),g&&(m=g),g=t[e],x=B?B.sub(g)._unit()._perp():w,w=w||x;let r=w.add(x);0===r.x&&0===r.y||r._unit();const s=r.x*x.x+r.y*x.y,o=0!==s?1/s:1/0,p=s<Zg&&m&&B;if(p&&e>c){const t=g.dist(m);if(t>2*u){const e=g.sub(g.sub(m)._mult(u/t)._round());this.distance+=e.dist(m),this.addCurrentVertex(e,this.distance,w.mult(1),0,0,!1,d,a),m=e;}}const v=m&&B;let b=v?A:B?f:y;if(v&&"round"===b&&(o<n?b="miter":o<=2&&(b="fakeround")),"miter"===b&&o>i&&(b="bevel"),"bevel"===b&&(o>2&&(b="flipbevel"),o<i&&(b="miter")),m&&(this.distance+=g.dist(m)),"miter"===b)r._mult(o),this.addCurrentVertex(g,this.distance,r,0,0,!1,d,a);else if("flipbevel"===b){if(o>100)r=x.clone().mult(-1);else {const t=w.x*x.y-w.y*x.x>0?-1:1,e=o*w.add(x).mag()/w.sub(x).mag();r._perp()._mult(e*t);}this.addCurrentVertex(g,this.distance,r,0,0,!1,d,a),this.addCurrentVertex(g,this.distance,r.mult(-1),0,0,!1,d,a);}else if("bevel"===b||"fakeround"===b){const t=w.x*x.y-w.y*x.x>0,e=-Math.sqrt(o*o-1);if(t?(E=0,C=e):(C=0,E=e),_||this.addCurrentVertex(g,this.distance,w,C,E,!1,d,a),"fakeround"===b){const e=Math.floor(8*(.5-(s-.5)));let A;for(let r=0;r<e;r++)A=x.mult((r+1)/(e+1))._add(w)._unit(),this.addPieSliceVertex(g,this.distance,A,t,d,a);this.addPieSliceVertex(g,this.distance,r,t,d,a);for(let r=e-1;r>=0;r--)A=w.mult((r+1)/(e+1))._add(x)._unit(),this.addPieSliceVertex(g,this.distance,A,t,d,a);}B&&this.addCurrentVertex(g,this.distance,x,-C,-E,!1,d,a);}else "butt"===b?(_||this.addCurrentVertex(g,this.distance,w,0,0,!1,d,a),B&&this.addCurrentVertex(g,this.distance,x,0,0,!1,d,a)):"square"===b?(_||(this.addCurrentVertex(g,this.distance,w,1,1,!1,d,a),this.e1=this.e2=-1),B&&this.addCurrentVertex(g,this.distance,x,-1,-1,!1,d,a)):"round"===b&&(_||(this.addCurrentVertex(g,this.distance,w,0,0,!1,d,a),this.addCurrentVertex(g,this.distance,w,1,1,!0,d,a),this.e1=this.e2=-1),B&&(this.addCurrentVertex(g,this.distance,x,-1,-1,!0,d,a),this.addCurrentVertex(g,this.distance,x,0,0,!1,d,a)));if(p&&e<l-1){const t=g.dist(B);if(t>2*u){const e=g.add(B.sub(g)._mult(u/t)._round());this.distance+=e.dist(g),this.addCurrentVertex(e,this.distance,x.mult(1),0,0,!1,d,a),g=e;}}_=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},o);}calcTDSpacePoint(t){const e=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])}addCurrentVertex(t,e,A,r,i,n,s,a){let o;const h=this.layoutVertexArray,l=this.indexArray;o=A.clone(),r&&o._sub(A.perp()._mult(r));const c=this.calcTDSpacePoint(t);$g(h,c,o,n,!1,r,e,a),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,o=A.mult(-1),i&&o._sub(A.perp()._mult(i)),$g(h,c,o,n,!0,-i,e,a),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Jg/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,A,r,i,n,s,a));}addPieSliceVertex(t,e,A,r,i,n){A=A.mult(r?-1:1);const s=this.indexArray;$g(this.layoutVertexArray,this.calcTDSpacePoint(t),A,!1,r,0,e,n),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;}}Fi("SphereTrackingBucket",tm,{omit:["layers"]});const em=new wn({"tracking-cap":new fn(Bt.layout_tracking["tracking-cap"]),"tracking-join":new yn(Bt.layout_tracking["tracking-join"]),"tracking-miter-limit":new fn(Bt.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new fn(Bt.layout_tracking["tracking-round-limit"]),"tracking-sort-key":new yn(Bt.layout_tracking["tracking-sort-key"]),"tracking-display-mode":new fn(Bt.layout_tracking["tracking-display-mode"])});var Am={paint:new wn({"tracking-opacity":new yn(Bt.paint_tracking["tracking-opacity"]),"tracking-color":new yn(Bt.paint_tracking["tracking-color"]),"tracking-translate":new fn(Bt.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new fn(Bt.paint_tracking["tracking-translate-anchor"]),"tracking-width":new yn(Bt.paint_tracking["tracking-width"]),"tracking-gap-width":new yn(Bt.paint_tracking["tracking-gap-width"]),"tracking-offset":new yn(Bt.paint_tracking["tracking-offset"]),"tracking-blur":new yn(Bt.paint_tracking["tracking-blur"]),"tracking-type":new fn(Bt.paint_tracking["tracking-type"]),"tracking-run-time":new fn(Bt.paint_tracking["tracking-run-time"]),"tracking-seg-count":new fn(Bt.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new fn(Bt.paint_tracking["tracking-seg-group"]),"tracking-speed":new fn(Bt.paint_tracking["tracking-speed"]),"tracking-delay":new fn(Bt.paint_tracking["tracking-delay"]),"tracking-speed-factor":new fn(Bt.paint_tracking["tracking-speed-factor"])}),layout:em};const rm=new class extends yn{possiblyEvaluate(t,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,A,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,A,r)}}(Am.paint.properties["tracking-width"].specification);function im(t,e){return e>0?e+2*t:t}rm.useIntegerZoom=!0;var nm={paint:new wn({"3d-model-opacity":new fn(Bt["paint_3d-model"]["3d-model-opacity"])})};class sm{constructor(t,e,A){this.func=t,this.mask=e,this.range=A;}}sm.ReadOnly=!1,sm.ReadWrite=!0,sm.ALWAYS=519,sm.disabled=new sm(519,sm.ReadOnly,[0,1]);const am=7680;class om{constructor(t,e,A,r,i,n){this.test=t,this.ref=e,this.mask=A,this.fail=r,this.depthFail=i,this.pass=n;}}om.disabled=new om({func:519,mask:0},0,0,am,am,am),om.enableClipGround=new om({func:519,mask:255},1,255,am,am,7681),om.openClipGround=new om({func:517,mask:255},1,0,am,am,am);var hm=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047});class lm{constructor(t,e,A){this.blendFunction=t,this.blendColor=e,this.mask=A;}}lm.Replace=[1,0],lm.disabled=new lm(lm.Replace,ee.transparent,[!1,!1,!1,!1]),lm.unblended=new lm(lm.Replace,ee.transparent,[!0,!0,!0,!0]),lm.alphaBlended=new lm([1,771],ee.transparent,[!0,!0,!0,!0]),lm.srcAvgBlended=new lm([hm.SRC_ALPHA,hm.ONE_MINUS_SRC_ALPHA],ee.transparent,[!0,!0,!0,!0]),lm.alphaAvgBlended=new lm([hm.ONE_MINUS_DST_ALPHA,hm.DST_ALPHA],ee.transparent,[!0,!0,!0,!0]),lm.colorAvgBlended=new lm([hm.SRC_COLOR,hm.DST_COLOR],ee.transparent,[!0,!0,!0,!0]);const cm=1029;class um{constructor(t,e,A){this.enable=t,this.mode=e,this.frontFace=A;}}um.disabled=new um(!1,cm,2305),um.backCCW=new um(!0,cm,2305),um.backCW=new um(!0,cm,2304);const pm={ALPHA:$.COLORTYPEANDLENGTH.ALPHA,RGB:$.COLORTYPEANDLENGTH.RGB,RGBA:$.COLORTYPEANDLENGTH.RGBA,LUMINANCE:$.COLORTYPEANDLENGTH.LUMINANCE,LUMINANCE_ALPHA:$.COLORTYPEANDLENGTH.LUMINANCE_ALPHA,RGB_DXT1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:$.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_ETC1_WEBGL,isCompressedFormat(t){let e;return e=Array.isArray(t)&&t.length>0?t[0].format:t.format||"",e===pm.RGB_DXT1||e===pm.RGBA_DXT1||e===pm.RGBA_DXT3||e===pm.RGBA_DXT5||e===pm.RGB_PVRTC_4BPPV1||e===pm.RGB_PVRTC_2BPPV1||e===pm.RGBA_PVRTC_4BPPV1||e===pm.RGBA_PVRTC_2BPPV1||e===pm.RGB_ETC1},isDXTFormat:t=>t===pm.RGB_DXT1||t===pm.RGBA_DXT1||t===pm.RGBA_DXT3||t===pm.RGBA_DXT5,isPVRTCFormat:t=>t===pm.RGB_PVRTC_4BPPV1||t===pm.RGB_PVRTC_2BPPV1||t===pm.RGBA_PVRTC_4BPPV1||t===pm.RGBA_PVRTC_2BPPV1,isETC1Format:t=>t===pm.RGB_ETC1,compressedTextureSizeInBytes(t,e,A){switch(t){case pm.RGB_DXT1:case pm.RGBA_DXT1:case pm.RGB_ETC1:return Math.floor((e+3)/4)*Math.floor((A+3)/4)*8;case pm.RGBA_DXT3:case pm.RGBA_DXT5:return Math.floor((e+3)/4)*Math.floor((A+3)/4)*16;case pm.RGB_PVRTC_4BPPV1:case pm.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(e,8)*Math.max(A,8)*4+7)/8);case pm.RGB_PVRTC_2BPPV1:case pm.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(e,16)*Math.max(A,8)*2+7)/8);default:return 0}},componentsLength(t){switch(t){case pm.RGB:return 3;case pm.RGBA:return 4;case pm.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes(t,e,A,r){let i=pm.componentsLength(t);return pm.isPacked(e)&&(i=1),i*pm.sizeInBytes(e)*A*r},sizeInBytes(t){switch(t){case $.PixelDatatype.UNSIGNED_BYTE:return 1;case $.PixelDatatype.UNSIGNED_SHORT:case $.PixelDatatype.UNSIGNED_SHORT_4_4_4_4:case $.PixelDatatype.UNSIGNED_SHORT_5_5_5_1:case $.PixelDatatype.UNSIGNED_SHORT_5_6_5:case $.PixelDatatype.HALF_FLOAT:return 2;case $.PixelDatatype.UNSIGNED_INT:case $.PixelDatatype.FLOAT:case $.PixelDatatype.UNSIGNED_INT_24_8:return 4}},isPacked:t=>t===$.PixelDatatype.UNSIGNED_INT_24_8||t===$.PixelDatatype.UNSIGNED_SHORT_4_4_4_4||t===$.PixelDatatype.UNSIGNED_SHORT_5_5_5_1||t===$.PixelDatatype.UNSIGNED_SHORT_5_6_5},{HTMLImageElement:dm,HTMLCanvasElement:fm,HTMLVideoElement:ym,ImageData:gm,ImageBitmap:mm}=A;class Bm{constructor(t,e,A,r,i){this.mIsGenerateMipmap=!1,r&&r.TexUrl&&(this.mTexUrl=r.TexUrl),this.referenceCount=1,this.name=i||"",this.context=t,this.format=A,this.texture=t.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!r||!r.flipY),r&&r.compressed?(this.compressed=r.compressed,e={data:e[0].data,width:e[0].width,height:e[0].height},pm.isDXTFormat(A)&&!t._s3tc?T("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc."):pm.isPVRTCFormat(A)&&!t._pvrtc?T("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc."):pm.isETC1Format(A)&&!t._etc1&&T("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.")):this.compressed=!1,this.update(e,r);}update(t,e){const{width:A,height:r}=t,i=!this.size||this.size[0]!==A||this.size[1]!==r,{context:n}=this,{gl:s}=n;this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),n.pixelStoreUnpackFlipY.set(this.flipY),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),i?(this.size=[A,r],this.compressed?s.compressedTexImage2D(s.TEXTURE_2D,0,this.format,A,r,0,t.data):(this.format!==s.RGBA||e&&!1===e.premultiply||n.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof dm||t instanceof fm||t instanceof ym||t instanceof gm||mm&&t instanceof mm?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,A,r,0,this.format,s.UNSIGNED_BYTE,t.data))):t instanceof dm||t instanceof fm||t instanceof ym||t instanceof gm||mm&&t instanceof mm?s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,0,0,A,r,s.RGBA,s.UNSIGNED_BYTE,t.data),i&&(this._powerOfTwoCalculated=!1),this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?(s.generateMipmap(s.TEXTURE_2D),this.mIsGenerateMipmap=!0):this.mIsGenerateMipmap=!1;}bind(t,e){const{context:A}=this,{gl:r}=A;let i;r.bindTexture(r.TEXTURE_2D,this.texture),i=this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?r.LINEAR_MIPMAP_NEAREST:r.LINEAR,t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),this.filter=t),e!==this.wrap&&(e!==r.CLAMP_TO_EDGE&&this.isSizePowerOfTwoNoneSquare()?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.wrap=r.CLAMP_TO_EDGE));}addReference(){this.referenceCount+=1;}upload(t){const{context:e}=this,{gl:A}=e;this.size=[t.width,t.height],A.deleteTexture(this.texture),this.texture=A.createTexture(),A.bindTexture(A.TEXTURE_2D,this.texture),this.compressed?A.compressedTexImage2D(A.TEXTURE_2D,0,this.format,t.width,t.height,0,t.data):t instanceof dm||t instanceof fm||t instanceof ym||t instanceof gm||mm&&t instanceof mm?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,this.size[0],this.size[1],0,this.format,A.UNSIGNED_BYTE,t.data);}freeForce(){if(this.context&&(this.referenceCount=0,0===this.referenceCount)){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null,this.context=null;}}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}isSizePowerOfTwoNoneSquare(){return this._powerOfTwoCalculated?this.powerOfTwoNoneSquareFlag:!!this.size&&(this._powerOfTwoCalculated=!0,this.powerOfTwoNoneSquareFlag=Math.log(this.size[0])/Math.LN2%1==0&&Math.log(this.size[1])/Math.LN2%1==0,this.powerOfTwoNoneSquareFlag)}destroy(){if(this.context&&(this.referenceCount-=1,0===this.referenceCount)){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null,this.context=null;}}}var wm=e((function(t,e){t.exports={autobind:function(t){for(const e of Object.getOwnPropertyNames(t.constructor.prototype)){const A=t[e];"constructor"!==e&&"function"==typeof A&&(t[e]=A.bind(t));}return t}};}));class xm{constructor(){}static getTexture(t,e,A,r,i){const n=xm.texMap.get(t);if(n)return n.addReference(),n;{const n=new Bm(e,A,r,i,t);return t&&""!=t&&xm.texMap.set(t,n),n}}static freeTexture(t){const e=xm.texMap.get(t);e&&(e.destroy(),0===e.referenceCount&&xm.texMap.delete(t));}}xm.texMap=new Map;const Cm="undefined"!=typeof __VERSION__?__VERSION__:"latest",Em={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},_m=Em.global||Em.self||Em.window,vm="object"!=typeof process||"[object process]"!==String(process)||process.browser,bm="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);bm&&parseFloat(bm[1]);const{_parseImageNode:Um}=_m,Fm="undefined"!=typeof Image,Mm="undefined"!=typeof ImageBitmap,Qm=Boolean(Um),Im=!!vm||Qm;const Sm=/^data:image\/svg\+xml/,Tm=/\.svg((\?|#).*)?$/;function Rm(t){return t&&(Sm.test(t)||Tm.test(t))}function Lm(t,e){if(Rm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Pm(t,e,A){const r=function(t,e){if(Rm(e)){const e=(new TextDecoder).decode(t);return `data:image/svg+xml;base64,${btoa(e)}`}return Lm(t,e)}(t,A),i=self.URL||self.webkitURL,n="string"!=typeof r&&i.createObjectURL(r);try{return await async function(t,e){const A=new Image;return A.src=t,e.image&&e.image.decode&&A.decode?(await A.decode(),A):await new Promise(((e,r)=>{try{A.onload=()=>e(A),A.onerror=e=>r(new Error(`Could not load image ${t}: ${e}`));}catch(t){r(t);}}))}(n||r,e)}finally{n&&i.revokeObjectURL(n);}}const Hm={};let Om=!0;const Dm=!1,Nm=!0;function km(t){const e=Vm(t),A=function(t){const e=Vm(t);return e.byteLength>=24&&2303741511===e.getUint32(0,Dm)?{mimeType:"image/png",width:e.getUint32(16,Dm),height:e.getUint32(20,Dm)}:null}(e)||function(t){const e=Vm(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,Dm)&&255===e.getUint8(2)))return null;const{tableMarkers:A,sofMarkers:r}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return {tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let i=2;for(;i+9<e.byteLength;){const t=e.getUint16(i,Dm);if(r.has(t))return {mimeType:"image/jpeg",height:e.getUint16(i+5,Dm),width:e.getUint16(i+7,Dm)};if(!A.has(t))return null;i+=2,i+=e.getUint16(i,Dm);}return null}(e)||function(t){const e=Vm(t);return e.byteLength>=10&&1195984440===e.getUint32(0,Dm)?{mimeType:"image/gif",width:e.getUint16(6,Nm),height:e.getUint16(8,Nm)}:null}(e)||function(t){const e=Vm(t);return e.byteLength>=14&&16973===e.getUint16(0,Dm)&&e.getUint32(2,Nm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Nm),height:e.getUint32(22,Nm)}:null}(e);if(!A)throw new Error('存在无法解析的纹理图片格式，模型纹理图片格式必须是下述格式之一"png、jpeg、bmp"');return A}function Vm(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const Gm={name:"Images",id:"image",module:"images",version:Cm,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,A){const r=((e=e||{}).image||{}).type||"auto",{url:i}=A||{};let n;switch(function(t){switch(t){case"auto":case"data":return function(){if(Mm)return "imagebitmap";if(Fm)return "image";if(Im)return "data";throw new Error("Install '@mm-loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return Mm||Fm||Im;case"imagebitmap":return Mm;case"image":case"html":return Fm;case"data":case"ndarray":return Im;default:throw new Error(`@mm-loaders.gl/images: image ${t} not supported in this environment`)}}(t),t}}(r)){case"imagebitmap":n=await async function(t,e,A){let r;r=Rm(A)?await Pm(t,e,A):Lm(t,A);const i=e&&e.imagebitmap;return await async function(t,e=null){if(!function(t){for(const e in t||Hm)return !1;return !0}(e)&&Om||(e=null),e)try{return await createImageBitmap(t,e)}catch(t){Om=!1;}return await createImageBitmap(t)}(r,i)}(t,e,i);break;case"image":n=await Pm(t,e,i);break;case"data":n=await function(t,e){const{mimeType:A}=km(t)||{},{_parseImageNode:r}=_m;return r(t,A,e)}(t,e);}return "data"===r&&(n=function(t){switch(function(t){const e=function(t){return "undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),A=e.getContext("2d");if(A)return e.width=t.width,e.height=t.height,A.drawImage(t,0,0),A.getImageData(0,0,t.width,t.height);default:return function(t,e){throw new Error(void 0)}()}}(n)),n},tests:[t=>Boolean(km(new DataView(t)))],options:{image:{type:"auto",decode:!0}}};function Km(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const zm={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Xm=zm.global||zm.self||zm.window,qm="object"!=typeof process||"[object process]"!==String(process)||process.browser,jm="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),Ym=jm&&parseFloat(jm[1])||0,Wm={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Zm=Wm.global||Wm.self||Wm.window,Jm="object"!=typeof process||"[object process]"!==String(process)||process.browser,$m="function"==typeof importScripts,tB="undefined"!=typeof window&&void 0!==window.orientation,eB="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);eB&&parseFloat(eB[1]);const AB=new Map;function rB(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function iB(t,e=!0,A){const r=A||new Set;if(t)if(nB(t))r.add(t);else if(nB(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const A in t)iB(t[A],e,r);return void 0===A?Array.from(r):[]}function nB(t){return !!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}const sB=t=>{};class aB{static isSupported(){return "undefined"!=typeof Worker}constructor(t){const{name:e,source:A,url:r}=t;this.name=e,this.source=A,this.url=r,this.onMessage=sB,this.onError=t=>{console.log(t);},this.terminated=!1,this.worker=this._createBrowserWorker();}destroy(){this.onMessage=sB,this.onError=sB,this.worker.terminate(),this.terminated=!0;}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||iB(t),this.worker.postMessage(t,e);}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=function({source:t,url:e}){let A=AB.get(t||e);return A||(e&&(A=function(t){return t.startsWith("http")?rB(`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):t}(e),AB.set(e,A)),t&&(A=rB(t),AB.set(t,A))),A}({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError("No data received");},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0;},t.onmessageerror=t=>{console.error(t);},t}}class oB{constructor(t,e){this.name=t,this.workerThread=e,this.isRunning=!0,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e;}));}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e});}done(t){this.isRunning=!1,this._resolve(t);}error(t){this.isRunning=!1,this._reject(t);}}class hB{constructor({source:t,url:e,name:A="unnamed",maxConcurrency:r=1,onMessage:i,onDebug:n=(()=>{}),reuseWorkers:s=!0}){this.source=t,this.url=e,this.name=A,this.maxConcurrency=r,this.onMessage=i,this.onDebug=n,this.reuseWorkers=s,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1;}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0;}async startJob(t,e=((t,e,A)=>t.done(A)),A=((t,e)=>t.error(e))){const r=new Promise((r=>{this.jobQueue.push({name:t,onMessage:e,onError:A,onStart:r});}));return this._startQueuedJob(),r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",jobName:e.name,workerThread:t,backlog:this.jobQueue.length});const A=new oB(e.name,t);t.onMessage=t=>e.onMessage(A,t.type,t.payload),t.onError=t=>e.onError(A,t),e.onStart(A);try{await A.result;}finally{this.returnWorkerToQueue(t);}}}returnWorkerToQueue(t){this.isDestroyed?t.destroy():(this.reuseWorkers?this.idleQueue.push(t):(t.destroy(),this.count--),this._startQueuedJob());}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.maxConcurrency){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new aB({name:t,source:this.source,url:this.url})}return null}}const lB={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};let cB=null;class uB{static isSupported(){return aB.isSupported()}static getWorkerFarm(t={}){return cB=cB||new uB({}),cB.setProps(t),cB}constructor(t){this.props={...lB},this.setProps(t),this.workerPools=new Map;}destroy(){this.workerPools.forEach((t=>t.destroy()));}setProps(t){this.props={...this.props,...t};}getWorkerPool({name:t,source:e,url:A}){let r=this.workerPools.get(t);return r||(r=new hB({name:t,source:e,url:A,maxConcurrency:tB?this.props.maxMobileConcurrency:this.props.maxConcurrency,onDebug:this.props.onDebug,reuseWorkers:this.props.reuseWorkers}),this.workerPools.set(t,r)),r}}const pB="undefined"!=typeof __VERSION__?__VERSION__:"beta";function dB(t){const e=t.split(".").map(Number);return {major:e[0],minor:e[1]}}const fB=new Map;class yB{static set onmessage(t){self.onmessage=e=>{if(!gB(e))return;const{type:A,payload:r}=e.data;t(A,r);};}static addEventListener(t){let e=fB.get(t);e||(e=e=>{if(!gB(e))return;const{type:A,payload:r}=e.data;t(A,r);}),self.addEventListener("message",e);}static removeEventListener(t){const e=fB.get(t);fB.delete(t),self.removeEventListener("message",e);}static postMessage(t,e){if(self){const A={source:"loaders.gl",type:t,payload:e},r=iB(e);self.postMessage(A,r);}}}function gB(t){const{type:e,data:A}=t;return "message"===e&&A&&"string"==typeof A.source&&A.source.startsWith("loaders.gl")}"undefined"==typeof __VERSION__||__VERSION__;const mB={};async function BB(t,e=null,A={}){return e&&(t=function(t,e,A){if(t.startsWith("http"))return t;const r=A.modules||{};return r[t]?r[t]:Jm?A.CDN?`${A.CDN}/${e}/dist/libs/${t}`:$m?`../src/libs/${t}`:`modules/${e}/src/libs/${t}`:`modules/${e}/dist/libs/${t}`}(t,e,A)),mB[t]=mB[t]||async function(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if($m)return importScripts(t);const e=await fetch(t);return function(t,e){if($m)return eval.call(Zm,t),null;const A=document.createElement("script");A.id=e;try{A.appendChild(document.createTextNode(t));}catch(e){A.text=t;}return document.body.appendChild(A),null}(await e.text(),t)}(t),await mB[t]}"undefined"==typeof __VERSION__||__VERSION__;let wB=0;function xB(t,e={}){return new Promise(((A,r)=>{const i=wB++,n=(t,e)=>{if(e.id===i)switch(t){case"done":yB.removeEventListener(n),A(e.result);break;case"error":yB.removeEventListener(n),r(e.error);}};yB.addEventListener(n),yB.postMessage("process",{id:i,input:t,options:e});}))}async function CB(t,e,A,r){switch(A){case"done":e.done(r);break;case"error":e.error(r.error);break;case"process":const{id:A,input:i,options:n}=r;try{const r=await t(i,n);e.postMessage("done",{id:A,result:r});}catch(t){e.postMessage("error",{id:A,error:t.message});}}}var EB={toArrayBuffer:t=>Buffer.isBuffer(t)?new Uint8Array(t).buffer:t,toBuffer(t){if(ArrayBuffer.isView(t)&&(t=t.buffer),"undefined"!=typeof Buffer&&t instanceof ArrayBuffer){const e=new Buffer(t.byteLength),A=new Uint8Array(t);for(let t=0;t<e.length;++t)e[t]=A[t];return e}return Km(!1)}};function _B(t){if(EB.toArrayBuffer&&(t=EB.toArrayBuffer(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){const e=t;return (new TextEncoder).encode(e).buffer}return t&&"object"==typeof t&&t._toArrayBuffer?t._toArrayBuffer():Km(!1)}const vB={};"undefined"==typeof __VERSION__||__VERSION__,"undefined"==typeof __VERSION__||__VERSION__;const bB="undefined"!=typeof __VERSION__?__VERSION__:"";Xm.loaders=Object.assign(Xm.loaders||{},{VERSION:bB});const UB=t=>"function"==typeof t,FB=t=>null!==t&&"object"==typeof t,MB=t=>FB(t)&&t.constructor==={}.constructor,QB=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,IB=t=>"undefined"!=typeof Blob&&t instanceof Blob,SB=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||FB(t)&&UB(t.tee)&&UB(t.cancel)&&UB(t.getReader))(t)||(t=>FB(t)&&UB(t.read)&&UB(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),TB=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,RB=/^([-\w.]+\/[-\w.+]+)/;function LB(t){if("string"!=typeof t)return "";const e=t.match(TB);return e?e[1]:""}const PB=/\?.*/;function HB(t){if(QB(t)){const e=function(t){if("string"!=typeof t)return "";const e=t.match(RB);return e?e[1]:t}(t.headers.get("content-type")),A=LB(t.url);return {url:OB(t.url||""),type:e||A||null}}return IB(t)?{url:OB(t.name||""),type:t.type||""}:"string"==typeof t?{url:OB(t),type:LB(t)}:{url:"",type:""}}function OB(t){return t.replace(PB,"")}async function DB(t){if(QB(t))return t;const e={},A=function(t){return QB(t)?t.headers["content-length"]||-1:IB(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);A>=0&&(e["content-length"]=String(A));const{url:r,type:i}=HB(t);i&&(e["content-type"]=i);const n=await async function(t){if("string"==typeof t)return `data:,${t.slice(0,5)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const A=new FileReader;A.onload=e=>t(e.target&&e.target.result),A.readAsDataURL(e);}))}if(t instanceof ArrayBuffer){const e=function(t){let e="";const A=new Uint8Array(t);for(let t=0;t<A.byteLength;t++)e+=String.fromCharCode(A[t]);return btoa(e)}(t.slice(0,5));return `data:base64,${e}`}return null}(t);n&&(e["x-first-bytes"]=n),"string"==typeof t&&(t=(new TextEncoder).encode(t));const s=new Response(t,{headers:e});return Object.defineProperty(s,"url",{value:r}),s}async function NB(t,e={}){if("string"!=typeof t)return await DB(t);t=function(t){for(const e in vB)t.startsWith(e)&&(t=t.replace(e,vB[e]));return t.startsWith("http://")||t.startsWith("https://")||(t=`${t}`),t}(t);const A=await fetch(t,e);if(!A.ok&&e.throws)throw new Error(await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{t.headers.get("Content-Type").includes("application/json")?e+=await t.text():e+=t.statusText;}catch(t){return e}return e}(A));return A}class kB{log(){return t=>{}}info(){return t=>{}}warn(){return t=>{}}error(){return t=>{}}}const VB={fetch:null,CDN:"",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,log:new class{constructor(){this.console=console;}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},metadata:!1,transforms:[],attributeName:null,attributeType:null,reuseWorkers:!0,_workerType:void 0},GB={dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},KB=()=>{Xm.loaders=Xm.loaders||{};const{loaders:t}=Xm;return t._state=t._state||{},t._state},zB=()=>{const t=KB();return VB.CDN=`${Xm.minemapCDN}/@mm-loaders.gl/`,t.globalOptions=t.globalOptions||{...VB},t.globalOptions};function XB(t,e){const A=zB(),r=t.fetch||A.fetch;return "function"==typeof r?r:FB(r)?t=>NB(t,r):e&&e.fetch?e.fetch:e=>NB(e,t)}function qB(t,e,A,r,i,n){for(const A in t){const s=!e&&FB(t[A]);A in r||"baseUri"===A&&!e||A in i||s||jB(A,n);}}function jB(t,e){const A=t.toLowerCase();let r="";for(const i of e)for(const e in i.options){if(t===e)return `Did you mean '${i.id}.${e}'?`;const n=e.toLowerCase();(A.startsWith(n)||n.startsWith(A))&&(r=r||`Did you mean '${i.id}.${e}'?`);}return r}function YB(t,e){for(const A in e)A in e&&(t[A]=MB(e[A])&&MB(t[A])?{...t[A],...e[A]}:e[A]);}function WB(t){return Array.isArray(t)&&(t=t[0]),!!t&&Array.isArray(t.extensions)}function ZB(t){let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t.parseTextSync||t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}async function JB(t,e,A){return await new Promise(((r,i)=>{const n=t.slice(e,A),s=new FileReader;s.onload=t=>r(t.target&&t.target.result),s.onerror=t=>i(t),s.readAsArrayBuffer(n);}))}function $B(t){if(qm||Ym>=10){if("function"==typeof t[Symbol.asyncIterator])return async function*(t){for await(const e of t)yield _B(e);}(t);if("function"==typeof t.getIterator)return t.getIterator()}return qm?async function*(t){const e=t.getReader();try{for(;;){const{done:t,value:A}=await e.read();if(t)return;yield _B(A);}}catch(t){e.releaseLock();}}(t):async function*(t){for(t=await t;;){const e=t.read();if(null===e){if(t._readableState.ended)return;await tw(t);}else yield _B(e);}}(t)}async function tw(t){return new Promise((e=>{t.once("readable",e);}))}const ew="Cannot convert supplied data type";const Aw=/\.([^.]+)$/;function rw(t,e=[],A={},r={}){if(e&&!Array.isArray(e))return ZB(e);!function(t){for(const e of t)ZB(e);}(e=[...e||[],...(()=>{const t=KB();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()]);const{url:i,type:n}=HB(t);let s=function(t,e){const A=e&&e.match(Aw),r=A&&A[1];return r&&function(t,e){e=e.toLowerCase();for(const A of t)for(const t of A.extensions)if(t.toLowerCase()===e)return A;return null}(t,r)}(e,i||r.url);if(s=s||function(t,e){for(const A of t){if(A.mimeTypes&&A.mimeTypes.includes(e))return A;if(e===`application/x.${A.id}`)return A;if(A.mimeTypes&&A.mimeTypes.includes("image/crn"))return A;if(A.mimeTypes&&A.mimeTypes.includes("image/ktx"))return A;if(A.mimeTypes&&A.mimeTypes.includes("image/ktx2"))return A;if(A.mimeTypes&&A.mimeTypes.includes("image/basis"))return A}return null}(e,n),s=s||function(t,e){if(!e)return null;for(const A of t)if("string"==typeof e){if(nw(e,A))return A}else if(ArrayBuffer.isView(e)){if(sw(e.buffer,e.byteOffset,A))return A}else if(e instanceof ArrayBuffer&&sw(e,0,A))return A;return null}(e,t),!s&&!A.nothrow)throw new Error(iw(t));return s}function iw(t){const{url:e,type:A}=HB(t);let r="No valid loader found";return t&&(r+=` data: "${function(t,e=5){return "string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?aw(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?aw(t,0,e):""}(t)}", contentType: "${A}"`),e&&(r+=` url: ${e}`),r}function nw(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function sw(t,e,A){return (Array.isArray(A.tests)?A.tests:[A.tests]).some((r=>function(t,e,A,r){if(r instanceof ArrayBuffer)return function(t,e,A){if(t.byteLength<(A=A||t.byteLength)||e.byteLength<A)return !1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let t=0;t<r.length;++t)if(r[t]!==i[t])return !1;return !0}(r,t,r.byteLength);switch(typeof r){case"function":return r(t,A);case"string":return r===aw(t,e,r.length);default:return !1}}(t,e,A,r)))}function aw(t,e,A){if(t.byteLength<e+A)return "";const r=new DataView(t);let i="";for(let t=0;t<A;t++)i+=String.fromCharCode(r.getUint8(e+t));return i}async function ow(t,e,A,r){!e||Array.isArray(e)||WB(e)||(r=A,A=e,e=null),t=await t,A=A||{};const{url:i}=HB(t),n=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let A;if(t&&(A=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];A=A?[...A,...t]:t;}return A&&A.length?A:null}(e,r),s=await async function(t,e=[],A={},r={}){let i=rw(t,e,{...A,nothrow:!0},r);if(i)return i;if(IB(t)&&(i=rw(t=await JB(t,0,10),e,A,r)),!i&&!A.nothrow)throw new Error(iw(t));return i}(t,n,A);if(!s)return null;r=function(t,e,A=null){return A||(t={fetch:XB(e||{},t),...t},Array.isArray(t.loaders)||(t.loaders=null),t)}({url:i,parse:ow,loaders:n},A=function(t,e,A,r){return A=A||[],function(t,e,A=console){VB.CDN=Xm.minemapCDN,qB(t,null,0,VB,GB,e);for(const A of e)qB(t&&t[A.id]||{},A.id,0,A.options&&A.options[A.id]||{},A.defaultOptions&&A.defaultOptions[A.id]||{},e);}(t,A=Array.isArray(A)?A:[A]),function(t,e,A){const r={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e);}(r,A),null===r.log&&(r.log=new kB),YB(r,zB()),YB(r,e),r}(e,t,r)}(A,s,n,i),r);const a=await async function(t,e,A,r){return function(t,e=pB){let A=t.version;e&&A&&(e=dB(e),A=dB(A));}(t),e=it(e=await async function(t,e){const A=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||A)return function(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer){const A=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(A):A}if(ArrayBuffer.isView(t)||(A=t)&&"object"==typeof A&&A.isBuffer){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let A=t.buffer;const r=t.byteLength||t.length;return 0===t.byteOffset&&r===A.byteLength||(A=A.slice(t.byteOffset,t.byteOffset+r)),A}var A;throw new Error(ew)}(t,e);if(IB(t)&&(t=await DB(t)),QB(t)){const A=t;return await async function(t){if(!t.ok){const e=await async function(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{const A=t.headers.get("Content-Type");let r=t.statusText;A.includes("application/json")&&(r+=` ${await t.text()}`),e+=r,e=e.length>60?`${e.slice(60)}...`:e;}catch(t){}return e}(t);throw new Error(e)}}(A),e.binary?await A.arrayBuffer():await A.text()}if(SB(t)&&(t=function(t,e={}){return "string"==typeof t?function*(t,e={}){const{chunkSize:A=262144}=e;let r=0;const i=new TextEncoder;for(;r<t.length;){const e=Math.min(t.length-r,A),n=t.slice(r,r+e);r+=e,yield i.encode(n);}}(t,e):t instanceof ArrayBuffer?function*(t,e={}){const{chunkSize:A=262144}=e;let r=0;for(;r<t.byteLength;){const e=Math.min(t.byteLength-r,A),i=new ArrayBuffer(e),n=new Uint8Array(t,r,e);new Uint8Array(i).set(n),r+=e,yield i;}}(t,e):IB(t)?async function*(t,e={}){const A=e.chunkSize||1048576;let r=0;for(;r<t.size;){const e=r+A,i=await JB(t,r,e);r=e,yield i;}}(t,e):SB(t)?$B(t):QB(t)?$B(t.body):Km(!1)}(t)),(r=t)&&"function"==typeof r[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return async function(t){const e=[],A=[];for await(const r of t)"string"==typeof r?A.push(r):e.push(r);return A.length>0?A.join(""):function(...t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),A=e.reduce(((t,e)=>t+e.byteLength),0),r=new Uint8Array(A);let i=0;for(const t of e)r.set(t,i),i+=t.byteLength;return r.buffer}(...e)}(t);var r;throw new Error(ew)}(e,t)),t.parseTextSync&&"string"==typeof e?(A.dataType="text",t.parseTextSync(e,A,r,t)):function(t,e,A,r){return !!uB.isSupported()&&!(!t.worker||!A.worker)&&(!t.useWorker||t.useWorker(A))}(t,0,A)?await async function(t,e,A,r,i){const n=t.id,s=function(t,e){const A=e||{},r=`${t.id}-worker.js`;let i=(A[t.id]||{}).workerUrl;return "test"===A._workerType&&(i=`modules/${t.module}/dist/${r}`),i||(i=`${window.minemapCDN}/@mm-loaders.gl/${t.module}/dist/${r}`),i}(t,A),a=uB.getWorkerFarm(A).getWorkerPool({name:n,url:s});A=JSON.parse(JSON.stringify(A));const o=await a.startJob("process-on-worker",CB.bind(null,i));o.postMessage("process",{input:e,options:A});const h=await o.result;return await h.result}(t,e,A,0,ow):t.parseText&&"string"==typeof e?await t.parseText(e,A,r,t):t.parse?await t.parse(e,A,r,t):function(t,e){throw new Error("loaders.gl assertion failed.")}()}(s,t,A,r);return a}async function hw(t,e,A,r,i){Array.isArray(e)||WB(e)||(A=e,e=null);const n=XB(A||{});let s=t;return "string"==typeof t?s=await n(t):t=null,IB(t)&&(s=await n(t),t=null),A&&(A.modelFolder=i),await ow(s,e,A)}class lw{constructor(){this.m_State=!1,this.m_Xmin=0,this.m_Xmax=0,this.m_Ymin=0,this.m_Ymax=0,this.m_Zmin=0,this.m_Zmax=0,this.m_Len=new nh,this.m_Center=new nh;}calculateSizeAndCenter(){this.m_Len.set(.5*(this.m_Xmax-this.m_Xmin),.5*(this.m_Ymax-this.m_Ymin),.5*(this.m_Zmax-this.m_Zmin)),this.m_Center.set(.5*(this.m_Xmax+this.m_Xmin),.5*(this.m_Ymax+this.m_Ymin),.5*(this.m_Zmax+this.m_Zmin));}update(t){0==this.m_State?(this.m_Xmin=t[0],this.m_Xmax=t[0],this.m_Ymin=t[1],this.m_Ymax=t[1],this.m_Zmin=t[2],this.m_Zmax=t[2],this.m_State=!0):(this.m_Xmin=Math.min(this.m_Xmin,t[0]),this.m_Xmax=Math.max(this.m_Xmax,t[0]),this.m_Ymin=Math.min(this.m_Ymin,t[1]),this.m_Ymax=Math.max(this.m_Ymax,t[1]),this.m_Zmin=Math.min(this.m_Zmin,t[2]),this.m_Zmax=Math.max(this.m_Zmax,t[2]));}getXmax(){return this.m_Xmax}getXmin(){return this.m_Xmin}getYmax(){return this.m_Ymax}getYmin(){return this.m_Ymin}getZmax(){return this.m_Zmax}getZmin(){return this.m_Zmin}setZmax(t){this.m_Zmax=t;}setZmin(t){this.m_Zmin=t;}setXmax(t){this.m_Xmax=t;}setXmin(t){this.m_Xmin=t;}setYmax(t){this.m_Ymax=t;}setYmin(t){this.m_Ymin=t;}}const cw="undefined"!=typeof __VERSION__?__VERSION__:"latest",uw="undefined"!=typeof __VERSION__?__VERSION__:"beta",pw={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},dw=[171,75,84,88,32,50,48,187,13,10,26,10];var fw,yw,gw,mw,Bw,ww,xw,Cw,Ew;(Ew=fw||(fw={}))[Ew.NONE=0]="NONE",Ew[Ew.BASISLZ=1]="BASISLZ",Ew[Ew.ZSTD=2]="ZSTD",Ew[Ew.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT";}(yw||(yw={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC";}(gw||(gw={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB";}(mw||(mw={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2";}(Bw||(Bw={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED";}(ww||(ww={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA";}(xw||(xw={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG";}(Cw||(Cw={}));class _w{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=fw.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:yw.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:gw.UNSPECIFIED,colorPrimaries:mw.SRGB,transferFunction:mw.SRGB,flags:ww.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null;}}class vw{constructor(t,e,A,r){this._dataView=new DataView(t.buffer,t.byteOffset+e,A),this._littleEndian=r,this._offset=0;}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const A=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==e&&r<t;)r++,this._offset++;return r<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+A,r)}}function bw(t){return "undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}function Uw(t,e){const A=new Array(e.mipMapLevels);let r=e.width,i=e.height,n=0;for(let s=0;s<e.mipMapLevels;++s){const a=Mw(e,r,i,t,s),o=Fw(t,s,n,a);A[s]={compressed:!0,format:e.internalFormat,data:o,width:r,height:i,levelSize:a},r=Math.max(1,r>>1),i=Math.max(1,i>>1),n+=a;}return A}function Fw(t,e,A,r){return Array.isArray(t)?t[e].levelData:new Uint8Array(t.buffer,t.byteOffset+A,r)}function Mw(t,e,A,r,i){return Array.isArray(r)?t.sizeFunction(r[i]):t.sizeFunction(e,A)}const Qw={MAGIC_NUMBER:542327876,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,HEADER_SIZE_INDEX:1,HEADER_FLAGS_INDEX:2,HEADER_HEIGHT_INDEX:3,HEADER_WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,HEADER_PF_FLAGS_INDEX:20,HEADER_PF_FOURCC_INDEX:21,DDSD_MIPMAPCOUNT:131072,DDPF_FOURCC:4,PIXEL_FORMATS:{DXT1:pw.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:pw.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:pw.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":pw.COMPRESSED_RGB_ATC_WEBGL,ATCA:pw.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:pw.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},SIZE_FUNCTIONS:{DXT1:Iw,DXT3:Sw,DXT5:Sw,"ATC ":Iw,ATCA:Sw,ATCI:Sw}};function Iw(t,e){return (t+3>>2)*(e+3>>2)*8}function Sw(t,e){return (t+3>>2)*(e+3>>2)*16}!function(){const t=new Uint32Array([305419896]);new Uint8Array(t.buffer,t.byteOffset,t.byteLength);}(),new Uint8Array([147,78,85,77,80,89]);const Tw={id:"crunch",name:"Crunch",module:"textures",version:uw,worker:!0,extensions:["crn"],mimeTypes:["image/crn","image/x-crn","application/octet-stream"],binary:!0,options:{crunch:{libraryPath:"libs/"}}};let Rw;const Lw={};Lw[0]={pixelFormat:pw.COMPRESSED_RGB_S3TC_DXT1_EXT,sizeFunction:Iw},Lw[1]={pixelFormat:pw.COMPRESSED_RGBA_S3TC_DXT3_EXT,sizeFunction:Sw},Lw[2]={pixelFormat:pw.COMPRESSED_RGBA_S3TC_DXT5_EXT,sizeFunction:Sw};let Pw=0,Hw=null;const Ow={...Tw,parse:async function(t,e={}){const A=await async function(t){const e=t.modules||{};return e.crunch?e.crunch:async function(t){if(Rw)return Rw;let e=null;return [e]=await Promise.all([await BB("crunch.js","textures",t)]),e=e||globalThis.LoadCrunchDecoder,Rw=e(),Rw}(t)}(e),r=t.byteLength,i=new Uint8Array(t),n=A._malloc(r);!function(t,e,A,r){let i;const n=A/4,s=r%4,a=new Uint32Array(t.buffer,0,(r-s)/4),o=new Uint32Array(e.buffer);for(i=0;i<a.length;i++)o[n+i]=a[i];for(i=r-s;i<r;i++)e[A+i]=t[i];}(i,A.HEAPU8,n,r);const s=A._crn_get_dxt_format(n,r),a=A._crn_get_levels(n,r),o=A._crn_get_width(n,r),h=A._crn_get_height(n,r),l=Lw[s].sizeFunction;let c=0;for(let t=0;t<a;++t)c+=l(o>>t,h>>t);return Pw<c&&(Hw&&A._free(Hw),Hw=A._malloc(c),Pw=c),A._crn_decompress(n,r,Hw,c,0,a),A._free(n),Uw(new Uint8Array(A.HEAPU8.buffer,Hw,c).slice(),{mipMapLevels:a,width:o,height:h,sizeFunction:l,internalFormat:Lw[s].pixelFormat})}};var Dw;function Nw(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const A=e&&e.modelFolder?e.modelFolder:e.baseUri||e.uri;if(!A)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return e&&e.modelFolder?"/"===e.modelFolder.slice(-1)?e.modelFolder+t:`${e.modelFolder}/${t}`:A.substr(0,A.lastIndexOf("/")+1)+t}Dw=Ow,"undefined"!=typeof self&&(yB.onmessage=async(t,e)=>{if("process"===t)try{const{input:t,options:A={}}=e,r=await async function({loader:t,arrayBuffer:e,options:A,context:r}){let i,n;if(t.parseSync||t.parse)i=e,n=t.parseSync||t.parse;else {if(!t.parseTextSync)throw new Error(`Could not load data with ${t.name} loader`);i=(new TextDecoder).decode(e),n=t.parseTextSync;}return A={...A,modules:t&&t.options&&t.options.modules||{},worker:!1},await n(i,{...A},r,t)}({loader:Dw,arrayBuffer:t,byteOffset:0,byteLength:0,options:A,context:{parse:xB}});yB.postMessage("done",{result:r});}catch(t){yB.postMessage("error",{error:t.message});}});const kw="undefined"!=typeof __VERSION__?__VERSION__:"latest";var Vw=Mn([{name:"a_POSITION",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2}]),Gw=e((function(t,e){t.exports=function(){var t=function(e,A){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var A in e)Object.prototype.hasOwnProperty.call(e,A)&&(t[A]=e[A]);},t(e,A)};function e(e,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function r(){this.constructor=e;}t(e,A),e.prototype=null===A?Object.create(A):(r.prototype=A.prototype,new r);}var A=function(){return A=Object.assign||function(t){for(var e,A=1,r=arguments.length;A<r;A++)for(var i in e=arguments[A])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},A.apply(this,arguments)};function r(t,e,A,r){return new(A||(A=Promise))((function(i,n){function s(t){try{o(r.next(t));}catch(t){n(t);}}function a(t){try{o(r.throw(t));}catch(t){n(t);}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof A?e:new A((function(t){t(e);}))).then(s,a);}o((r=r.apply(t,e||[])).next());}))}function i(t,e){var A,r,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(A)throw new TypeError("Generator is already executing.");for(;s;)try{if(A=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s);}catch(t){n=[6,t],r=0;}finally{A=i=0;}if(5&n[0])throw n[1];return {value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}function n(t,e,A){if(A||2===arguments.length)for(var r,i=0,n=e.length;i<n;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||e)}for(var s=function(){function t(t,e,A,r){this.left=t,this.top=e,this.width=A,this.height=r;}return t.prototype.add=function(e,A,r,i){return new t(this.left+e,this.top+A,this.width+r,this.height+i)},t.fromClientRect=function(e,A){return new t(A.left+e.windowBounds.left,A.top+e.windowBounds.top,A.width,A.height)},t.fromDOMRectList=function(e,A){var r=Array.from(A).find((function(t){return 0!==t.width}));return r?new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),a=function(t,e){return s.fromClientRect(t,e.getBoundingClientRect())},o=function(t){for(var e=[],A=0,r=t.length;A<r;){var i=t.charCodeAt(A++);if(i>=55296&&i<=56319&&A<r){var n=t.charCodeAt(A++);56320==(64512&n)?e.push(((1023&i)<<10)+(1023&n)+65536):(e.push(i),A--);}else e.push(i);}return e},h=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var A=t.length;if(!A)return "";for(var r=[],i=-1,n="";++i<A;){var s=t[i];s<=65535?r.push(s):r.push(55296+((s-=65536)>>10),s%1024+56320),(i+1===A||r.length>16384)&&(n+=String.fromCharCode.apply(String,r),r.length=0);}return n},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),u=0;u<l.length;u++)c[l.charCodeAt(u)]=u;for(var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"==typeof Uint8Array?[]:new Uint8Array(256),f=0;f<p.length;f++)d[p.charCodeAt(f)]=f;for(var y=function(t,e,A){return t.slice?t.slice(e,A):new Uint16Array(Array.prototype.slice.call(t,e,A))},g=function(){function t(t,e,A,r,i,n){this.initialValue=t,this.errorValue=e,this.highStart=A,this.highValueIndex=r,this.index=i,this.data=n;}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return this.data[e=((e=this.index[t>>5])<<2)+(31&t)];if(t<=65535)return this.data[e=((e=this.index[2048+(t-55296>>5)])<<2)+(31&t)];if(t<this.highStart)return e=this.index[e=2080+(t>>11)],this.data[e=((e=this.index[e+=t>>5&63])<<2)+(31&t)];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",B="undefined"==typeof Uint8Array?[]:new Uint8Array(256),w=0;w<m.length;w++)B[m.charCodeAt(w)]=w;var x,C,E,_,v,b,U,F,M=10,Q=13,I=15,S=17,T=18,R=19,L=20,P=21,H=22,O=24,D=25,N=26,k=27,V=28,G=30,K=32,z=33,X=34,q=35,j=37,Y=38,W=39,Z=40,J=42,$=[9001,65288],tt="×",et="÷",At=(_=function(t){var e,A,r,i,n,s=.75*t.length,a=t.length,o=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var h="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),l=Array.isArray(h)?h:new Uint8Array(h);for(e=0;e<a;e+=4)A=d[t.charCodeAt(e)],r=d[t.charCodeAt(e+1)],i=d[t.charCodeAt(e+2)],n=d[t.charCodeAt(e+3)],l[o++]=A<<2|r>>4,l[o++]=(15&r)<<4|i>>2,l[o++]=(3&i)<<6|63&n;return h}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),v=Array.isArray(_)?function(t){for(var e=t.length,A=[],r=0;r<e;r+=4)A.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return A}(_):new Uint32Array(_),b=Array.isArray(_)?function(t){for(var e=t.length,A=[],r=0;r<e;r+=2)A.push(t[r+1]<<8|t[r]);return A}(_):new Uint16Array(_),U=y(b,12,v[4]/2),F=2===v[5]?y(b,(24+v[4])/2):(x=v,C=Math.ceil((24+v[4])/4),x.slice?x.slice(C,E):new Uint32Array(Array.prototype.slice.call(x,C,E))),new g(v[0],v[1],v[2],v[3],U,F)),rt=[G,36],it=[1,2,3,5],nt=[M,8],st=[k,N],at=it.concat(nt),ot=[Y,W,Z,X,q],ht=[I,Q],lt=function(t,e,A,r){var i=r[A];if(Array.isArray(t)?-1!==t.indexOf(i):t===i)for(var n=A;n<=r.length;){if((o=r[++n])===e)return !0;if(o!==M)break}if(i===M)for(n=A;n>0;){var s=r[--n];if(Array.isArray(t)?-1!==t.indexOf(s):t===s)for(var a=A;a<=r.length;){var o;if((o=r[++a])===e)return !0;if(o!==M)break}if(s!==M)break}return !1},ct=function(t,e){for(var A=t;A>=0;){var r=e[A];if(r!==M)return r;A--;}return 0},ut=function(t,e,A,r,i){if(0===A[r])return tt;var n=r-1;if(Array.isArray(i)&&!0===i[n])return tt;var s=n-1,a=n+1,o=e[n],h=s>=0?e[s]:0,l=e[a];if(2===o&&3===l)return tt;if(-1!==it.indexOf(o))return "!";if(-1!==it.indexOf(l))return tt;if(-1!==nt.indexOf(l))return tt;if(8===ct(n,e))return et;if(11===At.get(t[n]))return tt;if((o===K||o===z)&&11===At.get(t[a]))return tt;if(7===o||7===l)return tt;if(9===o)return tt;if(-1===[M,Q,I].indexOf(o)&&9===l)return tt;if(-1!==[S,T,R,O,V].indexOf(l))return tt;if(ct(n,e)===H)return tt;if(lt(23,H,n,e))return tt;if(lt([S,T],P,n,e))return tt;if(lt(12,12,n,e))return tt;if(o===M)return et;if(23===o||23===l)return tt;if(16===l||16===o)return et;if(-1!==[Q,I,P].indexOf(l)||14===o)return tt;if(36===h&&-1!==ht.indexOf(o))return tt;if(o===V&&36===l)return tt;if(l===L)return tt;if(-1!==rt.indexOf(l)&&o===D||-1!==rt.indexOf(o)&&l===D)return tt;if(o===k&&-1!==[j,K,z].indexOf(l)||-1!==[j,K,z].indexOf(o)&&l===N)return tt;if(-1!==rt.indexOf(o)&&-1!==st.indexOf(l)||-1!==st.indexOf(o)&&-1!==rt.indexOf(l))return tt;if(-1!==[k,N].indexOf(o)&&(l===D||-1!==[H,I].indexOf(l)&&e[a+1]===D)||-1!==[H,I].indexOf(o)&&l===D||o===D&&-1!==[D,V,O].indexOf(l))return tt;if(-1!==[D,V,O,S,T].indexOf(l))for(var c=n;c>=0;){if((u=e[c])===D)return tt;if(-1===[V,O].indexOf(u))break;c--;}if(-1!==[k,N].indexOf(l))for(c=-1!==[S,T].indexOf(o)?s:n;c>=0;){var u;if((u=e[c])===D)return tt;if(-1===[V,O].indexOf(u))break;c--;}if(Y===o&&-1!==[Y,W,X,q].indexOf(l)||-1!==[W,X].indexOf(o)&&-1!==[W,Z].indexOf(l)||-1!==[Z,q].indexOf(o)&&l===Z)return tt;if(-1!==ot.indexOf(o)&&-1!==[L,N].indexOf(l)||-1!==ot.indexOf(l)&&o===k)return tt;if(-1!==rt.indexOf(o)&&-1!==rt.indexOf(l))return tt;if(o===O&&-1!==rt.indexOf(l))return tt;if(-1!==rt.concat(D).indexOf(o)&&l===H&&-1===$.indexOf(t[a])||-1!==rt.concat(D).indexOf(l)&&o===T)return tt;if(41===o&&41===l){for(var p=A[n],d=1;p>0&&41===e[--p];)d++;if(d%2!=0)return tt}return o===K&&l===z?tt:et},pt=function(){function t(t,e,A,r){this.codePoints=t,this.required="!"===e,this.start=A,this.end=r;}return t.prototype.slice=function(){return h.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),dt=45,ft=43,yt=-1,gt=function(t){return t>=48&&t<=57},mt=function(t){return gt(t)||t>=65&&t<=70||t>=97&&t<=102},Bt=function(t){return 10===t||9===t||32===t},wt=function(t){return function(t){return function(t){return t>=97&&t<=122}(t)||function(t){return t>=65&&t<=90}(t)}(t)||function(t){return t>=128}(t)||95===t},xt=function(t){return wt(t)||gt(t)||t===dt},Ct=function(t){return t>=0&&t<=8||11===t||t>=14&&t<=31||127===t},Et=function(t,e){return 92===t&&10!==e},_t=function(t,e,A){return t===dt?wt(e)||Et(e,A):!!wt(t)||!(92!==t||!Et(t,e))},vt=function(t,e,A){return t===ft||t===dt?!!gt(e)||46===e&&gt(A):gt(46===t?e:t)},bt=function(t){var e=0,A=1;t[e]!==ft&&t[e]!==dt||(t[e]===dt&&(A=-1),e++);for(var r=[];gt(t[e]);)r.push(t[e++]);var i=r.length?parseInt(h.apply(void 0,r),10):0;46===t[e]&&e++;for(var n=[];gt(t[e]);)n.push(t[e++]);var s=n.length,a=s?parseInt(h.apply(void 0,n),10):0;69!==t[e]&&101!==t[e]||e++;var o=1;t[e]!==ft&&t[e]!==dt||(t[e]===dt&&(o=-1),e++);for(var l=[];gt(t[e]);)l.push(t[e++]);var c=l.length?parseInt(h.apply(void 0,l),10):0;return A*(i+a*Math.pow(10,-s))*Math.pow(10,o*c)},Ut={type:2},Ft={type:3},Mt={type:4},Qt={type:13},It={type:8},St={type:21},Tt={type:9},Rt={type:10},Lt={type:11},Pt={type:12},Ht={type:14},Ot={type:23},Dt={type:1},Nt={type:25},kt={type:24},Vt={type:26},Gt={type:27},Kt={type:28},zt={type:29},Xt={type:31},qt={type:32},jt=function(){function t(){this._value=[];}return t.prototype.write=function(t){this._value=this._value.concat(o(t));},t.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==qt;)t.push(e),e=this.consumeToken();return t},t.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),A=this.peekCodePoint(1),r=this.peekCodePoint(2);if(xt(e)||Et(A,r)){var i=_t(e,A,r)?2:1;return {type:5,value:this.consumeName(),flags:i}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Qt;break;case 39:return this.consumeStringToken(39);case 40:return Ut;case 41:return Ft;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ht;break;case ft:if(vt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 44:return Mt;case dt:var n=t,s=this.peekCodePoint(0),a=this.peekCodePoint(1);if(vt(n,s,a))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(_t(n,s,a))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(s===dt&&62===a)return this.consumeCodePoint(),this.consumeCodePoint(),kt;break;case 46:if(vt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var o=this.consumeCodePoint();if(42===o&&47===(o=this.consumeCodePoint()))return this.consumeToken();if(o===yt)return this.consumeToken()}break;case 58:return Vt;case 59:return Gt;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===dt&&this.peekCodePoint(2)===dt)return this.consumeCodePoint(),this.consumeCodePoint(),Nt;break;case 64:var l=this.peekCodePoint(0),c=this.peekCodePoint(1),u=this.peekCodePoint(2);if(_t(l,c,u))return {type:7,value:this.consumeName()};break;case 91:return Kt;case 92:if(Et(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case 93:return zt;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),It;break;case 123:return Lt;case 125:return Pt;case 117:case 85:var p=this.peekCodePoint(0),d=this.peekCodePoint(1);return p!==ft||!mt(d)&&63!==d||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Tt;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),St;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Rt;break;case yt:return qt}return Bt(t)?(this.consumeWhiteSpace(),Xt):gt(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):wt(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:h(t)}},t.prototype.consumeCodePoint=function(){var t=this._value.shift();return void 0===t?-1:t},t.prototype.reconsumeCodePoint=function(t){this._value.unshift(t);},t.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},t.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();mt(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var A=!1;63===e&&t.length<6;)t.push(e),e=this.consumeCodePoint(),A=!0;if(A)return {type:30,start:parseInt(h.apply(void 0,t.map((function(t){return 63===t?48:t}))),16),end:parseInt(h.apply(void 0,t.map((function(t){return 63===t?70:t}))),16)};var r=parseInt(h.apply(void 0,t),16);if(this.peekCodePoint(0)===dt&&mt(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var i=[];mt(e)&&i.length<6;)i.push(e),e=this.consumeCodePoint();return {type:30,start:r,end:parseInt(h.apply(void 0,i),16)}}return {type:30,start:r,end:r}},t.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return "url"===t.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},t.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===yt)return {type:22,value:""};var e=this.peekCodePoint(0);if(39===e||34===e){var A=this.consumeStringToken(this.consumeCodePoint());return 0===A.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===yt||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:A.value}):(this.consumeBadUrlRemnants(),Ot)}for(;;){var r=this.consumeCodePoint();if(r===yt||41===r)return {type:22,value:h.apply(void 0,t)};if(Bt(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===yt||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:h.apply(void 0,t)}):(this.consumeBadUrlRemnants(),Ot);if(34===r||39===r||40===r||Ct(r))return this.consumeBadUrlRemnants(),Ot;if(92===r){if(!Et(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Ot;t.push(this.consumeEscapedCodePoint());}else t.push(r);}},t.prototype.consumeWhiteSpace=function(){for(;Bt(this.peekCodePoint(0));)this.consumeCodePoint();},t.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(41===t||t===yt)return;Et(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint();}},t.prototype.consumeStringSlice=function(t){for(var e="";t>0;){var A=Math.min(5e4,t);e+=h.apply(void 0,this._value.splice(0,A)),t-=A;}return this._value.shift(),e},t.prototype.consumeStringToken=function(t){for(var e="",A=0;;){var r=this._value[A];if(r===yt||void 0===r||r===t)return {type:0,value:e+=this.consumeStringSlice(A)};if(10===r)return this._value.splice(0,A),Dt;if(92===r){var i=this._value[A+1];i!==yt&&void 0!==i&&(10===i?(e+=this.consumeStringSlice(A),A=-1,this._value.shift()):Et(r,i)&&(e+=this.consumeStringSlice(A),e+=h(this.consumeEscapedCodePoint()),A=-1));}A++;}},t.prototype.consumeNumber=function(){var t=[],e=4,A=this.peekCodePoint(0);for(A!==ft&&A!==dt||t.push(this.consumeCodePoint());gt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());A=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===A&&gt(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;gt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());A=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((69===A||101===A)&&((r===ft||r===dt)&&gt(i)||gt(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;gt(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return [bt(t),e]},t.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],A=t[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),n=this.peekCodePoint(2);return _t(r,i,n)?{type:15,number:e,flags:A,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:e,flags:A}):{type:17,number:e,flags:A}},t.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(mt(t)){for(var e=h(t);mt(this.peekCodePoint(0))&&e.length<6;)e+=h(this.consumeCodePoint());Bt(this.peekCodePoint(0))&&this.consumeCodePoint();var A=parseInt(e,16);return 0===A||function(t){return t>=55296&&t<=57343}(A)||A>1114111?65533:A}return t===yt?65533:t},t.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(xt(e))t+=h(e);else {if(!Et(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),t;t+=h(this.consumeEscapedCodePoint());}}},t}(),Yt=function(){function t(t){this._tokens=t;}return t.create=function(e){var A=new jt;return A.write(e),new t(A.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var t=this.consumeToken();31===t.type;)t=this.consumeToken();if(32===t.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do{t=this.consumeToken();}while(31===t.type);if(32===t.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(32===e.type)return t;t.push(e),t.push();}},t.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},t.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},A=this.consumeToken();;){if(32===A.type||ie(A,t))return e;this.reconsumeToken(A),e.values.push(this.consumeComponentValue()),A=this.consumeToken();}},t.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var A=this.consumeToken();if(32===A.type||3===A.type)return e;this.reconsumeToken(A),e.values.push(this.consumeComponentValue());}},t.prototype.consumeToken=function(){var t=this._tokens.shift();return void 0===t?qt:t},t.prototype.reconsumeToken=function(t){this._tokens.unshift(t);},t}(),Wt=function(t){return 15===t.type},Zt=function(t){return 17===t.type},Jt=function(t){return 20===t.type},$t=function(t){return 0===t.type},te=function(t,e){return Jt(t)&&t.value===e},ee=function(t){return 31!==t.type},Ae=function(t){return 31!==t.type&&4!==t.type},re=function(t){var e=[],A=[];return t.forEach((function(t){if(4===t.type){if(0===A.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(A),void(A=[])}31!==t.type&&A.push(t);})),A.length&&e.push(A),e},ie=function(t,e){return 11===e&&12===t.type||28===e&&29===t.type||2===e&&3===t.type},ne=function(t){return 17===t.type||15===t.type},se=function(t){return 16===t.type||ne(t)},ae=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},oe={type:17,number:0,flags:4},he={type:16,number:50,flags:4},le={type:16,number:100,flags:4},ce=function(t,e,A){var r=t[0],i=t[1];return [ue(r,e),ue(void 0!==i?i:r,A)]},ue=function(t,e){if(16===t.type)return t.number/100*e;if(Wt(t))switch(t.unit){case"rem":case"em":return 16*t.number;default:return t.number}return t.number},pe="grad",de="turn",fe=function(t,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case pe:return Math.PI/200*e.number;case"rad":return e.number;case de:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},ye=function(t){return 15===t.type&&("deg"===t.unit||t.unit===pe||"rad"===t.unit||t.unit===de)},ge=function(t){switch(t.filter(Jt).map((function(t){return t.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return [oe,oe];case"to top":case"bottom":return me(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return [oe,le];case"to right":case"left":return me(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return [le,le];case"to bottom":case"top":return me(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return [le,oe];case"to left":case"right":return me(270)}return 0},me=function(t){return Math.PI*t/180},Be=function(t,e){if(18===e.type){var A=Fe[e.name];if(void 0===A)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return A(t,e.values)}if(5===e.type){if(3===e.value.length){var r=e.value.substring(0,1),i=e.value.substring(1,2),n=e.value.substring(2,3);return Ce(parseInt(r+r,16),parseInt(i+i,16),parseInt(n+n,16),1)}if(4===e.value.length){r=e.value.substring(0,1),i=e.value.substring(1,2),n=e.value.substring(2,3);var s=e.value.substring(3,4);return Ce(parseInt(r+r,16),parseInt(i+i,16),parseInt(n+n,16),parseInt(s+s,16)/255)}if(6===e.value.length)return r=e.value.substring(0,2),i=e.value.substring(2,4),n=e.value.substring(4,6),Ce(parseInt(r,16),parseInt(i,16),parseInt(n,16),1);if(8===e.value.length)return r=e.value.substring(0,2),i=e.value.substring(2,4),n=e.value.substring(4,6),s=e.value.substring(6,8),Ce(parseInt(r,16),parseInt(i,16),parseInt(n,16),parseInt(s,16)/255)}if(20===e.type){var a=Qe[e.value.toUpperCase()];if(void 0!==a)return a}return Qe.TRANSPARENT},we=function(t){return 0==(255&t)},xe=function(t){var e=255&t,A=255&t>>8,r=255&t>>16,i=255&t>>24;return e<255?"rgba("+i+","+r+","+A+","+e/255+")":"rgb("+i+","+r+","+A+")"},Ce=function(t,e,A,r){return (t<<24|e<<16|A<<8|Math.round(255*r)<<0)>>>0},Ee=function(t,e){if(17===t.type)return t.number;if(16===t.type){var A=3===e?1:255;return 3===e?t.number/100*A:Math.round(t.number/100*A)}return 0},_e=function(t,e){var A=e.filter(Ae);if(3===A.length){var r=A.map(Ee);return Ce(r[0],r[1],r[2],1)}if(4===A.length){var i=A.map(Ee);return Ce(i[0],i[1],i[2],i[3])}return 0};function ve(t,e,A){return A<0&&(A+=1),A>=1&&(A-=1),A<1/6?(e-t)*A*6+t:A<.5?e:A<2/3?6*(e-t)*(2/3-A)+t:t}var be,Ue=function(t,e){var A=e.filter(Ae),r=A[0],i=A[1],n=A[2],s=A[3],a=(17===r.type?me(r.number):fe(0,r))/(2*Math.PI),o=se(i)?i.number/100:0,h=se(n)?n.number/100:0,l=void 0!==s&&se(s)?ue(s,1):1;if(0===o)return Ce(255*h,255*h,255*h,1);var c=h<=.5?h*(o+1):h+o-h*o,u=2*h-c,p=ve(u,c,a+1/3),d=ve(u,c,a),f=ve(u,c,a-1/3);return Ce(255*p,255*d,255*f,l)},Fe={hsl:Ue,hsla:Ue,rgb:_e,rgba:_e},Me=function(t,e){return Be(t,Yt.create(e).parseComponentValue())},Qe={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Ie={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Jt(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Se={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Te=function(t,e){var A=Be(t,e[0]),r=e[1];return r&&se(r)?{color:A,stop:r}:{color:A,stop:null}},Re=function(t,e){var A=t[0],r=t[t.length-1];null===A.stop&&(A.stop=oe),null===r.stop&&(r.stop=le);for(var i=[],n=0,s=0;s<t.length;s++){var a=t[s].stop;if(null!==a){var o=ue(a,e);i.push(o>n?o:n),n=o;}else i.push(null);}var h=null;for(s=0;s<i.length;s++){var l=i[s];if(null===l)null===h&&(h=s);else if(null!==h){for(var c=s-h,u=(l-i[h-1])/(c+1),p=1;p<=c;p++)i[h+p-1]=u*p;h=null;}}return t.map((function(t,A){return {color:t.color,stop:Math.max(Math.min(1,i[A]/e),0)}}))},Le=function(t,e){return Math.sqrt(t*t+e*e)},Pe=function(t,e,A,r,i){return [[0,0],[0,e],[t,0],[t,e]].reduce((function(t,e){var n=Le(A-e[0],r-e[1]);return (i?n<t.optimumDistance:n>t.optimumDistance)?{optimumCorner:e,optimumDistance:n}:t}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},He=function(t,e){var A=me(180),r=[];return re(e).forEach((function(e,i){if(0===i){var n=e[0];if(20===n.type&&-1!==["top","left","right","bottom"].indexOf(n.value))return void(A=ge(e));if(ye(n))return void(A=(fe(0,n)+me(270))%me(360))}var s=Te(t,e);r.push(s);})),{angle:A,stops:r,type:1}},Oe="closest-side",De="farthest-side",Ne="closest-corner",ke="farthest-corner",Ve="circle",Ge="ellipse",Ke="cover",ze="contain",Xe=function(t,e){var A=0,r=3,i=[],n=[];return re(e).forEach((function(e,s){var a=!0;if(0===s?a=e.reduce((function(t,e){if(Jt(e))switch(e.value){case"center":return n.push(he),!1;case"top":case"left":return n.push(oe),!1;case"right":case"bottom":return n.push(le),!1}else if(se(e)||ne(e))return n.push(e),!1;return t}),a):1===s&&(a=e.reduce((function(t,e){if(Jt(e))switch(e.value){case Ve:return A=0,!1;case Ge:return A=1,!1;case ze:case Oe:return r=0,!1;case De:return r=1,!1;case Ne:return r=2,!1;case Ke:case ke:return r=3,!1}else if(ne(e)||se(e))return Array.isArray(r)||(r=[]),r.push(e),!1;return t}),a)),a){var o=Te(t,e);i.push(o);}})),{size:r,shape:A,stops:i,position:n,type:2}},qe=function(t,e){if(22===e.type){var A={url:e.value,type:0};return t.cache.addImage(e.value),A}if(18===e.type){var r=je[e.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(t,e.values)}throw new Error("Unsupported image type "+e.type)},je={"linear-gradient":function(t,e){var A=me(180),r=[];return re(e).forEach((function(e,i){if(0===i){var n=e[0];if(20===n.type&&"to"===n.value)return void(A=ge(e));if(ye(n))return void(A=fe(0,n))}var s=Te(t,e);r.push(s);})),{angle:A,stops:r,type:1}},"-moz-linear-gradient":He,"-ms-linear-gradient":He,"-o-linear-gradient":He,"-webkit-linear-gradient":He,"radial-gradient":function(t,e){var A=0,r=3,i=[],n=[];return re(e).forEach((function(e,s){var a=!0;if(0===s){var o=!1;a=e.reduce((function(t,e){if(o)if(Jt(e))switch(e.value){case"center":return n.push(he),t;case"top":case"left":return n.push(oe),t;case"right":case"bottom":return n.push(le),t}else (se(e)||ne(e))&&n.push(e);else if(Jt(e))switch(e.value){case Ve:return A=0,!1;case Ge:return A=1,!1;case"at":return o=!0,!1;case Oe:return r=0,!1;case Ke:case De:return r=1,!1;case ze:case Ne:return r=2,!1;case ke:return r=3,!1}else if(ne(e)||se(e))return Array.isArray(r)||(r=[]),r.push(e),!1;return t}),a);}if(a){var h=Te(t,e);i.push(h);}})),{size:r,shape:A,stops:i,position:n,type:2}},"-moz-radial-gradient":Xe,"-ms-radial-gradient":Xe,"-o-radial-gradient":Xe,"-webkit-radial-gradient":Xe,"-webkit-gradient":function(t,e){var A=me(180),r=[],i=1;return re(e).forEach((function(e,A){var n=e[0];if(0===A){if(Jt(n)&&"linear"===n.value)return void(i=1);if(Jt(n)&&"radial"===n.value)return void(i=2)}if(18===n.type)if("from"===n.name){var s=Be(t,n.values[0]);r.push({stop:oe,color:s});}else if("to"===n.name)s=Be(t,n.values[0]),r.push({stop:le,color:s});else if("color-stop"===n.name){var a=n.values.filter(Ae);if(2===a.length){s=Be(t,a[1]);var o=a[0];Zt(o)&&r.push({stop:{type:16,number:100*o.number,flags:o.flags},color:s});}}})),1===i?{angle:(A+me(180))%me(360),stops:r,type:i}:{size:3,shape:0,stops:r,position:[],type:i}}},Ye={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return [];var A=e[0];return 20===A.type&&"none"===A.value?[]:e.filter((function(t){return Ae(t)&&function(t){return !(20===t.type&&"none"===t.value||18===t.type&&!je[t.name])}(t)})).map((function(e){return qe(t,e)}))}},We={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(Jt(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Ze={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return re(e).map((function(t){return t.filter(se)})).map(ae)}},Je={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return re(e).map((function(t){return t.filter(Jt).map((function(t){return t.value})).join(" ")})).map($e)}},$e=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover";}(be||(be={}));var tA,eA={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return re(e).map((function(t){return t.filter(AA)}))}},AA=function(t){return Jt(t)||se(t)},rA=function(t){return {name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},iA=rA("top"),nA=rA("right"),sA=rA("bottom"),aA=rA("left"),oA=function(t){return {name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return ae(e.filter(se))}}},hA=oA("top-left"),lA=oA("top-right"),cA=oA("bottom-right"),uA=oA("bottom-left"),pA=function(t){return {name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},dA=pA("top"),fA=pA("right"),yA=pA("bottom"),gA=pA("left"),mA=function(t){return {name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Wt(e)?e.number:0}}},BA=mA("top"),wA=mA("right"),xA=mA("bottom"),CA=mA("left"),EA={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_A={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){return "rtl"===e?1:0}},vA={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(Jt).reduce((function(t,e){return t|bA(e.value)}),0)}},bA=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},UA={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},FA={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return 20===e.type&&"normal"===e.value?0:17===e.type||15===e.type?e.number:0}};!function(t){t.NORMAL="normal",t.STRICT="strict";}(tA||(tA={}));var MA,QA={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return "strict"===e?tA.STRICT:tA.NORMAL}},IA={name:"line-height",initialValue:"normal",prefix:!1,type:4},SA=function(t,e){return Jt(t)&&"normal"===t.value?1.2*e:17===t.type?e*t.number:se(t)?ue(t,e):e},TA={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return 20===e.type&&"none"===e.value?null:qe(t,e)}},RA={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){return "inside"===e?0:1}},LA={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return -1}}},PA=function(t){return {name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},HA=PA("top"),OA=PA("right"),DA=PA("bottom"),NA=PA("left"),kA={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(Jt).map((function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},VA={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return "break-word"===e?"break-word":"normal"}},GA=function(t){return {name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},KA=GA("top"),zA=GA("right"),XA=GA("bottom"),qA=GA("left"),jA={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},YA={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},WA={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&te(e[0],"none")?[]:re(e).map((function(e){for(var A={color:Qe.TRANSPARENT,offsetX:oe,offsetY:oe,blur:oe},r=0,i=0;i<e.length;i++){var n=e[i];ne(n)?(0===r?A.offsetX=n:1===r?A.offsetY=n:A.blur=n,r++):A.color=Be(t,n);}return A}))}},ZA={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},JA={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(20===e.type&&"none"===e.value)return null;if(18===e.type){var A=$A[e.name];if(void 0===A)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return A(e.values)}return null}},$A={matrix:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number}));return 6===e.length?e:null},matrix3d:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number}));return 16===e.length?[e[0],e[1],e[4],e[5],e[12],e[13]]:null}},tr={type:16,number:50,flags:4},er=[tr,tr],Ar={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var A=e.filter(se);return 2!==A.length?er:[A[0],A[1]]}},rr={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all";}(MA||(MA={}));for(var ir={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return MA.BREAK_ALL;case"keep-all":return MA.KEEP_ALL;default:return MA.NORMAL}}},nr={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(20===e.type)return {auto:!0,order:0};if(Zt(e))return {auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},sr={name:"time",parse:function(t,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},ar={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return Zt(e)?e.number:1}},or={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},hr={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(Jt).map((function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(t){return 0!==t}))}},lr={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var A=[],r=[];return e.forEach((function(t){switch(t.type){case 20:case 0:A.push(t.value);break;case 17:A.push(t.number.toString());break;case 4:r.push(A.join(" ")),A.length=0;}})),A.length&&r.push(A.join(" ")),r.map((function(t){return -1===t.indexOf(" ")?t:"'"+t+"'"}))}},cr={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ur={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){return Zt(e)?e.number:Jt(e)&&"bold"===e.value?700:400}},pr={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(Jt).map((function(t){return t.value}))}},dr={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return "oblique";case"italic":return "italic";default:return "normal"}}},fr=function(t,e){return 0!=(t&e)},yr={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return [];var A=e[0];return 20===A.type&&"none"===A.value?[]:e}},gr={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var A=e[0];if(20===A.type&&"none"===A.value)return null;for(var r=[],i=e.filter(ee),n=0;n<i.length;n++){var s=i[n],a=i[n+1];if(20===s.type){var o=a&&Zt(a)?a.number:1;r.push({counter:s.value,increment:o});}}return r}},mr={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return [];for(var A=[],r=e.filter(ee),i=0;i<r.length;i++){var n=r[i],s=r[i+1];if(Jt(n)&&"none"!==n.value){var a=s&&Zt(s)?s.number:0;A.push({counter:n.value,reset:a});}}return A}},Br={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Wt).map((function(e){return sr.parse(t,e)}))}},wr={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var A=e[0];if(20===A.type&&"none"===A.value)return null;var r=[],i=e.filter($t);if(i.length%2!=0)return null;for(var n=0;n<i.length;n+=2)r.push({open:i[n].value,close:i[n+1].value});return r}},xr=function(t,e,A){if(!t)return "";var r=t[Math.min(e,t.length-1)];return r?A?r.open:r.close:""},Cr={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&te(e[0],"none")?[]:re(e).map((function(e){for(var A={color:255,offsetX:oe,offsetY:oe,blur:oe,spread:oe,inset:!1},r=0,i=0;i<e.length;i++){var n=e[i];te(n,"inset")?A.inset=!0:ne(n)?(0===r?A.offsetX=n:1===r?A.offsetY=n:2===r?A.blur=n:A.spread=n,r++):A.color=Be(t,n);}return A}))}},Er={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var A=[];return e.filter(Jt).forEach((function(t){switch(t.value){case"stroke":A.push(1);break;case"fill":A.push(0);break;case"markers":A.push(2);}})),[0,1,2].forEach((function(t){-1===A.indexOf(t)&&A.push(t);})),A}},_r={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},vr={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Wt(e)?e.number:0}},br=function(){function t(t,e){var A,r;this.animationDuration=Mr(t,Br,e.animationDuration),this.backgroundClip=Mr(t,Ie,e.backgroundClip),this.backgroundColor=Mr(t,Se,e.backgroundColor),this.backgroundImage=Mr(t,Ye,e.backgroundImage),this.backgroundOrigin=Mr(t,We,e.backgroundOrigin),this.backgroundPosition=Mr(t,Ze,e.backgroundPosition),this.backgroundRepeat=Mr(t,Je,e.backgroundRepeat),this.backgroundSize=Mr(t,eA,e.backgroundSize),this.borderTopColor=Mr(t,iA,e.borderTopColor),this.borderRightColor=Mr(t,nA,e.borderRightColor),this.borderBottomColor=Mr(t,sA,e.borderBottomColor),this.borderLeftColor=Mr(t,aA,e.borderLeftColor),this.borderTopLeftRadius=Mr(t,hA,e.borderTopLeftRadius),this.borderTopRightRadius=Mr(t,lA,e.borderTopRightRadius),this.borderBottomRightRadius=Mr(t,cA,e.borderBottomRightRadius),this.borderBottomLeftRadius=Mr(t,uA,e.borderBottomLeftRadius),this.borderTopStyle=Mr(t,dA,e.borderTopStyle),this.borderRightStyle=Mr(t,fA,e.borderRightStyle),this.borderBottomStyle=Mr(t,yA,e.borderBottomStyle),this.borderLeftStyle=Mr(t,gA,e.borderLeftStyle),this.borderTopWidth=Mr(t,BA,e.borderTopWidth),this.borderRightWidth=Mr(t,wA,e.borderRightWidth),this.borderBottomWidth=Mr(t,xA,e.borderBottomWidth),this.borderLeftWidth=Mr(t,CA,e.borderLeftWidth),this.boxShadow=Mr(t,Cr,e.boxShadow),this.color=Mr(t,EA,e.color),this.direction=Mr(t,_A,e.direction),this.display=Mr(t,vA,e.display),this.float=Mr(t,UA,e.cssFloat),this.fontFamily=Mr(t,lr,e.fontFamily),this.fontSize=Mr(t,cr,e.fontSize),this.fontStyle=Mr(t,dr,e.fontStyle),this.fontVariant=Mr(t,pr,e.fontVariant),this.fontWeight=Mr(t,ur,e.fontWeight),this.letterSpacing=Mr(t,FA,e.letterSpacing),this.lineBreak=Mr(t,QA,e.lineBreak),this.lineHeight=Mr(t,IA,e.lineHeight),this.listStyleImage=Mr(t,TA,e.listStyleImage),this.listStylePosition=Mr(t,RA,e.listStylePosition),this.listStyleType=Mr(t,LA,e.listStyleType),this.marginTop=Mr(t,HA,e.marginTop),this.marginRight=Mr(t,OA,e.marginRight),this.marginBottom=Mr(t,DA,e.marginBottom),this.marginLeft=Mr(t,NA,e.marginLeft),this.opacity=Mr(t,ar,e.opacity);var i=Mr(t,kA,e.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=Mr(t,VA,e.overflowWrap),this.paddingTop=Mr(t,KA,e.paddingTop),this.paddingRight=Mr(t,zA,e.paddingRight),this.paddingBottom=Mr(t,XA,e.paddingBottom),this.paddingLeft=Mr(t,qA,e.paddingLeft),this.paintOrder=Mr(t,Er,e.paintOrder),this.position=Mr(t,YA,e.position),this.textAlign=Mr(t,jA,e.textAlign),this.textDecorationColor=Mr(t,or,null!==(A=e.textDecorationColor)&&void 0!==A?A:e.color),this.textDecorationLine=Mr(t,hr,null!==(r=e.textDecorationLine)&&void 0!==r?r:e.textDecoration),this.textShadow=Mr(t,WA,e.textShadow),this.textTransform=Mr(t,ZA,e.textTransform),this.transform=Mr(t,JA,e.transform),this.transformOrigin=Mr(t,Ar,e.transformOrigin),this.visibility=Mr(t,rr,e.visibility),this.webkitTextStrokeColor=Mr(t,_r,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=Mr(t,vr,e.webkitTextStrokeWidth),this.wordBreak=Mr(t,ir,e.wordBreak),this.zIndex=Mr(t,nr,e.zIndex);}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},t.prototype.isTransparent=function(){return we(this.backgroundColor)},t.prototype.isTransformed=function(){return null!==this.transform},t.prototype.isPositioned=function(){return 0!==this.position},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return 0!==this.float},t.prototype.isInlineLevel=function(){return fr(this.display,4)||fr(this.display,33554432)||fr(this.display,268435456)||fr(this.display,536870912)||fr(this.display,67108864)||fr(this.display,134217728)},t}(),Ur=function(t,e){this.content=Mr(t,yr,e.content),this.quotes=Mr(t,wr,e.quotes);},Fr=function(t,e){this.counterIncrement=Mr(t,gr,e.counterIncrement),this.counterReset=Mr(t,mr,e.counterReset);},Mr=function(t,e,A){var r=new jt,i=null!=A?A.toString():e.initialValue;r.write(i);var n=new Yt(r.read());switch(e.type){case 2:var s=n.parseComponentValue();return e.parse(t,Jt(s)?s.value:e.initialValue);case 0:return e.parse(t,n.parseComponentValue());case 1:return e.parse(t,n.parseComponentValues());case 4:return n.parseComponentValue();case 3:switch(e.format){case"angle":return fe(0,n.parseComponentValue());case"color":return Be(t,n.parseComponentValue());case"image":return qe(t,n.parseComponentValue());case"length":var a=n.parseComponentValue();return ne(a)?a:oe;case"length-percentage":var o=n.parseComponentValue();return se(o)?o:oe;case"time":return sr.parse(t,n.parseComponentValue())}}},Qr=function(t,e){var A=function(t){switch(t.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(t);return 1===A||e===A},Ir=function(t,e){this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Qr(e,3),this.styles=new br(t,window.getComputedStyle(e,null)),Si(e)&&(this.styles.animationDuration.some((function(t){return t>0}))&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=a(this.context,e),Qr(e,4)&&(this.flags|=16);},Sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tr="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Rr=0;Rr<Sr.length;Rr++)Tr[Sr.charCodeAt(Rr)]=Rr;for(var Lr=function(t,e,A){return t.slice?t.slice(e,A):new Uint16Array(Array.prototype.slice.call(t,e,A))},Pr=function(){function t(t,e,A,r,i,n){this.initialValue=t,this.errorValue=e,this.highStart=A,this.highValueIndex=r,this.index=i,this.data=n;}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return this.data[e=((e=this.index[t>>5])<<2)+(31&t)];if(t<=65535)return this.data[e=((e=this.index[2048+(t-55296>>5)])<<2)+(31&t)];if(t<this.highStart)return e=this.index[e=2080+(t>>11)],this.data[e=((e=this.index[e+=t>>5&63])<<2)+(31&t)];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),Hr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Or="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Dr=0;Dr<Hr.length;Dr++)Or[Hr.charCodeAt(Dr)]=Dr;var Nr,kr=8,Vr=9,Gr=11,Kr=12,zr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var A=t.length;if(!A)return "";for(var r=[],i=-1,n="";++i<A;){var s=t[i];s<=65535?r.push(s):r.push(55296+((s-=65536)>>10),s%1024+56320),(i+1===A||r.length>16384)&&(n+=String.fromCharCode.apply(String,r),r.length=0);}return n},Xr=function(t,e){var A,r,i,n=function(t){var e,A,r,i,n,s=.75*t.length,a=t.length,o=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var h="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),l=Array.isArray(h)?h:new Uint8Array(h);for(e=0;e<a;e+=4)A=Tr[t.charCodeAt(e)],r=Tr[t.charCodeAt(e+1)],i=Tr[t.charCodeAt(e+2)],n=Tr[t.charCodeAt(e+3)],l[o++]=A<<2|r>>4,l[o++]=(15&r)<<4|i>>2,l[o++]=(3&i)<<6|63&n;return h}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),s=Array.isArray(n)?function(t){for(var e=t.length,A=[],r=0;r<e;r+=4)A.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return A}(n):new Uint32Array(n),a=Array.isArray(n)?function(t){for(var e=t.length,A=[],r=0;r<e;r+=2)A.push(t[r+1]<<8|t[r]);return A}(n):new Uint16Array(n),o=Lr(a,12,s[4]/2),h=2===s[5]?Lr(a,(24+s[4])/2):(A=s,r=Math.ceil((24+s[4])/4),A.slice?A.slice(r,i):new Uint32Array(Array.prototype.slice.call(A,r,i)));return new Pr(s[0],s[1],s[2],s[3],o,h)}(),qr="×",jr=function(t){return Xr.get(t)},Yr=function(t,e,A){var r=A-2,i=e[r],n=e[A-1],s=e[A];if(2===n&&3===s)return qr;if(2===n||3===n||4===n)return "÷";if(2===s||3===s||4===s)return "÷";if(n===kr&&-1!==[kr,Vr,Gr,Kr].indexOf(s))return qr;if(!(n!==Gr&&n!==Vr||s!==Vr&&10!==s))return qr;if((n===Kr||10===n)&&10===s)return qr;if(13===s||5===s)return qr;if(7===s)return qr;if(1===n)return qr;if(13===n&&14===s){for(;5===i;)i=e[--r];if(14===i)return qr}if(15===n&&15===s){for(var a=0;15===i;)a++,i=e[--r];if(a%2==0)return qr}return "÷"},Wr=function(t){var e=function(t){for(var e=[],A=0,r=t.length;A<r;){var i=t.charCodeAt(A++);if(i>=55296&&i<=56319&&A<r){var n=t.charCodeAt(A++);56320==(64512&n)?e.push(((1023&i)<<10)+(1023&n)+65536):(e.push(i),A--);}else e.push(i);}return e}(t),A=e.length,r=0,i=0,n=e.map(jr);return {next:function(){if(r>=A)return {done:!0,value:null};for(var t=qr;r<A&&(t=Yr(0,n,++r))===qr;);if(t!==qr||r===A){var s=zr.apply(null,e.slice(i,r));return i=r,{value:s,done:!1}}return {done:!0,value:null}}}},Zr=function(t){return 0===t[0]&&255===t[1]&&0===t[2]&&255===t[3]},Jr=function(t,e,A,r,i){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),a=document.createElementNS(n,"foreignObject");return s.setAttributeNS(null,"width",t.toString()),s.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",A.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(a),a.appendChild(i),s},$r=function(t){return new Promise((function(e,A){var r=new Image;r.onload=function(){return e(r)},r.onerror=A,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t));}))},ti={get SUPPORT_RANGE_BOUNDS(){var t=function(t){if(t.createRange){var e=t.createRange();if(e.getBoundingClientRect){var A=t.createElement("boundtest");A.style.height="123px",A.style.display="block",t.body.appendChild(A),e.selectNode(A);var r=e.getBoundingClientRect(),i=Math.round(r.height);if(t.body.removeChild(A),123===i)return !0}}return !1}(document);return Object.defineProperty(ti,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=ti.SUPPORT_RANGE_BOUNDS&&function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var A=t.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=e.firstChild,i=o(r.data).map((function(t){return h(t)})),n=0,s={},a=i.every((function(t,e){A.setStart(r,n),A.setEnd(r,n+t.length);var i=A.getBoundingClientRect();n+=t.length;var a=i.x>s.x||i.y>s.y;return s=i,0===e||a}));return t.body.removeChild(e),a}(document);return Object.defineProperty(ti,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=function(t){var e=new Image,A=t.createElement("canvas"),r=A.getContext("2d");if(!r)return !1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),A.toDataURL();}catch(t){return !1}return !0}(document);return Object.defineProperty(ti,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var e=t.createElement("canvas"),A=100;e.width=A,e.height=A;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,A,A);var i=new Image,n=e.toDataURL();i.src=n;var s=Jr(A,A,0,0,i);return r.fillStyle="red",r.fillRect(0,0,A,A),$r(s).then((function(e){r.drawImage(e,0,0);var i=r.getImageData(0,0,A,A).data;r.fillStyle="red",r.fillRect(0,0,A,A);var s=t.createElement("div");return s.style.backgroundImage="url("+n+")",s.style.height="100px",Zr(i)?$r(Jr(A,A,0,0,s)):Promise.reject(!1)})).then((function(t){return r.drawImage(t,0,0),Zr(r.getImageData(0,0,A,A).data)})).catch((function(){return !1}))}(document):Promise.resolve(!1);return Object.defineProperty(ti,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=void 0!==(new Image).crossOrigin;return Object.defineProperty(ti,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(ti,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(ti,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(ti,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},ei=function(t,e){this.text=t,this.bounds=e;},Ai=function(t,e,A){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(t,e),i.setEnd(t,e+A),i},ri=function(t){if(ti.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map((function(t){return t.segment}))}return function(t){for(var e,A=Wr(t),r=[];!(e=A.next()).done;)e.value&&r.push(e.value.slice());return r}(t)},ii=[32,160,4961,65792,65793,4153,4241],ni=function(t,e){for(var A,r=function(t,e){var A=o(t),r=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var A=function(t,e){void 0===e&&(e="strict");var A=[],r=[],i=[];return t.forEach((function(t,n){var s=At.get(t);if(s>50?(i.push(!0),s-=50):i.push(!1),-1!==["normal","auto","loose"].indexOf(e)&&-1!==[8208,8211,12316,12448].indexOf(t))return r.push(n),A.push(16);if(4===s||11===s){if(0===n)return r.push(n),A.push(G);var a=A[n-1];return -1===at.indexOf(a)?(r.push(r[n-1]),A.push(a)):(r.push(n),A.push(G))}return r.push(n),31===s?A.push("strict"===e?P:j):s===J||29===s?A.push(G):43===s?A.push(t>=131072&&t<=196605||t>=196608&&t<=262141?j:G):void A.push(s)})),[r,A,i]}(t,e.lineBreak),r=A[0],i=A[1],n=A[2];"break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(i=i.map((function(t){return -1!==[D,G,J].indexOf(t)?j:t})));var s="keep-all"===e.wordBreak?n.map((function(e,A){return e&&t[A]>=19968&&t[A]<=40959})):void 0;return [r,i,s]}(A,e),i=r[0],n=r[1],s=r[2],a=A.length,h=0,l=0;return {next:function(){if(l>=a)return {done:!0,value:null};for(var t=tt;l<a&&(t=ut(A,n,i,++l,s))===tt;);if(t!==tt||l===a){var e=new pt(A,t,h,l);return h=l,{value:e,done:!1}}return {done:!0,value:null}}}}(t,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),i=[],n=function(){if(A.value){var t=A.value.slice(),e=o(t),r="";e.forEach((function(t){-1===ii.indexOf(t)?r+=h(t):(r.length&&i.push(r),i.push(h(t)),r="");})),r.length&&i.push(r);}};!(A=r.next()).done;)n();return i},si=function(t,e,A){this.text=ai(e.data,A.textTransform),this.textBounds=function(t,e,A,r){var i=function(t,e){return 0!==e.letterSpacing?ri(t):function(t,e){if(ti.SUPPORT_NATIVE_TEXT_SEGMENTATION){var A=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(A.segment(t)).map((function(t){return t.segment}))}return ni(t,e)}(t,e)}(e,A),n=[],o=0;return i.forEach((function(e){if(A.textDecorationLine.length||e.trim().length>0)if(ti.SUPPORT_RANGE_BOUNDS){var i=Ai(r,o,e.length).getClientRects();if(i.length>1){var h=ri(e),l=0;h.forEach((function(e){n.push(new ei(e,s.fromDOMRectList(t,Ai(r,l+o,e.length).getClientRects()))),l+=e.length;}));}else n.push(new ei(e,s.fromDOMRectList(t,i)));}else {var c=r.splitText(e.length);n.push(new ei(e,function(t,e){var A=e.ownerDocument;if(A){var r=A.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(r,e);var n=a(t,r);return r.firstChild&&i.replaceChild(r.firstChild,r),n}}return s.EMPTY}(t,r))),r=c;}else ti.SUPPORT_RANGE_BOUNDS||(r=r.splitText(e.length));o+=e.length;})),n}(t,this.text,A,e);},ai=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(oi,hi);case 2:return t.toUpperCase();default:return t}},oi=/(^|\s|:|-|\(|\))([a-z])/g,hi=function(t,e,A){return t.length>0?e+A.toUpperCase():t},li=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.src=A.currentSrc||A.src,r.intrinsicWidth=A.naturalWidth,r.intrinsicHeight=A.naturalHeight,r.context.cache.addImage(r.src),r}return e(A,t),A}(Ir),ci=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.canvas=A,r.intrinsicWidth=A.width,r.intrinsicHeight=A.height,r}return e(A,t),A}(Ir),ui=function(t){function A(e,A){var r=t.call(this,e,A)||this,i=new XMLSerializer,n=a(e,A);return A.setAttribute("width",n.width+"px"),A.setAttribute("height",n.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(A)),r.intrinsicWidth=A.width.baseVal.value,r.intrinsicHeight=A.height.baseVal.value,r.context.cache.addImage(r.svg),r}return e(A,t),A}(Ir),pi=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.value=A.value,r}return e(A,t),A}(Ir),di=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.start=A.start,r.reversed="boolean"==typeof A.reversed&&!0===A.reversed,r}return e(A,t),A}(Ir),fi=[{type:15,flags:0,unit:"px",number:3}],yi=[{type:16,flags:0,number:50}],gi="checkbox",mi="radio",Bi=707406591,wi=function(t){function A(e,A){var r=t.call(this,e,A)||this;switch(r.type=A.type.toLowerCase(),r.checked=A.checked,r.value=function(t){var e="password"===t.type?new Array(t.value.length+1).join("•"):t.value;return 0===e.length?t.placeholder||"":e}(A),r.type!==gi&&r.type!==mi||(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=function(t){return t.width>t.height?new s(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new s(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t}(r.bounds)),r.type){case gi:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=fi;break;case mi:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=yi;}return r}return e(A,t),A}(Ir),xi=function(t){function A(e,A){var r=t.call(this,e,A)||this,i=A.options[A.selectedIndex||0];return r.value=i&&i.text||"",r}return e(A,t),A}(Ir),Ci=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.value=A.value,r}return e(A,t),A}(Ir),Ei=function(t){function A(e,A){var r=t.call(this,e,A)||this;r.src=A.src,r.width=parseInt(A.width,10)||0,r.height=parseInt(A.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(A.contentWindow&&A.contentWindow.document&&A.contentWindow.document.documentElement){r.tree=Ui(e,A.contentWindow.document.documentElement);var i=A.contentWindow.document.documentElement?Me(e,getComputedStyle(A.contentWindow.document.documentElement).backgroundColor):Qe.TRANSPARENT,n=A.contentWindow.document.body?Me(e,getComputedStyle(A.contentWindow.document.body).backgroundColor):Qe.TRANSPARENT;r.backgroundColor=we(i)?we(n)?r.styles.backgroundColor:n:i;}}catch(t){}return r}return e(A,t),A}(Ir),_i=["OL","UL","MENU"],vi=function(t,e,A,r){for(var i=e.firstChild,n=void 0;i;i=n)if(n=i.nextSibling,Qi(i)&&i.data.trim().length>0)A.textNodes.push(new si(t,i,A.styles));else if(Ii(i))if(Xi(i)&&i.assignedNodes)i.assignedNodes().forEach((function(e){return vi(t,e,A,r)}));else {var s=bi(t,i);s.styles.isVisible()&&(Fi(i,s,r)?s.flags|=4:Mi(s.styles)&&(s.flags|=2),-1!==_i.indexOf(i.tagName)&&(s.flags|=8),A.elements.push(s),i.shadowRoot?vi(t,i.shadowRoot,s,r):Ki(i)||Hi(i)||zi(i)||vi(t,i,s,r));}},bi=function(t,e){return ki(e)?new li(t,e):Di(e)?new ci(t,e):Hi(e)?new ui(t,e):Ri(e)?new pi(t,e):Li(e)?new di(t,e):Pi(e)?new wi(t,e):zi(e)?new xi(t,e):Ki(e)?new Ci(t,e):Vi(e)?new Ei(t,e):new Ir(t,e)},Ui=function(t,e){var A=bi(t,e);return A.flags|=4,vi(t,e,A,A),A},Fi=function(t,e,A){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Oi(t)&&A.styles.isTransparent()},Mi=function(t){return t.isPositioned()||t.isFloating()},Qi=function(t){return t.nodeType===Node.TEXT_NODE},Ii=function(t){return t.nodeType===Node.ELEMENT_NODE},Si=function(t){return Ii(t)&&void 0!==t.style&&!Ti(t)},Ti=function(t){return "object"==typeof t.className},Ri=function(t){return "LI"===t.tagName},Li=function(t){return "OL"===t.tagName},Pi=function(t){return "INPUT"===t.tagName},Hi=function(t){return "svg"===t.tagName},Oi=function(t){return "BODY"===t.tagName},Di=function(t){return "CANVAS"===t.tagName},Ni=function(t){return "VIDEO"===t.tagName},ki=function(t){return "IMG"===t.tagName},Vi=function(t){return "IFRAME"===t.tagName},Gi=function(t){return "STYLE"===t.tagName},Ki=function(t){return "TEXTAREA"===t.tagName},zi=function(t){return "SELECT"===t.tagName},Xi=function(t){return "SLOT"===t.tagName},qi=function(t){return t.tagName.indexOf("-")>0},ji=function(){function t(){this.counters={};}return t.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},t.prototype.getCounterValues=function(t){return this.counters[t]||[]},t.prototype.pop=function(t){var e=this;t.forEach((function(t){return e.counters[t].pop()}));},t.prototype.parse=function(t){var e=this,A=t.counterIncrement,r=t.counterReset,i=!0;null!==A&&A.forEach((function(t){var A=e.counters[t.counter];A&&0!==t.increment&&(i=!1,A.length||A.push(1),A[Math.max(0,A.length-1)]+=t.increment);}));var n=[];return i&&r.forEach((function(t){var A=e.counters[t.counter];n.push(t.counter),A||(A=e.counters[t.counter]=[]),A.push(t.reset);})),n},t}(),Yi={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Wi={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},Zi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Ji={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},$i=function(t,e,A,r,i,n){return t<e||t>A?hn(t,i,n.length>0):r.integers.reduce((function(e,A,i){for(;t>=A;)t-=A,e+=r.values[i];return e}),"")+n},tn=function(t,e,A,r){var i="";do{A||t--,i=r(t)+i,t/=e;}while(t*e>=e);return i},en=function(t,e,A,r,i){var n=A-e+1;return (t<0?"-":"")+(tn(Math.abs(t),n,r,(function(t){return h(Math.floor(t%n)+e)}))+i)},An=function(t,e,A){void 0===A&&(A=". ");var r=e.length;return tn(Math.abs(t),r,!1,(function(t){return e[Math.floor(t%r)]}))+A},rn=function(t,e,A,r,i,n){if(t<-9999||t>9999)return hn(t,4,i.length>0);var s=Math.abs(t),a=i;if(0===s)return e[0]+a;for(var o=0;s>0&&o<=4;o++){var h=s%10;0===h&&fr(n,1)&&""!==a?a=e[h]+a:h>1||1===h&&0===o||1===h&&1===o&&fr(n,2)||1===h&&1===o&&fr(n,4)&&t>100||1===h&&o>1&&fr(n,8)?a=e[h]+(o>0?A[o-1]:"")+a:1===h&&o>0&&(a=A[o-1]+a),s=Math.floor(s/10);}return (t<0?r:"")+a},nn="十百千萬",sn="拾佰仟萬",an="マイナス",on="마이너스",hn=function(t,e,A){var r=A?". ":"",i=A?"、":"",n=A?", ":"",s=A?" ":"";switch(e){case 0:return "•"+s;case 1:return "◦"+s;case 2:return "◾"+s;case 5:var a=en(t,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return An(t,"〇一二三四五六七八九",i);case 6:return $i(t,1,3999,Yi,3,r).toLowerCase();case 7:return $i(t,1,3999,Yi,3,r);case 8:return en(t,945,969,!1,r);case 9:return en(t,97,122,!1,r);case 10:return en(t,65,90,!1,r);case 11:return en(t,1632,1641,!0,r);case 12:case 49:return $i(t,1,9999,Wi,3,r);case 35:return $i(t,1,9999,Wi,3,r).toLowerCase();case 13:return en(t,2534,2543,!0,r);case 14:case 30:return en(t,6112,6121,!0,r);case 15:return An(t,"子丑寅卯辰巳午未申酉戌亥",i);case 16:return An(t,"甲乙丙丁戊己庚辛壬癸",i);case 17:case 48:return rn(t,"零一二三四五六七八九",nn,"負",i,14);case 47:return rn(t,"零壹貳參肆伍陸柒捌玖",sn,"負",i,15);case 42:return rn(t,"零一二三四五六七八九",nn,"负",i,14);case 41:return rn(t,"零壹贰叁肆伍陆柒捌玖",sn,"负",i,15);case 26:return rn(t,"〇一二三四五六七八九","十百千万",an,i,0);case 25:return rn(t,"零壱弐参四伍六七八九","拾百千万",an,i,7);case 31:return rn(t,"영일이삼사오육칠팔구","십백천만",on,n,7);case 33:return rn(t,"零一二三四五六七八九","十百千萬",on,n,0);case 32:return rn(t,"零壹貳參四五六七八九","拾百千",on,n,7);case 18:return en(t,2406,2415,!0,r);case 20:return $i(t,1,19999,Ji,3,r);case 21:return en(t,2790,2799,!0,r);case 22:return en(t,2662,2671,!0,r);case 22:return $i(t,1,10999,Zi,3,r);case 23:return An(t,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return An(t,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return en(t,3302,3311,!0,r);case 28:return An(t,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case 29:return An(t,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case 34:return en(t,3792,3801,!0,r);case 37:return en(t,6160,6169,!0,r);case 38:return en(t,4160,4169,!0,r);case 39:return en(t,2918,2927,!0,r);case 40:return en(t,1776,1785,!0,r);case 43:return en(t,3046,3055,!0,r);case 44:return en(t,3174,3183,!0,r);case 45:return en(t,3664,3673,!0,r);case 46:return en(t,3872,3881,!0,r);default:return en(t,48,57,!0,r)}},ln="data-html2canvas-ignore",cn=function(){function t(t,e,A){if(this.context=t,this.options=A,this.scrolledElements=[],this.referenceElement=e,this.counters=new ji,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1);}return t.prototype.toIFrame=function(t,e){var A=this,n=pn(t,e);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var s=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,o=n.contentWindow,h=o.document,l=yn(n).then((function(){return r(A,void 0,void 0,(function(){var t,A;return i(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(xn),o&&(o.scrollTo(e.left,e.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||o.scrollY===e.top&&o.scrollX===e.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),t=this.options.onclone,void 0===(A=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:h.fonts&&h.fonts.ready?[4,h.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return /(AppleWebKit)/g.test(navigator.userAgent)?[4,fn(h)]:[3,4];case 3:r.sent(),r.label=4;case 4:return "function"==typeof t?[2,Promise.resolve().then((function(){return t(h,A)})).then((function(){return n}))]:[2,n]}}))}))}));return h.open(),h.write(Bn(document.doctype)+"<html></html>"),wn(this.referenceElement.ownerDocument,s,a),h.replaceChild(h.adoptNode(this.documentElement),h.documentElement),h.close(),l},t.prototype.createElementClone=function(t){if(Qr(t,2),Di(t))return this.createCanvasClone(t);if(Ni(t))return this.createVideoClone(t);if(Gi(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return ki(e)&&(ki(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),qi(e)?this.createCustomElementClone(e):e},t.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return mn(t.style,e),e},t.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var A=[].slice.call(e.cssRules,0).reduce((function(t,e){return e&&"string"==typeof e.cssText?t+e.cssText:t}),""),r=t.cloneNode(!1);return r.textContent=A,r}}catch(t){if(this.context.logger.error("Unable to access cssRules property",t),"SecurityError"!==t.name)throw t}return t.cloneNode(!1)},t.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var A=t.ownerDocument.createElement("img");try{return A.src=t.toDataURL(),A}catch(e){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t);}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var i=t.getContext("2d"),n=r.getContext("2d");if(n)if(!this.options.allowTaint&&i)n.putImageData(i.getImageData(0,0,t.width,t.height),0,0);else {var s=null!==(e=t.getContext("webgl2"))&&void 0!==e?e:t.getContext("webgl");if(s){var a=s.getContextAttributes();!1===(null==a?void 0:a.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t);}n.drawImage(t,0,0);}return r}catch(e){this.context.logger.info("Unable to clone canvas as it is tainted",t);}return r},t.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var A=e.getContext("2d");try{return A&&(A.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||A.getImageData(0,0,e.width,e.height)),e}catch(e){this.context.logger.info("Unable to clone video as it is tainted",t);}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},t.prototype.appendChildNode=function(t,e,A){Ii(e)&&(function(t){return "SCRIPT"===t.tagName}(e)||e.hasAttribute(ln)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&Ii(e)&&Gi(e)||t.appendChild(this.cloneNode(e,A));},t.prototype.cloneChildNodes=function(t,e,A){for(var r=this,i=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;i;i=i.nextSibling)if(Ii(i)&&Xi(i)&&"function"==typeof i.assignedNodes){var n=i.assignedNodes();n.length&&n.forEach((function(t){return r.appendChildNode(e,t,A)}));}else this.appendChildNode(e,i,A);},t.prototype.cloneNode=function(t,e){if(Qi(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var A=t.ownerDocument.defaultView;if(A&&Ii(t)&&(Si(t)||Ti(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var i=A.getComputedStyle(t),n=A.getComputedStyle(t,":before"),s=A.getComputedStyle(t,":after");this.referenceElement===t&&Si(r)&&(this.clonedReferenceElement=r),Oi(r)&&vn(r);var a=this.counters.parse(new Fr(this.context,i)),o=this.resolvePseudoContent(t,r,n,Nr.BEFORE);qi(t)&&(e=!0),Ni(t)||this.cloneChildNodes(t,r,e),o&&r.insertBefore(o,r.firstChild);var h=this.resolvePseudoContent(t,r,s,Nr.AFTER);return h&&r.appendChild(h),this.counters.pop(a),(i&&(this.options.copyStyles||Ti(t))&&!Vi(t)||e)&&mn(i,r),0===t.scrollTop&&0===t.scrollLeft||this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(Ki(t)||zi(t))&&(Ki(r)||zi(r))&&(r.value=t.value),r}return t.cloneNode(!1)},t.prototype.resolvePseudoContent=function(t,e,A,r){var i=this;if(A){var n=A.content,s=e.ownerDocument;if(s&&n&&"none"!==n&&"-moz-alt-content"!==n&&"none"!==A.display){this.counters.parse(new Fr(this.context,A));var a=new Ur(this.context,A),o=s.createElement("html2canvaspseudoelement");mn(A,o),a.content.forEach((function(e){if(0===e.type)o.appendChild(s.createTextNode(e.value));else if(22===e.type){var A=s.createElement("img");A.src=e.value,A.style.opacity="1",o.appendChild(A);}else if(18===e.type){if("attr"===e.name){var r=e.values.filter(Jt);r.length&&o.appendChild(s.createTextNode(t.getAttribute(r[0].value)||""));}else if("counter"===e.name){var n=e.values.filter(Ae),h=n[1];if((u=n[0])&&Jt(u)){var l=i.counters.getCounterValue(u.value),c=h&&Jt(h)?LA.parse(i.context,h.value):3;o.appendChild(s.createTextNode(hn(l,c,!1)));}}else if("counters"===e.name){var u,p=e.values.filter(Ae),d=p[1];if(h=p[2],(u=p[0])&&Jt(u)){var f=i.counters.getCounterValues(u.value),y=h&&Jt(h)?LA.parse(i.context,h.value):3,g=d&&0===d.type?d.value:"",m=f.map((function(t){return hn(t,y,!1)})).join(g);o.appendChild(s.createTextNode(m));}}}else if(20===e.type)switch(e.value){case"open-quote":o.appendChild(s.createTextNode(xr(a.quotes,i.quoteDepth++,!0)));break;case"close-quote":o.appendChild(s.createTextNode(xr(a.quotes,--i.quoteDepth,!1)));break;default:o.appendChild(s.createTextNode(e.value));}})),o.className=Cn+" "+En;var h=r===Nr.BEFORE?" "+Cn:" "+En;return Ti(e)?e.className.baseValue+=h:e.className+=h,o}}},t.destroy=function(t){return !!t.parentNode&&(t.parentNode.removeChild(t),!0)},t}();!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER";}(Nr||(Nr={}));var un,pn=function(t,e){var A=t.createElement("iframe");return A.className="html2canvas-container",A.style.visibility="hidden",A.style.position="fixed",A.style.left="-10000px",A.style.top="0px",A.style.border="0",A.width=e.width.toString(),A.height=e.height.toString(),A.scrolling="no",A.setAttribute(ln,"true"),t.body.appendChild(A),A},dn=function(t){return new Promise((function(e){t.complete?e():t.src?(t.onload=e,t.onerror=e):e();}))},fn=function(t){return Promise.all([].slice.call(t.images,0).map(dn))},yn=function(t){return new Promise((function(e,A){var r=t.contentWindow;if(!r)return A("No window assigned for iframe");var i=r.document;r.onload=t.onload=function(){r.onload=t.onload=null;var A=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(A),e(t));}),50);};}))},gn=["all","d","content"],mn=function(t,e){for(var A=t.length-1;A>=0;A--){var r=t.item(A);-1===gn.indexOf(r)&&e.style.setProperty(r,t.getPropertyValue(r));}return e},Bn=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},wn=function(t,e,A){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||A!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,A);},xn=function(t){var e=t[0],A=t[2];e.scrollLeft=t[1],e.scrollTop=A;},Cn="___html2canvas___pseudoelement_before",En="___html2canvas___pseudoelement_after",_n='{\n    content: "" !important;\n    display: none !important;\n}',vn=function(t){bn(t,"."+Cn+":before"+_n+"\n         ."+En+":after"+_n);},bn=function(t,e){var A=t.ownerDocument;if(A){var r=A.createElement("style");r.textContent=e,t.appendChild(r);}},Un=function(){function t(){}return t.getOrigin=function(e){var A=t._link;return A?(A.href=e,A.href=A.href,A.protocol+A.hostname+A.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href);},t._origin="about:blank",t}(),Fn=function(){function t(t,e){this.context=t,this._options=e,this._cache={};}return t.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)?e:Ln(t)||Sn(t)?((this._cache[t]=this.loadImage(t)).catch((function(){})),e):e},t.prototype.match=function(t){return this._cache[t]},t.prototype.loadImage=function(t){return r(this,void 0,void 0,(function(){var e,A,r,n,s=this;return i(this,(function(i){switch(i.label){case 0:return e=Un.isSameOrigin(t),A=!Tn(t)&&!0===this._options.useCORS&&ti.SUPPORT_CORS_IMAGES&&!e,r=!Tn(t)&&!e&&!Ln(t)&&"string"==typeof this._options.proxy&&ti.SUPPORT_CORS_XHR&&!A,e||!1!==this._options.allowTaint||Tn(t)||Ln(t)||r||A?(n=t,r?[4,this.proxy(n)]:[3,2]):[2];case 1:n=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise((function(t,e){var r=new Image;r.onload=function(){return t(r)},r.onerror=e,(Rn(n)||A)&&(r.crossOrigin="anonymous"),r.src=n,!0===r.complete&&setTimeout((function(){return t(r)}),500),s._options.imageTimeout>0&&setTimeout((function(){return e("Timed out ("+s._options.imageTimeout+"ms) loading image")}),s._options.imageTimeout);}))];case 3:return [2,i.sent()]}}))}))},t.prototype.has=function(t){return void 0!==this._cache[t]},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(t){var e=this,A=this._options.proxy;if(!A)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise((function(i,n){var s=ti.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===s)i(a.response);else {var t=new FileReader;t.addEventListener("load",(function(){return i(t.result)}),!1),t.addEventListener("error",(function(t){return n(t)}),!1),t.readAsDataURL(a.response);}else n("Failed to proxy resource "+r+" with status code "+a.status);},a.onerror=n;var o=A.indexOf("?")>-1?"&":"?";if(a.open("GET",""+A+o+"url="+encodeURIComponent(t)+"&responseType="+s),"text"!==s&&a instanceof XMLHttpRequest&&(a.responseType=s),e._options.imageTimeout){var h=e._options.imageTimeout;a.timeout=h,a.ontimeout=function(){return n("Timed out ("+h+"ms) proxying "+r)};}a.send();}))},t}(),Mn=/^data:image\/svg\+xml/i,Qn=/^data:image\/.*;base64,/i,In=/^data:image\/.*/i,Sn=function(t){return ti.SUPPORT_SVG_DRAWING||!Pn(t)},Tn=function(t){return In.test(t)},Rn=function(t){return Qn.test(t)},Ln=function(t){return "blob"===t.substr(0,4)},Pn=function(t){return "svg"===t.substr(-3).toLowerCase()||Mn.test(t)},Hn=function(){function t(t,e){this.type=0,this.x=t,this.y=e;}return t.prototype.add=function(e,A){return new t(this.x+e,this.y+A)},t}(),On=function(t,e,A){return new Hn(t.x+(e.x-t.x)*A,t.y+(e.y-t.y)*A)},Dn=function(){function t(t,e,A,r){this.type=1,this.start=t,this.startControl=e,this.endControl=A,this.end=r;}return t.prototype.subdivide=function(e,A){var r=On(this.start,this.startControl,e),i=On(this.startControl,this.endControl,e),n=On(this.endControl,this.end,e),s=On(r,i,e),a=On(i,n,e),o=On(s,a,e);return A?new t(this.start,r,s,o):new t(o,a,n,this.end)},t.prototype.add=function(e,A){return new t(this.start.add(e,A),this.startControl.add(e,A),this.endControl.add(e,A),this.end.add(e,A))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Nn=function(t){return 1===t.type},kn=function(t){var e=t.styles,A=t.bounds,r=ce(e.borderTopLeftRadius,A.width,A.height),i=r[0],n=r[1],s=ce(e.borderTopRightRadius,A.width,A.height),a=s[0],o=s[1],h=ce(e.borderBottomRightRadius,A.width,A.height),l=h[0],c=h[1],u=ce(e.borderBottomLeftRadius,A.width,A.height),p=u[0],d=u[1],f=[];f.push((i+a)/A.width),f.push((p+l)/A.width),f.push((n+d)/A.height),f.push((o+c)/A.height);var y=Math.max.apply(Math,f);y>1&&(i/=y,n/=y,a/=y,o/=y,l/=y,c/=y,p/=y,d/=y);var g=A.width-a,m=A.height-c,B=A.width-l,w=A.height-d,x=e.borderTopWidth,C=e.borderRightWidth,E=e.borderBottomWidth,_=e.borderLeftWidth,v=ue(e.paddingTop,t.bounds.width),b=ue(e.paddingRight,t.bounds.width),U=ue(e.paddingBottom,t.bounds.width),F=ue(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||n>0?Vn(A.left+_/3,A.top+x/3,i-_/3,n-x/3,un.TOP_LEFT):new Hn(A.left+_/3,A.top+x/3),this.topRightBorderDoubleOuterBox=i>0||n>0?Vn(A.left+g,A.top+x/3,a-C/3,o-x/3,un.TOP_RIGHT):new Hn(A.left+A.width-C/3,A.top+x/3),this.bottomRightBorderDoubleOuterBox=l>0||c>0?Vn(A.left+B,A.top+m,l-C/3,c-E/3,un.BOTTOM_RIGHT):new Hn(A.left+A.width-C/3,A.top+A.height-E/3),this.bottomLeftBorderDoubleOuterBox=p>0||d>0?Vn(A.left+_/3,A.top+w,p-_/3,d-E/3,un.BOTTOM_LEFT):new Hn(A.left+_/3,A.top+A.height-E/3),this.topLeftBorderDoubleInnerBox=i>0||n>0?Vn(A.left+2*_/3,A.top+2*x/3,i-2*_/3,n-2*x/3,un.TOP_LEFT):new Hn(A.left+2*_/3,A.top+2*x/3),this.topRightBorderDoubleInnerBox=i>0||n>0?Vn(A.left+g,A.top+2*x/3,a-2*C/3,o-2*x/3,un.TOP_RIGHT):new Hn(A.left+A.width-2*C/3,A.top+2*x/3),this.bottomRightBorderDoubleInnerBox=l>0||c>0?Vn(A.left+B,A.top+m,l-2*C/3,c-2*E/3,un.BOTTOM_RIGHT):new Hn(A.left+A.width-2*C/3,A.top+A.height-2*E/3),this.bottomLeftBorderDoubleInnerBox=p>0||d>0?Vn(A.left+2*_/3,A.top+w,p-2*_/3,d-2*E/3,un.BOTTOM_LEFT):new Hn(A.left+2*_/3,A.top+A.height-2*E/3),this.topLeftBorderStroke=i>0||n>0?Vn(A.left+_/2,A.top+x/2,i-_/2,n-x/2,un.TOP_LEFT):new Hn(A.left+_/2,A.top+x/2),this.topRightBorderStroke=i>0||n>0?Vn(A.left+g,A.top+x/2,a-C/2,o-x/2,un.TOP_RIGHT):new Hn(A.left+A.width-C/2,A.top+x/2),this.bottomRightBorderStroke=l>0||c>0?Vn(A.left+B,A.top+m,l-C/2,c-E/2,un.BOTTOM_RIGHT):new Hn(A.left+A.width-C/2,A.top+A.height-E/2),this.bottomLeftBorderStroke=p>0||d>0?Vn(A.left+_/2,A.top+w,p-_/2,d-E/2,un.BOTTOM_LEFT):new Hn(A.left+_/2,A.top+A.height-E/2),this.topLeftBorderBox=i>0||n>0?Vn(A.left,A.top,i,n,un.TOP_LEFT):new Hn(A.left,A.top),this.topRightBorderBox=a>0||o>0?Vn(A.left+g,A.top,a,o,un.TOP_RIGHT):new Hn(A.left+A.width,A.top),this.bottomRightBorderBox=l>0||c>0?Vn(A.left+B,A.top+m,l,c,un.BOTTOM_RIGHT):new Hn(A.left+A.width,A.top+A.height),this.bottomLeftBorderBox=p>0||d>0?Vn(A.left,A.top+w,p,d,un.BOTTOM_LEFT):new Hn(A.left,A.top+A.height),this.topLeftPaddingBox=i>0||n>0?Vn(A.left+_,A.top+x,Math.max(0,i-_),Math.max(0,n-x),un.TOP_LEFT):new Hn(A.left+_,A.top+x),this.topRightPaddingBox=a>0||o>0?Vn(A.left+Math.min(g,A.width-C),A.top+x,g>A.width+C?0:Math.max(0,a-C),Math.max(0,o-x),un.TOP_RIGHT):new Hn(A.left+A.width-C,A.top+x),this.bottomRightPaddingBox=l>0||c>0?Vn(A.left+Math.min(B,A.width-_),A.top+Math.min(m,A.height-E),Math.max(0,l-C),Math.max(0,c-E),un.BOTTOM_RIGHT):new Hn(A.left+A.width-C,A.top+A.height-E),this.bottomLeftPaddingBox=p>0||d>0?Vn(A.left+_,A.top+Math.min(w,A.height-E),Math.max(0,p-_),Math.max(0,d-E),un.BOTTOM_LEFT):new Hn(A.left+_,A.top+A.height-E),this.topLeftContentBox=i>0||n>0?Vn(A.left+_+F,A.top+x+v,Math.max(0,i-(_+F)),Math.max(0,n-(x+v)),un.TOP_LEFT):new Hn(A.left+_+F,A.top+x+v),this.topRightContentBox=a>0||o>0?Vn(A.left+Math.min(g,A.width+_+F),A.top+x+v,g>A.width+_+F?0:a-_+F,o-(x+v),un.TOP_RIGHT):new Hn(A.left+A.width-(C+b),A.top+x+v),this.bottomRightContentBox=l>0||c>0?Vn(A.left+Math.min(B,A.width-(_+F)),A.top+Math.min(m,A.height+x+v),Math.max(0,l-(C+b)),c-(E+U),un.BOTTOM_RIGHT):new Hn(A.left+A.width-(C+b),A.top+A.height-(E+U)),this.bottomLeftContentBox=p>0||d>0?Vn(A.left+_+F,A.top+w,Math.max(0,p-(_+F)),d-(E+U),un.BOTTOM_LEFT):new Hn(A.left+_+F,A.top+A.height-(E+U));};!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT";}(un||(un={}));var Vn=function(t,e,A,r,i){var n=(Math.sqrt(2)-1)/3*4,s=A*n,a=r*n,o=t+A,h=e+r;switch(i){case un.TOP_LEFT:return new Dn(new Hn(t,h),new Hn(t,h-a),new Hn(o-s,e),new Hn(o,e));case un.TOP_RIGHT:return new Dn(new Hn(t,e),new Hn(t+s,e),new Hn(o,h-a),new Hn(o,h));case un.BOTTOM_RIGHT:return new Dn(new Hn(o,e),new Hn(o,e+a),new Hn(t+s,h),new Hn(t,h));default:return new Dn(new Hn(o,h),new Hn(o-s,h),new Hn(t,e+a),new Hn(t,e))}},Gn=function(t){return [t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},Kn=function(t){return [t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},zn=function(t,e,A){this.offsetX=t,this.offsetY=e,this.matrix=A,this.type=0,this.target=6;},Xn=function(t,e){this.path=t,this.target=e,this.type=1;},qn=function(t){this.opacity=t,this.type=2,this.target=6;},jn=function(t){return 1===t.type},Yn=function(t,e){return t.length===e.length&&t.some((function(t,A){return t===e[A]}))},Wn=function(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[];},Zn=function(){function t(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new kn(this.container),this.container.styles.opacity<1&&this.effects.push(new qn(this.container.styles.opacity)),null!==this.container.styles.transform&&this.effects.push(new zn(this.container.bounds.left+this.container.styles.transformOrigin[0].number,this.container.bounds.top+this.container.styles.transformOrigin[1].number,this.container.styles.transform)),0!==this.container.styles.overflowX){var A=Gn(this.curves),r=Kn(this.curves);Yn(A,r)?this.effects.push(new Xn(A,6)):(this.effects.push(new Xn(A,2)),this.effects.push(new Xn(r,4)));}}return t.prototype.getEffects=function(t){for(var e=-1===[2,3].indexOf(this.container.styles.position),A=this.parent,r=this.effects.slice(0);A;){var i=A.effects.filter((function(t){return !jn(t)}));if(e||0!==A.container.styles.position||!A.parent){if(r.unshift.apply(r,i),e=-1===[2,3].indexOf(A.container.styles.position),0!==A.container.styles.overflowX){var n=Gn(A.curves),s=Kn(A.curves);Yn(n,s)||r.unshift(new Xn(s,6));}}else r.unshift.apply(r,i);A=A.parent;}return r.filter((function(e){return fr(e.target,t)}))},t}(),Jn=function(t,e,A,r){t.container.elements.forEach((function(i){var n=fr(i.flags,4),s=fr(i.flags,2),a=new Zn(i,t);fr(i.styles.display,2048)&&r.push(a);var o=fr(i.flags,8)?[]:r;if(n||s){var h=n||i.styles.isPositioned()?A:e,l=new Wn(a);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var c=i.styles.zIndex.order;if(c<0){var u=0;h.negativeZIndex.some((function(t,e){return c>t.element.container.styles.zIndex.order?(u=e,!1):u>0})),h.negativeZIndex.splice(u,0,l);}else if(c>0){var p=0;h.positiveZIndex.some((function(t,e){return c>=t.element.container.styles.zIndex.order?(p=e+1,!1):p>0})),h.positiveZIndex.splice(p,0,l);}else h.zeroOrAutoZIndexOrTransformedOrOpacity.push(l);}else i.styles.isFloating()?h.nonPositionedFloats.push(l):h.nonPositionedInlineLevel.push(l);Jn(a,l,n?l:A,o);}else i.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),Jn(a,e,A,o);fr(i.flags,8)&&$n(i,o);}));},$n=function(t,e){for(var A=t instanceof di?t.start:1,r=t instanceof di&&t.reversed,i=0;i<e.length;i++){var n=e[i];n.container instanceof pi&&"number"==typeof n.container.value&&0!==n.container.value&&(A=n.container.value),n.listValue=hn(A,n.container.styles.listStyleType,!0),A+=r?-1:1;}},ts=function(t,e){switch(e){case 0:return As(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return As(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return As(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);default:return As(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},es=function(t,e){var A=[];return Nn(t)?A.push(t.subdivide(.5,!1)):A.push(t),Nn(e)?A.push(e.subdivide(.5,!0)):A.push(e),A},As=function(t,e,A,r){var i=[];return Nn(t)?i.push(t.subdivide(.5,!1)):i.push(t),Nn(A)?i.push(A.subdivide(.5,!0)):i.push(A),Nn(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),Nn(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},rs=function(t){var e=t.styles;return t.bounds.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},is=function(t){var e=t.styles,A=t.bounds,r=ue(e.paddingLeft,A.width),i=ue(e.paddingRight,A.width),n=ue(e.paddingTop,A.width),s=ue(e.paddingBottom,A.width);return A.add(r+e.borderLeftWidth,n+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+i),-(e.borderTopWidth+e.borderBottomWidth+n+s))},ns=function(t,e,A){var r=function(t,e){return 0===t?e.bounds:2===t?is(e):rs(e)}(hs(t.styles.backgroundOrigin,e),t),i=function(t,e){return 0===t?e.bounds:2===t?is(e):rs(e)}(hs(t.styles.backgroundClip,e),t),n=os(hs(t.styles.backgroundSize,e),A,r),s=n[0],a=n[1],o=ce(hs(t.styles.backgroundPosition,e),r.width-s,r.height-a);return [ls(hs(t.styles.backgroundRepeat,e),o,n,r,i),Math.round(r.left+o[0]),Math.round(r.top+o[1]),s,a]},ss=function(t){return Jt(t)&&t.value===be.AUTO},as=function(t){return "number"==typeof t},os=function(t,e,A){var r=e[0],i=e[1],n=e[2],s=t[0],a=t[1];if(!s)return [0,0];if(se(s)&&a&&se(a))return [ue(s,A.width),ue(a,A.height)];var o=as(n);if(Jt(s)&&(s.value===be.CONTAIN||s.value===be.COVER))return as(n)?A.width/A.height<n!=(s.value===be.COVER)?[A.width,A.width/n]:[A.height*n,A.height]:[A.width,A.height];var h=as(r),l=as(i),c=h||l;if(ss(s)&&(!a||ss(a)))return h&&l?[r,i]:o||c?c&&o?[h?r:i*n,l?i:r/n]:[h?r:A.width,l?i:A.height]:[A.width,A.height];if(o){var u=0,p=0;return se(s)?u=ue(s,A.width):se(a)&&(p=ue(a,A.height)),ss(s)?u=p*n:a&&!ss(a)||(p=u/n),[u,p]}var d=null,f=null;if(se(s)?d=ue(s,A.width):a&&se(a)&&(f=ue(a,A.height)),null===d||a&&!ss(a)||(f=h&&l?d/r*i:A.height),null!==f&&ss(s)&&(d=h&&l?f/i*r:A.width),null!==d&&null!==f)return [d,f];throw new Error("Unable to calculate background-size for element")},hs=function(t,e){var A=t[e];return void 0===A?t[0]:A},ls=function(t,e,A,r,i){var n=e[0],s=e[1],a=A[0],o=A[1];switch(t){case 2:return [new Hn(Math.round(r.left),Math.round(r.top+s)),new Hn(Math.round(r.left+r.width),Math.round(r.top+s)),new Hn(Math.round(r.left+r.width),Math.round(o+r.top+s)),new Hn(Math.round(r.left),Math.round(o+r.top+s))];case 3:return [new Hn(Math.round(r.left+n),Math.round(r.top)),new Hn(Math.round(r.left+n+a),Math.round(r.top)),new Hn(Math.round(r.left+n+a),Math.round(r.height+r.top)),new Hn(Math.round(r.left+n),Math.round(r.height+r.top))];case 1:return [new Hn(Math.round(r.left+n),Math.round(r.top+s)),new Hn(Math.round(r.left+n+a),Math.round(r.top+s)),new Hn(Math.round(r.left+n+a),Math.round(r.top+s+o)),new Hn(Math.round(r.left+n),Math.round(r.top+s+o))];default:return [new Hn(Math.round(i.left),Math.round(i.top)),new Hn(Math.round(i.left+i.width),Math.round(i.top)),new Hn(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Hn(Math.round(i.left),Math.round(i.height+i.top))]}},cs="Hidden Text",us=function(){function t(t){this._data={},this._document=t;}return t.prototype.parseMetrics=function(t,e){var A=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),n=this._document.body;A.style.visibility="hidden",A.style.fontFamily=t,A.style.fontSize=e,A.style.margin="0",A.style.padding="0",A.style.whiteSpace="nowrap",n.appendChild(A),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(cs)),A.appendChild(i),A.appendChild(r);var s=r.offsetTop-i.offsetTop+2;A.removeChild(i),A.appendChild(this._document.createTextNode(cs)),A.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-A.offsetTop+2;return n.removeChild(A),{baseline:s,middle:a}},t.prototype.getMetrics=function(t,e){var A=t+" "+e;return void 0===this._data[A]&&(this._data[A]=this.parseMetrics(t,e)),this._data[A]},t}(),ps=function(t,e){this.context=t,this.options=e;},ds=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r._activeEffects=[],r.canvas=A.canvas?A.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),A.canvas||(r.canvas.width=Math.floor(A.width*A.scale),r.canvas.height=Math.floor(A.height*A.scale),r.canvas.style.width=A.width+"px",r.canvas.style.height=A.height+"px"),r.fontMetrics=new us(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-A.x,-A.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+A.width+"x"+A.height+") with scale "+A.scale),r}return e(A,t),A.prototype.applyEffects=function(t){for(var e=this;this._activeEffects.length;)this.popEffect();t.forEach((function(t){return e.applyEffect(t)}));},A.prototype.applyEffect=function(t){this.ctx.save(),function(t){return 2===t.type}(t)&&(this.ctx.globalAlpha=t.opacity),function(t){return 0===t.type}(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),jn(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t);},A.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore();},A.prototype.renderStack=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.element.container.styles.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},A.prototype.renderNode=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return fr(t.container.flags,16),t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return [2]}}))}))},A.prototype.renderTextWithLetterSpacing=function(t,e,A){var r=this;0===e?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+A):ri(t.text).reduce((function(e,i){return r.ctx.fillText(i,e,t.bounds.top+A),e+r.ctx.measureText(i).width}),t.bounds.left);},A.prototype.createFontStyle=function(t){var e=t.fontVariant.filter((function(t){return "normal"===t||"small-caps"===t})).join(""),A=Bs(t.fontFamily).join(", "),r=Wt(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return [[t.fontStyle,e,t.fontWeight,r,A].join(" "),A,r]},A.prototype.renderTextNode=function(t,e){return r(this,void 0,void 0,(function(){var A,r,n,s,a,o,h,l=this;return i(this,(function(i){return A=this.createFontStyle(e),r=A[1],n=A[2],this.ctx.font=A[0],this.ctx.direction=1===e.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(r,n),a=s.baseline,o=s.middle,h=e.paintOrder,t.textBounds.forEach((function(t){h.forEach((function(A){switch(A){case 0:l.ctx.fillStyle=xe(e.color),l.renderTextWithLetterSpacing(t,e.letterSpacing,a);var r=e.textShadow;r.length&&t.text.trim().length&&(r.slice(0).reverse().forEach((function(A){l.ctx.shadowColor=xe(A.color),l.ctx.shadowOffsetX=A.offsetX.number*l.options.scale,l.ctx.shadowOffsetY=A.offsetY.number*l.options.scale,l.ctx.shadowBlur=A.blur.number,l.renderTextWithLetterSpacing(t,e.letterSpacing,a);})),l.ctx.shadowColor="",l.ctx.shadowOffsetX=0,l.ctx.shadowOffsetY=0,l.ctx.shadowBlur=0),e.textDecorationLine.length&&(l.ctx.fillStyle=xe(e.textDecorationColor||e.color),e.textDecorationLine.forEach((function(e){switch(e){case 1:l.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+a),t.bounds.width,1);break;case 2:l.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:l.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+o),t.bounds.width,1);}})));break;case 1:e.webkitTextStrokeWidth&&t.text.trim().length&&(l.ctx.strokeStyle=xe(e.webkitTextStrokeColor),l.ctx.lineWidth=e.webkitTextStrokeWidth,l.ctx.lineJoin=window.chrome?"miter":"round",l.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+a)),l.ctx.strokeStyle="",l.ctx.lineWidth=0,l.ctx.lineJoin="miter";}}));})),[2]}))}))},A.prototype.renderReplacedElement=function(t,e,A){if(A&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var r=is(t),i=Kn(e);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(A,0,0,t.intrinsicWidth,t.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore();}},A.prototype.renderNodeContent=function(t){return r(this,void 0,void 0,(function(){var e,r,n,a,o,h,l,c,u,p,d,f,y,g,m,B;return i(this,(function(i){switch(i.label){case 0:this.applyEffects(t.getEffects(4)),r=t.curves,n=(e=t.container).styles,a=0,o=e.textNodes,i.label=1;case 1:return a<o.length?[4,this.renderTextNode(o[a],n)]:[3,4];case 2:i.sent(),i.label=3;case 3:return a++,[3,1];case 4:if(!(e instanceof li))return [3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return y=i.sent(),this.renderReplacedElement(e,r,y),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof ci&&this.renderReplacedElement(e,r,e.canvas),!(e instanceof ui))return [3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return y=i.sent(),this.renderReplacedElement(e,r,y),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof Ei&&e.tree?[4,new A(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:h=i.sent(),e.width&&e.height&&this.ctx.drawImage(h,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),i.label=14;case 14:if(e instanceof wi&&(l=Math.min(e.bounds.width,e.bounds.height),e.type===gi?e.checked&&(this.ctx.save(),this.path([new Hn(e.bounds.left+.39363*l,e.bounds.top+.79*l),new Hn(e.bounds.left+.16*l,e.bounds.top+.5549*l),new Hn(e.bounds.left+.27347*l,e.bounds.top+.44071*l),new Hn(e.bounds.left+.39694*l,e.bounds.top+.5649*l),new Hn(e.bounds.left+.72983*l,e.bounds.top+.23*l),new Hn(e.bounds.left+.84*l,e.bounds.top+.34085*l),new Hn(e.bounds.left+.39363*l,e.bounds.top+.79*l)]),this.ctx.fillStyle=xe(Bi),this.ctx.fill(),this.ctx.restore()):e.type===mi&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+l/2,e.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=xe(Bi),this.ctx.fill(),this.ctx.restore())),fs(e)&&e.value.length){switch(c=this.createFontStyle(n),u=this.fontMetrics.getMetrics(m=c[0],c[1]).baseline,this.ctx.font=m,this.ctx.fillStyle=xe(n.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=gs(e.styles.textAlign),B=is(e),p=0,e.styles.textAlign){case 1:p+=B.width/2;break;case 2:p+=B.width;}d=B.add(p,0,0,-B.height/2+1),this.ctx.save(),this.path([new Hn(B.left,B.top),new Hn(B.left+B.width,B.top),new Hn(B.left+B.width,B.top+B.height),new Hn(B.left,B.top+B.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new ei(e.value,d),n.letterSpacing,u),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left";}if(!fr(e.styles.display,2048))return [3,20];if(null===e.styles.listStyleImage)return [3,19];if(0!==(f=e.styles.listStyleImage).type)return [3,18];y=void 0,g=f.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(g)];case 16:return y=i.sent(),this.ctx.drawImage(y,e.bounds.left-(y.width+10),e.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+g),[3,18];case 18:return [3,20];case 19:t.listValue&&-1!==e.styles.listStyleType&&(m=this.createFontStyle(n)[0],this.ctx.font=m,this.ctx.fillStyle=xe(n.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",B=new s(e.bounds.left,e.bounds.top+ue(e.styles.paddingTop,e.bounds.width),e.bounds.width,SA(n.lineHeight,n.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new ei(t.listValue,B),n.letterSpacing,SA(n.lineHeight,n.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return [2]}}))}))},A.prototype.renderStackContent=function(t){return r(this,void 0,void 0,(function(){var e,A,r,n,s,a,o,h,l,c,u,p,d,f;return i(this,(function(i){switch(i.label){case 0:return fr(t.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:i.sent(),e=0,A=t.negativeZIndex,i.label=2;case 2:return e<A.length?[4,this.renderStack(A[e])]:[3,5];case 3:i.sent(),i.label=4;case 4:return e++,[3,2];case 5:return [4,this.renderNodeContent(t.element)];case 6:i.sent(),r=0,n=t.nonInlineLevel,i.label=7;case 7:return r<n.length?[4,this.renderNode(n[r])]:[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:s=0,a=t.nonPositionedFloats,i.label=11;case 11:return s<a.length?[4,this.renderStack(a[s])]:[3,14];case 12:i.sent(),i.label=13;case 13:return s++,[3,11];case 14:o=0,h=t.nonPositionedInlineLevel,i.label=15;case 15:return o<h.length?[4,this.renderStack(h[o])]:[3,18];case 16:i.sent(),i.label=17;case 17:return o++,[3,15];case 18:l=0,c=t.inlineLevel,i.label=19;case 19:return l<c.length?[4,this.renderNode(c[l])]:[3,22];case 20:i.sent(),i.label=21;case 21:return l++,[3,19];case 22:u=0,p=t.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return u<p.length?[4,this.renderStack(p[u])]:[3,26];case 24:i.sent(),i.label=25;case 25:return u++,[3,23];case 26:d=0,f=t.positiveZIndex,i.label=27;case 27:return d<f.length?[4,this.renderStack(f[d])]:[3,30];case 28:i.sent(),i.label=29;case 29:return d++,[3,27];case 30:return [2]}}))}))},A.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath();},A.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath();},A.prototype.formatPath=function(t){var e=this;t.forEach((function(t,A){var r=Nn(t)?t.start:t;0===A?e.ctx.moveTo(r.x,r.y):e.ctx.lineTo(r.x,r.y),Nn(t)&&e.ctx.bezierCurveTo(t.startControl.x,t.startControl.y,t.endControl.x,t.endControl.y,t.end.x,t.end.y);}));},A.prototype.renderRepeat=function(t,e,A,r){this.path(t),this.ctx.fillStyle=e,this.ctx.translate(A,r),this.ctx.fill(),this.ctx.translate(-A,-r);},A.prototype.resizeImage=function(t,e,A){var r;if(t.width===e&&t.height===A)return t;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,e),i.height=Math.max(1,A),i.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,A),i},A.prototype.renderBackgroundImage=function(t){return r(this,void 0,void 0,(function(){var e,A,r,n,s;return i(this,(function(a){switch(a.label){case 0:e=t.styles.backgroundImage.length-1,A=function(A){var n,s,a,o,h,l,c,u,p,d,f,y,g,m,B,w,x,C,E,_,v,b,U,F,M,Q,I,S,T,R,L;return i(this,(function(i){switch(i.label){case 0:if(0!==A.type)return [3,5];n=void 0,s=A.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return n=i.sent(),[3,4];case 3:return i.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return n&&(a=ns(t,e,[n.width,n.height,n.width/n.height]),w=a[0],b=a[1],U=a[2],m=r.ctx.createPattern(r.resizeImage(n,E=a[3],_=a[4]),"repeat"),r.renderRepeat(w,m,b,U)),[3,6];case 5:1===A.type?(o=ns(t,e,[null,null,null]),w=o[0],b=o[1],U=o[2],h=function(t,e,A){var r="number"==typeof t?t:function(t,e,A){var r=e/2,i=A/2,n=ue(t[0],e)-r,s=i-ue(t[1],A);return (Math.atan2(s,n)+2*Math.PI)%(2*Math.PI)}(t,e,A),i=Math.abs(e*Math.sin(r))+Math.abs(A*Math.cos(r)),n=e/2,s=A/2,a=i/2,o=Math.sin(r-Math.PI/2)*a,h=Math.cos(r-Math.PI/2)*a;return [i,n-h,n+h,s-o,s+o]}(A.angle,E=o[3],_=o[4]),l=h[0],c=h[1],u=h[2],p=h[3],d=h[4],(f=document.createElement("canvas")).width=E,f.height=_,y=f.getContext("2d"),g=y.createLinearGradient(c,p,u,d),Re(A.stops,l).forEach((function(t){return g.addColorStop(t.stop,xe(t.color))})),y.fillStyle=g,y.fillRect(0,0,E,_),E>0&&_>0&&(m=r.ctx.createPattern(f,"repeat"),r.renderRepeat(w,m,b,U))):2===A.type&&(B=ns(t,e,[null,null,null]),w=B[0],x=B[1],C=B[2],_=B[4],b=ue((v=0===A.position.length?[he]:A.position)[0],E=B[3]),U=ue(v[v.length-1],_),F=function(t,e,A,r,i){var n=0,s=0;switch(t.size){case 0:0===t.shape?n=s=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(A),Math.abs(A-i)):1===t.shape&&(n=Math.min(Math.abs(e),Math.abs(e-r)),s=Math.min(Math.abs(A),Math.abs(A-i)));break;case 2:if(0===t.shape)n=s=Math.min(Le(e,A),Le(e,A-i),Le(e-r,A),Le(e-r,A-i));else if(1===t.shape){var a=Math.min(Math.abs(A),Math.abs(A-i))/Math.min(Math.abs(e),Math.abs(e-r)),o=Pe(r,i,e,A,!0);s=a*(n=Le(o[0]-e,(o[1]-A)/a));}break;case 1:0===t.shape?n=s=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(A),Math.abs(A-i)):1===t.shape&&(n=Math.max(Math.abs(e),Math.abs(e-r)),s=Math.max(Math.abs(A),Math.abs(A-i)));break;case 3:if(0===t.shape)n=s=Math.max(Le(e,A),Le(e,A-i),Le(e-r,A),Le(e-r,A-i));else if(1===t.shape){a=Math.max(Math.abs(A),Math.abs(A-i))/Math.max(Math.abs(e),Math.abs(e-r));var h=Pe(r,i,e,A,!1);s=a*(n=Le(h[0]-e,(h[1]-A)/a));}}return Array.isArray(t.size)&&(n=ue(t.size[0],r),s=2===t.size.length?ue(t.size[1],i):n),[n,s]}(A,b,U,E,_),Q=F[1],(M=F[0])>0&&Q>0&&(I=r.ctx.createRadialGradient(x+b,C+U,0,x+b,C+U,M),Re(A.stops,2*M).forEach((function(t){return I.addColorStop(t.stop,xe(t.color))})),r.path(w),r.ctx.fillStyle=I,M!==Q?(S=t.bounds.left+.5*t.bounds.width,T=t.bounds.top+.5*t.bounds.height,L=1/(R=Q/M),r.ctx.save(),r.ctx.translate(S,T),r.ctx.transform(1,0,0,R,0,0),r.ctx.translate(-S,-T),r.ctx.fillRect(x,L*(C-T)+T,E,_*L),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return e--,[2]}}))},r=this,n=0,s=t.styles.backgroundImage.slice(0).reverse(),a.label=1;case 1:return n<s.length?[5,A(s[n])]:[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return [2]}}))}))},A.prototype.renderSolidBorder=function(t,e,A){return r(this,void 0,void 0,(function(){return i(this,(function(r){return this.path(ts(A,e)),this.ctx.fillStyle=xe(t),this.ctx.fill(),[2]}))}))},A.prototype.renderDoubleBorder=function(t,e,A,n){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return e<3?[4,this.renderSolidBorder(t,A,n)]:[3,2];case 1:return i.sent(),[2];case 2:return r=function(t,e){switch(e){case 0:return As(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return As(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return As(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);default:return As(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}}(n,A),this.path(r),this.ctx.fillStyle=xe(t),this.ctx.fill(),s=function(t,e){switch(e){case 0:return As(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return As(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return As(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);default:return As(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}}(n,A),this.path(s),this.ctx.fill(),[2]}}))}))},A.prototype.renderNodeBackgroundAndBorders=function(t){return r(this,void 0,void 0,(function(){var e,A,r,n,s,a,o,h,l=this;return i(this,(function(i){switch(i.label){case 0:return this.applyEffects(t.getEffects(2)),A=!we((e=t.container.styles).backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],n=ys(hs(e.backgroundClip,0),t.curves),A||e.boxShadow.length?(this.ctx.save(),this.path(n),this.ctx.clip(),we(e.backgroundColor)||(this.ctx.fillStyle=xe(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach((function(e){l.ctx.save();var A,r,i,n,s=Gn(t.curves),a=e.inset?0:1e4,o=(A=(e.inset?1:-1)*e.spread.number-a,r=(e.inset?1:-1)*e.spread.number,i=e.spread.number*(e.inset?-2:2),n=e.spread.number*(e.inset?-2:2),s.map((function(t,e){switch(e){case 0:return t.add(A,r);case 1:return t.add(A+i,r);case 2:return t.add(A+i,r+n);case 3:return t.add(A,r+n)}return t})));e.inset?(l.path(s),l.ctx.clip(),l.mask(o)):(l.mask(s),l.ctx.clip(),l.path(o)),l.ctx.shadowOffsetX=e.offsetX.number+a,l.ctx.shadowOffsetY=e.offsetY.number,l.ctx.shadowColor=xe(e.color),l.ctx.shadowBlur=e.blur.number,l.ctx.fillStyle=e.inset?xe(e.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore();})),i.label=2;case 2:s=0,a=0,o=r,i.label=3;case 3:return a<o.length?0!==(h=o[a]).style&&!we(h.color)&&h.width>0?2!==h.style?[3,5]:[4,this.renderDashedDottedBorder(h.color,h.width,s,t.curves,2)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return 3!==h.style?[3,7]:[4,this.renderDashedDottedBorder(h.color,h.width,s,t.curves,3)];case 6:return i.sent(),[3,11];case 7:return 4!==h.style?[3,9]:[4,this.renderDoubleBorder(h.color,h.width,s,t.curves)];case 8:return i.sent(),[3,11];case 9:return [4,this.renderSolidBorder(h.color,s,t.curves)];case 10:i.sent(),i.label=11;case 11:s++,i.label=12;case 12:return a++,[3,3];case 13:return [2]}}))}))},A.prototype.renderDashedDottedBorder=function(t,e,A,n,s){return r(this,void 0,void 0,(function(){var r,a,o,h,l,c,u,p,d,f,y,g,m,B,w,x;return i(this,(function(i){return this.ctx.save(),r=function(t,e){switch(e){case 0:return es(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return es(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return es(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);default:return es(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}}(n,A),a=ts(n,A),2===s&&(this.path(a),this.ctx.clip()),Nn(a[0])?(o=a[0].start.x,h=a[0].start.y):(o=a[0].x,h=a[0].y),Nn(a[1])?(l=a[1].end.x,c=a[1].end.y):(l=a[1].x,c=a[1].y),u=0===A||2===A?Math.abs(o-l):Math.abs(h-c),this.ctx.beginPath(),this.formatPath(3===s?r:a.slice(0,2)),p=e<3?3*e:2*e,d=e<3?2*e:e,3===s&&(p=e,d=e),f=!0,u<=2*p?f=!1:u<=2*p+d?(p*=y=u/(2*p+d),d*=y):(g=Math.floor((u+d)/(p+d)),m=(u-g*p)/(g-1),d=(B=(u-(g+1)*p)/g)<=0||Math.abs(d-m)<Math.abs(d-B)?m:B),f&&this.ctx.setLineDash(3===s?[0,p+d]:[p,d]),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=e):this.ctx.lineWidth=2*e+1.1,this.ctx.strokeStyle=xe(t),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Nn(a[0])&&(w=a[3],x=a[0],this.ctx.beginPath(),this.formatPath([new Hn(w.end.x,w.end.y),new Hn(x.start.x,x.start.y)]),this.ctx.stroke()),Nn(a[1])&&(w=a[1],x=a[2],this.ctx.beginPath(),this.formatPath([new Hn(w.end.x,w.end.y),new Hn(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},A.prototype.render=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=xe(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),A=new Zn(t,null),r=new Wn(A),Jn(A,r,r,i=[]),$n(A.container,i),[4,this.renderStack(r)];case 1:return e.sent(),this.applyEffects([]),[2,this.canvas]}var A,r,i;}))}))},A}(ps),fs=function(t){return t instanceof Ci||t instanceof xi||t instanceof wi&&t.type!==mi&&t.type!==gi},ys=function(t,e){switch(t){case 0:return Gn(e);case 2:return function(t){return [t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]}(e);default:return Kn(e)}},gs=function(t){switch(t){case 1:return "center";case 2:return "right";default:return "left"}},ms=["-apple-system","system-ui"],Bs=function(t){return /iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter((function(t){return -1===ms.indexOf(t)})):t},ws=function(t){function A(e,A){var r=t.call(this,e,A)||this;return r.canvas=A.canvas?A.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=A,r.canvas.width=Math.floor(A.width*A.scale),r.canvas.height=Math.floor(A.height*A.scale),r.canvas.style.width=A.width+"px",r.canvas.style.height=A.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-A.x,-A.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+A.width+"x"+A.height+" at "+A.x+","+A.y+") with scale "+A.scale),r}return e(A,t),A.prototype.render=function(t){return r(this,void 0,void 0,(function(){var e,A;return i(this,(function(r){switch(r.label){case 0:return e=Jr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,xs(e)];case 1:return A=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=xe(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(A,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},A}(ps),xs=function(t){return new Promise((function(e,A){var r=new Image;r.onload=function(){e(r);},r.onerror=A,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t));}))},Cs=function(){function t(t){var e=t.enabled;this.id=t.id,this.enabled=e,this.start=Date.now();}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,n([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t));},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,n([this.id,this.getTime()+"ms"],t));},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,n([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t));},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,n([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t));},t.instances={},t}(),Es=function(){function t(e,A){var r;this.windowBounds=A,this.instanceName="#"+t.instanceCount++,this.logger=new Cs({id:this.instanceName,enabled:e.logging}),this.cache=null!==(r=e.cache)&&void 0!==r?r:new Fn(this,e);}return t.instanceCount=1,t}();"undefined"!=typeof window&&Un.setContext(window);var _s=function(t,e,A){var r=e.ownerDocument,i=r.documentElement?Me(t,getComputedStyle(r.documentElement).backgroundColor):Qe.TRANSPARENT,n=r.body?Me(t,getComputedStyle(r.body).backgroundColor):Qe.TRANSPARENT,s="string"==typeof A?Me(t,A):null===A?Qe.TRANSPARENT:4294967295;return e===r.documentElement?we(i)?we(n)?s:n:i:s};return function(t,e){return void 0===e&&(e={}),function(t,e){return r(void 0,void 0,void 0,(function(){var r,n,o,h,l,c,u,p,d,f,y,g,m,B,w,x,C,E,_,v,b,U,F,M,Q,I,S,T,R,L,P,H,O,D,N,k,V,G;return i(this,(function(i){switch(i.label){case 0:if(!t||"object"!=typeof t)return [2,Promise.reject("Invalid element provided as first argument")];if(!(r=t.ownerDocument))throw new Error("Element is not attached to a Document");if(!(n=r.defaultView))throw new Error("Document is not attached to a Window");return o={allowTaint:null!==(U=e.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(F=e.imageTimeout)&&void 0!==F?F:15e3,proxy:e.proxy,useCORS:null!==(M=e.useCORS)&&void 0!==M&&M},h=A({logging:null===(Q=e.logging)||void 0===Q||Q,cache:e.cache},o),l={windowWidth:null!==(I=e.windowWidth)&&void 0!==I?I:n.innerWidth,windowHeight:null!==(S=e.windowHeight)&&void 0!==S?S:n.innerHeight,scrollX:null!==(T=e.scrollX)&&void 0!==T?T:n.pageXOffset,scrollY:null!==(R=e.scrollY)&&void 0!==R?R:n.pageYOffset},c=new s(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),u=new Es(h,c),p=null!==(L=e.foreignObjectRendering)&&void 0!==L&&L,d={allowTaint:null!==(P=e.allowTaint)&&void 0!==P&&P,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:p,copyStyles:p},u.logger.debug("Starting document clone with size "+c.width+"x"+c.height+" scrolled to "+-c.left+","+-c.top),f=new cn(u,t,d),(y=f.clonedReferenceElement)?[4,f.toIFrame(r,c)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return g=i.sent(),m=Oi(y)||function(t){return "HTML"===t.tagName}(y)?function(t){var e=t.body,A=t.documentElement;if(!e||!A)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,A.scrollWidth),Math.max(e.offsetWidth,A.offsetWidth),Math.max(e.clientWidth,A.clientWidth)),i=Math.max(Math.max(e.scrollHeight,A.scrollHeight),Math.max(e.offsetHeight,A.offsetHeight),Math.max(e.clientHeight,A.clientHeight));return new s(0,0,r,i)}(y.ownerDocument):a(u,y),B=m.width,w=m.height,x=m.left,C=m.top,E=_s(u,y,e.backgroundColor),_={canvas:e.canvas,backgroundColor:E,scale:null!==(O=null!==(H=e.scale)&&void 0!==H?H:n.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(D=e.x)&&void 0!==D?D:0)+x,y:(null!==(N=e.y)&&void 0!==N?N:0)+C,width:null!==(k=e.width)&&void 0!==k?k:Math.ceil(B),height:null!==(V=e.height)&&void 0!==V?V:Math.ceil(w)},p?(u.logger.debug("Document cloned, using foreign object rendering"),[4,new ws(u,_).render(y)]):[3,3];case 2:return v=i.sent(),[3,5];case 3:return u.logger.debug("Document cloned, element located at "+x+","+C+" with size "+B+"x"+w+" using computed rendering"),u.logger.debug("Starting DOM parsing"),b=Ui(u,y),E===b.styles.backgroundColor&&(b.styles.backgroundColor=Qe.TRANSPARENT),u.logger.debug("Starting renderer for element at "+_.x+","+_.y+" with size "+_.width+"x"+_.height),[4,new ds(u,_).render(b)];case 4:v=i.sent(),i.label=5;case 5:return (null===(G=e.removeContainer)||void 0===G||G)&&(cn.destroy(g)||u.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),u.logger.debug("Finished rendering"),[2,v]}}))}))}(t,e)}}();}));const Kw=[[1,3,2],[1,4,3],[1,2,5],[2,6,5],[2,3,6],[3,7,6],[5,6,8],[8,6,7],[1,5,4],[4,5,8],[3,4,8],[3,8,7]];function zw(t){const{source:e,layer:A,node:r,inputData:i,tile:n}=t;let s;n?s=new Eh:(e.respectiveTransformation||(s=kf(e.flipYZ,e,new Eh)),e.respectiveTransformation&&(s=kf(e.flipYZ,A,new Eh)));const a=[];if(n&&s.multiplyRight(Nf(n)),r&&!r.identityMatrix&&s.multiplyRight(r.matrix),i)for(let t=0;t<i.length;t++)a.push([new nh(i[t][0]).transform(s).toArray(),new nh(i[t][1]).transform(s).toArray(),new nh(i[t][2]).transform(s).toArray()]);return a}function Xw(t){const{source:e,node:A,inputData:r,tile:i,layer:n}=t;let s;i?s=new Eh:(e.respectiveTransformation||(s=kf(e.flipYZ,e,new Eh)),e.respectiveTransformation&&(s=kf(e.flipYZ,n,new Eh))),i&&s.multiplyRight(Nf(i)),A&&!A.identityMatrix&&s.multiplyRight(A.matrix);const a=[[r[0][0],r[0][1],r[0][2],1],[r[0][0],r[0][1],r[1][2],1],[r[1][0],r[0][1],r[1][2],1],[r[1][0],r[0][1],r[0][2],1],[r[0][0],r[1][1],r[0][2],1],[r[0][0],r[1][1],r[1][2],1],[r[1][0],r[1][1],r[1][2],1],[r[1][0],r[1][1],r[0][2],1]],o=[];for(let t=0;t<8;t++)o.push(new ah(a[t]).transform(s).toArray());const h=[];for(let t=0;t<Kw.length;t++){const e=Kw[t];h.push([o[e[0]-1],o[e[1]-1],o[e[2]-1]]);}return h}function qw(t,e){try{let A=new DataView(t.buffer);const r=e.IB,i=e.VB;if(void 0===i)return [[[0,0,0],[0,0,0],[0,0,0]]];const n=[];for(let t=0;t<r.count;t+=3){let e,s,a;5121===r.type?(e=A.getUint8(r.offset+t),s=A.getUint8(r.offset+t+1),a=A.getUint8(r.offset+t+2)):5123===r.type?(e=A.getUint16(r.offset+2*t,!0),s=A.getUint16(r.offset+2*(t+1),!0),a=A.getUint16(r.offset+2*(t+2),!0)):(e=A.getUint32(r.offset+4*t,!0),s=A.getUint32(r.offset+4*(t+1),!0),a=A.getUint32(r.offset+4*(t+2),!0));const o=A.getFloat32(i.offset+e*i.byteStride,!0),h=A.getFloat32(i.offset+e*i.byteStride+4,!0),l=A.getFloat32(i.offset+e*i.byteStride+8,!0),c=A.getFloat32(i.offset+s*i.byteStride,!0),u=A.getFloat32(i.offset+s*i.byteStride+4,!0),p=A.getFloat32(i.offset+s*i.byteStride+8,!0),d=A.getFloat32(i.offset+a*i.byteStride,!0),f=A.getFloat32(i.offset+a*i.byteStride+4,!0),y=A.getFloat32(i.offset+a*i.byteStride+8,!0);n.push([[o,h,l],[c,u,p],[d,f,y]]);}return A=null,n}catch(t){return [[[0,0,0],[0,0,0],[0,0,0]]]}}class jw extends En{constructor(t){if(super(t,nm),this.baseMatrixCalculated=!1,this.useLayerPosition=!1,this.respectiveTransformation=!1,this.boolAABBCalculated=!1,this.identityMatrix=!0,this.highLightColorsIndex=0,this.matrix=[],this.isSpecialLight=!!t.isSpecialLight,t.translation&&(this.translation=t.translation,this.useLayerPosition=!0),t.rotation&&(this.rotation=t.rotation,this.useLayerPosition=!0),t.scale&&(this.scale=t.scale,this.useLayerPosition=!0),t.location)this.location=t.location,this.useLayerPosition=!0;else if(this.useLayerPosition)throw new Error("3d_model_style_layer,constructor(): 不允许图层在未设置经纬度参考点的情况下，设置其他的空间变换参数，即一旦想要进行按照layer图层进行空间变化，那么position是必须的");if(Array.isArray(t.highLightColors)){this.highLightColors=[];for(const e of t.highLightColors||[])this.highLightColors.push(ee.parse(e));}"number"!=typeof t.highLightColorsIndex||isNaN(t.highLightColorsIndex)||(this.highLightColorsIndex=t.highLightColorsIndex),this.nodes=[],this.meshes=[],this.primitives=[],this.isSpecialLight=t.isSpecialLight||!1,this.specialLights=null,this.isSpecialLight&&this.setSpecialLights(t.specialLights||[]),this.viewshedRender=!t.hasOwnProperty("viewshed-render")||!!t["viewshed-render"],this.lightExposure=t.lightExposure?t.lightExposure:1;}calcBaseMatrix(t){if(!this.baseMatrixCalculated){for(let e=0;e<t.nodes.length;e++)this.nodes.push(t.nodes[e]);this.baseMatrixCalculated=!0;}}queryLayerRenderedFeatures(t,e,A,r,i,n){const s=n.getSource();this.clearPick();const a=[];let o=1/0,h=[];for(let t=0;t<this.nodes.length;t++){const e=this.nodes[t],A=s.meshes[this.nodes[t].mesh];if(e.primitiveStack)for(let t=0;t<A.primitivesInd.length;t++){const r=s.primitives[A.primitivesInd[t]];let n=Xw({source:s,layer:this,node:e,inputData:r.aabb});for(let A=0;A<n.length;A++)if(i.intersectTriangle(...n[A],!1,[])){let A=zw({source:s,layer:this,node:e,inputData:qw(s.gltfParser.bufferData[r.intersectOptions.bufViewBufferIndex],r.intersectOptions.bufferDataConfig)});for(let r=0;r<A.length;r++){const n=i.intersectTriangle(...A[r],!1,[]);if(n){const A=new nh(i.origin).distance(n);A<o&&(h=n,o=A,a[0]=e.primitiveStack[t]);}}A=null;}n=null;}}return a[0]?[{_parent:this,primitiveData:a[0],intersectionZ:o,intersectionPoint:h,layer:this.id}]:a}clearPick(t){for(let t=0;t<this.nodes.length;t++){const e=this.nodes[t];if(e.primitiveStack)for(let t=0;t<e.primitiveStack.length;t++)e.primitiveStack[t].highlight=!1;}t&&t.fire(new yt("data",{}));}highlightMesh(t){this.clearPick();for(let e=0;e<this.nodes.length;e++){const A=this.nodes[e];if(A.primitiveStack)for(let e=0;e<A.primitiveStack.length;e++){const r=A.primitiveStack[e];r.primitiveDataInd===t.primitiveData.primitiveDataInd&&(r.highlight=!0);}}}setSpecialLights(t){this.specialLights=[];for(let e=0;e<t.length;e++){const A=t[e],r=Lf([],A.position,$.TRANSFORM.R+(A.position[2]||0)*$.TRANSFORM.R_SCALE),i=Lf([],A.direction,$.TRANSFORM.R+(A.direction[2]||0)*$.TRANSFORM.R_SCALE),n=[r[0]-i[0],r[1]-i[1],r[2]-i[2]];A.position=r,A.direction=n,this.specialLights.push(A);}}setHighlightIndex(t){"number"!=typeof t||isNaN(t)||(this.highLightColorsIndex=t);}}var Yw={paint:new wn({})};const Ww=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}],4),{members:Zw}=Ww,Jw=uy.VectorTileFeature.types,$w=Math.cos(Math.PI/180*37.5),tx=Math.pow(2,14)/.5;let ex=0,Ax=0,rx=1;function ix(t,e,A,r,i,n,s){t.emplaceBack(e.x,e.y,e.z,r?1:0,i?1:-1,Math.round(63*A.x)+128,Math.round(63*A.y)+128,1+(0===n?0:n<0?-1:1)|(.5*s&63)<<2,.5*s>>6,255&ex,parseInt(Ax),parseInt(rx));}class nx{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Hn,this.indexArray=new es,this.programConfigurations=new Es(Zw,t.layers,t.zoom),this.segments=new ys,this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));for(const{feature:r,index:i,sourceLayerIndex:n}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),r,A)){const t=bs(r);this.addFeature(r,t,i,A),e.featureIndex.insert(r,t,i,n,this.index);}}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zw),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r){const i=this.layers[0].layout,n=i.get("sprite-join").evaluate(t,{}),s=i.get("sprite-cap"),a=i.get("sprite-miter-limit"),o=i.get("sprite-round-limit");Ax=t.properties.link_seq?Number(t.properties.link_seq):Ax,Ax%=10,rx=Number(t.properties.status)||1,Number(t.properties.link_seq),Number(t.properties.total);for(const i of e)this.addLine(i,t,n,s,a,o,A,r);}addLine(t,e,A,r,i,n,s,a){const o="Polygon"===Jw[e.type];let h=t.length;for(;h>=2&&t[h-1].equals(t[h-2]);)h--;let l=0;for(;l<h-1&&t[l].equals(t[l+1]);)l++;if(h<(o?3:2))return;"bevel"===A&&(i=1.05);const c=ji/(512*this.overscaling)*15,u=t[l],p=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);this.distance=0;const d=r,f=o?"butt":r;let y,g,m,B,w,x,C,E=!0;this.e1=this.e2=this.e3=-1,o&&(y=t[h-2],w=u.sub(y)._unit()._perp());for(let e=l;e<h;e++){if(ex=Math.round(255/h*e),m=o&&e===h-1?t[l+1]:t[e+1],m&&t[e].equals(m))continue;w&&(B=w),y&&(g=y),y=t[e],w=m?m.sub(y)._unit()._perp():B,B=B||w;let r=B.add(w);0===r.x&&0===r.y||r._unit();const s=r.x*w.x+r.y*w.y,a=0!==s?1/s:1/0,u=s<$w&&g&&m;if(u&&e>l){const t=y.dist(g);if(t>2*c){const e=y.sub(y.sub(g)._mult(c/t)._round());this.distance+=e.dist(g),this.addCurrentVertex(e,this.distance,B.mult(1),0,0,!1,p),g=e;}}const _=g&&m;let v=_?A:m?d:f;if(_&&"round"===v&&(a<n?v="miter":a<=2&&(v="fakeround")),"miter"===v&&a>i&&(v="bevel"),"bevel"===v&&(a>2&&(v="flipbevel"),a<i&&(v="miter")),g&&(this.distance+=y.dist(g)),"miter"===v)r._mult(a),this.addCurrentVertex(y,this.distance,r,0,0,!1,p);else if("flipbevel"===v){if(a>100)r=w.clone().mult(-1);else {const t=B.x*w.y-B.y*w.x>0?-1:1,e=a*B.add(w).mag()/B.sub(w).mag();r._perp()._mult(e*t);}this.addCurrentVertex(y,this.distance,r,0,0,!1,p),this.addCurrentVertex(y,this.distance,r.mult(-1),0,0,!1,p);}else if("bevel"===v||"fakeround"===v){const t=B.x*w.y-B.y*w.x>0,e=-Math.sqrt(a*a-1);if(t?(C=0,x=e):(x=0,C=e),E||this.addCurrentVertex(y,this.distance,B,x,C,!1,p),"fakeround"===v){const e=Math.floor(8*(.5-(s-.5)));let A;for(let r=0;r<e;r++)A=w.mult((r+1)/(e+1))._add(B)._unit(),this.addPieSliceVertex(y,this.distance,A,t,p);this.addPieSliceVertex(y,this.distance,r,t,p);for(let r=e-1;r>=0;r--)A=B.mult((r+1)/(e+1))._add(w)._unit(),this.addPieSliceVertex(y,this.distance,A,t,p);}m&&this.addCurrentVertex(y,this.distance,w,-x,-C,!1,p);}else "butt"===v?(E||this.addCurrentVertex(y,this.distance,B,0,0,!1,p),m&&this.addCurrentVertex(y,this.distance,w,0,0,!1,p)):"square"===v?(E||(this.addCurrentVertex(y,this.distance,B,1,1,!1,p),this.e1=this.e2=-1),m&&this.addCurrentVertex(y,this.distance,w,-1,-1,!1,p)):"round"===v&&(E||(this.addCurrentVertex(y,this.distance,B,0,0,!1,p),this.addCurrentVertex(y,this.distance,B,1,1,!0,p),this.e1=this.e2=-1),m&&(this.addCurrentVertex(y,this.distance,w,-1,-1,!0,p),this.addCurrentVertex(y,this.distance,w,0,0,!1,p)));if(u&&e<h-1){const t=y.dist(m);if(t>2*c){const e=y.add(m.sub(y)._mult(c/t)._round());this.distance+=e.dist(y),this.addCurrentVertex(e,this.distance,w.mult(1),0,0,!1,p),y=e;}}E=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a);}calcTDSpacePoint(t){const e=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])}addCurrentVertex(t,e,A,r,i,n,s){let a;const o=this.layoutVertexArray,h=this.indexArray;a=A.clone(),r&&a._sub(A.perp()._mult(r));const l=this.calcTDSpacePoint(t);ix(o,l,a,n,!1,r,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(h.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,a=A.mult(-1),i&&a._sub(A.perp()._mult(i)),ix(o,l,a,n,!0,-i,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(h.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>tx/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,A,r,i,n,s));}addPieSliceVertex(t,e,A,r,i){A=A.mult(r?-1:1);const n=this.indexArray;ix(this.layoutVertexArray,this.calcTDSpacePoint(t),A,!1,r,0,e),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(n.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3;}}Fi("SphereSpriteBucket",nx,{omit:["layers"]});const sx=new wn({"sprite-cap":new fn(Bt.layout_sprite["sprite-cap"]),"sprite-join":new yn(Bt.layout_sprite["sprite-join"]),"sprite-miter-limit":new fn(Bt.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new fn(Bt.layout_sprite["sprite-round-limit"]),"sprite-sort-key":new yn(Bt.layout_sprite["sprite-sort-key"])});var ax={paint:new wn({"sprite-opacity":new yn(Bt.paint_sprite["sprite-opacity"]),"sprite-color":new yn(Bt.paint_sprite["sprite-color"]),"sprite-translate":new fn(Bt.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new fn(Bt.paint_sprite["sprite-translate-anchor"]),"sprite-width":new yn(Bt.paint_sprite["sprite-width"]),"sprite-gap-width":new yn(Bt.paint_sprite["sprite-gap-width"]),"sprite-offset":new yn(Bt.paint_sprite["sprite-offset"]),"sprite-blur":new yn(Bt.paint_sprite["sprite-blur"]),"sprite-speed-factor":new yn(Bt.paint_sprite["sprite-speed-factor"]),"sprite-speed":new yn(Bt.paint_sprite["sprite-speed"]),"sprite-pattern":new gn(Bt.paint_sprite["sprite-pattern"]),"sprite-interpolate":new fn(Bt.paint_sprite["sprite-interpolate"]),"sprite-status":new yn(Bt.paint_sprite["sprite-status"]),"sprite-instatus":new yn(Bt.paint_sprite["sprite-instatus"]),"sprite-height-offset":new fn(Bt.paint_sprite["sprite-height-offset"])}),layout:sx};const ox=new class extends yn{possiblyEvaluate(t,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,A,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,A,r)}}(ax.paint.properties["sprite-width"].specification);function hx(t,e){return e>0?e+2*t:t}ox.useIntegerZoom=!0;class lx extends En{constructor(t){super(t,{}),this.id=t.id,this.type=t.type,this.anchor=t.anchor,this.renderingMode=t.renderingMode,this.implementation=t;}hasOffscreenPass(){return void 0!==this.implementation.prerender||"3d"===this.implementation.renderingMode}recalculate(t,e){}updateTransitions(){}hasTransition(){}serialize(){}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl);}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t);}}var cx={paint:new wn({"panorama-opacity":new fn(Bt.paint_panorama["panorama-opacity"])})};const ux=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_ed",components:3,type:"Float32"},{name:"a_st",components:3,type:"Float32"}],4),{members:px}=ux;function dx(t,e,A,r,i,n,s,a,o,h){t.emplaceBack(e,A,r,i,n,s,a,o,h);}class fx{constructor(t){this.featureTrangles=[],this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.layoutVertexArray=new Pn,this.indexArray=new es,this.programConfigurations=new Es(px,t.layers,t.zoom),this.segments=new ys,this.projection=t.projection||ua.MERCATOR;}populate(t,e,A){this.x=e.x,this.y=e.y,this.z=e.z;for(const{feature:e,index:r}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),e,A)){const t=bs(e);this.addFeature(e,t,r,[],A);}this.baseP&&(this.matrix=Vf(0,this.baseP));}update(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,px),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r,i){let n=0,s=0;const a=this.layers[0].paint.get("histogram-height"),o=this.layers[0].paint.get("histogram-base");n=a.evaluate(t,{},i)||0,s=o.evaluate(t,{},i)||0,this.layers[0].layout.get("histogram-max-height-render")&&(n*=100,s*=100);for(const t of na(e,500)){let e=0;for(const A of t)e+=A.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e of t)if(0!==e.length&&!oa(e)){ha(e)&&(e=ey(e));for(let t=0;t<e.length;t++){const i=e[t];if(t>=1){const a=e[t-1];if(la(i,a))continue;if(!aa(i,a)){A.vertexLength+4>ys.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=Hf(i.x,i.y,s,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=t);const e=Hf(i.x,i.y,n,this.x,this.y,this.z,this.projection),o=Hf(a.x,a.y,s,this.x,this.y,this.z,this.projection),h=Hf(a.x,a.y,n,this.x,this.y,this.z,this.projection),l=this.baseP,c=new nh;c.subVectors(t,e);const u=new nh;u.subVectors(t,o);const p=c.cross(u);dx(this.layoutVertexArray,t[0]-l[0],t[1]-l[1],t[2]-l[2],p[0],p[1],p[2],0,s/5,0),dx(this.layoutVertexArray,e[0]-l[0],e[1]-l[1],e[2]-l[2],p[0],p[1],p[2],0,n/5,1);const d=20*new nh(o).distance(t);dx(this.layoutVertexArray,o[0]-l[0],o[1]-l[1],o[2]-l[2],p[0],p[1],p[2],d,s/5,0),dx(this.layoutVertexArray,h[0]-l[0],h[1]-l[1],h[2]-l[2],p[0],p[1],p[2],d,n/5,1);const f=A.vertexLength;this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f+1,f+2,f+3),r.push([t,e,o],[e,o,h]),A.vertexLength+=4,A.primitiveLength+=2;}}}}A.vertexLength+e>ys.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray));const i=[],a=[],o=A.vertexLength,h=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&a.push(i.length/2);const A=ca(t);for(let t=0;t<e.length;t++){const r=e[t],s=[(r.x-A.minX)/A.maxLength,(r.y-A.minY)/A.maxLength],a=Hf(r.x,r.y,n+(this.x%2+this.y%2)/256,this.x,this.y,this.z,this.projection);h.push(a),this.baseP||(this.baseP=a),dx(this.layoutVertexArray,a[0]-this.baseP[0],a[1]-this.baseP[1],a[2]-this.baseP[2],0,8,0,s[0],s[1],1),i.push(r.x),i.push(r.y);}}const l=Us(i,a);for(let t=0;t<l.length;t+=3)this.indexArray.emplaceBack(o+l[t],o+l[t+1],o+l[t+2]),r.push([h[l[t]],h[l[t+1]],h[l[t+2]]]);A.primitiveLength+=l.length/3,A.vertexLength+=e;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,{},i);}}Fi("SphereHistogramBucket",fx,{omit:["layers"]});const yx=new wn({"histogram-max-height-render":new fn(Bt.layout_histogram["histogram-max-height-render"]),"histogram-color-render":new fn(Bt.layout_histogram["histogram-color-render"])});var gx={paint:new wn({"histogram-opacity":new fn(Bt.paint_histogram["histogram-opacity"]),"histogram-color":new yn(Bt.paint_histogram["histogram-color"]),"histogram-colors":new fn(Bt.paint_histogram["histogram-colors"]),"histogram-translate":new fn(Bt.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new fn(Bt.paint_histogram["histogram-translate-anchor"]),"histogram-height":new yn(Bt.paint_histogram["histogram-height"]),"histogram-base":new yn(Bt.paint_histogram["histogram-base"]),"histogram-vertical-gradient":new fn(Bt.paint_histogram["histogram-vertical-gradient"]),"histogram-dynamic":new fn(Bt.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new yn(Bt.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new yn(Bt.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new yn(Bt.paint_histogram["histogram-heightArr3"]),"histogram-speed":new fn(Bt.paint_histogram["histogram-speed"]),"histogram-count":new fn(Bt.paint_histogram["histogram-count"]),"histogram-max-height":new fn(Bt.paint_histogram["histogram-max-height"]),"depth-change":new fn(Bt.paint_histogram["depth-change"])}),layout:yx};const mx=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:3,type:"Uint16"}]),Bx=Mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wx=Mn([{name:"a_placed",components:2,type:"Uint8"}],4);Mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const xx=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cx=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);Mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),Mn([{type:"Float32",name:"offsetX"}]),Mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ex=uy.VectorTileFeature.types,_x=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vx(t,e,A,r,i,n,s,a,o,h){t.emplaceBack(e.x,e.y,e.z,Math.round(32*A),Math.round(32*r),i,n,s?s[0]:0,s?s[1]:0,a,o,h||0);}function bx(t,e,A,r){t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A),t.emplaceBack(e.x-r.x,e.y-r.y,A);}class Ux{constructor(t){this.layoutVertexArray=new $n,this.indexArray=new es,this.programConfigurations=t,this.segments=new ys,this.dynamicLayoutVertexArray=new Nn,this.opacityVertexArray=new zn,this.placedSymbolArray=new as;}upload(t,e,A,r){A&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bx.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_x,!0),this.opacityVertexBuffer.itemSize=1),(A||r)&&this.programConfigurations.upload(t);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}Fi("SphereSymtrackingBuffers",Ux);class Fx{constructor(t,e,A){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new A,this.segments=new ys,this.collisionVertexArray=new qn;}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,wx.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}Fi("SphereSymtrackingCollisionBuffers",Fx);class Mx{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasRTLText=!1;const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ig(this.zoom,e["text-size"]),this.iconSizeData=Ig(this.zoom,e["icon-size"]);const A=this.layers[0].layout;this.sortFeaturesByY=A.get("text-allow-overlap")||A.get("icon-allow-overlap")||A.get("text-ignore-placement")||A.get("icon-ignore-placement"),this.sourceID=t.sourceID,this.projection=t.projection||ua.MERCATOR;}createArrays(){this.text=new Ux(new Es(mx.members,this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Ux(new Es(mx.members,this.layers,this.zoom,(t=>/^icon/.test(t)))),this.collisionBox=new Fx(Jn,xx.members,As),this.collisionCircle=new Fx(Jn,Cx.members,es),this.glyphOffsetArray=new hs,this.lineVertexArray=new cs;}calculateGlyphDependencies(t,e,A,r){for(let i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,A&&r){const A=Mg[t.charAt(i)];A&&(e[A.charCodeAt(0)]=!0);}}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));const r=this.layers[0],i=r.layout,n=i.get("text-font"),s=i.get("text-field"),a=i.get("icon-image"),o=("constant"!==s.value.kind||s.value.value.toString().length>0)&&("constant"!==n.value.kind||n.value.value.length>0),h="constant"!==a.value.kind||a.value.value&&a.value.value.length>0;if(this.features=[],!o&&!h)return;const l=e.iconDependencies,c=e.glyphDependencies,u=e.availableImages,p=new Xi(this.zoom);for(const{feature:e,index:s,sourceLayerIndex:a}of t){if(!r._featureFilter(p,e))continue;let t,d;if(o){const i=r.getValueAndResolveTokens("text-field",e,A,u),n=pe.factory(i);n.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Gi()||this.hasRTLText&&zi.isParsed())&&(t=Ug(n,r,e));}if(h){const t=r.getValueAndResolveTokens("icon-image",e,A,u);d=t instanceof de?t:de.fromString(t);}if(!t&&!d)continue;const f={text:t,icon:d,index:s,sourceLayerIndex:a,geometry:bs(e),properties:e.properties,type:Ex[e.type]};if(void 0!==e.id&&(f.id=e.id),this.features.push(f),d&&d instanceof de&&(l[d.name]=!0),t){const A=n.evaluate(e,{}).join(","),r=c[A]=c[A]||{},s="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");if(t instanceof pe)for(const e of t.sections){const r=ne(t.toString()),i=e.fontStack||A,n=c[i]=c[i]||{};this.calculateGlyphDependencies(e.text,n,s,r);}else {const e=ne(t);this.calculateGlyphDependencies(t,r,s,e);}}}"line"===i.get("symbol-placement")&&(this.features=Fg(this.features));}update(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(t,e){const A=this.lineVertexArray.length;if(void 0!==t.segment){let A=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const i={};for(let r=t.segment+1;r<e.length;r++)i[r]={x:e[r].x,y:e[r].y,tileUnitDistanceFromAnchor:A},r<e.length-1&&(A+=e[r+1].dist(e[r]));for(let A=t.segment||0;A>=0;A--)i[A]={x:e[A].x,y:e[A].y,tileUnitDistanceFromAnchor:r},A>0&&(r+=e[A-1].dist(e[A]));for(let t=0;t<e.length;t++){const e=i[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor);}}return {lineStartIndex:A,lineLength:this.lineVertexArray.length-A}}addSymbols(t,e,A,r,i,n,s,a,o,h,l){const c=t.indexArray,u=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,d=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),f=this.glyphOffsetArray.length,y=d.vertexLength;for(const t of e){const e=t.tl,r=t.tr,i=t.bl,s=t.br,o=t.tex,h=d.vertexLength,l=t.glyphOffset[1],f=this.calcTDSpacePoint(a.x,a.y),y=n.properties;let g,m,B;y.hasOwnProperty("link_seq")?(g=y.link_seq,m=y.link_total||0,B=0):y.hasOwnProperty("link_time")&&(g=y.link_time%1e4,m=y.link_time_before%1e4,B=y.link_time_end%1e4,this.timestampExtraData||(this.timestampExtraData={total_time_end:y.total_time_end%1e4,total_time_start:y.total_time_start%1e4})),vx(u,f,e.x,l+e.y,o.x,o.y,A,g,m,B),vx(u,f,r.x,l+r.y,o.x+o.w,o.y,A,g,m,B),vx(u,f,i.x,l+i.y,o.x,o.y+o.h,A,g,m,B),vx(u,f,s.x,l+s.y,o.x+o.w,o.y+o.h,A,g,m,B),bx(p,a,0,a),c.emplaceBack(h,h+1,h+2),c.emplaceBack(h+1,h+2,h+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(t.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(a.x,a.y,f,this.glyphOffsetArray.length-f,y,o,h,a.segment,A?A[0]:0,A?A[1]:0,r[0],r[1],s,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,n,n.index,{},l);}_addCollisionDebugVertex(t,e,A,r,i){return e.emplaceBack(0,0),t.emplaceBack(A.x,A.y,A.z,r.x,r.y,Math.round(i.x),Math.round(i.y))}addCollisionDebugVertices(t,e,A,r,i,n,s,a){const o=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),h=o.vertexLength,c=i.layoutVertexArray,u=i.collisionVertexArray,p=this.calcTDSpacePoint(n.x,n.y);if(this._addCollisionDebugVertex(c,u,p,s.anchor,new l(t,e)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(A,e)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(A,r)),this._addCollisionDebugVertex(c,u,p,s.anchor,new l(t,r)),o.vertexLength+=4,a){const t=i.indexArray;t.emplaceBack(h,h+1,h+2),t.emplaceBack(h,h+2,h+3),o.primitiveLength+=2;}else {const t=i.indexArray;t.emplaceBack(h,h+1),t.emplaceBack(h+1,h+2),t.emplaceBack(h+2,h+3),t.emplaceBack(h+3,h),o.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const t of this.symbolInstances){t.textCollisionFeature={boxStartIndex:t.textBoxStartIndex,boxEndIndex:t.textBoxEndIndex},t.iconCollisionFeature={boxStartIndex:t.iconBoxStartIndex,boxEndIndex:t.iconBoxEndIndex};for(let e=0;e<2;e++){const A=t[0===e?"textCollisionFeature":"iconCollisionFeature"];if(A)for(let e=A.boxStartIndex;e<A.boxEndIndex;e++){const A=this.collisionBoxArray.get(e),r=A.radius>0;this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,r?this.collisionCircle:this.collisionBox,A.anchorPoint,t,r);}}}}deserializeCollisionBoxes(t,e,A,r,i){const n={};for(let r=e;r<A;r++){const e=t.get(r);if(0===e.radius){n.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},n.textFeatureIndex=e.featureIndex;break}n.textCircles||(n.textCircles=[],n.textFeatureIndex=e.featureIndex),n.textCircles.push(e.anchorPointX,e.anchorPointY,e.radius,e.signedDistanceFromAnchor,1);}for(let e=r;e<i;e++){const A=t.get(e);if(0===A.radius){n.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},n.iconFeatureIndex=A.featureIndex;break}}return n}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(t){if(!this.sortFeaturesByY)return;if(this.sortedAngle===t)return;if(this.sortedAngle=t,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const e=[];for(let t=0;t<this.symbolInstances.length;t++)e.push(t);const A=Math.sin(t),r=Math.cos(t);e.sort(((t,e)=>{const i=this.symbolInstances[t],n=this.symbolInstances[e];return (0|Math.round(A*i.anchor.x+r*i.anchor.y))-(0|Math.round(A*n.anchor.x+r*n.anchor.y))||n.featureIndex-i.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of e){const e=this.symbolInstances[t];this.featureSortOrder.push(e.featureIndex);for(const t of e.placedTextSymbolIndices){const e=this.text.placedSymbolArray.get(t),A=e.vertexStartIndex+4*e.numGlyphs;for(let t=e.vertexStartIndex;t<A;t+=4)this.text.indexArray.emplaceBack(t,t+1,t+2),this.text.indexArray.emplaceBack(t+1,t+2,t+3);}const A=this.icon.placedSymbolArray.get(t);if(A.numGlyphs){const t=A.vertexStartIndex;this.icon.indexArray.emplaceBack(t,t+1,t+2),this.icon.indexArray.emplaceBack(t+1,t+2,t+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(t,e){const A=Lf([],Of(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),$.TRANSFORM.R);return new l(A[0]-this.tilePlane.out1[0],A[1]-this.tilePlane.out1[1],A[2]-this.tilePlane.out1[2])}}Fi("SphereSymtrackingBucket",Mx,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),Mx.MAX_GLYPHS=65535,Mx.addDynamicAttributes=bx;const Qx=new wn({"symtracking-display-mode":new fn(Bt.layout_symtracking["symtracking-display-mode"]),"symtracking-time-segment":new fn(Bt.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new fn(Bt.layout_symtracking["symtracking-fps"]),"symtracking-sort-key":new yn(Bt.layout_symtracking["symtracking-sort-key"]),"symtracking-z-order":new fn(Bt.layout_symtracking["symtracking-z-order"]),"compatible-mode":new fn(Bt.layout_symtracking["compatible-mode"]),"symbol-placement":new fn(Bt.layout_symtracking["symbol-placement"]),"symbol-spacing":new fn(Bt.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new fn(Bt.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new fn(Bt.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new fn(Bt.layout_symtracking["icon-ignore-placement"]),"icon-optional":new fn(Bt.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new fn(Bt.layout_symtracking["icon-rotation-alignment"]),"icon-size":new yn(Bt.layout_symtracking["icon-size"]),"icon-text-fit":new fn(Bt.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new fn(Bt.layout_symtracking["icon-text-fit-padding"]),"icon-image":new yn(Bt.layout_symtracking["icon-image"]),"icon-rotate":new yn(Bt.layout_symtracking["icon-rotate"]),"icon-padding":new fn(Bt.layout_symtracking["icon-padding"]),"icon-keep-upright":new fn(Bt.layout_symtracking["icon-keep-upright"]),"icon-offset":new yn(Bt.layout_symtracking["icon-offset"]),"icon-anchor":new yn(Bt.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new fn(Bt.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new fn(Bt.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new fn(Bt.layout_symtracking["text-rotation-alignment"]),"text-field":new yn(Bt.layout_symtracking["text-field"]),"text-font":new yn(Bt.layout_symtracking["text-font"]),"text-size":new yn(Bt.layout_symtracking["text-size"]),"text-max-width":new yn(Bt.layout_symtracking["text-max-width"]),"text-line-height":new fn(Bt.layout_symtracking["text-line-height"]),"text-letter-spacing":new yn(Bt.layout_symtracking["text-letter-spacing"]),"text-justify":new yn(Bt.layout_symtracking["text-justify"]),"text-anchor":new yn(Bt.layout_symtracking["text-anchor"]),"text-max-angle":new fn(Bt.layout_symtracking["text-max-angle"]),"text-rotate":new yn(Bt.layout_symtracking["text-rotate"]),"text-padding":new fn(Bt.layout_symtracking["text-padding"]),"text-keep-upright":new fn(Bt.layout_symtracking["text-keep-upright"]),"text-transform":new yn(Bt.layout_symtracking["text-transform"]),"text-offset":new yn(Bt.layout_symtracking["text-offset"]),"text-allow-overlap":new fn(Bt.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new fn(Bt.layout_symtracking["text-ignore-placement"]),"text-optional":new fn(Bt.layout_symtracking["text-optional"])});var Ix={paint:new wn({"icon-opacity":new yn(Bt.paint_symtracking["icon-opacity"]),"icon-color":new yn(Bt.paint_symtracking["icon-color"]),"icon-halo-color":new yn(Bt.paint_symtracking["icon-halo-color"]),"icon-halo-width":new yn(Bt.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new yn(Bt.paint_symtracking["icon-halo-blur"]),"icon-translate":new fn(Bt.paint_symtracking["icon-translate"]),"icon-translate-anchor":new fn(Bt.paint_symtracking["icon-translate-anchor"]),"text-opacity":new yn(Bt.paint_symtracking["text-opacity"]),"text-color":new yn(Bt.paint_symtracking["text-color"]),"text-halo-color":new yn(Bt.paint_symtracking["text-halo-color"]),"text-halo-width":new yn(Bt.paint_symtracking["text-halo-width"]),"text-halo-blur":new yn(Bt.paint_symtracking["text-halo-blur"]),"text-translate":new fn(Bt.paint_symtracking["text-translate"]),"text-translate-anchor":new fn(Bt.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new fn(Bt.paint_symtracking["symtracking-delay"])}),layout:Qx};const Sx=Mn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}],4),{members:Tx}=Sx,Rx=uy.VectorTileFeature.types,Lx=Math.cos(Math.PI/180*37.5),Px=Math.pow(2,14)/.5;class Hx{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={};})),this.layoutVertexArray=new Dn,this.indexArray=new es,this.programConfigurations=new Es(Tx,t.layers,t.zoom),this.segments=new ys,this.maxLineLength=0,this.projection=t.projection||ua.MERCATOR,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.seq=0,this.total=0,this.offset=0;}_getSampleNumber(t){let e=8;return e-=t,e<=0?0:e}_convertGeometryPointToLine(t){const e=[];for(let A=0;A<t.length;A++){const r=[];let i=1/0,n=1/0,s=-1/0,a=-1/0;for(let e=0;e<t[A].length;e++){const o=t[A][e].x,h=t[A][e].y;r.push([o,h]),i>o&&(i=o),s<o&&(s=o),n>h&&(n=h),a<h&&(a=h);}e.push({type:"LineString",geometry:[r],min:[i,n],max:[s,a]});}return e}_convertLineToGeometry(t){const e=[];for(let A=0;A<t.length;A++){const r=t[A].geometry.map((t=>t.map((t=>new l(t[0],t[1])))));e.push(...r);}return e}populate(t,e,A){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=Df(this.x,this.y,this.z,this.projection));for(const{feature:r,index:i,sourceLayerIndex:n}of t)if(this.layers[0]._featureFilter(new Xi(this.zoom),r,A)){const t=bs(r),s=[];ty(this._getSampleNumber(this.z),0,8192,0,8192,this._convertGeometryPointToLine(t),s);const a=this._convertLineToGeometry(s);this.addFeature(r,a,i,A,{}),e.featureIndex.insert(r,t,i,n,this.index);}}update(t,e,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,A);}addFeatures(t,e,A){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,A);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,A,r,i){const n=this.layers[0].layout,s=n.get("dynamicLine-join").evaluate(t,{}),a=n.get("dynamicLine-cap"),o=n.get("dynamicLine-miter-limit"),h=n.get("dynamicLine-round-limit");this.seq=t.properties.link_seq,this.total=t.properties.total_link_count,this.offset=t.properties.offset_link_count;for(const A of e)this.addLine(A,t,s,a,o,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,A,i,r);}addLine(t,e,A,r,i,n){this.distance=0,this.scaledDistance=0,this.totalDistance=0;const s="Polygon"===Rx[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let o=0;for(;o<a-1&&t[o].equals(t[o+1]);)o++;if(a<(s?3:2))return;"bevel"===A&&(i=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,l=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let c,u,p,d,f;this.e1=this.e2=-1,s&&(c=t[a-2],f=t[o].sub(c)._unit()._perp());for(let e=o;e<a;e++){if(this.seq++,p=e===a-1?s?t[o+1]:void 0:t[e+1],p&&t[e].equals(p))continue;f&&(d=f),c&&(u=c),c=t[e],f=p?p.sub(c)._unit()._perp():d,d=d||f;let y=d.add(f);0===y.x&&0===y.y||y._unit();const g=d.x*f.x+d.y*f.y,m=y.x*f.x+y.y*f.y,B=0!==m?1/m:1/0,w=2*Math.sqrt(2-2*m),x=m<Lx&&u&&p,C=d.x*f.y-d.y*f.x>0;if(x&&e>o){const t=c.dist(u);if(t>2*h){const e=c.sub(c.sub(u)._mult(h/t)._round());this.updateDistance(u,e),this.addCurrentVertex(e,d,0,0,l),u=e;}}const E=u&&p;let _=E?A:s?"butt":r;if(E&&"round"===_&&(B<n?_="miter":B<=2&&(_="fakeround")),"miter"===_&&B>i&&(_="bevel"),"bevel"===_&&(B>2&&(_="flipbevel"),B<i&&(_="miter")),u&&this.updateDistance(u,c),"miter"===_)y._mult(B),this.addCurrentVertex(c,y,0,0,l);else if("flipbevel"===_){if(B>100)y=f.mult(-1);else {const t=B*d.add(f).mag()/d.sub(f).mag();y._perp()._mult(t*(C?-1:1));}this.addCurrentVertex(c,y,0,0,l),this.addCurrentVertex(c,y.mult(-1),0,0,l);}else if("bevel"===_||"fakeround"===_){const t=-Math.sqrt(B*B-1),e=C?t:0,A=C?0:t;if(u&&this.addCurrentVertex(c,d,e,A,l),"fakeround"===_){const t=Math.round(180*w/Math.PI/20);for(let e=1;e<t;e++){let A=e/t;if(.5!==A){const t=A-.5;A+=A*t*(A-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*t*t+(.848013+g*(.215638*g-1.06021)));}const r=f.sub(d)._mult(A)._add(d)._unit()._mult(C?-1:1);this.addHalfVertex(c,r.x,r.y,!1,C,0,l);}}p&&this.addCurrentVertex(c,f,-e,-A,l);}else if("butt"===_)this.addCurrentVertex(c,y,0,0,l);else if("square"===_){const t=u?1:-1;this.addCurrentVertex(c,y,t,t,l);}else "round"===_&&(u&&(this.addCurrentVertex(c,d,0,0,l),this.addCurrentVertex(c,d,1,1,l,!0)),p&&(this.addCurrentVertex(c,f,-1,-1,l,!0),this.addCurrentVertex(c,f,0,0,l)));if(x&&e<a-1){const t=c.dist(p);if(t>2*h){const e=c.add(p.sub(c)._mult(h/t)._round());this.updateDistance(c,e),this.addCurrentVertex(e,f,0,0,l),c=e;}}}}calcTDSpacePoint(t){const e=Lf([],Of(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),$.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])}addCurrentVertex(t,e,A,r,i,n=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*A,e.y-e.x*A,n,!1,A,i),this.addHalfVertex(t,s,a,n,!0,-r,i),this.distance>Px/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,A,r,i,n));}addHalfVertex(t,e,A,r,i,n,s){const a=this.scaledDistance,o=this.calcTDSpacePoint(t),h=.5*a;this.layoutVertexArray.emplaceBack(o.x,o.y,o.z,(r?2:0)+(i?1:0),Math.round(63*e)+128,Math.round(63*A)+128,1+(0===n?0:n<0?-1:1)|(63&h)<<2,h>>6,this.seq,this.total,this.offset);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),i?this.e2=l:this.e1=l;}updateScaledDistance(){this.scaledDistance=this.distance;}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance();}}Fi("SphereDynamicLineBucket",Hx,{omit:["layers","patternFeatures"]});const Ox=new wn({"dynamicLine-cap":new fn(Bt.layout_dynamicLine["dynamicLine-cap"]),"dynamicLine-join":new yn(Bt.layout_dynamicLine["dynamicLine-join"]),"dynamicLine-miter-limit":new fn(Bt.layout_dynamicLine["dynamicLine-miter-limit"]),"dynamicLine-round-limit":new fn(Bt.layout_dynamicLine["dynamicLine-round-limit"]),"dynamicLine-sort-key":new yn(Bt.layout_dynamicLine["dynamicLine-sort-key"])});var Dx={paint:new wn({"dynamicLine-opacity":new yn(Bt.paint_dynamicLine["dynamicLine-opacity"]),"dynamicLine-color":new yn(Bt.paint_dynamicLine["dynamicLine-color"]),"dynamicLine-width":new yn(Bt.paint_dynamicLine["dynamicLine-width"]),"dynamicLine-gap-width":new yn(Bt.paint_dynamicLine["dynamicLine-gap-width"]),"dynamicLine-blur":new yn(Bt.paint_dynamicLine["dynamicLine-blur"]),"dynamicLine-seg-group":new fn(Bt.paint_dynamicLine["dynamicLine-seg-group"]),"dynamicLine-speed":new fn(Bt.paint_dynamicLine["dynamicLine-speed"])}),layout:Ox};const Nx=new class extends yn{possiblyEvaluate(t,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,A,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,A,r)}}(Dx.paint.properties["dynamicLine-width"].specification);function kx(t,e){return e>0?e+2*t:t}Nx.useIntegerZoom=!0;const Vx={raster:class extends En{constructor(t){super(t,vn);}},fill:class extends En{constructor(t){super(t,Iy),this.maskType=!!t.maskType&&t.maskType;}recalculate(t,e){super.recalculate(t,e),this.paint=this._transitioningPaint.possiblyEvaluate(t);const A=this.paint._values["fill-outline-color"];"constant"===A.value.kind&&void 0===A.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);}createBucket(t){return new fy(t)}queryRadius(){return Fy(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){return function(t,e){if(1===t.length)return _y(e,t[0]);for(let A=0;A<e.length;A++){const r=e[A];for(let e=0;e<r.length;e++)if(vy(t,r[e]))return !0}for(let A=0;A<t.length;A++)if(_y(e,t[A]))return !0;for(let A=0;A<e.length;A++)if(wy(t,e[A]))return !0;return !1}(My(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),n.angle,s),r)}hasOffscreenPass(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility}},line:class extends En{constructor(t){t&&t.layout&&"visible"===t.layout["border-visibility"]&&t.paint&&t.paint["line-gap-width"]&&(T("'line-gap-width' cannot be set when 'border-visibility' is 'visible'"),t.paint["line-gap-width"]=0),super(t,Gy),this.gradientVersion=0;}_handleSpecialPaintPropertyUpdate(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof lA,this.gradientVersion=(this.gradientVersion+1)%u);}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(t,e){super.recalculate(t,e),t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this.paint._values["line-floorwidth"]=Ky.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t);}createBucket(t){return new ky(t)}queryRadius(t){const e=t,A=zy(Uy("line-width",this,e),Uy("line-gap-width",this,e)),r=Uy("line-offset",this,e);return A/2+Math.abs(r)+Fy(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){const a=My(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,s),o=s/2*zy(this.paint.get("line-width").evaluate(e,A),this.paint.get("line-gap-width").evaluate(e,A)),h=this.paint.get("line-offset").evaluate(e,A);return h&&(r=function(t,e){const A=[],r=new l(0,0);for(let i=0;i<t.length;i++){const n=t[i],s=[];for(let t=0;t<n.length;t++){const A=n[t-1],i=n[t],a=n[t+1],o=0===t?r:i.sub(A)._unit()._perp(),h=t===n.length-1?r:a.sub(i)._unit()._perp(),l=o._add(h)._unit();l._mult(1/(l.x*h.x+l.y*h.y)),s.push(l._mult(e)._add(i));}A.push(s);}return A}(r,h*s)),my(a,r,o)}hasOffscreenPass(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility}},airline:class extends En{constructor(t){super(t,tg);}recalculate(t,e){super.recalculate(t,e),this.paint._values["airline-floorwidth"]=eg.possiblyEvaluate(this._transitioningPaint._values["airline-width"].value,t);}createBucket(t){return new Jy(t)}getCrossfadeParameters(){return this._crossfadeParameters}queryRadius(t){const e=t,A=Ag(Uy("airline-width",this,e),Uy("airline-gap-width",this,e)),r=Uy("airline-offset",this,e);return A/2+Math.abs(r)+Fy(this.paint.get("airline-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){const a=My(t,this.paint.get("airline-translate"),this.paint.get("airline-translate-anchor"),n.angle,s),o=s/2*Ag(this.paint.get("airline-width").evaluate(e,A),this.paint.get("airline-gap-width").evaluate(e,A)),h=this.paint.get("airline-offset").evaluate(e,A);return h&&(r=function(t,e){const A=[],r=new l(0,0);for(let i=0;i<t.length;i++){const n=t[i],s=[];for(let t=0;t<n.length;t++){const A=n[t-1],i=n[t],a=n[t+1],o=0===t?r:i.sub(A)._unit()._perp(),h=t===n.length-1?r:a.sub(i)._unit()._perp(),l=o._add(h)._unit();l._mult(1/(l.x*h.x+l.y*h.y)),s.push(l._mult(e)._add(i));}A.push(s);}return A}(r,h*s)),my(a,r,o)}},circle:class extends En{constructor(t){super(t,og);}createBucket(t){return new sg(t)}queryRadius(t){const e=t;return Uy("circle-radius",this,e)+Uy("circle-stroke-width",this,e)+Fy(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s,a){const o=My(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),n.angle,s),h=this.paint.get("circle-radius").evaluate(e,A)+this.paint.get("circle-stroke-width").evaluate(e,A),l="map"===this.paint.get("circle-pitch-alignment"),c=l?o:function(t,e){return t.map((t=>hg(t,e)))}(o,a),u=l?h*s:h;for(const t of r)for(const e of t){const t=l?e:hg(e,a);let A=u;const r=new ah([e.x,e.y,0,1]).transform(a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?A*=r[3]/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(A*=n.cameraToCenterDistance/r[3]),gy(c,t,A))return !0}return !1}},heatmap:class extends En{createBucket(t){return new pg(t)}constructor(t){super(t,Bg),this._updateColorRamp();}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp();}_updateColorRamp(){this.colorRamp=wg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null;}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},symbol:class extends En{constructor(t){super(t,kg);}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(t,e,A,r){const i=this.layout.get(t).evaluate(e,{},A,r),n=this._unevaluatedLayout._values[t];return n.isDataDriven()||Ir(n.value)?i:Dg(e.properties,i)}createBucket(t){return new Og(t)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},extrusion:class extends En{constructor(t){super(t,qg),this.enableQuery=t.enableQuery||!1,t.hasOwnProperty("patternZoomOffset")&&(this.patternZoomOffset=t.patternZoomOffset),this.radiationRegions=[];const e=t["radiation-regions"]||[];for(let t=0;t<e.length;t++)if(e[t].scan){const A=Lf([],[e[t].location[0],e[t].location[1]+.1],$.TRANSFORM.R),r=Lf([],e[t].location,$.TRANSFORM.R),i=Lf([],[e[t].location[0]+.1,e[t].location[1]],$.TRANSFORM.R);this.radiationRegions.push({geo:[...r,e[t].radius*$.TRANSFORM.R_SCALE],location:e[t].location,scan:!0,north:A,cross:new nh(A).sub(r).cross(new nh(i).sub(r)).toArray(),speed:e[t].speed||10});}else this.radiationRegions.push({geo:[...Lf([],e[t].location,$.TRANSFORM.R),e[t].radius*$.TRANSFORM.R_SCALE],location:e[t].location,scan:!1,speed:e[t].speed||10});}createBucket(t){return new Xg(t,this.enableQuery)}queryRadius(){return Fy(this.paint.get("extrusion-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){return My(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),n.angle,s),!1}hasOffscreenPass(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},histogram:class extends En{constructor(t){super(t,gx),this.radiationRegions=[];const e=t["radiation-regions"]||[];for(let t=0;t<e.length;t++)if(e[t].scan){const A=Lf([],[e[t].location[0],e[t].location[1]+.1],$.TRANSFORM.R),r=Lf([],e[t].location,$.TRANSFORM.R),i=Lf([],[e[t].location[0]+.1,e[t].location[1]],$.TRANSFORM.R);this.radiationRegions.push({geo:[...r,e[t].radius*$.TRANSFORM.R_SCALE],location:e[t].location,scan:!0,north:A,cross:new nh(A).sub(r).cross(new nh(i).sub(r)).toArray(),speed:e[t].speed||10});}else this.radiationRegions.push({geo:[...Lf([],e[t].location,$.TRANSFORM.R),e[t].radius*$.TRANSFORM.R_SCALE],location:e[t].location,scan:!1,speed:e[t].speed||10});}createBucket(t){return new fx(t)}queryRadius(){return Fy(this.paint.get("histogram-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){return My(t,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),n.angle,s),!1}hasOffscreenPass(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},sprite:class extends En{constructor(t){super(t,ax);}recalculate(t,e){super.recalculate(t,e),t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this.paint._values["sprite-floorwidth"]=ox.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,t);}createBucket(t){return new nx(t)}queryRadius(t){const e=t,A=hx(Uy("sprite-width",this,e),Uy("sprite-gap-width",this,e)),r=Uy("sprite-offset",this,e);return A/2+Math.abs(r)+Fy(this.paint.get("sprite-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){const a=My(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),n.angle,s),o=s/2*hx(this.paint.get("sprite-width").evaluate(e,A),this.paint.get("sprite-gap-width").evaluate(e,A)),h=this.paint.get("sprite-offset").evaluate(e,A);return h&&(r=function(t,e){const A=[],r=new l(0,0);for(let i=0;i<t.length;i++){const n=t[i],s=[];for(let t=0;t<n.length;t++){const A=n[t-1],i=n[t],a=n[t+1],o=0===t?r:i.sub(A)._unit()._perp(),h=t===n.length-1?r:a.sub(i)._unit()._perp(),l=o._add(h)._unit();l._mult(1/(l.x*h.x+l.y*h.y)),s.push(l._mult(e)._add(i));}A.push(s);}return A}(r,h*s)),my(a,r,o)}},background:class extends En{constructor(t){super(t,_n);}},tracking:class extends En{constructor(t){super(t,Am);}recalculate(t,e){super.recalculate(t,e),t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this.paint._values["tracking-floorwidth"]=rm.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,t);}getCrossfadeParameters(){return this._crossfadeParameters}createBucket(t){return new tm(t)}queryRadius(t){const e=t,A=im(Uy("tracking-width",this,e),Uy("tracking-gap-width",this,e)),r=Uy("tracking-offset",this,e);return A/2+Math.abs(r)+Fy(this.paint.get("tracking-translate"))}queryIntersectsFeature(t,e,A,r,i,n,s){const a=My(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),n.angle,s),o=s/2*im(this.paint.get("tracking-width").evaluate(e,A),this.paint.get("tracking-gap-width").evaluate(e,A)),h=this.paint.get("tracking-offset").evaluate(e,A);return h&&(r=function(t,e){const A=[],r=new l(0,0);for(let i=0;i<t.length;i++){const n=t[i],s=[];for(let t=0;t<n.length;t++){const A=n[t-1],i=n[t],a=n[t+1],o=0===t?r:i.sub(A)._unit()._perp(),h=t===n.length-1?r:a.sub(i)._unit()._perp(),l=o._add(h)._unit();l._mult(1/(l.x*h.x+l.y*h.y)),s.push(l._mult(e)._add(i));}A.push(s);}return A}(r,h*s)),my(a,r,o)}},"3d-model":jw,"3d-tiles":class extends En{constructor(t){super(t,Yw),this.viewshedRender=!t.hasOwnProperty("viewshed-render")||!!t["viewshed-render"],this.cvtBGR2RGB=!!t.hasOwnProperty("cvtBGR2RGB")&&!!t.cvtBGR2RGB;}},panorama:class extends En{constructor(t){super(t,cx);}},symtracking:class extends En{constructor(t){super(t,Ix);}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(t,e){const A=this.layout.get(t).evaluate(e,{}),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||Ir(r.value)?A:Dg(e.properties,A)}createBucket(t){return new Mx(t)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},dynamicLine:class extends En{constructor(t){super(t,Dx);}recalculate(t,e){super.recalculate(t,e),this.paint._values["dynamicLine-floorwidth"]=Nx.possiblyEvaluate(this._transitioningPaint._values["dynamicLine-width"].value,t);}createBucket(t){return new Hx(t)}queryRadius(t){const e=t;return kx(Uy("dynamicLine-width",this,e),Uy("dynamicLine-gap-width",this,e))/2}queryIntersectsFeature(t,e,A,r,i,n,s){return my([],r,s/2*kx(this.paint.get("dynamicLine-width").evaluate(e,A),this.paint.get("dynamicLine-gap-width").evaluate(e,A)))}isTileClipped(){return !0}}};function Gx(t){let e=0,A=0;for(const r of t)e+=r.w*r.h,A=Math.max(A,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),A),h:1/0}];let i=0,n=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const A=r[t];if(!(e.w>A.w||e.h>A.h)){if(e.x=A.x,e.y=A.y,n=Math.max(n,e.y+e.h),i=Math.max(i,e.x+e.w),e.w===A.w&&e.h===A.h){const e=r.pop();t<r.length&&(r[t]=e);}else e.h===A.h?(A.x+=e.w,A.w-=e.w):e.w===A.w?(A.y+=e.h,A.h-=e.h):(r.push({x:A.x+e.w,y:A.y,w:A.w-e.w,h:e.h}),A.y+=e.h,A.h-=e.h);break}}return {w:i,h:n,fill:e/(i*n)||0}}class Kx{constructor(t,{pixelRatio:e,version:A,stretchX:r,stretchY:i,content:n}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=i,this.content=n,this.version=A;}get tl(){return [this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return [this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return [(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zx{constructor(t,e){const A={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(t,A,i),this.addImages(e,r,i);const{w:n,h:s}=Gx(i),a=new mg({width:n||1,height:s||1});for(const e in t){const r=t[e],i=A[e].paddedRect;mg.copy(r.data,a,{x:0,y:0},{x:i.x+1,y:i.y+1},r.data);}for(const t in e){const A=e[t],i=r[t].paddedRect,n=i.x+1,s=i.y+1,o=A.data.width,h=A.data.height;mg.copy(A.data,a,{x:0,y:0},{x:n,y:s},A.data),mg.copy(A.data,a,{x:0,y:h-1},{x:n,y:s-1},{width:o,height:1}),mg.copy(A.data,a,{x:0,y:0},{x:n,y:s+h},{width:o,height:1}),mg.copy(A.data,a,{x:o-1,y:0},{x:n-1,y:s},{width:1,height:h}),mg.copy(A.data,a,{x:0,y:0},{x:n+o,y:s},{width:1,height:h});}this.image=a,this.iconPositions=A,this.patternPositions=r;}addImages(t,e,A){for(const r in t){const i=t[r],n={x:0,y:0,w:i.data.width+2,h:i.data.height+2};A.push(n),e[r]=new Kx(n,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r);}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const A in t.updatedImages)this.patchUpdatedImage(this.iconPositions[A],t.getImage(A),e),this.patchUpdatedImage(this.patternPositions[A],t.getImage(A),e);}patchUpdatedImage(t,e,A){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,i]=t.tl;A.update(e.data,void 0,{x:r,y:i});}}Fi("ImagePosition",Kx),Fi("ImageAtlas",zx);var Xx=function(t,e,A,r,i){var n,s,a=8*i-r-1,o=(1<<a)-1,h=o>>1,l=-7,c=A?i-1:0,u=A?-1:1,p=t[e+c];for(c+=u,n=p&(1<<-l)-1,p>>=-l,l+=a;l>0;n=256*n+t[e+c],c+=u,l-=8);for(s=n&(1<<-l)-1,n>>=-l,l+=r;l>0;s=256*s+t[e+c],c+=u,l-=8);if(0===n)n=1-h;else {if(n===o)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),n-=h;}return (p?-1:1)*s*Math.pow(2,n-r)},qx=function(t,e,A,r,i,n){var s,a,o,h=8*n-i-1,l=(1<<h)-1,c=l>>1,u=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:n-1,d=r?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(o=Math.pow(2,-s))<1&&(s--,o*=2),(e+=s+c>=1?u/o:u*Math.pow(2,1-c))*o>=2&&(s++,o/=2),s+c>=l?(a=0,s=l):s+c>=1?(a=(e*o-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[A+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;t[A+p]=255&s,p+=d,s/=256,h-=8);t[A+p-d]|=128*f;},jx=Yx;function Yx(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}Yx.Varint=0,Yx.Fixed64=1,Yx.Bytes=2,Yx.Fixed32=5;var Wx=4294967296,Zx=1/Wx,Jx="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function $x(t){return t.type===Yx.Bytes?t.readVarint()+t.pos:t.pos+1}function tC(t,e,A){return A?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function eC(t,e,A){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));A.realloc(r);for(var i=A.pos-1;i>=t;i--)A.buf[i+r]=A.buf[i];}function AC(t,e){for(var A=0;A<t.length;A++)e.writeVarint(t[A]);}function rC(t,e){for(var A=0;A<t.length;A++)e.writeSVarint(t[A]);}function iC(t,e){for(var A=0;A<t.length;A++)e.writeFloat(t[A]);}function nC(t,e){for(var A=0;A<t.length;A++)e.writeDouble(t[A]);}function sC(t,e){for(var A=0;A<t.length;A++)e.writeBoolean(t[A]);}function aC(t,e){for(var A=0;A<t.length;A++)e.writeFixed32(t[A]);}function oC(t,e){for(var A=0;A<t.length;A++)e.writeSFixed32(t[A]);}function hC(t,e){for(var A=0;A<t.length;A++)e.writeFixed64(t[A]);}function lC(t,e){for(var A=0;A<t.length;A++)e.writeSFixed64(t[A]);}function cC(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function uC(t,e,A){t[A]=e,t[A+1]=e>>>8,t[A+2]=e>>>16,t[A+3]=e>>>24;}function pC(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function dC(t,e,A){1===t&&A.readMessage(fC,e);}function fC(t,e,A){if(3===t){const{id:t,bitmap:r,width:i,height:n,left:s,top:a,advance:o}=A.readMessage(yC,{});e.push({id:t,bitmap:new gg({width:i+6,height:n+6},r),metrics:{width:i,height:n,left:s,top:a,advance:o}});}}function yC(t,e,A){1===t?e.id=A.readVarint():2===t?e.bitmap=A.readBytes():3===t?e.width=A.readVarint():4===t?e.height=A.readVarint():5===t?e.left=A.readSVarint():6===t?e.top=A.readSVarint():7===t&&(e.advance=A.readVarint());}Yx.prototype={destroy:function(){this.buf=null;},readFields:function(t,e,A){for(A=A||this.length;this.pos<A;){var r=this.readVarint(),i=r>>3,n=this.pos;this.type=7&r,t(i,e,this),this.pos===n&&this.skip(r);}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=cC(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=pC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=cC(this.buf,this.pos)+cC(this.buf,this.pos+4)*Wx;return this.pos+=8,t},readSFixed64:function(){var t=cC(this.buf,this.pos)+pC(this.buf,this.pos+4)*Wx;return this.pos+=8,t},readFloat:function(){var t=Xx(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xx(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,A,r=this.buf;return e=127&(A=r[this.pos++]),A<128?e:(e|=(127&(A=r[this.pos++]))<<7,A<128?e:(e|=(127&(A=r[this.pos++]))<<14,A<128?e:(e|=(127&(A=r[this.pos++]))<<21,A<128?e:function(t,e,A){var r,i,n=A.buf;if(r=(112&(i=n[A.pos++]))>>4,i<128)return tC(t,r,e);if(r|=(127&(i=n[A.pos++]))<<3,i<128)return tC(t,r,e);if(r|=(127&(i=n[A.pos++]))<<10,i<128)return tC(t,r,e);if(r|=(127&(i=n[A.pos++]))<<17,i<128)return tC(t,r,e);if(r|=(127&(i=n[A.pos++]))<<24,i<128)return tC(t,r,e);if(r|=(1&(i=n[A.pos++]))<<31,i<128)return tC(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(A=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Jx?function(t,e,A){return Jx.decode(t.subarray(e,A))}(this.buf,e,t):function(t,e,A){for(var r="",i=e;i<A;){var n,s,a,o=t[i],h=null,l=o>239?4:o>223?3:o>191?2:1;if(i+l>A)break;1===l?o<128&&(h=o):2===l?128==(192&(n=t[i+1]))&&(h=(31&o)<<6|63&n)<=127&&(h=null):3===l?(s=t[i+2],128==(192&(n=t[i+1]))&&128==(192&s)&&((h=(15&o)<<12|(63&n)<<6|63&s)<=2047||h>=55296&&h<=57343)&&(h=null)):4===l&&(s=t[i+2],a=t[i+3],128==(192&(n=t[i+1]))&&128==(192&s)&&128==(192&a)&&((h=(15&o)<<18|(63&n)<<12|(63&s)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,l=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),r+=String.fromCharCode(h),i+=l;}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Yx.Bytes)return t.push(this.readVarint(e));var A=$x(this);for(t=t||[];this.pos<A;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Yx.Bytes)return t.push(this.readSVarint());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Yx.Bytes)return t.push(this.readBoolean());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Yx.Bytes)return t.push(this.readFloat());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Yx.Bytes)return t.push(this.readDouble());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Yx.Bytes)return t.push(this.readFixed32());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Yx.Bytes)return t.push(this.readSFixed32());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Yx.Bytes)return t.push(this.readFixed64());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Yx.Bytes)return t.push(this.readSFixed64());var e=$x(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Yx.Varint)for(;this.buf[this.pos++]>127;);else if(e===Yx.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Yx.Fixed32)this.pos+=4;else {if(e!==Yx.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8;}},writeTag:function(t,e){this.writeVarint(t<<3|e);},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var A=new Uint8Array(e);A.set(this.buf),this.buf=A,this.length=e;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),uC(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),uC(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),uC(this.buf,-1&t,this.pos),uC(this.buf,Math.floor(t*Zx),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),uC(this.buf,-1&t,this.pos),uC(this.buf,Math.floor(t*Zx),this.pos+4),this.pos+=8;},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var A,r;if(t>=0?(A=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(A=~(-t%4294967296))?A=A+1|0:(A=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,A){A.buf[A.pos++]=127&t|128,t>>>=7,A.buf[A.pos++]=127&t|128,t>>>=7,A.buf[A.pos++]=127&t|128,t>>>=7,A.buf[A.pos++]=127&t|128,A.buf[A.pos]=127&(t>>>=7);}(A,0,e),function(t,e){var A=(7&t)<<4;e.buf[e.pos++]|=A|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))));}(r,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,A){for(var r,i,n=0;n<e.length;n++){if((r=e.charCodeAt(n))>55295&&r<57344){if(!i){r>56319||n+1===e.length?(t[A++]=239,t[A++]=191,t[A++]=189):i=r;continue}if(r<56320){t[A++]=239,t[A++]=191,t[A++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null;}else i&&(t[A++]=239,t[A++]=191,t[A++]=189,i=null);r<128?t[A++]=r:(r<2048?t[A++]=r>>6|192:(r<65536?t[A++]=r>>12|224:(t[A++]=r>>18|240,t[A++]=r>>12&63|128),t[A++]=r>>6&63|128),t[A++]=63&r|128);}return A}(this.buf,t,this.pos);var A=this.pos-e;A>=128&&eC(e,A,this),this.pos=e-1,this.writeVarint(A),this.pos+=A;},writeFloat:function(t){this.realloc(4),qx(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),qx(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var A=0;A<e;A++)this.buf[this.pos++]=t[A];},writeRawMessage:function(t,e){this.pos++;var A=this.pos;t(e,this);var r=this.pos-A;r>=128&&eC(A,r,this),this.pos=A-1,this.writeVarint(r),this.pos+=r;},writeMessage:function(t,e,A){this.writeTag(t,Yx.Bytes),this.writeRawMessage(e,A);},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,AC,e);},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,rC,e);},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,sC,e);},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,iC,e);},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,nC,e);},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,aC,e);},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,oC,e);},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,hC,e);},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,lC,e);},writeBytesField:function(t,e){this.writeTag(t,Yx.Bytes),this.writeBytes(e);},writeFixed32Field:function(t,e){this.writeTag(t,Yx.Fixed32),this.writeFixed32(e);},writeSFixed32Field:function(t,e){this.writeTag(t,Yx.Fixed32),this.writeSFixed32(e);},writeFixed64Field:function(t,e){this.writeTag(t,Yx.Fixed64),this.writeFixed64(e);},writeSFixed64Field:function(t,e){this.writeTag(t,Yx.Fixed64),this.writeSFixed64(e);},writeVarintField:function(t,e){this.writeTag(t,Yx.Varint),this.writeVarint(e);},writeSVarintField:function(t,e){this.writeTag(t,Yx.Varint),this.writeSVarint(e);},writeStringField:function(t,e){this.writeTag(t,Yx.Bytes),this.writeString(e);},writeFloatField:function(t,e){this.writeTag(t,Yx.Fixed32),this.writeFloat(e);},writeDoubleField:function(t,e){this.writeTag(t,Yx.Fixed64),this.writeDouble(e);},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e));}};class gC{constructor(t,e,A){this.target=t,this.parent=e,this.mapId=A,this.callbacks={},this.callbackID=0,U(["receive"],this),this.target.addEventListener("message",this.receive,!1);}send(t,e,A,r){const i=A?`${this.mapId}:${this.callbackID++}`:null;A&&(this.callbacks[i]=A);const n=[];if(this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(i),data:Ii(e,n)},n),A)return {cancel:()=>this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:"<cancel>",id:String(i)})}}receive(t){const e=t.data,A=e.id;let r;if(e.targetMapId&&this.mapId!==e.targetMapId)return;const i=(t,e)=>{delete this.callbacks[A];const r=[];this.target.postMessage(e&&e.img&&e.img.data&&0===e.img.data.byteLength?{sourceMapId:this.mapId,type:"<response>",id:String(A),error:Ii({message:"图片为空"}),data:null}:{sourceMapId:this.mapId,type:"<response>",id:String(A),error:t?Ii(t):null,data:Ii(e,r)},r);};if("<response>"===e.type||"<cancel>"===e.type)r=this.callbacks[e.id],delete this.callbacks[e.id],r&&e.error?r(Si(e.error)):r&&r(null,Si(e.data));else if(void 0!==e.id&&this.parent[e.type]){this.callbacks[e.id]=null;const t=Si(e.data);"reloadTile"===e.type&&(t.projection=this.parent.projection);const A=this.parent[e.type](e.sourceMapId,t,i);A&&null===this.callbacks[e.id]&&(this.callbacks[e.id]=A);}else if(void 0!==e.id&&this.parent.getWorkerSource){const t=e.type.split("."),A=Si(e.data);this.parent.getWorkerSource(e.sourceMapId,t[0],A.source)[t[1]](A,i);}else this.parent[e.type](Si(e.data));}remove(){this.target.removeEventListener("message",this.receive,!1);}}class mC{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=b();const A=this.workerPool.acquire(this.id);for(let t=0;t<A.length;t++){const r=new mC.Actor(A[t],e,this.id);r.name=`Worker ${t}`,this.actors.push(r);}}broadcast(t,e,A){E(this.actors,((A,r)=>{A.send(t,e,r);}),A=A||function(){});}send(t,e,A,r){return (isNaN(r)||"number"!=typeof r)&&(r=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[r]&&this.actors[r].send(t,e,A),r}remove(){this.actors.forEach((t=>{t.remove();})),this.actors=[],this.workerPool.release(this.id);}}mC.Actor=gC;var BC=Mn([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2},{name:"a_normal",type:"Float32",components:3}]);class wC{constructor(){}clone(t){return t.uBuffer=this.uBuffer,t.vBuffer=this.vBuffer,t.heightBuffer=this.heightBuffer,t.normalBuffer=this.normalBuffer,t.index=this.index,t.first=this.first,t.second=this.second,t.ratio=this.ratio,t}initializeIndexed(t,e,A,r,i){this.uBuffer=t,this.vBuffer=e,this.heightBuffer=A,this.normalBuffer=r,this.index=i,this.first=void 0,this.second=void 0,this.ratio=void 0;}initializeFromClipResult(t,e,A){let r=e+1;return -1!==t[e]?A[t[e]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=A[t[r]],++r,this.second=A[t[r]],++r,this.ratio=t[r],++r),r}getKey(){return this.isIndexed()?`${this.index||0}`:JSON.stringify({first:this.first?this.first.getKey():"",second:this.second?this.second.getKey():"",ratio:this.ratio||0})}isIndexed(){return null!=this.index}getH(){return null!=this.index?this.heightBuffer[this.index]:this.first&&this.second?zf(this.first.getH(),this.second.getH(),this.ratio||0):0}getU(){return null!=this.index?this.uBuffer[this.index]:this.first&&this.second?zf(this.first.getU(),this.second.getU(),this.ratio||0):0}getV(){return null!=this.index?this.vBuffer[this.index]:this.first&&this.second?zf(this.first.getV(),this.second.getV(),this.ratio||0):0}}const xC=function(t,e,A,r,i,n){let s,a,o;n.length=0,e?(s=A<t,a=r<t,o=i<t):(s=A>t,a=r>t,o=i>t);const h=s+a+o;let l,c,u,p,d,f;return 1===h?s?(l=(t-A)/(r-A),c=(t-A)/(i-A),n.push(1),n.push(2),1!==c&&(n.push(-1),n.push(0),n.push(2),n.push(c)),1!==l&&(n.push(-1),n.push(0),n.push(1),n.push(l))):a?(u=(t-r)/(i-r),p=(t-r)/(A-r),n.push(2),n.push(0),1!==p&&(n.push(-1),n.push(1),n.push(0),n.push(p)),1!==u&&(n.push(-1),n.push(1),n.push(2),n.push(u))):o&&(d=(t-i)/(A-i),f=(t-i)/(r-i),n.push(0),n.push(1),1!==f&&(n.push(-1),n.push(2),n.push(1),n.push(f)),1!==d&&(n.push(-1),n.push(2),n.push(0),n.push(d))):2===h?s||A===t?a||r===t?o||i===t||(c=(t-A)/(i-A),u=(t-r)/(i-r),n.push(2),n.push(-1),n.push(0),n.push(2),n.push(c),n.push(-1),n.push(1),n.push(2),n.push(u)):(f=(t-i)/(r-i),l=(t-A)/(r-A),n.push(1),n.push(-1),n.push(2),n.push(1),n.push(f),n.push(-1),n.push(0),n.push(1),n.push(l)):(p=(t-r)/(A-r),d=(t-i)/(A-i),n.push(0),n.push(-1),n.push(1),n.push(0),n.push(p),n.push(-1),n.push(2),n.push(0),n.push(d)):3!==h&&(n.push(0),n.push(1),n.push(2)),n};class CC{constructor(){this.maxShort=32767,this.halfMaxShort=this.maxShort/2|0;}getCenterLngLat(t,e,A,r){const i=fa(r),n=Math.pow(2,A+1);return i.tileNumberToLngLat([2*t+1,2*e+1],1,n)}createTerrain(t,e,A,r,i){if(!t||0===t.byteLength)return;t.buffer&&(t=t.buffer);const n=fa(i),s=Math.pow(2,r),a=n.tileNumberToLngLat([e,A],1,s),o=n.tileNumberToLngLat([e+1,A+1],1,s),h=Math.abs(o.lng-a.lng),l=this.getCenterLngLat(e,A,r,i);let c=null,u=null,p=null,d=null,f=null;if("LATLON"===i){const t=fa(ua.MERCATOR);c=t.latY(a.lat,s),u=t.lngX(a.lng,s),p=t.latY(o.lat,s),d=t.lngX(o.lng,s),f=(p-c)/(d-u);}const y=new Tn,g=new es;let m=0;const B=3*Float64Array.BYTES_PER_ELEMENT,w=4*Float64Array.BYTES_PER_ELEMENT,x=3*Uint16Array.BYTES_PER_ELEMENT;let C=Uint16Array.BYTES_PER_ELEMENT,E=3*C;const _=new DataView(t);m+=B;const v=_.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const b=_.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const U=Lf([],[l.lng,l.lat],$.TRANSFORM.R+v*$.TRANSFORM.R_SCALE),F={vertex:[Lf([],[a.lng,a.lat],$.TRANSFORM.R+v),Lf([],[o.lng,a.lat],$.TRANSFORM.R+v),Lf([],[o.lng,o.lat],$.TRANSFORM.R+v),Lf([],[a.lng,o.lat],$.TRANSFORM.R+v),Lf([],[a.lng,a.lat],$.TRANSFORM.R+b),Lf([],[o.lng,a.lat],$.TRANSFORM.R+b),Lf([],[o.lng,o.lat],$.TRANSFORM.R+b),Lf([],[a.lng,o.lat],$.TRANSFORM.R+b)],indices:[0,3,2,0,2,1,4,7,6,4,6,5,0,4,7,0,7,3,1,5,6,1,6,2,0,5,4,0,1,5,3,6,2,3,7,6]},M=[];for(let t=0;t<F.indices.length;)M.push([F.vertex[F.indices[t]],F.vertex[F.indices[t+1]],F.vertex[F.indices[t+2]]]),t+=3;let Q;m+=w,m+=B;try{Q=_.getUint32(m,!0);}catch(t){return}m+=Uint32Array.BYTES_PER_ELEMENT;const I=new Uint16Array(t,m,3*Q);m+=Q*x,Q>65536&&(C=Uint32Array.BYTES_PER_ELEMENT,E=3*C);const S=I.subarray(0,Q),T=I.subarray(Q,2*Q),R=I.subarray(2*Q,3*Q),L=[],P=[],H=[];this.zigZagDeltaDecode({uBuffer:S,vBuffer:T,heightBuffer:R,maximumHeight:b,minimumHeight:v,position:L,uv:P,hei:H,sphereMaskedBoundsArray:y,centerLngLat:l,deltaLng:h,rP:U,worldSize:s,x:e,y:A,z:r,newY:c,lnglatScale:f}),m%C!=0&&(m+=C-m%C);const O=_.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;const D=new Uint16Array(t,m,3*O);m+=O*E;let N=0;const k=D.length;for(let t=0;t<k;++t){const e=D[t];D[t]=N-e,0===e&&++N;}const V=_.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let G=new Uint16Array(t,m,V);m+=V*C;const K=_.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let z=new Uint16Array(t,m,K);m+=K*C;const X=_.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let q=new Uint16Array(t,m,X);m+=X*C;const j=_.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let Y=new Uint16Array(t,m,j);m+=j*C;const W=Math.max(0,2*(G.length+z.length+q.length+Y.length-4)),Z=new Uint16Array(k+3*W);function J(t,e){return T[t]-T[e]}function tt(t,e){return S[t]-S[e]}Z.set(D,0),G=this.sortIndicesIfNecessary(G,J),z=this.sortIndicesIfNecessary(z,tt),q=this.sortIndicesIfNecessary(q,J),Y=this.sortIndicesIfNecessary(Y,tt);let et=k,At=I.length;et=this.addSkirt(At,Z,et,G,!0,3,L,P,H,y,r,U),At+=3*G.length,et=this.addSkirt(At,Z,et,z,!1,3,L,P,H,y,r,U),At+=3*z.length,et=this.addSkirt(At,Z,et,q,!1,3,L,P,H,y,r,U),At+=3*q.length,this.addSkirt(At,Z,et,Y,!0,3,L,P,H,y,r,U);for(let t=0;t<Z.length;t+=3)g.emplaceBack(Z[t],Z[t+1],Z[t+2]);return {sphereMaskedBoundsArray:y,sphereIndexArray:g,rP:U,count:L.length,minimumHeight:v,maximumHeight:b,tileBounds:M,tileBoundsVertex:F.vertex,indices:D,skirtIndex:D.length,vertexCountWithoutSkirts:Q,x:e,y:A,z:r,uBuffer:S.slice(0),vBuffer:T.slice(0),hBuffer:R.slice(0),westIndices:G.slice(0),southIndices:z.slice(0),eastIndices:q.slice(0),northIndices:Y.slice(0)}}createChildTerrain(t){const e=this.upsampleQuantizedTerrainMesh(t);return this.createUpSampleTerrain(e)}createUpSampleTerrain(t){const e=fa(t.projectionType),A=t.x,r=t.y,i=t.z,n=Math.pow(2,i),s=e.tileNumberToLngLat([A,r],1,n),a=e.tileNumberToLngLat([A+1,r+1],1,n);let o=null,h=null,l=null,c=null,u=null;if("LATLON"===t.projectionType){const t=fa(ua.MERCATOR);o=t.latY(s.lat,n),h=t.lngX(s.lng,n),l=t.latY(a.lat,n),c=t.lngX(a.lng,n),u=(l-o)/(c-h);}const p=Math.abs(a.lng-s.lng),d=this.getCenterLngLat(A,r,i),f=new Tn,y=new es,g=new Uint16Array(t.uBuffer),m=new Uint16Array(t.vBuffer),B=new Uint16Array(t.heightBuffer),w=[],x=[],C=[],E=t.maximumHeight,_=t.minimumHeight,v=Lf([],[d.lng,d.lat],$.TRANSFORM.R+_*$.TRANSFORM.R_SCALE);this.zigZagUpsampleDeltaDecode({uBuffer:g,vBuffer:m,heightBuffer:B,maximumHeight:E,minimumHeight:_,position:w,uv:x,hei:C,sphereMaskedBoundsArray:f,centerLngLat:d,deltaLng:p,rP:v,x:A,y:r,z:i,worldSize:n,newY:o,lnglatScale:u});const b=t.indices,U=b.length;let F=t.westIndices,M=t.eastIndices,Q=t.northIndices,I=t.southIndices;const S=t.vertexCount,T=Math.max(0,2*(F.length+I.length+M.length+Q.length-4)),R=new Uint16Array(U+3*T);function L(t,e){return m[t]-m[e]}function P(t,e){return g[t]-g[e]}R.set(b,0),F=this.sortIndicesIfNecessary(F,L),I=this.sortIndicesIfNecessary(I,P),M=this.sortIndicesIfNecessary(M,L),Q=this.sortIndicesIfNecessary(Q,P);let H=U,O=3*S;H=this.addSkirt(O,R,H,F,!0,3,w,x,C,f,i,v),O+=3*F.length,H=this.addSkirt(O,R,H,I,!1,3,w,x,C,f,i,v),O+=3*I.length,H=this.addSkirt(O,R,H,M,!1,3,w,x,C,f,i,v),O+=3*M.length,this.addSkirt(O,R,H,Q,!0,3,w,x,C,f,i,v);for(let t=0;t<R.length;t+=3)y.emplaceBack(R[t],R[t+1],R[t+2]);return {sphereMaskedBoundsArray:f,sphereIndexArray:y,count:w.length,minimumHeight:_,maximumHeight:E,x:t.x,y:t.y,z:t.z,uBuffer:g.slice(0),vBuffer:m.slice(0),hBuffer:B,indices:b,westIndices:F.slice(0),southIndices:I.slice(0),northIndices:Q.slice(0),eastIndices:M.slice(0),rP:v,skirtIndex:b.length,vertexCountWithoutSkirts:S}}zigZagDecode(t){return t>>1^-(1&t)}zigZagDeltaDecode(t){const e=fa(ua.MERCATOR),A=t.uBuffer.length;let r=0,i=0,n=0;const s=(t.maximumHeight-t.minimumHeight)/this.maxShort,a=t.deltaLng/this.maxShort;for(let o=0;o<A;++o){r+=this.zigZagDecode(t.uBuffer[o]),i+=this.zigZagDecode(t.vBuffer[o]),n+=this.zigZagDecode(t.heightBuffer[o]),t.heightBuffer[o]=n,t.uBuffer[o]=r,t.vBuffer[o]=i,t.position[o]=null===t.newY?[t.centerLngLat.lng+(r-this.halfMaxShort)*a,e.yLat(t.y-i/this.maxShort+1,t.worldSize)]:[t.centerLngLat.lng+(r-this.halfMaxShort)*a,e.yLat(t.newY-i/(this.maxShort/t.lnglatScale)+1*t.lnglatScale,t.worldSize)],t.uv[o]=[r,this.maxShort-i],t.hei[o]=t.minimumHeight+n*s;const A=Lf([],t.position[o],$.TRANSFORM.R+t.hei[o]*$.TRANSFORM.R_SCALE);t.sphereMaskedBoundsArray.emplaceBack(A[0]-t.rP[0],A[1]-t.rP[1],A[2]-t.rP[2],t.uv[o][0],t.uv[o][1]);}}addSkirt(t,e,A,r,i,n,s,a,o,h,l,c){let u,p,d;i?(u=r.length-1,p=-1,d=-1):(u=0,p=r.length,d=1);let f=-1,y=t/n;for(let t=u;t!==p;t+=d){const i=r[t];s[y]=s[i],a[y]=a[i],o[y]=o[i]-100;const n=Lf([],[s[y][0],s[y][1]],$.TRANSFORM.R+o[y]*$.TRANSFORM.R_SCALE);h.emplaceBack(n[0]-c[0],n[1]-c[1],n[2]-c[2],a[y][0],a[y][1]),-1!==f&&(e[A++]=f,e[A++]=y-1,e[A++]=i,e[A++]=y-1,e[A++]=y,e[A++]=i),f=i,++y;}return A}sortIndicesIfNecessary(t,e){const A=[];A.length=t.length;let r=!1;for(let i=0,n=t.length;i<n;++i)A[i]=t[i],r=r||i>0&&e(t[i-1],t[i])>0;return r?(A.sort(e),new Uint16Array(A)):t}upsampleQuantizedTerrainMesh(t){const e=t.isEastChild,A=t.isNorthChild,r=e?this.halfMaxShort:0,i=e?this.maxShort:this.halfMaxShort,n=A?this.halfMaxShort:0,s=A?this.maxShort:this.halfMaxShort,a=[],o=[],h=[],l=[],c={},u=t.indices;let p=0;const d=t.vertexCountWithoutSkirts,f=t.minimumHeight,y=t.maximumHeight,g=new Array(d),m=new Array(d),B=new Array(d),w=t.uBuffer,x=t.vBuffer,C=t.hBuffer;let E,_,v,b,U;const F=[],M=[];for(E=0,_=0;E<d;++E,_+=2)v=w[E],b=x[E],v<20&&(v=0),b<20&&(b=0),this.maxShort-v<20&&(v=this.maxShort),this.maxShort-b<20&&(b=this.maxShort),g[E]=v,m[E]=b,B[E]=C[E],(e&&v>=this.halfMaxShort||!e&&v<=this.halfMaxShort)&&(A&&b>=this.halfMaxShort||!A&&b<=this.halfMaxShort)&&(c[E]=p,a.push(v),o.push(b),h.push(B[E]),++p);const Q=[];Q.push(new wC),Q.push(new wC),Q.push(new wC);const I=[];I.push(new wC),I.push(new wC),I.push(new wC);const S=[];let T,R;for(S.push(new wC),S.push(new wC),S.push(new wC),S.push(new wC),E=0;E<u.length;E+=3){const t=u[E],r=u[E+1],i=u[E+2],n=g[t],s=g[r],p=g[i];Q[0].initializeIndexed(g,m,B,null,t),Q[1].initializeIndexed(g,m,B,null,r),Q[2].initializeIndexed(g,m,B,null,i);const d=xC(this.halfMaxShort,e,n,s,p,M);T=0,T>=d.length||(T=I[0].initializeFromClipResult(d,T,Q),T>=d.length||(T=I[1].initializeFromClipResult(d,T,Q),T>=d.length||(T=I[2].initializeFromClipResult(d,T,Q),R=xC(this.halfMaxShort,A,I[0].getV(),I[1].getV(),I[2].getV(),F),this.addClippedPolygon(a,o,h,l,c,R,I,S),T<d.length&&(I[2].clone(I[1]),I[2].initializeFromClipResult(d,T,Q),R=xC(this.halfMaxShort,A,I[0].getV(),I[1].getV(),I[2].getV(),F),this.addClippedPolygon(a,o,h,l,c,R,I,S)))));}const L=e?-this.maxShort:0,P=A?-this.maxShort:0,H=[],O=[],D=[],N=[];let k=Number.MAX_VALUE,V=-k;for(E=0;E<a.length;++E)v=Math.round(a[E]),v<=r?(H.push(E),v=0):v>=i?(D.push(E),v=this.maxShort):v=2*v+L,a[E]=v,b=Math.round(o[E]),b<=n?(O.push(E),b=0):b>=s?(N.push(E),b=this.maxShort):b=2*b+P,o[E]=b,U=zf(f,y,h[E]/this.maxShort),U<k&&(k=U),U>V&&(V=U),h[E]=U;const G=V-k;for(E=0;E<h.length;++E)h[E]=this.maxShort*(h[E]-k)/G;return {minimumHeight:k,maximumHeight:V,westIndices:H,southIndices:O,eastIndices:D,northIndices:N,indices:l,uBuffer:a,vBuffer:o,heightBuffer:h,vertexCount:a.length,x:t.x,y:t.y,z:t.z,rP:t.rP}}zigZagUpsampleDeltaDecode(t){const e=fa(ua.MERCATOR),A=t.uBuffer.length;let r=0,i=0,n=0;const s=(t.maximumHeight-t.minimumHeight)/this.maxShort,a=t.deltaLng/this.maxShort;for(let o=0;o<A;++o){r=t.uBuffer[o],i=t.vBuffer[o],n=t.heightBuffer[o],t.position[o]=null===t.newY?[t.centerLngLat.lng+(r-this.halfMaxShort)*a,e.yLat(t.y-i/this.maxShort+1,t.worldSize)]:[t.centerLngLat.lng+(r-this.halfMaxShort)*a,e.yLat(t.newY-i/(this.maxShort/t.lnglatScale)+1*t.lnglatScale,t.worldSize)],t.uv[o]=[r,this.maxShort-i],t.hei[o]=t.minimumHeight+n*s;const A=Lf([],t.position[o],$.TRANSFORM.R+t.hei[o]*$.TRANSFORM.R_SCALE);t.sphereMaskedBoundsArray.emplaceBack(A[0]-t.rP[0],A[1]-t.rP[1],A[2]-t.rP[2],t.uv[o][0],t.uv[o][1]);}}addClippedPolygon(t,e,A,r,i,n,s,a){if(0===n.length)return;let o=0,h=0;for(;h<n.length;)h=a[o++].initializeFromClipResult(n,h,s);for(let r=0;r<o;++r){const n=a[r];if(n.isIndexed())n.newIndex=i[n.index],n.uBuffer=t,n.vBuffer=e,n.heightBuffer=A;else {const r=n.getKey();if(null!=i[r])n.newIndex=i[r];else {const s=t.length;t.push(n.getU()),e.push(n.getV()),A.push(n.getH()),n.newIndex=s,i[r]=s;}}}3===o?(r.push(a[0].newIndex),r.push(a[1].newIndex),r.push(a[2].newIndex)):4===o&&(r.push(a[0].newIndex),r.push(a[1].newIndex),r.push(a[2].newIndex),r.push(a[0].newIndex),r.push(a[2].newIndex),r.push(a[3].newIndex));}}class EC{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const A=t[e];this._stringToNumber[A]=e,this._numberToString[e]=A;}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class _C{constructor(t,e,A,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=A,t._y=r,this.properties=t.properties,null!=t.id&&(this.id=t.id);}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t;}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class vC{constructor(t,e,A){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ei(ji,16,0),this.grid3D=new Ei(ji,16,0),this.featureIndexArray=new ps,this.promoteId=e,this.projection=A;}insert(t,e,A,r,i,n){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(A,r,i);const a=n?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const A=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<A.length;t++){const e=A[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y);}r[0]<ji&&r[1]<ji&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3]);}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new uy.VectorTile(new jx(this.rawTileData),null,this.projection).layers,this.sourceLayerCoder=new EC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,A){this.loadVTLayers();const r=t.params||{},i=ji/t.tileSize/t.scale,n=qr(r.filter),s=t.queryGeometry,a=t.queryPadding*i,o=UC(s),h=this.grid.query(o.minX-a,o.minY-a,o.maxX+a,o.maxY+a),c=UC(t.cameraQueryGeometry),u=this.grid3D.query(c.minX-a,c.minY-a,c.maxX+a,c.maxY+a,((e,A,r,i)=>function(t,e,A,r,i){for(const n of t)if(e<=n.x&&A<=n.y&&r>=n.x&&i>=n.y)return !0;const n=[new l(e,A),new l(e,i),new l(r,i),new l(r,A)];if(t.length>2)for(const e of n)if(vy(t,e))return !0;for(let e=0;e<t.length-1;e++)if(by(t[e],t[e+1],n))return !0;return !1}(t.cameraQueryGeometry,e-a,A-a,r+a,i+a)));for(const t of u)h.push(t);h.sort(bC);const p={};let d;for(let a=0;a<h.length;a++){const o=h[a];if(o===d)continue;d=o;const l=this.featureIndexArray.get(o);let c=null;this.loadMatchingFeature(p,l.bucketIndex,l.sourceLayerIndex,l.featureIndex,n,r.layers,e,A,((e,A,r)=>(c||(c=bs(e)),A.queryIntersectsFeature(s,e,r,c,this.z,t.transform,i,t.posMatrix))));}return p}loadMatchingFeature(t,e,A,r,i,n,s,a,o){const h=this.bucketLayerIDs[e];if(n&&!function(t,e){for(let A=0;A<t.length;A++)if(e.indexOf(t[A])>=0)return !0;return !1}(n,h))return;const l=this.sourceLayerCoder.decode(A),c=this.vtLayers[l].feature(r);if(!i(new Xi(this.tileID.overscaledZ),c))return;const u=this.getId(c,l);for(let e=0;e<h.length;e++){const A=h[e];if(n&&n.indexOf(A)<0)continue;const i=s[A];if(!i)continue;let l={};void 0!==u&&a&&(l=a.getState(i.sourceLayer||"_geojsonTileLayer",u));const p=!o||o(c,i,l);if(!p)continue;const d=new _C(c,this.z,this.x,this.y);d.layer=i.serialize(),d.id=u;let f=t[A];void 0===f&&(f=t[A]=[]),f.push({featureIndex:r,feature:d,intersectionZ:p});}}lookupSymbolFeatures(t,e,A,r,i,n){const s={};this.loadVTLayers();const a=qr(r);for(const r of t)this.loadMatchingFeature(s,e,A,r,a,i,n);return s}hasLayer(t){for(const e of this.bucketLayerIDs)for(const A of e)if(t===A)return !0;return !1}getId(t,e){let A=t.id;return this.promoteId&&(A=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof A&&(A=Number(A))),A}}function bC(t,e){return e-t}function UC(t){let e=1/0,A=1/0,r=-1/0,i=-1/0;for(const n of t)e=Math.min(e,n.x),A=Math.min(A,n.y),r=Math.max(r,n.x),i=Math.max(i,n.y);return {minX:e,minY:A,maxX:r,maxY:i}}Fi("FeatureIndex",vC,{omit:["rawTileData","sourceLayerCoder"]});class FC{constructor(t,e){this.maxCacheSize=e||100,this.terrainTiles={},this.dispatcher=t,this.mmDemTile=new CC,this.requestingParentTiles={};}updateRequestingParentTile(t,e,A,r,i){if(e===FC.REMOVE){if(this.requestingParentTiles[t.key]){const e=this.requestingParentTiles[t.key].tiles;for(let t=0;t<e.length;t++)e[t]&&e[t].notifyDEMParentDataFinished(this,r,i);delete this.requestingParentTiles[t.key];}}else e===FC.REQUEST&&(this.requestingParentTiles[t.key]?this.requestingParentTiles[t.key].tiles.push(A):this.requestingParentTiles[t.key]={tiles:[A]});}hasRequestingParentTile(t){return !!this.requestingParentTiles[t.key]}parseTerrainTile(t,e){const A={terrainJson:t,triangleData:[],sphereSegments:new ys,sphereMaskedBoundsBuffer:null,sphereMaskedIndexBuffer:null,withDepthRange:!1,rP:[0,0,0],placedAabb:[],matrix:[]},r=A.sphereSegments,i=A.terrainJson.sphereMaskedBoundsArray,n=A.terrainJson.sphereIndexArray,s=r.prepareSegment(0,[],[]);return s.vertexLength+=A.terrainJson.sphereMaskedBoundsArray.length,s.primitiveLength+=A.terrainJson.sphereIndexArray.length,r.prepareSegment(0,i,n),A.sphereMaskedBoundsBuffer=e.createVertexBuffer(i,BC.members),A.sphereMaskedIndexBuffer=e.createIndexBuffer(n),A.rP=A.terrainJson.rP,A.placedAabb=A.terrainJson.tileBounds,A.matrix=Vf(0,A.rP),A}hasTile(t){return !!this.terrainTiles[t]}addTerrainTile(t,e,A,r){if(this.translation||(this.translation=r),this.hasTile(t.key))return this.getTerrainTileByKey(t.key);if(!e.terrainData)return null;const i={terrainJson:e.terrainData,triangleData:[],sphereSegments:new ys,sphereMaskedBoundsBuffer:null,sphereMaskedIndexBuffer:null,withDepthRange:!1,rP:[0,0,0],placedAabb:[],matrix:[]},n=i.sphereSegments,s=i.terrainJson.sphereMaskedBoundsArray,a=i.terrainJson.sphereIndexArray,o=n.prepareSegment(0,[],[]);return o.vertexLength+=i.terrainJson.sphereMaskedBoundsArray.length,o.primitiveLength+=i.terrainJson.sphereIndexArray.length,n.prepareSegment(0,s,a),i.sphereMaskedBoundsBuffer=A.createVertexBuffer(s,BC.members),i.sphereMaskedIndexBuffer=A.createIndexBuffer(a),i.rP=i.terrainJson.rP,i.placedAabb=i.terrainJson.tileBounds,i.matrix=Vf(0,i.rP),this._addTileByKey(t.key,i),i}_addTileByKey(t,e){e&&(e._removeTimeout&&(clearTimeout(e._removeTimeout),delete e._removeTimeout),this.terrainTiles[t]=e);}getTerrainTileByKey(t){const e=this.terrainTiles[t];return e&&e._removeTimeout&&(clearTimeout(e._removeTimeout),delete e._removeTimeout),e}getTerrainTileByID(t,e){let A=t;if(e){let t=e;for(;t>0;){const e=nn.getParentTileId(A);if(this.hasTile(e.key))return this.getTerrainTileByKey(e.key);t--,A=e;}return null}return this.getTerrainTileByKey(t.key)}removeTerrainTile(t){const e=this.terrainTiles[t];e&&e.sphereSegments&&e.sphereMaskedBoundsBuffer&&e.sphereMaskedIndexBuffer&&!e._removeTimeout&&(e._removeTimeout=setTimeout((()=>{e.sphereSegments.destroy(),e.sphereMaskedBoundsBuffer.destroy(),e.sphereMaskedIndexBuffer.destroy(),this.terrainTiles[t]=null,delete this.terrainTiles[t];}),1e4));}removeAllTerrainTile(){for(const t in this.terrainTiles)this.removeTerrainTile(t);}_findHeight(t,e){let A=t[0].z,r=A;for(let e=1;e<t.length;e++)t[e].z>A&&(A=t[e].z),t[e].z<r&&(r=t[e].z);return {max:A,min:r,middle:(A+r)/2}}queryOneTileIntersectHeight(t,e){const A=t.coveringTiles({tileSize:e.tileSize}),r=Math.floor(t.zoom);let i=0;for(let n=0;n<A.length;n++){const s=A[n];if(s.canonical.z===r+Math.log2(t.tileSize/e.tileSize)&&this.getTerrainTileByID(s)){const t=this.getTerrainTileByID(s);t&&t.terrainJson.maximumHeight>i&&(i=t.terrainJson.maximumHeight);}}return i}queryTileIntersectPoint(t,e,A,r){const i=t.coveringTiles({tileSize:e.tileSize,minzoom:e.minzoom,maxzoom:e.maxzoom,roundZoom:e.roundZoom,reparseOverscaled:e.reparseOverscaled});let n=1/0,s=[];for(let t=0;t<i.length;t++){const e=this.getTerrainTileByKey(i[t].key);if(e){const t=e.terrainJson,A=t.sphereMaskedBoundsArray.float32,i=t.sphereIndexArray.uint16,a=e.terrainJson.rP;if(e.placedAabb)for(let o=0;o<e.placedAabb.length;o++){let h=r.intersectTriangle(...e.placedAabb[o],!1,[]);if(h)for(let e=0;e<t.skirtIndex;){const t=r.intersectTriangle([A[5*i[e]]+a[0],A[5*i[e]+1]+a[1],A[5*i[e]+2]+a[2]],[A[5*i[e+1]]+a[0],A[5*i[e+1]+1]+a[1],A[5*i[e+1]+2]+a[2]],[A[5*i[e+2]]+a[0],A[5*i[e+2]+1]+a[1],A[5*i[e+2]+2]+a[2]],!1,[]);if(e+=3,t){const e=new nh(r.origin).distance(t);e<n&&(s=t,n=e);}}h=null;}}}if(s&&s.length){const t=Pf([],s);return s?{intersectionZ:n,intersectionPoint:s,lngLat:[t[0],t[1]],alt:t[2]*$.TRANSFORM.R_ZOOM}:{}}return {}}}FC.REMOVE="REMOVE",FC.REQUEST="REQUEST";const MC={horizontal:1,vertical:2,horizontalOnly:3};class QC{constructor(){this.text="",this.sectionIndex=[],this.sections=[];}static fromFeature(t,e){const A=new QC;if(t instanceof pe)for(let r=0;r<t.sections.length;r++){const i=t.sections[r];A.sections.push({scale:i.scale||1,fontStack:i.fontStack||e}),A.text+=i.text;for(let t=0;t<i.text.length;t++)A.sectionIndex.push(r);}else {A.text=t,A.sections.push({scale:1,fontStack:e});for(let e=0;e<t.length;e++)A.sectionIndex.push(0);}return A}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let A=0;A<t.length;A++){const r=t.charCodeAt(A+1)||null,i=t.charCodeAt(A-1)||null;e+=r&&oe(r)&&!Mg[t[A+1]]||i&&oe(i)&&!Mg[t[A-1]]||!Mg[t[A]]?t[A]:Mg[t[A]];}return e}(this.text);}trim(){let t=0;for(let e=0;e<this.text.length&&SC[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let A=this.text.length-1;A>=0&&A>=t&&SC[this.text.charCodeAt(A)];A--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e);}substring(t,e){const A=new QC;return A.text=this.text.substring(t,e),A.sectionIndex=this.sectionIndex.slice(t,e),A.sections=this.sections,A}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}}function IC(t,e){const A=[],r=t.text;let i=0;for(const r of e)A.push(t.substring(i,r)),i=r;return i<r.length&&A.push(t.substring(i,r.length)),A}const SC={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function RC(t,e,A,r){const i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(A)*A}function LC(t,e){let A=0;return 10===t&&(A-=1e4),40!==t&&65288!==t||(A+=50),41!==e&&65289!==e||(A+=50),A}function PC(t,e,A,r,i,n){let s=null,a=RC(e,A,i,n);for(const t of r){const r=RC(e-t.x,A,i,n)+t.badness;r<=a&&(s=t,a=r);}return {index:t,x:e,priorBreak:s,badness:a}}function HC(t){return t?HC(t.priorBreak).concat(t.index):[]}function OC(t,e,A,r){if(!A)return [];if(!t)return [];const i=[],n=function(t,e,A,r){let i=0;for(let A=0;A<t.length();A++){const n=t.getSection(A),s=r[n.fontStack],a=s&&s[t.getCharCode(A)];a&&(i+=a.metrics.advance*n.scale+e);}return i/Math.max(1,Math.ceil(i/A))}(t,e,A,r);let s=0;for(let A=0;A<t.length();A++){const o=t.getSection(A),h=t.getCharCode(A),l=r[o.fontStack],c=l&&l[h];c&&!SC[h]&&(s+=c.metrics.advance*o.scale+e),A<t.length()-1&&(TC[h]||!((a=h)<11904)&&(ie["Bopomofo Extended"](a)||ie.Bopomofo(a)||ie["CJK Compatibility Forms"](a)||ie["CJK Compatibility Ideographs"](a)||ie["CJK Compatibility"](a)||ie["CJK Radicals Supplement"](a)||ie["CJK Strokes"](a)||ie["CJK Symbols and Punctuation"](a)||ie["CJK Unified Ideographs Extension A"](a)||ie["CJK Unified Ideographs"](a)||ie["Enclosed CJK Letters and Months"](a)||ie["Halfwidth and Fullwidth Forms"](a)||ie.Hiragana(a)||ie["Ideographic Description Characters"](a)||ie["Kangxi Radicals"](a)||ie["Katakana Phonetic Extensions"](a)||ie.Katakana(a)||ie["Vertical Forms"](a)||ie["Yi Radicals"](a)||ie["Yi Syllables"](a)))&&i.push(PC(A+1,s,n,i,LC(h,t.getCharCode(A+1)),!1));}var a;return HC(PC(t.length(),s,n,i,0,!0))}function DC(t){let e=.5,A=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;}switch(t){case"bottom":case"bottom-right":case"bottom-left":A=1;break;case"top":case"top-right":case"top-left":A=0;}return {horizontalAlign:e,verticalAlign:A}}function NC(t,e,A,r,i){if(!i)return;const n=t[r],s=e[n.fontStack],a=s&&s[n.glyph];if(a){const e=(t[r].x+a.metrics.advance*n.scale)*i;for(let i=A;i<=r;i++)t[i].x-=e;}}class kC{constructor(t){this.uid=(1e3*Math.random()).toFixed(0),this.options=t||{},this.maxParallelRequests=t.maxParallelRequests||6,this.status="preparing",this.requestingCount=0,this.ids=[],this.requests={};}setMaxParallelRequests(t){this.maxParallelRequests=t;}run(){this.status="running";let t=this.maxParallelRequests-this.requestingCount;t<=0&&(t=1);for(let e=0;e<t;e++)this.releaseRequest();}pauseRequest(){this.status="pausing";}restart(){this.run();}checkStatus(){0===this.ids.length&&(this.status="stopped");}_nextRequest(t){this.removeRequestById(t),this.requestingCount--,"pausing"!==this.status&&(this.checkStatus(),this.releaseRequest());}pushRequest(t){return !this.hasRequest(t.id)&&(this.ids.push(t.id),this.requests[t.id]={req:null,send:!1,param:t.param,cb:(e,A,r,i)=>{this.requests[t.id]&&(t.cb(e,A,r,i),this._nextRequest(t.id));}},!0)}pushRequests(t){for(let e=0;e<t.length;e++)this.pushRequest(t[e]);}releaseRequest(){for(let t=0;t<this.ids.length;t++)if(!this.requests[this.ids[t]].send&&!this.requests[this.ids[t]].req){this.releaseRequestById(this.ids[t]),this.requestingCount++;break}}releaseRequestById(t){const e=this.requests[t];this.requests[t].send||this.requests[t].req||(e.req=ht(e.param,e.cb),e.send=!0);}releaseRequestByIds(t){for(let e=0;e<t.length;e++)this.releaseRequestById(t[e]);}hasRequest(t){return -1!==this.ids.indexOf(t)}removeRequestById(t){if(this.hasRequest(t)){const e=this.ids.indexOf(t);this.ids.splice(e,1),this.cancelRequestById(t),delete this.requests[t];}}removeRequests(t){for(let e=0;e<t.length;e++)this.removeRequestById(t[e]);}removeAllRequest(){for(;this.ids.length>0;)this.removeRequestById(this.ids[0]);}cancelRequestById(t){const e=this.requests[t];e.send&&e.req&&e.req.cancel(),e.req=null,e.send=!1;}cancelRequests(t){for(let e=0;e<t.length;e++)this.cancelRequestById(t[e]);}cancelAllRequest(){for(let t=0;t<this.ids.length;t++)this.cancelRequestById(this.ids[t]);}destroy(){this.removeAllRequest(),this.ids=[],this.requests={};}}class VC extends kC{constructor(t){super(t);}pushRequest(t){if(!this.hasRequest(t.id)){this.ids.push(t.id);const e=(e,A,r,i)=>{this.done("terrain",{err:e,data:A,cacheControl:r,expires:i},t);};return this.requests[t.id]={req:null,send:!1,param:t.param,count:0,renderWithTerrain:t.renderWithTerrain,terrainParam:t.renderWithTerrain?t.terrainParam:null,terrainRequest:null,out:{},cb:(e,A,r,i)=>{this.done("image",{err:e,data:A,cacheControl:r,expires:i},t);},cb1:t.renderWithTerrain?e:()=>{}},!0}return !1}done(t,{err:e,data:r,cacheControl:i,expires:n},s){const a=this.requests[s.id];if(a){if(a.count++,e)throw a.out.err=e,new Error(e);"image"===t?a.out.img=r&&!this._checkBase64(r)?new A.Blob([new Uint8Array(r)],{type:"image/png"}):null:a.out.terrainData={data:r,cacheControl:i,expires:n},(1===a.count&&!a.renderWithTerrain||2===a.count&&a.renderWithTerrain)&&(s.cb(a.out.err,a.out),this._nextRequest(s.id));}}releaseRequestById(t){const e=this.requests[t];this.requests[t].send||this.requests[t].req||(e.req=ht(e.param,e.cb),e.renderWithTerrain&&(e.terrainRequest=ht(e.terrainParam,e.cb1)),e.send=!0);}cancelRequestById(t){const e=this.requests[t];e.send&&e.req&&e.req.cancel&&(e.req.cancel(),e.renderWithTerrain&&e.terrainRequest&&e.terrainRequest.cancel()),e.req=null,e.terrainRequest=null,e.send=!1;}_checkBase64(t){if(t.byteLength>200)return !1;const e=new Uint8Array(t);let A="";for(let t=0;t<e.length;t++)A+=String.fromCharCode(e[t]);return -1!==A.indexOf("data:image")||-1!==A.indexOf("base64")}}const GC=A.performance;t.Actor=gC,t.AlphaImage=gg,t.Anchor=Qg,t.BoundingSphere=ul,t.CN_Envelope=lw,t.CONSTS=$,t.CanonicalTileID=An,t.ClassificationType=xn,t.CollisionBoxArray=ns,t.Color=ee,t.ColorMode=lm,t.CompressedTextureUtil=pm,t.Coordinate=h,t.CoordsUntils=Tf,t.CrunchWorkerLoader=Ow,t.CullFaceMode=um,t.CullingVolume=Ul,t.DOM=H,t.DataConstantProperty=fn,t.DepthMode=sm,t.DictionaryCoder=EC,t.Dispatcher=mC,t.EXTENT=ji,t.Ellipsoid=nl,t.ErrorEvent=gt,t.EvaluationParameters=Xi,t.Event=yt,t.Evented=mt,t.Feature=_C,t.FeatureIndex=vC,t.Formatted=pe,t.GL=pw,t.GLYPH_PBF_BORDER=3,t.ImageAtlas=zx,t.ImageLoader=Gm,t.ImagePosition=Kx,t.LAYER_LAYOUT_CONSTS={SYMTRACKING_DISPLAY_MODE:{DEFAULT:"default",SEQUENCE:"time-sequence",TIMESTAMP:"timestamp"}},t.LngLat=Zi,t.LngLatBounds=Yi,t.MMDemTile=CC,t.Matrix2=ph,t.Matrix3=mh,t.Matrix4=Eh,t.OrientedBoundingBox=wl,t.OverscaledTileID=nn,t.Plane=El,t.ProgramConfiguration=Cs,t.ProjectionType=ua,t.Properties=wn,t.Quaternion=vh,t.RGBAImage=mg,t.RequestPerformanceManger=class{constructor(t){this.options=t||{},this.imageCacheRequests={},this.vectorCacheRequests={};}getImageRequesterById(t){return this.imageCacheRequests[t]||(this.imageCacheRequests[t]=new VC({id:t,maxParallelRequests:1})),this.imageCacheRequests[t]}getVectorRequesterById(t){return this.vectorCacheRequests[t]||(this.vectorCacheRequests[t]=new kC({id:t,maxParallelRequests:1})),this.vectorCacheRequests[t]}removeImageRequesterById(t){this.imageCacheRequests[t]&&(this.imageCacheRequests[t].destroy(),delete this.imageCacheRequests[t]);}removeVectorRequesterById(t){this.vectorCacheRequests[t]&&(this.vectorCacheRequests[t].destroy(),delete this.vectorCacheRequests[t]);}removeAll(){for(const t in this.imageCacheRequests)this.removeImageRequesterById(t);for(const t in this.vectorCacheRequests)this.removeVectorRequesterById(t);}destroy(){this.removeAll(),this.imageCacheRequests={},this.vectorCacheRequests={};}},t.ResourceType=nt,t.SegmentVector=ys,t.SharedTerrainTileCache=FC,t.SphereSymbolBucket=Og,t.SphereSymtrackingBucket=Mx,t.StencilMode=om,t.StructArrayLayout2i4=In,t.StructArrayLayout3f12=Nn,t.StructArrayLayout3ui6=es,t.StructArrayLayout4i8=Sn,t.StructArrayLayout5f20=Tn,t.TdModelStyleLayer=jw,t.Texture=Bm,t.TextureManager=xm,t.Transitionable=hn,t.UnwrappedTileID=rn,t.VERSION=uw,t.VERSION$1=kw,t.VERSION$2=cw,t.ValidationError=wt,t.Vector2=Ah,t.Vector3=nh,t.Vector4=ah,t.WebGLConstants=hm,t.WritingMode=MC,t.ZoomHistory=Ti,t.add=Co,t.addDynamicAttributes=Lg,t.allowsLetterSpacing=function(t){for(const e of t)if(!se(e.charCodeAt(0)))return !1;return !0},t.allowsVerticalWritingMode=ne,t.arrayInclude=function(t,e){return t.filter((t=>t===e)).length>0},t.assert=Km,t.asyncAll=E,t.autobind_min=wm,t.bezier=d,t.bindAll=U,t.calc3dModelTranslateMatrix=kf,t.calc3dTileTranslateMatrix=Nf,t.calc3dVectorTileTranslateMatrix=Vf,t.calcCustomLayerTranslateMatrix=function(t,e,A){return kf(!1,{location:t,translation:A},e,$.TRANSFORM.R)},t.calcLocalCoords=function(t,e,A){const r=Lf([],t,t[2]?$.TRANSFORM.REAL_R+t[2]:$.TRANSFORM.REAL_R),i=Lf([],e,e[2]?$.TRANSFORM.REAL_R+e[2]:$.TRANSFORM.REAL_R);let n=Gf();n=Kf(e,0,A);const s=new nh(r).transform(n);let a=Gf();a=Kf(e,0,A);const o=new nh(i).transform(a);return new nh(s.x-o.x,s.y-o.y,s.z-o.z).toArray()},t.calcNodeBBox=Xw,t.calcPrimitivePositionOfWorld=zw,t.calcSpaceEnvelopeOfGltf=function(t,e){const A=new lw;for(let r=0;r<t.nodes.length;r++){const i=t.nodes[r];if(!i||!i.hasOwnProperty("mesh")||!i.primitiveStack)continue;let n;n=e?(new Eh).rotateX(Math.PI/2).clone():new Eh,i.identityMatrix||n.multiplyRight(i.matrix);for(let e=0;e<i.primitiveStack.length;e++){const r=t.primitives[i.primitiveStack[e].primitiveInd],s=r.aabb[1],a=[...r.aabb[0],1],o=new ah(a).transform(n).toArray(),h=[...s,1],l=new ah(h).transform(n).toArray(),c=new nh(o[0],o[1],o[2]),u=new nh(l[0],l[1],l[2]);A.update(c),A.update(u);}}return A},t.calcTrackModelBBox=function(t,e){const A=[[t[0][0],t[0][1],t[0][2],1],[t[0][0],t[0][1],t[1][2],1],[t[1][0],t[0][1],t[1][2],1],[t[1][0],t[0][1],t[0][2],1],[t[0][0],t[1][1],t[0][2],1],[t[0][0],t[1][1],t[1][2],1],[t[1][0],t[1][1],t[1][2],1],[t[1][0],t[1][1],t[0][2],1]],r=[];for(let t=0;t<8;t++)r.push(new ah(A[t]).transform(e).toArray());const i=[];for(let t=0;t<Kw.length;t++){const e=Kw[t];i.push([r[e[0]-1],r[e[1]-1],r[e[2]-1]]);}return i},t.calcTrackModelSpaceTriangles=function(t,e){const A=[];for(let r=0;r<t.length;r++)A.push([new nh(t[r][0]).transform(e).toArray(),new nh(t[r][1]).transform(e).toArray(),new nh(t[r][2]).transform(e).toArray()]);return A},t.clamp=x,t.clamp$1=Pa,t.classifyRings=na,t.clone=I,t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.createCommonjsModule=e,t.createExpression=Sr,t.createFilter=qr,t.createFloat64ArrayFromAMatrix=function(t){return t instanceof Eh?t.clone():t.slice(0)},t.createFloat64ArrayIdentityMatrix=Gf,t.createLayout=Mn,t.createLayoutGltf=function(t,e=1){const A=[],r=t.map((t=>{const e=t.components||1;return A.push(t.name),t.instance?{name:t.name,type:t.type,components:e,instance:t.instance}:{name:t.name,type:t.type,components:e,offset:t.offset||0,byteStride:t.byteStride||4}}));return A.sort(),{members:r,size:Qn(0,Math.max(0,e)),alignment:e,key:A.join(";")}},t.createStyleLayer=function(t){return "custom"===t.type?new lx(t):new Vx[t.type](t)},t.cross=vo,t.cubeGenerator=function(t,e,A,r,i){const n=[-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,1,-1,1,-1,-1,1,1,1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1];for(let r=0;r<n.length;r+=3)i.emplaceBack(n[r]*t,n[r+1]*e,n[r+2]*A,0,0);},t.decodeGLB=it,t.deepCopy=function t(e){if(!e)return;const A=e.constructor===Array?[]:{};if("object"!=typeof e)return e;for(const r in e)A[r]="object"==typeof e[r]?t(e[r]):e[r];return A},t.defined=ga,t.degrees=Ma,t.distToSegmentSquared=Ey,t.dot=_o,t.earcut_1=Us,t.ease=f,t.easeCubicInOut=p,t.easeForSphere=y,t.easeIn=m,t.easeInOut=w,t.easeOut=B,t.emitValidationErrors=Ci,t.endsWith=F,t.evaluateSizeForFeature=function(t,e,A){const r=e;return "source"===t.functionType?A.lowerSize/10:"composite"===t.functionType?cA(A.lowerSize/10,A.upperSize/10,r.uSizeT):r.uSize},t.evaluateSizeForZoom=function(t,e,A){if("constant"===t.functionType)return {uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return {uSizeT:0,uSize:0};if("camera"===t.functionType){const{propertyValue:r,zoomRange:i,sizeRange:n}=t,s=x(Hr(r,A.specification).interpolationFactor(e,i.min,i.max),0,1);return {uSizeT:0,uSize:n.min+s*(n.max-n.min)}}{const{propertyValue:r,zoomRange:i}=t;return {uSizeT:x(Hr(r,A.specification).interpolationFactor(e,i.min,i.max),0,1),uSize:0}}},t.evented=Vi,t.exported=s,t.extend=_,t.extractMipmapImages=Uw,t.fetchFile=NB,t.filterObject=Q,t.findTrackModelMatchNodes=function(t,e){const A=e.split("::")[1],r=[];return t.forEach(((t,e)=>{A!==t.properties.fatherName&&A!==t.properties.name||r.push(t);})),r},t.getArrayBuffer=ht,t.getBinaryImageMetadata=km,t.getCameraDistanceFromZoom=function t(e,A,r){if(A>=3)return r*(Math.sin(Math.PI/Math.pow(2,A))/Math.tan(e/2)+Math.cos(Math.PI/Math.pow(2,A)));{const i=r/Math.sin(e/2),n=t(e,3,r);return A>=2&&A<3?n+(i-n)*(3-A):i*(2-A+1)}},t.getCoordinatesCenter=function(t){let e=1/0,A=1/0,r=-1/0,i=-1/0;for(let n=0;n<t.length;n++)e=Math.min(e,t[n].column),A=Math.min(A,t[n].row),r=Math.max(r,t[n].column),i=Math.max(i,t[n].row);const n=Math.max(r-e,i-A),s=Math.max(0,Math.floor(-Math.log(n)/Math.LN2));return new h((e+r)/2,(A+i)/2,0).zoomTo(s)},t.getImage=pt,t.getJSON=function(t,e){return ot(_(t="string"==typeof t?{url:t}:t,{type:"json"}),e)},t.getPerformanceMeasurement=function(t){const e=t?t.url.toString():void 0;return GC.getEntriesByName(e)},t.getProjection=fa,t.getRTLTextPluginStatus=Gi,t.getReferrer=at,t.getSpherePos=Hf,t.getTranslatedLngLatPoint=function(t,e){const A=function(t,e,A){return kf(!1,{location:t,translation:void 0},e,$.TRANSFORM.REAL_R)}(t,Gf());return Pf([],new nh(e).transform(A))},t.getVideo=function(t,e){const r=A.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r);};for(let e=0;e<t.length;e++){const i=A.document.createElement("source");lt(t[e])||(r.crossOrigin="Anonymous"),i.src=t[e],r.appendChild(i);}return {cancel:()=>{}}},t.getVideoControl=function(t,e){const{msg:A,url:r}=t,i={url:r,headers:{"Content-Type":"application/json;charset=utf-8;"},method:"post",body:JSON.stringify(A)};return ot(_(i,{type:"json"}),e)},t.getZoomFromDistance=function(t,e,A){const r=1/Math.tan(t/2),i=e/A/Math.sqrt(Math.pow(r,2)+Math.pow(1,2)),n=Math.asin(i);return Math.log2(Math.PI/(n-t/2))},t.html2canvas=Gw,t.isDDS=function(t){return new Uint32Array(t,0,Qw.HEADER_LENGTH)[Qw.MAGIC_NUMBER_INDEX]===Qw.MAGIC_NUMBER},t.isNumber=function(t){return "number"==typeof t},t.keysDifference=function(t,e){const A=[];for(const r in t)r in e||A.push(r);return A},t.lazyLoadRTLTextPlugin=function(){zi.isLoading()||zi.isLoaded()||"deferred"!==Gi()||Ki();},t.limitLnglatScope=function(t){const e=t[0],A=t[1];let r=e,i=A;return e>180?r-=360:e<-180&&(r+=360),A>90?i=90:A<-90&&(i=-90),[r,i]},t.linear=g,t.load=hw,t.loadLibrary=BB,t.makeRequest=ot,t.mapObject=M,t.mvt=uy,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=Eo,t.number=cA,t.p=function(t){const e=new Uint8Array(t.buffer,t.byteOffset,dw.length);if(e[0]!==dw[0]||e[1]!==dw[1]||e[2]!==dw[2]||e[3]!==dw[3]||e[4]!==dw[4]||e[5]!==dw[5]||e[6]!==dw[6]||e[7]!==dw[7]||e[8]!==dw[8]||e[9]!==dw[9]||e[10]!==dw[10]||e[11]!==dw[11])throw new Error("Missing KTX 2.0 identifier.");const A=new _w,r=17*Uint32Array.BYTES_PER_ELEMENT,i=new vw(t,dw.length,r,!0);A.vkFormat=i._nextUint32(),A.typeSize=i._nextUint32(),A.pixelWidth=i._nextUint32(),A.pixelHeight=i._nextUint32(),A.pixelDepth=i._nextUint32(),A.layerCount=i._nextUint32(),A.faceCount=i._nextUint32();const n=i._nextUint32();A.supercompressionScheme=i._nextUint32();const s=i._nextUint32(),a=i._nextUint32(),o=i._nextUint32(),h=i._nextUint32(),l=i._nextUint64(),c=i._nextUint64(),u=new vw(t,dw.length+r,3*n*8,!0);for(let e=0;e<n;e++)A.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const p=new vw(t,s,a,!0),d={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:{x:p._nextUint8()+1,y:p._nextUint8()+1,z:p._nextUint8()+1,w:p._nextUint8()+1},bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},f=(d.descriptorBlockSize/4-6)/4;for(let t=0;t<f;t++)d.samples[t]={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelID:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:p._nextUint32(),sampleUpper:p._nextUint32()};A.dataFormatDescriptor.length=0,A.dataFormatDescriptor.push(d);const y=new vw(t,o,h,!0);for(;y._offset<h;){const t=y._nextUint32(),e=y._scan(t),r=bw(e),i=y._scan(t-e.byteLength);A.keyValue[r]=r.match(/^ktx/i)?bw(i):i,t%4&&y._skip(4-t%4);}if(c<=0)return A;const g=new vw(t,l,c,!0),m=g._nextUint16(),B=g._nextUint16(),w=g._nextUint32(),x=g._nextUint32(),C=g._nextUint32(),E=g._nextUint32(),_=[];for(let t=0;t<n;t++)_.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});const v=l+g._offset,b=v+w,U=b+x,F=U+C,M=new Uint8Array(t.buffer,t.byteOffset+v,w),Q=new Uint8Array(t.buffer,t.byteOffset+b,x),I=new Uint8Array(t.buffer,t.byteOffset+U,C),S=new Uint8Array(t.buffer,t.byteOffset+F,E);return A.globalData={endpointCount:m,selectorCount:B,imageDescs:_,endpointsData:M,selectorsData:Q,tablesData:I,extendedData:S},A},t.parse=ow,t.parseCSSColor=$t,t.parseCacheControl=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,A,r,i)=>{const n=r||i;return e[A]=!n||n.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t;}return e},t.parseDDS=function(t){const e=new Int32Array(t,0,Qw.HEADER_LENGTH),A=(r=e[Qw.HEADER_PF_FOURCC_INDEX],String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255));var r;const i=Qw.PIXEL_FORMATS[A],n=Qw.SIZE_FUNCTIONS[A];let s=1;e[Qw.HEADER_FLAGS_INDEX]&Qw.DDSD_MIPMAPCOUNT&&(s=Math.max(1,e[Qw.MIPMAPCOUNT_INDEX]));const a=e[Qw.HEADER_WIDTH_INDEX],o=e[Qw.HEADER_HEIGHT_INDEX];return Uw(new Uint8Array(t,e[Qw.HEADER_SIZE_INDEX]+4),{mipMapLevels:s,width:a,height:o,sizeFunction:n,internalFormat:i})},t.parseGlyphPBF=function(t){return new jx(t).readFields(dC,[])},t.pbf=jx,t.pick=function(t,e){const A={};for(let r=0;r<e.length;r++){const i=e[r];i in t&&(A[i]=t[i]);}return A},t.plugin=zi,t.pointGeometry3d=l,t.polygonIntersectsPolygon=function(t,e){for(let A=0;A<t.length;A++)if(vy(e,t[A]))return !0;for(let A=0;A<e.length;A++)if(vy(t,e[A]))return !0;return !!wy(t,e)},t.potpack=Gx,t.processBase64BuffersToLoadersBuffers=function(t){return t.map((t=>{const e=new Uint8Array((A=t.uri,window.atob(A.substring(A.indexOf(",")+1)).split("").map((t=>t.charCodeAt(0)))));var A;return {byteLength:e.byteLength,arrayBuffer:e.buffer,name:t.name||"name-undefined",byteOffset:0}}))},t.processModelingDataBuffersToLoadersBuffers=function(t){return t.map(((t,e)=>({byteLength:t.byteLength,arrayBuffer:t.data[0].buffer,name:t.name,byteOffset:0})))},t.processModelingImageToLoadersImages=function(t,e,A){const r=[];for(let A=0;A<t.length;A++){const i=Nw(t[A].uri,e);r.push(hw(i,Gm,{},0,null));}Promise.all(r).then((t=>{A(t);}));},t.properties=kg,t.properties$1=Ix,t.readArrayToTriangleFloatArray=qw,t.readArrayToTriangleFloatArrayCesium=function(t){try{const A=t.bufferDataConfig,r=t.verticesBufView,i=A.IB,n=A.VB,s=i.value;let a,o;if((e=r)instanceof Float32Array||e instanceof Int8Array||e instanceof Int16Array)a=r,o=5121===n.type?n.byteStride:5123===n.type?n.byteStride/2:n.byteStride/4;else {const t=r.buffer;5121===n.type?(a=new Int8Array(t.arrayBuffer,n.byteOffset+t.byteOffset+(r.byteOffset||0)),o=n.byteStride):5123===n.type?(a=new Int16Array(t.arrayBuffer,n.byteOffset+t.byteOffset+(r.byteOffset||0)),o=n.byteStride/2):(a=new Float32Array(t.arrayBuffer,n.byteOffset+t.byteOffset+(r.byteOffset||0)),o=n.byteStride/4);}const h=[];for(let t=0;t<i.count;t+=3){const e=s[t]*o,A=s[t+1]*o,r=s[t+2]*o;h.push([[a[e],a[e+1],a[e+2]],[a[A],a[A+1],a[A+2]],[a[r],a[r+1],a[r+2]]]);}return h}catch(t){return [[[0,0,0],[0,0,0],[0,0,0]]]}var e;},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Fi,t.registerForPluginStateChange=function(t){return t({pluginStatus:Oi,pluginURL:Di}),Vi.on("pluginStateChange",t),t},t.renderColorRamp=wg,t.resolveUrl=Nw,t.rgba2Hex=function(t){const e=t.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),A=parseFloat(e[3]||1),r=Math.floor(A*parseInt(e[0])+255*(1-A)),i=Math.floor(A*parseInt(e[1])+255*(1-A)),n=Math.floor(A*parseInt(e[2])+255*(1-A));return `#${`0${r.toString(16)}`.slice(-2)}${`0${i.toString(16)}`.slice(-2)}${`0${n.toString(16)}`.slice(-2)}`},t.scale=function(t,e,A){return t[0]=e[0]*A,t[1]=e[1]*A,t[2]=e[2]*A,t},t.setRTLTextPlugin=function(t,e,A=!1){if(Oi===Ri||Oi===Li||Oi===Pi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Di=s.resolveURL(t),Oi=Ri,Hi=e,ki(),A||Ki();},t.shapeIcon=function(t,e,A){const{horizontalAlign:r,verticalAlign:i}=DC(A),n=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*i;return {image:t,top:s,bottom:s+t.displaySize[1],left:n,right:n+t.displaySize[0]}},t.shapeText=function(t,e,A,r,i,n,s,a,o,h,l,c){const u=QC.fromFeature(t,A);l===MC.vertical&&u.verticalizePunctuation();const p=[],d={positionedGlyphs:p,text:u,top:o[1],bottom:o[1],left:o[0],right:o[0],writingMode:l};let f;if(c&&c.properties&&c.properties.hasOwnProperty("_wrap")){const t=c.properties._wrap.split(",");t.length>0&&""!==t[0]?(t.forEach(((t,e,A)=>{A[e]=parseInt(t);})),f=IC(u,t)):f=IC(u,[]);}else {const{processBidirectionalText:t,processStyledBidirectionalText:A}=zi;if(t&&1===u.sections.length){f=[];const A=t(u.toString(),OC(u,a,r,e));for(const t of A){const e=new QC;e.text=t,e.sections=u.sections;for(let A=0;A<t.length;A++)e.sectionIndex.push(0);f.push(e);}}else if(A){f=[];const t=A(u.text,u.sectionIndex,OC(u,a,r,e));for(const e of t){const t=new QC;t.text=e[0],t.sectionIndex=e[1],t.sections=u.sections,f.push(t);}}else f=IC(u,OC(u,a,r,e));}return function(t,e,A,r,i,n,s,a,o,h){let l=0,c=-17,u=0;const p=t.positionedGlyphs,d="right"===n?1:"left"===n?0:.5;for(const t of A){t.trim();const A=t.getMaxScale();if(!t.length()){c+=r;continue}const i=p.length;for(let r=0;r<t.length();r++){const i=t.getSection(r),n=t.getCharCode(r),h=24*(A-i.scale),u=e[i.fontStack],d=u&&u[n];d&&(ae(n)&&s!==MC.horizontal?(p.push({glyph:n,x:l,y:h,vertical:!0,scale:i.scale,fontStack:i.fontStack}),l+=o*i.scale+a):(p.push({glyph:n,x:l,y:c+h,vertical:!1,scale:i.scale,fontStack:i.fontStack}),l+=d.metrics.advance*i.scale+a));}p.length!==i&&(u=Math.max(l-a,u),NC(p,e,i,p.length-1,d)),l=0,c+=r*A;}const{horizontalAlign:f,verticalAlign:y}=DC(i);!function(t,e,A,r,i,n,s){const a=(e-A)*i,o=(-r*s+.5)*n;for(let e=0;e<t.length;e++)t[e].x+=a,t[e].y+=o;}(p,d,f,y,u,r,A.length);const g=c- -17;t.top+=-y*g,t.bottom=t.top+g,t.left+=-f*u,t.right=t.left+u;}(d,e,f,i,n,s,l,a,h),!!p.length&&(d.text=d.text.toString(),d)},t.sliceArrayBuffer=function(t,e,A){const r=void 0!==A?new Uint8Array(t).subarray(e,e+A):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer},t.spec=Bt,t.sphereGenerator=function(t,e,A,r,i){const n=fa(r),s=Math.pow(2,e);let a=s;r===ua.LATLON&&(a=s/2);for(let r=0;r<a;r++)for(let o=0;o<=s;o++)Rf(0,n,s,a,o,r,A,e,t,i),Rf(0,n,s,a,o,r+1,A,e,t,i);return {arr:[]}},t.sphereGltfAttributes=Vw,t.sphereRasterBoundsAttributes=BC,t.sphericalToCartesian=function([t,e,A]){return e+=90,e*=Math.PI/180,A*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(A),y:t*Math.sin(e)*Math.sin(A),z:t*Math.cos(A)}},t.squaredDistance=function(t,e){var A=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return A*A+r*r+i*i},t.sub=function(t,e,A){return t[0]=e[0]-A[0],t[1]=e[1]-A[1],t[2]=e[2]-A[2],t},t.toRadians=ba,t.transformECEFToGeographic=Lf,t.transformGeographicToECEF=Pf,t.transformGeographicToECEFforYup=function(t,e){const A=e[0],r=e[2],i=e[1],n=Math.sqrt(A*A+r*r+i*i);return t[0]=Math.atan2(r,A)*$.TRANSFORM.RAD_TO_DEG,t[1]=Math.asin(i/n)*$.TRANSFORM.RAD_TO_DEG,t[2]=(n-$.TRANSFORM.R)*$.TRANSFORM.R_ZOOM,t},t.transformMat4=Ro,t.triggerPluginCompletionEvent=Ni,t.unicodeBlockLookup=ie,t.uniqueId=b,t.validateLight=Bi,t.validateStyle=mi,t.values=function(t){const e=[];for(const A in t)e.push(t[A]);return e},t.warnOnce=T,t.window=A,t.wrap=C,t.xyToLngLat=function(t,e,A,r,i,n,s){const a=Math.pow(2,n),o=r+t/8192,h=i+e/8192,l=fa(s);return [l.xLng(o,a),l.yLat(h,a)]};}));

define(["./shared"],(function(t){"use strict";function e(t){const i=typeof t;if("number"===i||"boolean"===i||"string"===i||null==t)return JSON.stringify(t);if(Array.isArray(t)){let i="[";for(const n of t)i+=`${e(n)},`;return `${i}]`}const n=Object.keys(t).sort();let o="{";for(let i=0;i<n.length;i++)o+=`${JSON.stringify(n[i])}:${e(t[n[i]])},`;return `${o}}`}function i(i){let n="";for(const o of t.refProperties)n+=`/${e(i[o])}`;return n}class n{constructor(t){t&&this.replace(t);}replace(t){this._layerConfigs={},this._layers={},this.update(t,[]);}update(e,n){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.createStyleLayer(i);e._featureFilter=t.createFilter(e.filter);}for(const t of n)delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const o=function(t){const e={};for(let n=0;n<t.length;n++){const o=i(t[n]);let r=e[o];r||(r=e[o]=[]),r.push(t[n]);}const n=[];for(const t in e)n.push(e[t]);return n}(t.values(this._layerConfigs));for(const t of o){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let o=this.familiesBySource[n];o||(o=this.familiesBySource[n]={});const r=i.sourceLayer||"_geojsonTileLayer";let s=o[r];s||(s=o[r]=[]),s.push(e);}}}function o(t,e,i,n,o){if(void 0===e.segment)return !0;let r=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return !1;a-=t[s].dist(r),r=t[s];}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return !1;let r=t[s-1].angleTo(e)-e.angleTo(i);for(r=Math.abs((r+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:r}),c+=r;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>o)return !1;s++,a+=e.dist(i);}return !0}function r(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function s(t,e,i){return t?.6*e*i:0}function a(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function l(e,i,n,l,c,h){const u=s(n,c,h),f=a(n,l);let p=0;const d=r(e)/2;for(let n=0;n<e.length-1;n++){const r=e[n],s=e[n+1],a=r.dist(s);if(p+a>d){const l=(d-p)/a,c=t.number(r.x,s.x,l),h=t.number(r.y,s.y,l),g=new t.Anchor(c,h,s.angleTo(r),n);if(g._round(),u&&!o(e,g,f,u,i))return;return g}p+=a;}}function c(t,e,i,n,o,r,l,c,u){const f=s(n,r,l),p=a(n,o),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-p*l<e/4&&(e=p*l+e/4),h(t,d?e/2*c%e:(p/2+2*r)*l*c%e,e,f,i,p*l,d,!1,u)}function h(e,i,n,s,a,l,c,u,f){const p=l/2,d=r(e);let g=0,m=i-n,y=[];for(let i=0;i<e.length-1;i++){const r=e[i],c=e[i+1],h=r.dist(c),u=c.angleTo(r);for(;m+n<g+h;){m+=n;const x=(m-g)/h,v=t.number(r.x,c.x,x),w=t.number(r.y,c.y,x);if(v>=0&&v<f&&w>=0&&w<f&&m-p>=0&&m+p<=d){const n=new t.Anchor(v,w,u,i);n._round(),s&&!o(e,n,l,s,a)||y.push(n);}}g+=h;}return u||y.length||c||(y=h(e,g/2,n,s,a,l,c,!0,f)),y}class u{constructor(){this.opacity=0,this.targetOpacity=0,this.time=0;}clone(){const t=new u;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t}}t.register("OpacityState",u);class f{constructor(e,i,n,o,r,s,a,l,c,h,u,f){let p=a.top*l-c,d=a.bottom*l+c,g=a.left*l-c,m=a.right*l+c;if(this.boxStartIndex=e.length,h){let t=d-p;const a=m-g;t>0&&(t=Math.max(10*l,t),this._addLineCollisionCircles(e,i,n,n.segment,a,t,o,r,s,u));}else {if(f){const e=new t.pointGeometry3d(g,p),i=new t.pointGeometry3d(m,p),n=new t.pointGeometry3d(g,d),o=new t.pointGeometry3d(m,d),r=f*Math.PI/180;e._rotate(r),i._rotate(r),n._rotate(r),o._rotate(r),g=Math.min(e.x,i.x,n.x,o.x),m=Math.max(e.x,i.x,n.x,o.x),p=Math.min(e.y,i.y,n.y,o.y),d=Math.max(e.y,i.y,n.y,o.y);}e.emplaceBack(n.x,n.y,g,p,m,d,o,r,s,0,0);}this.boxEndIndex=e.length;}_addLineCollisionCircles(t,e,i,n,o,r,s,a,l,c){const h=r/2,u=Math.floor(o/h)||1,f=1+.4*Math.log(c)/Math.LN2,p=Math.floor(u*f/2),d=-r/2;let g=i,m=n+1,y=d;const x=-o/2,v=x-o/4;do{if(m--,m<0){if(y>x)return;m=0;break}y-=e[m].dist(g),g=e[m];}while(y>v);let w=e[m].dist(e[m+1]);for(let i=-p;i<u+p;i++){const n=i*h;let c=x+n;if(n<0&&(c+=n),n>o&&(c+=n-o),c<y)continue;for(;y+w<c;){if(y+=w,m++,m+1>=e.length)return;w=e[m].dist(e[m+1]);}const u=c-y,f=e[m],p=e[m+1].sub(f)._unit()._mult(u)._add(f)._round(),g=Math.abs(c-d)<h?0:.8*(c-d);t.emplaceBack(p.x,p.y,-r/2,-r/2,r/2,r/2,s,a,l,r/2,g);}}}class p{constructor(t=[],e=d){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t);}push(t){this.data.push(t),this.length++,this._up(this.length-1);}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const o=t-1>>1,r=e[o];if(i(n,r)>=0)break;e[t]=r,t=o;}e[t]=n;}_down(t){const{data:e,compare:i}=this,n=this.length>>1,o=e[t];for(;t<n;){let n=1+(t<<1),r=e[n];const s=n+1;if(s<this.length&&i(e[s],r)<0&&(n=s,r=e[s]),i(r,o)>=0)break;e[t]=r,t=n;}e[t]=o;}}function d(t,e){return t<e?-1:t>e?1:0}function g(e,i=1,n=!1){let o=1/0,r=1/0,s=-1/0,a=-1/0;const l=e[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<o)&&(o=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y);}const c=Math.min(s-o,a-r);let h=c/2;const u=new p([],m);if(0===c)return new t.pointGeometry3d(o,r);for(let t=o;t<s;t+=c)for(let i=r;i<a;i+=c)u.push(new y(t+h,i+h,h,e));let f=function(t){let e=0,i=0,n=0;const o=t[0];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s],l=r.x*a.y-a.x*r.y;i+=(r.x+a.x)*l,n+=(r.y+a.y)*l,e+=3*l;}return new y(i/e,n/e,0,t)}(e),d=u.length;for(;u.length;){const t=u.pop();(t.d>f.d||!f.d)&&(f=t,n&&console.warn("found best %d after %d probes",Math.round(1e4*t.d)/1e4,d)),t.max-f.d<=i||(h=t.h/2,u.push(new y(t.p.x-h,t.p.y-h,h,e)),u.push(new y(t.p.x+h,t.p.y-h,h,e)),u.push(new y(t.p.x-h,t.p.y+h,h,e)),u.push(new y(t.p.x+h,t.p.y+h,h,e)),d+=4);}return n&&(console.warn(`num probes: ${d}`),console.warn(`best distance: ${f.d}`)),f.p}function m(t,e){return e.max-t.max}function y(e,i,n,o){this.p=new t.pointGeometry3d(e,i),this.h=n,this.d=function(e,i){let n=!1,o=1/0;for(let r=0;r<i.length;r++){const s=i[r];for(let i=0,r=s.length,a=r-1;i<r;a=i++){const r=s[i],l=s[a];r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(n=!n),o=Math.min(o,t.distToSegmentSquared(e,r,l));}}return (n?1:-1)*Math.sqrt(o)}(this.p,o),this.max=this.d+this.h*Math.SQRT2;}function x(e,i,n,o,r,s,a){e.createArrays(),e.symbolInstances=[],e.tilePixelRatio=t.EXTENT/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.functionType){const{min:i,max:n}=e.textSizeData.zoomRange;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new t.EvaluationParameters(i),a),c["text-size"].possiblyEvaluate(new t.EvaluationParameters(n),a)];}if("composite"===e.iconSizeData.functionType){const{min:i,max:n}=e.iconSizeData.zoomRange;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(i),a),c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(n),a)];}h.layoutTextSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.layoutIconSize=c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.textMaxSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(18));const u=24,f=l.get("text-line-height")*u,p="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright"),g=l.get("text-size");for(const s of e.features){const c=l.get("text-font").evaluate(s,{},a).join(",");g.evaluate(s,{},a),h.layoutTextSize.evaluate(s,{},a),h.layoutIconSize.evaluate(s,{},a);const m=n,y={},x=s.text;let w,b=[0,0];if(x){const e=x instanceof t.Formatted?x.toString():x;b=l.get("text-offset").evaluate(s,{},a).map((t=>t*u));const n=l.get("text-letter-spacing").evaluate(s,{},a)*u,o=t.allowsLetterSpacing(e)?n:0,r=l.get("text-anchor").evaluate(s,{},a),h=l.get("text-justify").evaluate(s,{},a);l.get("symbol-placement");const g="point"===l.get("symbol-placement")?l.get("text-max-width").evaluate(s,{},a)*u:0;y.horizontal=t.shapeText(x,i,c,g,f,r,h,o,b,u,t.WritingMode.horizontal,s),t.allowsVerticalWritingMode(e)&&p&&d&&(y.vertical=t.shapeText(x,i,c,g,f,r,h,o,b,u,t.WritingMode.vertical,s));}let M=!1;if(s.icon){const i=o[s.icon];i&&(w=t.shapeIcon(r[s.icon],l.get("icon-offset").evaluate(s,{},a),l.get("icon-anchor").evaluate(s,{},a)),M=i.sdf,void 0===e.sdfIcons?e.sdfIcons=i.sdf:e.sdfIcons!==i.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(i.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0));}(y.horizontal||w)&&v(e,s,y,w,m,h,0,a);}s&&e.generateCollisionDebugBuffers();}function v(e,i,n,o,r,s,a,h){const p=s.layoutTextSize.evaluate(i,{},h),d=s.layoutIconSize.evaluate(i,{},h);let m=s.textMaxSize.evaluate(i,{},h);void 0===m&&(m=p);const y=e.layers[0].layout,x=y.get("text-offset").evaluate(i,{},h),v=y.get("icon-offset").evaluate(i,{},h),M=e.tilePixelRatio*(p/24),S=e.tilePixelRatio*m/24,_=e.tilePixelRatio*d,I=e.tilePixelRatio*y.get("symbol-spacing"),T=y.get("text-padding")*e.tilePixelRatio,P=y.get("icon-padding")*e.tilePixelRatio,z=y.get("text-max-angle")/180*Math.PI,k="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement"),L="map"===y.get("icon-rotation-alignment")&&"point"!==y.get("symbol-placement"),D=y.get("symbol-placement"),O=I/2,E=(a,l)=>{l.x<0||l.x>=t.EXTENT||l.y<0||l.y>=t.EXTENT||e.symbolInstances.push(function(e,i,n,o,r,s,a,l,c,h,p,d,g,m,y,x,v,b,M,S,_,I,T,P){const z=e.addToLineVertexArray(i,n);let k,L,D=0,O=0,E=0;const C=o.horizontal?o.horizontal.text:"",j=[];if(o.horizontal){const r=s.layout.get("text-rotate").evaluate(M,{},T);k=new f(a,n,i,l,c,h,o.horizontal,p,d,g,e.overscaling,r),O+=w(e,i,o.horizontal,s,g,M,m,z,o.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,j,S,_,T),o.vertical&&(E+=w(e,i,o.vertical,s,g,M,m,z,t.WritingMode.vertical,j,S,_,T));}const R=k?k.boxStartIndex:e.collisionBoxArray.length,A=k?k.boxEndIndex:e.collisionBoxArray.length;if(r){const u=function(e,i,n,o,r,s){const a=i.image,l=n.layout,c=i.top-1/a.pixelRatio,h=i.left-1/a.pixelRatio,u=i.bottom+1/a.pixelRatio,f=i.right+1/a.pixelRatio;let p,d,g,m,y;if("none"!==l.get("icon-text-fit")&&r){const e=f-h,i=u-c,n=l.get("text-size").evaluate(s,{})/24,o=r.left*n,a=r.top*n,y=r.right*n-o,x=r.bottom*n-a,v=l.get("icon-text-fit-padding")[0],w=l.get("icon-text-fit-padding")[1],b=l.get("icon-text-fit-padding")[2],M=l.get("icon-text-fit-padding")[3],S="width"===l.get("icon-text-fit")?.5*(x-i):0,_="height"===l.get("icon-text-fit")?.5*(y-e):0,I="width"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?y:e,T="height"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?x:i;p=new t.pointGeometry3d(o+_-M,a+S-v),d=new t.pointGeometry3d(o+_+w+I,a+S-v),g=new t.pointGeometry3d(o+_+w+I,a+S+b+T),m=new t.pointGeometry3d(o+_-M,a+S+b+T);}else p=new t.pointGeometry3d(h,c),d=new t.pointGeometry3d(f,c),g=new t.pointGeometry3d(f,u),m=new t.pointGeometry3d(h,u);if(y="symtracking"!==n.type||n.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.SEQUENCE&&n.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.TIMESTAMP?"symtracking"!==n.type||n.layout.get("compatible-mode")?"symtracking"===n.type?function(t,e){const i=t.geometry[0];return i.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf("箭头"))||1===i.length?0:i[1].angleTo(i[0])+0}(s):n.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180:s.properties.car_rotate*Math.PI/180:n.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180,y){const t=Math.sin(y),e=Math.cos(y),i=[e,-t,t,e];p._matMult(i),d._matMult(i),m._matMult(i),g._matMult(i);}return [{tl:p,tr:d,bl:m,br:g,tex:a.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,r,s,0,o.horizontal,M),p=s.layout.get("icon-rotate").evaluate(M,{},T);L=new f(a,n,i,l,c,h,r,y,x,!1,e.overscaling,p),D=4*u.length;const d=e.iconSizeData;let g=null;"source"===d.functionType?g=[10*s.layout.get("icon-size").evaluate(M,{},T)]:"composite"===d.functionType&&(g=[10*_.compositeIconSizes[0].evaluate(M,{},T),10*_.compositeIconSizes[1].evaluate(M,{},T)]),e.addSymbols(e.icon,u,g,b,v,M,!1,i,z.lineStartIndex,z.lineLength,T);}const G=L?L.boxStartIndex:e.collisionBoxArray.length,B=L?L.boxEndIndex:e.collisionBoxArray.length;return e.glyphOffsetArray.length>=t.SphereSymbolBucket.MAX_GLYPHS&&t.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/minemap/minemap-gl-js/issues/2907"),{key:C,textBoxStartIndex:R,textBoxEndIndex:A,iconBoxStartIndex:G,iconBoxEndIndex:B,textOffset:m,iconOffset:b,anchor:i,line:n,featureIndex:l,feature:M,numGlyphVertices:O,numVerticalGlyphVertices:E,numIconVertices:D,textOpacityState:new u,iconOpacityState:new u,isDuplicate:!1,placedTextSymbolIndices:j,crossTileID:0}}(e,l,a,n,o,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,M,T,k,x,_,P,L,v,i,r,s,0,h));};if("line"===D)for(const r of function(e,i,n,o,r){const s=[];for(let i=0;i<e.length;i++){const n=e[i];let a;for(let e=0;e<n.length-1;e++){let i=n[e],l=n[e+1];i.x<0&&l.x<0||(i.x<0?i=new t.pointGeometry3d(0,i.y+(0-i.x)/(l.x-i.x)*(l.y-i.y))._round():l.x<0&&(l=new t.pointGeometry3d(0,i.y+(0-i.x)/(l.x-i.x)*(l.y-i.y))._round()),i.y<0&&l.y<0||(i.y<0?i=new t.pointGeometry3d(i.x+(0-i.y)/(l.y-i.y)*(l.x-i.x),0)._round():l.y<0&&(l=new t.pointGeometry3d(i.x+(0-i.y)/(l.y-i.y)*(l.x-i.x),0)._round()),i.x>=o&&l.x>=o||(i.x>=o?i=new t.pointGeometry3d(o,i.y+(o-i.x)/(l.x-i.x)*(l.y-i.y))._round():l.x>=o&&(l=new t.pointGeometry3d(o,i.y+(o-i.x)/(l.x-i.x)*(l.y-i.y))._round()),i.y>=r&&l.y>=r||(i.y>=r?i=new t.pointGeometry3d(i.x+(r-i.y)/(l.y-i.y)*(l.x-i.x),r)._round():l.y>=r&&(l=new t.pointGeometry3d(i.x+(r-i.y)/(l.y-i.y)*(l.x-i.x),r)._round()),a&&i.equals(a[a.length-1])||(a=[i],s.push(a)),a.push(l)))));}}return s}(i.geometry,0,0,t.EXTENT,t.EXTENT)){const i=c(r,I,z,n.vertical||n.horizontal,o,24,S,e.overscaling,t.EXTENT);for(const t of i){const i=n.horizontal;i&&b(e,i.text,O,t)||E(r,t);}}else if("line-center"===D){for(const t of i.geometry)if(t.length>1){const e=l(t,z,n.vertical||n.horizontal,o,24,S);e&&E(t,e);}}else if("Polygon"===i.type)for(const e of t.classifyRings(i.geometry,0)){const i=g(e,16);E(e[0],new t.Anchor(i.x,i.y,0));}else if("LineString"===i.type)for(const e of i.geometry)E(e,new t.Anchor(e[0].x,e[0].y,0));else if("Point"===i.type)for(const e of i.geometry)for(const i of e)E([i],new t.Anchor(i.x,i.y,0));}function w(e,i,n,o,r,s,a,l,c,h,u,f,p){const d=function(e,i,n,o,r,s){const a=n.layout.get("text-rotate").evaluate(r,{})*Math.PI/180,l=n.layout.get("text-offset").evaluate(r,{}).map((t=>24*t)),c=i.positionedGlyphs,h=[];for(let e=0;e<c.length;e++){const n=c[e],r=s[n.fontStack],u=r&&r[n.glyph];if(!u)continue;const f=u.rect;if(!f)continue;const p=t.GLYPH_PBF_BORDER+1,d=u.metrics.advance*n.scale/2,g=o?[n.x+d,n.y]:[0,0],m=o?[0,0]:[n.x+d+l[0],n.y+l[1]],y=(u.metrics.left-p)*n.scale-d+m[0],x=(-u.metrics.top-p)*n.scale+m[1],v=y+f.w*n.scale,w=x+f.h*n.scale,b=new t.pointGeometry3d(y,x),M=new t.pointGeometry3d(v,x),S=new t.pointGeometry3d(y,w),_=new t.pointGeometry3d(v,w);if(o&&n.vertical){const e=new t.pointGeometry3d(-d,d),i=-Math.PI/2,n=new t.pointGeometry3d(5,0);b._rotateAround(i,e)._add(n),M._rotateAround(i,e)._add(n),S._rotateAround(i,e)._add(n),_._rotateAround(i,e)._add(n);}if(a){const t=Math.sin(a),e=Math.cos(a),i=[e,-t,t,e];b._matMult(i),M._matMult(i),S._matMult(i),_._matMult(i);}h.push({tl:b,tr:M,bl:S,br:_,tex:f,writingMode:i.writingMode,glyphOffset:g});}return h}(0,n,o,r,s,u),g=e.textSizeData;let m=null;return "source"===g.functionType?m=[10*o.layout.get("text-size").evaluate(s,{},p)]:"composite"===g.functionType&&(m=[10*f.compositeTextSizes[0].evaluate(s,{},p),10*f.compositeTextSizes[1].evaluate(s,{},p)]),e.addSymbols(e.text,d,m,a,r,s,c,i,l.lineStartIndex,l.lineLength,p),h.push(e.text.placedSymbolArray.length-1),4*d.length}function b(t,e,i,n){const o=t.compareText;if(e in o){const t=o[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return !0}else o[e]=[];return o[e].push(n),!1}function M(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;}function S(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i;}function _(t,e,i,n,o,r,s){this.id=t,this.x=e,this.y=i,this.w=n,this.h=o,this.maxw=r||n,this.maxh=s||o,this.refcount=0;}M.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,o,r=[],s=0;s<t.length;s++)if(n=t[s].h||t[s].height,(i=t[s].w||t[s].width)&&n){if(!(o=this.packOne(i,n,t[s].id)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),r.push(o);}return this.shrink(),r},M.prototype.packOne=function(t,e,i){var n,o,r,s,a,l,c,h,u={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof i||"number"==typeof i){if(n=this.getBin(i))return this.ref(n),n;"number"==typeof i&&(this.maxId=Math.max(i,this.maxId));}else i=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(n=this.freebins[s]).maxh&&t===n.maxw)return this.allocFreebin(s,t,e,i);e>n.maxh||t>n.maxw||e<=n.maxh&&t<=n.maxw&&(r=n.maxw*n.maxh-t*e)<u.waste&&(u.waste=r,u.freebin=s);}for(s=0;s<this.shelves.length;s++)if(f+=(o=this.shelves[s]).h,!(t>o.free)){if(e===o.h)return this.allocShelf(s,t,e,i);e>o.h||e<o.h&&(r=(o.h-e)*t)<u.waste&&(u.freebin=-1,u.waste=r,u.shelf=s);}return -1!==u.freebin?this.allocFreebin(u.freebin,t,e,i):-1!==u.shelf?this.allocShelf(u.shelf,t,e,i):e<=this.h-f&&t<=this.w?(o=new S(f,this.w,e),this.allocShelf(this.shelves.push(o)-1,t,e,i)):this.autoResize?(a=l=this.h,((c=h=this.w)<=a||t>c)&&(h=2*Math.max(t,c)),(a<c||e>a)&&(l=2*Math.max(e,a)),this.resize(h,l),this.packOne(t,e,i)):null},M.prototype.allocFreebin=function(t,e,i,n){var o=this.freebins.splice(t,1)[0];return o.id=n,o.w=e,o.h=i,o.refcount=0,this.bins[n]=o,this.ref(o),o},M.prototype.allocShelf=function(t,e,i,n){var o=this.shelves[t].alloc(e,i,n);return this.bins[n]=o,this.ref(o),o},M.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,i=0;i<this.shelves.length;i++){var n=this.shelves[i];e+=n.h,t=Math.max(n.w-n.free,t);}this.resize(t,e);}},M.prototype.getBin=function(t){return this.bins[t]},M.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e]);}return t.refcount},M.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},M.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;},M.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return !0},S.prototype.alloc=function(t,e,i){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,new _(i,n,this.y,t,e,t,this.h)},S.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};class I{constructor(e){const i=new t.AlphaImage({width:0,height:0}),n={},o=new M(0,0,{autoResize:!0});for(const r in e){const s=e[r],a=n[r]={};for(const e in s){const n=s[+e];if(n&&0!==n.bitmap.width&&0!==n.bitmap.height){const r=o.packOne(n.bitmap.width+2,n.bitmap.height+2);i.resize({width:o.w,height:o.h}),t.AlphaImage.copy(n.bitmap,i,{x:0,y:0},{x:r.x+1,y:r.y+1},n.bitmap),a[e]={rect:r,metrics:n.metrics};}}}o.shrink(),i.resize({width:o.w,height:o.h}),this.image=i,this.positions=n;}}t.register("GlyphAtlas",I);class T{constructor(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.projection=e.projection||t.ProjectionType.MERCATOR,this.promoteId=e.promoteId;}parse(e,i,n,o,r,s,a){this.status="parsing",this.data=e,this.demHeight=s||0,this.minMax3dtileBoundHeight=a||{minHeight:0,maxHeight:0},this.collisionBoxArray=new t.CollisionBoxArray;const l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId,this.projection);c.bucketLayerIDs=[];const h={},u={featureIndex:c,iconDependencies:{},glyphDependencies:{},x:this.tileID.canonical.x,y:this.tileID.canonical.y,z:this.tileID.canonical.z,availableImages:n},f=i.familiesBySource[this.source];for(const i in f){const o=e.layers[i];if(!o)continue;1===o.version&&t.warnOnce(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const r=l.encode(i),s=[];for(let t=0;t<o.length;t++){const e=o.feature(t),n=c.getId(e,i);e.id=n,s.push({feature:e,index:t,sourceLayerIndex:r});}for(const t of f[i]){const e=t[0];e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(P(t,this.zoom,n),(h[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:r,sourceID:this.source,projection:this.projection})).populate(s,u,this.tileID.canonical,this.demHeight,this.minMax3dtileBoundHeight),c.bucketLayerIDs.push(t.map((t=>t.id))));}}let p,d,g;const m=t.mapObject(u.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(m).length?o.send("getGlyphs",{uid:this.uid,stacks:m},((t,e)=>{p||(p=t,d=e,v.call(this));})):d={};const y=Object.keys(u.iconDependencies);function v(){if(p)return r(p);if(d&&g){const e=new I(d),i=new t.ImageAtlas(g);for(const o in h){const r=h[o];(r instanceof t.SphereSymtrackingBucket||r instanceof t.SphereSymbolBucket)&&(P(r.layers,this.zoom,n),x(r,d,e.positions,g,i.iconPositions,this.showCollisionBoxes,this.tileID.canonical));}this.status="done",r(null,{buckets:t.values(h).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:i});}}y.length?o.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{p||(p=t,g=e,v.call(this));})):g={},v.call(this);}}function P(e,i,n){const o=new t.EvaluationParameters(i);for(const t of e)t.recalculate(o,n);}class z{constructor(t,e,i,n){this.actor=t,this.layerIndex=e,this.loadVectorData=this.loadVectorTile,this.loading={},this.loaded={},this.availableImages=i,this.projection=n;}registRequestController(t){this.vrc=t;}loadVectorTile(e,i){return this.vrc.pushRequest({id:e.uid,param:e.request,cb:(n,o,r,s)=>{if(n)i(n);else if(o){const n=new t.mvt.VectorTile(new t.pbf(o),null,e&&e.projection);i(null,{vectorTile:n,rawData:o,cacheControl:r,expires:s});}}})}setDataLoaderFunction(t){t&&(this.loadVectorData=t);}loadTile(e,i){const n=e.uid,o=e&&e.request,r=o&&o.collectResourceTiming;this.loading||(this.loading={});const s=this.loading[n]=new T(e);s.hasRequest=this.loadVectorData(e,((a,l)=>{if(delete this.loading[n],a||!l)return i(a);const c=l.rawData,h={};l.expires&&(h.expires=l.expires),l.cacheControl&&(h.cacheControl=l.cacheControl);const u={};if(r){const e=t.getPerformanceMeasurement(o);e.length>0&&(u.resourceTiming=JSON.parse(JSON.stringify(e)));}s.vectorTile=l.vectorTile,s.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return i(e);i(null,t.extend({rawTileData:c.slice(0)},n,h,u));}),e.demHeight,e.minMax3dtileBoundHeight),this.loaded=this.loaded||{},this.loaded[n]=s;}),this.projection),this.vrc&&this.vrc.run();}reloadTile(t,e){const i=this.loaded,n=t.uid,o=this;if(i&&i[n]){const r=i[n];r.showCollisionBoxes=t.showCollisionBoxes;const s=(i,n)=>{const s=r.reloadCallback;s&&(delete r.reloadCallback,r.parse(r.vectorTile,o.layerIndex,this.availableImages,o.actor,s,t.demHeight,t.minMax3dtileBoundHeight)),e(i,n);};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,s,t.demHeight,t.minMax3dtileBoundHeight);}}abortTile(t,e){const i=this.loading,n=t.uid;i&&i[n]&&i[n].hasRequest&&(this.vrc.removeRequestById(n),delete i[n]),e();}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e();}}var k=function t(e,i){var n,o=e&&e.type;if("FeatureCollection"===o)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===o)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===o)t(e.geometry,i);else if("Polygon"===o)L(e.coordinates,i);else if("MultiPolygon"===o)for(n=0;n<e.coordinates.length;n++)L(e.coordinates[n],i);return e};function L(t,e){if(0!==t.length){D(t[0],e);for(var i=1;i<t.length;i++)D(t[i],!e);}}function D(t,e){for(var i=0,n=0,o=0,r=t.length,s=r-1;o<r;s=o++){var a=(t[o][0]-t[s][0])*(t[s][1]+t[o][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l;}i+n>=0!=!!e&&t.reverse();}const O=t.mvt.VectorTileFeature.prototype.toGeoJSON;class E{constructor(e,i){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,this.projObj=t.getProjection(i),"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10));}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.pointGeometry3d(...i)]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.pointGeometry3d(...e));e.push(n);}return e}}toGeoJSON(t,e,i){return O.call(this,t,e,i)}}class C{constructor(e,i){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e,this.projection=i;}feature(t){return new E(this._features[t],this.projection)}}var j=R;function R(t,e){this.x=t,this.y=e;}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),o=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(t){return t instanceof R?t:Array.isArray(t)?new R(t[0],t[1]):t};var A=G;function G(t,e,i,n,o){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=o,t.readFields(B,this,e);}function B(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],o=e._values[t.readVarint()];e.properties[n]=o;}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos);}function V(t){for(var e,i,n=0,o=0,r=t.length,s=r-1;o<r;s=o++)n+=((i=t[s]).x-(e=t[o]).x)*(e.y+i.y);return n}G.types=["Unknown","Point","LineString","Polygon"],G.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,o=0,r=0,s=0,a=[];t.pos<i;){if(o<=0){var l=t.readVarint();n=7&l,o=l>>3;}if(o--,1===n||2===n)r+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&a.push(e),e=[]),e.push(new j(r,s));else {if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone());}}return e&&a.push(e),a},G.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,o=0,r=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var h=t.readVarint();i=7&h,n=h>>3;}if(n--,1===i||2===i)(o+=t.readSVarint())<s&&(s=o),o>a&&(a=o),(r+=t.readSVarint())<l&&(l=r),r>c&&(c=r);else if(7!==i)throw new Error("unknown command "+i)}return [s,l,a,c]},G.prototype.toGeoJSON=function(t,e,i){var n,o,r=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=G.types[this.type];function h(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/r-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/r)*Math.PI/180))-90];}}switch(this.type){case 1:var u=[];for(n=0;n<l.length;n++)u[n]=l[n][0];h(l=u);break;case 2:for(n=0;n<l.length;n++)h(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return [t];for(var i,n,o=[],r=0;r<e;r++){var s=V(t[r]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&o.push(i),i=[t[r]]):i.push(t[r]));}return i&&o.push(i),o}(l),n=0;n<l.length;n++)for(o=0;o<l[n].length;o++)h(l[n][o]);}1===l.length?l=l[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return "id"in this&&(f.id=this.id),f};var N=F;function F(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(q,this,e),this.length=this._features.length;}function q(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null;}return e}(i));}function Y(t,e,i){if(3===t){var n=new N(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n);}}F.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new A(this._pbf,e,this.extent,this._keys,this._values)};var Z={VectorTile:function(t,e){this.layers=t.readFields(Y,{},e);},VectorTileFeature:A,VectorTileLayer:N}.VectorTileFeature,X=J;function J(t,e){this.options=e||{},this.features=t,this.length=t.length;}function W(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096;}J.prototype.feature=function(t){return new W(this.features[t],this.options.extent)},W.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],o=0;o<i.length;o++)n.push(new j(i[o][0],i[o][1]));this.geometry.push(n);}return this.geometry},W.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,o=-1/0,r=0;r<t.length;r++)for(var s=t[r],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),o=Math.max(o,l.y);}return [e,n,i,o]},W.prototype.toGeoJSON=Z.prototype.toGeoJSON;var $=U,H=X;function U(e){var i=new t.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,K,t.layers[i]);}(e,i),i.finish()}function K(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,Q,n);var o=n.keys;for(i=0;i<o.length;i++)e.writeStringField(3,o[i]);var r=n.values;for(i=0;i<r.length;i++)e.writeMessage(4,ot,r[i]);}function Q(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,tt,t),e.writeVarintField(3,i.type),e.writeMessage(4,nt,i);}function tt(t,e){var i=t.feature,n=t.keys,o=t.values,r=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=r[a];if(null!==l){void 0===c&&(n.push(a),r[a]=c=n.length-1),e.writeVarint(c);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var u=h+":"+l,f=s[u];void 0===f&&(o.push(l),s[u]=f=o.length-1),e.writeVarint(f);}}}function et(t,e){return (e<<3)+(7&t)}function it(t){return t<<1^t>>31}function nt(t,e){for(var i=t.loadGeometry(),n=t.type,o=0,r=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),e.writeVarint(et(1,c));for(var h=3===n?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==n&&e.writeVarint(et(2,h-1));var f=l[u].x-o,p=l[u].y-r;e.writeVarint(it(f)),e.writeVarint(it(p)),o+=f,r+=p;}3===n&&e.writeVarint(et(7,1));}}function ot(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t));}function rt(t,e,i,n,o,r){if(o-n<=i)return;const s=n+o>>1;st(t,e,s,n,o,r%2),rt(t,e,i,n,s-1,r+1),rt(t,e,i,s+1,o,r+1);}function st(t,e,i,n,o,r){for(;o>n;){if(o-n>600){const s=o-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);st(t,e,i,Math.max(n,Math.floor(i-a*c/s+h)),Math.min(o,Math.floor(i+(s-a)*c/s+h)),r);}const s=e[2*i+r];let a=n,l=o;for(at(t,e,n,i),e[2*o+r]>s&&at(t,e,n,o);a<l;){for(at(t,e,a,l),a++,l--;e[2*a+r]<s;)a++;for(;e[2*l+r]>s;)l--;}e[2*n+r]===s?at(t,e,n,l):(l++,at(t,e,l,o)),l<=i&&(n=l+1),i<=l&&(o=l-1);}}function at(t,e,i,n){lt(t,i,n),lt(e,2*i,2*n),lt(e,2*i+1,2*n+1);}function lt(t,e,i){const n=t[e];t[e]=t[i],t[i]=n;}function ct(t,e,i,n){const o=t-i,r=e-n;return o*o+r*r}$.fromVectorTileJs=U,$.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new X(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return U({layers:i})},$.GeoJSONWrapper=H;const ht=t=>t[0],ut=t=>t[1];class ft{constructor(t,e=ht,i=ut,n=64,o=Float64Array){this.nodeSize=n,this.points=t;const r=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new r(t.length),a=this.coords=new o(2*t.length);for(let n=0;n<t.length;n++)s[n]=n,a[2*n]=e(t[n]),a[2*n+1]=i(t[n]);rt(s,a,n,0,s.length-1,0);}range(t,e,i,n){return function(t,e,i,n,o,r,s){const a=[0,t.length-1,0],l=[];let c,h;for(;a.length;){const u=a.pop(),f=a.pop(),p=a.pop();if(f-p<=s){for(let s=p;s<=f;s++)c=e[2*s],h=e[2*s+1],c>=i&&c<=o&&h>=n&&h<=r&&l.push(t[s]);continue}const d=Math.floor((p+f)/2);c=e[2*d],h=e[2*d+1],c>=i&&c<=o&&h>=n&&h<=r&&l.push(t[d]);const g=(u+1)%2;(0===u?i<=c:n<=h)&&(a.push(p),a.push(d-1),a.push(g)),(0===u?o>=c:r>=h)&&(a.push(d+1),a.push(f),a.push(g));}return l}(this.ids,this.coords,t,e,i,n,this.nodeSize)}within(t,e,i){return function(t,e,i,n,o,r){const s=[0,t.length-1,0],a=[],l=o*o;for(;s.length;){const c=s.pop(),h=s.pop(),u=s.pop();if(h-u<=r){for(let o=u;o<=h;o++)ct(e[2*o],e[2*o+1],i,n)<=l&&a.push(t[o]);continue}const f=Math.floor((u+h)/2),p=e[2*f],d=e[2*f+1];ct(p,d,i,n)<=l&&a.push(t[f]);const g=(c+1)%2;(0===c?i-o<=p:n-o<=d)&&(s.push(u),s.push(f-1),s.push(g)),(0===c?i+o>=p:n+o>=d)&&(s.push(f+1),s.push(h),s.push(g));}return a}(this.ids,this.coords,t,e,i,this.nodeSize)}}const pt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},dt=Math.fround||(gt=new Float32Array(1),t=>(gt[0]=+t,gt[0]));var gt;class mt{constructor(e){this.options=It(Object.create(pt),e),this.trees=new Array(this.options.maxZoom+1),this.projection=e&&e.projection?e.projection:"MERCATOR",this.projObj=t.getProjection(this.projection);}createPointCluster(t,e,i){const[n,o]=t.geometry.coordinates;return {x:dt(wt(n)),y:dt((i?Mt:bt)(o)),zoom:1/0,index:e,parentId:-1}}load(t){const{log:e,minZoom:i,maxZoom:n,nodeSize:o}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;let s=[];for(let e=0;e<t.length;e++)t[e].geometry&&s.push(this.createPointCluster(t[e],e,this.options.isLatLon));this.trees[n+1]=new ft(s,Tt,Pt,o,Float32Array),e&&console.timeEnd(r);for(let t=n;t>=i;t--){const i=+Date.now();s=this._cluster(s,t),this.trees[t]=new ft(s,Tt,Pt,o,Float32Array),e&&console.warn("z%d: %d clusters in %dms",t,s.length,+Date.now()-i);}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let o=180===t[2]?180:((t[2]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,o=180;else if(i>o){const t=this.getClusters([i,n,180,r],e),s=this.getClusters([-180,n,o,r],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(wt(i),(this.options.isLatLon?Mt:bt)(r),wt(o),(this.options.isLatLon?Mt:bt)(n)),l=[];for(const t of a){const e=s.points[t];l.push(e.numPoints?xt(e,this.options.isLatLon):this.points[e.index]);}return l}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",o=this.trees[i];if(!o)throw new Error(n);const r=o.points[e];if(!r)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=o.within(r.x,r.y,s),l=[];for(const e of a){const i=o.points[e];i.parentId===t&&l.push(i.numPoints?xt(i,this.options.isLatLon):this.points[i.index]);}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],o=Math.pow(2,t),{extent:r,radius:s}=this.options,a=s/r,l=(i-a)/o,c=(i+1+a)/o,h={features:[]};return this._addTileFeatures(n.range((e-a)/o,l,(e+1+a)/o,c),n.points,e,i,o,h),0===e&&this._addTileFeatures(n.range(1-a/o,l,1,c),n.points,o,i,o,h),e===o-1&&this._addTileFeatures(n.range(0,l,a/o,c),n.points,-1,i,o,h),h.features.length?h:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id;}return e}_appendLeaves(t,e,i,n,o){const r=this.getChildren(e);for(const e of r){const r=e.properties;if(r&&r.cluster?o+r.point_count<=n?o+=r.point_count:o=this._appendLeaves(t,r.cluster_id,i,n,o):o<n?o++:t.push(e),t.length===i)break}return o}_addTileFeatures(t,e,i,n,o,r){for(const s of t){const t=e[s],a=t.numPoints;let l,c,h;if(a)l=vt(t),c=t.x,h=t.y;else {const e=this.points[t.index];l=e.properties,c=wt(e.geometry.coordinates[0]),h=bt(e.geometry.coordinates[1]);}const u={type:1,geometry:[[Math.round(this.options.extent*(c*o-i)),Math.round(this.options.extent*(h*o-n))]],tags:l};let f;a?f=t.id:this.options.generateId?f=t.index:this.points[t.index].id&&(f=this.points[t.index].id),void 0!==f&&(u.id=f),r.features.push(u);}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const i=[],{radius:n,extent:o,reduce:r,minPoints:s}=this.options,a=n/(o*Math.pow(2,e));for(let n=0;n<t.length;n++){const o=t[n];if(o.zoom<=e)continue;o.zoom=e;const l=this.trees[e+1],c=l.within(o.x,o.y,a),h=o.numPoints||1;let u=h;for(const t of c){const i=l.points[t];i.zoom>e&&(u+=i.numPoints||1);}if(u>=s){let t=o.x*h,s=o.y*h,a=r&&h>1?this._map(o,!0):null;const f=(n<<5)+(e+1)+this.points.length;for(const i of c){const n=l.points[i];if(n.zoom<=e)continue;n.zoom=e;const c=n.numPoints||1;t+=n.x*c,s+=n.y*c,n.parentId=f,r&&(a||(a=this._map(o,!0)),r(a,this._map(n)));}o.parentId=f,i.push(yt(t/u,s/u,f,u,a));}else if(i.push(o),u>1)for(const t of c){const n=l.points[t];n.zoom<=e||(n.zoom=e,i.push(n));}}return i}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return (t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?It({},t.properties):t.properties;const i=this.points[t.index].properties,n=this.options.map(i);return e&&n===i?It({},n):n}}function yt(t,e,i,n,o){return {x:dt(t),y:dt(e),zoom:1/0,id:i,parentId:-1,numPoints:n,properties:o}}function xt(t,e){return {type:"Feature",id:t.id,properties:vt(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e?_t:St)(t.y)]}};var i;}function vt(t){const e=t.numPoints,i=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return It(It({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function wt(t){return t/360+.5}function bt(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Mt(t){const e=(90-t)/360;return e<0?0:e>1?1:e}function St(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function _t(t){return 90-360*t}function It(t,e){for(const i in e)t[i]=e[i];return t}function Tt(t){return t.x}function Pt(t){return t.y}function zt(t,e,i,n){let o=n;const r=i-e>>1;let s,a=i-e;const l=t[e],c=t[e+1],h=t[i],u=t[i+1];for(let n=e+3;n<i;n+=3){const e=kt(t[n],t[n+1],l,c,h,u);if(e>o)s=n,o=e;else if(e===o){const t=Math.abs(n-r);t<a&&(s=n,a=t);}}o>n&&(s-e>3&&zt(t,e,s,n),t[s+2]=o,i-s>3&&zt(t,s,i,n));}function kt(t,e,i,n,o,r){let s=o-i,a=r-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=o,n=r):l>0&&(i+=s*l,n+=a*l);}return s=t-i,a=e-n,s*s+a*a}function Lt(t,e,i,n){const o={id:null==t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)Dt(o,i);else if("Polygon"===e)Dt(o,i[0]);else if("MultiLineString"===e)for(const t of i)Dt(o,t);else if("MultiPolygon"===e)for(const t of i)Dt(o,t[0]);return o}function Dt(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1]);}function Ot(t,e,i,n){if(!e.geometry)return;const o=e.geometry.coordinates,r=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===r)Et(o,a,i.projection);else if("MultiPoint"===r)for(const t of o)Et(t,a,i.projection);else if("LineString"===r)Ct(o,a,s,!1,i.projection);else if("MultiLineString"===r){if(i.lineMetrics){for(const n of o)a=[],Ct(n,a,s,!1,i.projection),t.push(Lt(l,"LineString",a,e.properties));return}jt(o,a,s,!1,i.projection);}else if("Polygon"===r)jt(o,a,s,!0,i.projection);else {if("MultiPolygon"!==r){if("GeometryCollection"===r){for(const o of e.geometry.geometries)Ot(t,{id:l,geometry:o,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of o){const e=[];jt(t,e,s,!0,i.projection),a.push(e);}}t.push(Lt(l,r,a,e.properties));}function Et(t,e,i){e.push(...Rt(t,i),0);}function Ct(t,e,i,n,o){let r,s,a=0;for(let i=0;i<t.length;i++){const l=Rt(t[i],o),c=l[0],h=l[1];e.push(c,h,0),i>0&&(a+=n?(r*h-c*s)/2:Math.sqrt(Math.pow(c-r,2)+Math.pow(h-s,2))),r=c,s=h;}const l=e.length-3;e[2]=1,zt(e,0,l,i),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size;}function jt(t,e,i,n,o){for(let r=0;r<t.length;r++){const s=[];Ct(t[r],s,i,n,o),e.push(s);}}function Rt(e,i){const n=t.getProjection(i),o=n.lngX(e[0],1);let r=n.latY(e[1],1);return r=r<0?0:r>1?1:r,[o,r]}function At(t,e,i,n,o,r,s,a){if(n/=e,r>=(i/=e)&&s<n)return t;if(s<i||r>=n)return null;const l=[];for(const e of t){const t=e.geometry;let r=e.type;const s=0===o?e.minX:e.minY,c=0===o?e.maxX:e.maxY;if(s>=i&&c<n){l.push(e);continue}if(c<i||s>=n)continue;let h=[];if("Point"===r||"MultiPoint"===r)Gt(t,h,i,n,o);else if("LineString"===r)Bt(t,h,i,n,o,!1,a.lineMetrics);else if("MultiLineString"===r)Nt(t,h,i,n,o,!1);else if("Polygon"===r)Nt(t,h,i,n,o,!0);else if("MultiPolygon"===r)for(const e of t){const t=[];Nt(e,t,i,n,o,!0),t.length&&h.push(t);}if(h.length){if(a.lineMetrics&&"LineString"===r){for(const t of h)l.push(Lt(e.id,r,t,e.tags));continue}"LineString"!==r&&"MultiLineString"!==r||(1===h.length?(r="LineString",h=h[0]):r="MultiLineString"),"Point"!==r&&"MultiPoint"!==r||(r=3===h.length?"Point":"MultiPoint"),l.push(Lt(e.id,r,h,e.tags));}}return l.length?l:null}function Gt(t,e,i,n,o){for(let r=0;r<t.length;r+=3){const s=t[r+o];s>=i&&s<=n&&Ft(e,t[r],t[r+1],t[r+2]);}}function Bt(t,e,i,n,o,r,s){let a=Vt(t);const l=0===o?qt:Yt;let c,h,u=t.start;for(let f=0;f<t.length-3;f+=3){const p=t[f],d=t[f+1],g=t[f+2],m=t[f+3],y=t[f+4],x=0===o?p:d,v=0===o?m:y;let w=!1;s&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-y,2))),x<i?v>i&&(h=l(a,p,d,m,y,i),s&&(a.start=u+c*h)):x>n?v<n&&(h=l(a,p,d,m,y,n),s&&(a.start=u+c*h)):Ft(a,p,d,g),v<i&&x>=i&&(h=l(a,p,d,m,y,i),w=!0),v>n&&x<=n&&(h=l(a,p,d,m,y,n),w=!0),!r&&w&&(s&&(a.end=u+c*h),e.push(a),a=Vt(t)),s&&(u+=c);}let f=t.length-3;const p=t[f],d=t[f+1],g=0===o?p:d;g>=i&&g<=n&&Ft(a,p,d,t[f+2]),f=a.length-3,r&&f>=3&&(a[f]!==a[0]||a[f+1]!==a[1])&&Ft(a,a[0],a[1],a[2]),a.length&&e.push(a);}function Vt(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Nt(t,e,i,n,o,r){for(const s of t)Bt(s,e,i,n,o,r,!1);}function Ft(t,e,i,n){t.push(e,i,n);}function qt(t,e,i,n,o,r){const s=(r-e)/(n-e);return Ft(t,r,i+(o-i)*s,1),s}function Yt(t,e,i,n,o,r){const s=(r-i)/(o-i);return Ft(t,e+(n-e)*s,r,1),s}function Zt(t,e){const i=[];for(let n=0;n<t.length;n++){const o=t[n],r=o.type;let s;if("Point"===r||"MultiPoint"===r||"LineString"===r)s=Xt(o.geometry,e);else if("MultiLineString"===r||"Polygon"===r){s=[];for(const t of o.geometry)s.push(Xt(t,e));}else if("MultiPolygon"===r){s=[];for(const t of o.geometry){const i=[];for(const n of t)i.push(Xt(n,e));s.push(i);}}i.push(Lt(o.id,r,s,o.tags));}return i}function Xt(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function Jt(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,o=t.y;for(const r of t.features){const t=r.geometry,s=r.type;if(r.geometry=[],1===s)for(let s=0;s<t.length;s+=2)r.geometry.push(Wt(t[s],t[s+1],e,i,n,o));else for(let s=0;s<t.length;s++){const a=[];for(let r=0;r<t[s].length;r+=2)a.push(Wt(t[s][r],t[s][r+1],e,i,n,o));r.geometry.push(a);}}return t.transformed=!0,t}function Wt(t,e,i,n,o,r){return [Math.round(i*(t*n-o)),Math.round(i*(e*n-r))]}function $t(t,e,i,n,o){const r=e===o.maxZoom?0:o.tolerance/((1<<e)*o.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)Ht(s,e,r,o);return s}function Ht(t,e,i,n){const o=e.geometry,r=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===r||"MultiPoint"===r)for(let e=0;e<o.length;e+=3)s.push(o[e],o[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)Ut(s,o,t,i,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(let e=0;e<o.length;e++)Ut(s,o[e],t,i,"Polygon"===r,0===e);else if("MultiPolygon"===r)for(let e=0;e<o.length;e++){const n=o[e];for(let e=0;e<n.length;e++)Ut(s,n[e],t,i,!0,0===e);}if(s.length){let i=e.tags||null;if("LineString"===r&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.minemap_clip_start=o.start/o.size,i.minemap_clip_end=o.end/o.size;}const a={geometry:s,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a);}}function Ut(t,e,i,n,o,r){const s=n*n;if(n>0&&e.size<(o?s:n))return void(i.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===n||e[t+2]>s)&&(i.numSimplified++,a.push(e[t],e[t+1])),i.numPoints++;o&&function(t,e){let i=0;for(let e=0,n=t.length,o=n-2;e<n;o=e,e+=2)i+=(t[e]-t[o])*(t[e+1]+t[o+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const n=t[e],o=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=n,t[i-1-e]=o;}}(a,r),t.push(a);}const Kt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0,projection:t.ProjectionType.MERCATOR};class Qt{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(Kt),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)Ot(i,t.features[n],e,n);else Ot(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.info("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const o=At(t,1,-1-i,i,0,-1,2,e),r=At(t,1,1-i,2+i,0,-1,2,e);return (o||r)&&(n=At(t,1,-i,1+i,0,-1,2,e)||[],o&&(n=Zt(o,1).concat(n)),r&&(n=n.concat(Zt(r,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.info("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.info("tiles generated:",this.total,JSON.stringify(this.stats)));}splitTile(t,e,i,n,o,r,s){const a=[t,e,i,n],l=this.options,c=l.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const h=1<<e,u=te(e,i,n);let f=this.tiles[u];if(!f&&(c>1&&console.time("creation"),f=this.tiles[u]=$t(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.info("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++;}if(f.source=t,null==o){if(e===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue}else {if(e===l.maxZoom||e===o)continue;if(null!=o){const t=o-e;if(i!==r>>t||n!==s>>t)continue}}if(f.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,d=.5-p,g=.5+p,m=1+p;let y=null,x=null,v=null,w=null,b=At(t,h,i-p,i+g,0,f.minX,f.maxX,l),M=At(t,h,i+d,i+m,0,f.minX,f.maxX,l);t=null,b&&(y=At(b,h,n-p,n+g,1,f.minY,f.maxY,l),x=At(b,h,n+d,n+m,1,f.minY,f.maxY,l),b=null),M&&(v=At(M,h,n-p,n+g,1,f.minY,f.maxY,l),w=At(M,h,n+d,n+m,1,f.minY,f.maxY,l),M=null),c>1&&console.timeEnd("clipping"),a.push(y||[],e+1,2*i,2*n),a.push(x||[],e+1,2*i,2*n+1),a.push(v||[],e+1,2*i+1,2*n),a.push(w||[],e+1,2*i+1,2*n+1);}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:o,debug:r}=n;if(t<0||t>24)return null;const s=1<<t,a=te(t,e=e+s&s-1,i);if(this.tiles[a])return Jt(this.tiles[a],o);r>1&&console.info("drilling down to z%d-%d-%d",t,e,i);let l,c=t,h=e,u=i;for(;!l&&c>0;)c--,h>>=1,u>>=1,l=this.tiles[te(c,h,u)];return l&&l.source?(r>1&&(console.info("found parent tile z%d-%d-%d",c,h,u),console.time("drilling down")),this.splitTile(l.source,c,h,u,t,e,i),r>1&&console.timeEnd("drilling down"),this.tiles[a]?Jt(this.tiles[a],o):null):null}}function te(t,e,i){return 32*((1<<t)*i+e)+t}function ee(t,e,i){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const o=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!o)return e(null,null);const r=new C(o.features,i);let s=$(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer});}class ie extends z{constructor(e,i,n,o){super(e,i,n,o),this.setDataLoaderFunction(ee),this.projection=o||t.ProjectionType.MERCATOR;}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const e=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const n=i&&i.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(i,((r,s)=>{if(r||!s)return e(r);if("object"!=typeof s)return e(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{k(s,!0);try{if(i.filter){const e=t.createExpression(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const n=s.features.filter((t=>e.value.evaluate({zoom:0},t)));s={type:"FeatureCollection",features:n};}i.geojsonVtOptions.projection=this.projection,this._geoJSONIndex=i.cluster?new mt(function({superclusterOptions:e,clusterProperties:i},n){if(!i||!e)return e.projection=n,e;const o={},r={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(i);for(const e of l){const[n,s]=i[e],a=t.createExpression(s),l=t.createExpression("string"==typeof n?[n,["accumulated"],["get",e]]:n);o[e]=a.value,r[e]=l.value;}return e.map=t=>{a.properties=t;const e={};for(const t of l)e[t]=o[t].evaluate(s,a);return e},e.reduce=(t,e)=>{a.properties=e;for(const e of l)s.accumulated=t[e],t[e]=r[e].evaluate(s,a);},e.projection=n,e}(i,this.projection)).load(s.features):function(t,e){return new Qt(t,e)}(s,i.geojsonVtOptions);}catch(r){return e(r)}this.loaded={};const a={};if(o){const e=t.getPerformanceMeasurement(n);e&&(a.resourceTiming={},a.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)));}e(null,a);}}));}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.getJSON(e.request,i);else {if("string"!=typeof e.data)return i(new Error("Input data is not a valid GeoJSON object."));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error("Input data is not a valid GeoJSON object."))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e();}getClusterExpansionZoom(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId));}getClusterChildren(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId));}getClusterLeaves(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset));}}class ne{constructor(e,i,n,o){this.actor=e,this.loading={},this.loaded={},this.mmDemTile=new t.MMDemTile,this.availableImages=n,this.projection=o;}registRequestController(t){this.irc=t;}loadTile(t,e){this._loadData(t,e);}_checkBase64(t){if(t.byteLength>200)return !1;const e=new Uint8Array(t);let i="";for(let t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return -1!==i.indexOf("data:image")||-1!==i.indexOf("base64")}_loadData(t,e){this.loading[t.uid]={imgRequest:null,binRequest:null};const i=t.uid;this.loading[i]=this.irc.pushRequest({id:i,param:t.request,renderWithTerrain:t.renderWithTerrain,terrainParam:t.terrainRequest,demDataMaxZoom:t.demDataMaxZoom,cb:(n,o)=>{if(n&&e(n,null),t.renderWithTerrain&&o.terrainData){const e=t.tileID;if(e.canonical.z>t.demDataMaxZoom){const i=e.scaledTo(t.demDataMaxZoom);o.terrainData=this.mmDemTile.createTerrain(o.terrainData.data,i.canonical.x,i.canonical.y,i.canonical.z,this.projection);}else o.terrainData=this.mmDemTile.createTerrain(o.terrainData.data,t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z,this.projection);}delete this.loading[i],this.loaded[i]=o,e(null,o);}}),this.irc.run();}reloadTile(t,e){this._loadData(t,e);const i=this.loaded,n=t.uid,o=this;if(i&&i[n]){const t=i[n],r=(i,n)=>{const r=t.reloadCallback;r&&(delete t.reloadCallback,t.parse(t.vectorTile,o.layerIndex,o.actor,r)),e(i,n);};"parsing"===t.status?t.reloadCallback=r:"done"===t.status&&t.parse(t.vectorTile,this.layerIndex,this.actor,r);}}abortTile(t,e){const i=this.loading,n=t.uid;i&&i[n]&&(this.irc.removeRequestById(n),delete i[n]),e();}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e();}}class oe{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.requestPerformanceManager=new t.RequestPerformanceManger,this.workerSourceTypes={vector:z,geojson:ie,raster:ne},this.workerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e;},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText;};}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],i();}spriteLoaded(e,i){this.isSpriteLoaded[e]=i;for(const n in this.workerSources[e]){const o=this.workerSources[e][n];for(const e in o)o[e]instanceof z&&(o[e].isSpriteLoaded=i,o[e].fire&&o[e].fire(new t.Event("isSpriteLoaded")));}}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const n=this.workerSources[t][i];for(const t in n)n[t].availableImages=e;}i();}setProjection(t,e,i){this.projection=e.projection,i();}setReferrer(t,e){this.referrer=e;}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i();}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i();}loadTile(t,e,i){e.projection=this.projection,this.getWorkerSource(t,e.type,e.source).loadTile(e,i);}reloadTile(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i);}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i);}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i);}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i();}trianglesIntersact(t,e,i){"raster"===e.type&&this.getWorkerSource(t,e.type,e.source).trianglesIntersact(e,i);}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i();}catch(t){i(t.toString());}}syncRTLPluginState(e,i,n){try{t.plugin.setState(i);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const i=t.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i);}}catch(t){n(t.toString());}}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}toggleRequestStatus(t,e){e?this.requestPerformanceManager.getVectorRequesterById("vector").pauseRequest():this.requestPerformanceManager.getVectorRequesterById("vector").restart();}getWorkerSource(e,i,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][i]||(this.workerSources[e][i]={}),!this.workerSources[e][i][n]){const o={send:(t,i,n)=>{this.actor.send(t,i,n,e);}},r=this.projection||t.ProjectionType.MERCATOR;this.workerSources[e][i][n]=new this.workerSourceTypes[i](o,this.getLayerIndex(e),this.getAvailableImages(e),r,this.isSpriteLoaded[e]),"raster"===i?this.workerSources[e][i][n].registRequestController(this.requestPerformanceManager.getImageRequesterById("img")):"vector"===i||"geojson"===i?this.workerSources[e][i][n].registRequestController(this.requestPerformanceManager.getVectorRequesterById("vector")):"3d-tiles"===i&&this.workerSources[e][i][n].registRequestController(this.requestPerformanceManager.getModelRequesterById("model"));}return this.workerSources[e][i][n]}}return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new oe(self)),oe}));

define(["./shared"],(function(e){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(let t=1;t<arguments.length;t++){const i=arguments[t];if(null!=i)for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t]);}return e});var t=e.createCommonjsModule((function(e){function t(e){return !i(e)}function i(e){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){const e=document.createElement("canvas");e.width=e.height=1;const t=e.getContext("2d");if(!t)return !1;const i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[i=e&&e.failIfMajorPerformanceCaveat]&&(r[i]=function(e){const i=function(e){var i=document.createElement("canvas"),r=Object.create(t.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,i.probablySupportsContext?i.probablySupportsContext("webgl",r)||i.probablySupportsContext("experimental-webgl",r):i.supportsContext?i.supportsContext("webgl",r)||i.supportsContext("experimental-webgl",r):i.getContext("webgl",r)||i.getContext("experimental-webgl",r)}(e);if(!i)return !1;const r=i.createShader(i.VERTEX_SHADER);return !(!r||i.isContextLost())&&(i.shaderSource(r,"void main() {}"),i.compileShader(r),!0===i.getShaderParameter(r,i.COMPILE_STATUS))}(i)),r[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i;}e.exports?e.exports=t:window&&(window.minemap=window.minemap||{},window.minemap.supported=t,window.minemap.notSupportedReason=i);var r={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};}));function i(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return !1;for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return !1;return !0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return !1;if(Object.keys(e).length!==Object.keys(t).length)return !1;for(const r in e)if(!i(e[r],t[r]))return !1;return !0}return e===t}const r={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",SERVER_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SERVER_URL:"//datahive.minedata.cn/service/",SRC_BASE:"/minemapapi/v3.4.0/",SRC_URL:"//minedata.cn/minemapapi/v3.4.0/",SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,APP_KEY:null,KEY:null,ACCESS_TOKEN:null,spriteUrl:null,MAX_PARALLEL_IMAGE_REQUESTS:16},o="参见minedata.cn帮助页面";function s(e,t){return Array.isArray(e)?t&&t.x&&t.y?e[(t.x+t.y)%e.length]:e[0]:e}function n(e,t,i,n,a,l){switch(e.protocol){case"minemap":{const t=_(r.SRC_URL);e.protocol=t.protocol,e.authority=t.authority;break}case"minemapdata":{const t=_(s(r.API_URL,l));e.path=t.path+e.authority+e.path,e.protocol=t.protocol,e.authority=t.authority;break}case"minemapdatad":{const t=_(s(r.DYN_URL||"",l));e.path=t.path+e.authority+e.path,e.protocol=t.protocol,e.authority=t.authority;break}case"minemapdatam":{const t=_(s(r.MERGE_URL||"",l));e.path=t.path+e.authority+e.path,e.protocol=t.protocol,e.authority=t.authority;break}case"minemapdatao":{const t=_(s(r.OTHER_URL||"",l));e.path=t.path+e.authority+e.path,e.protocol=t.protocol,e.authority=t.authority;break}case"mineserver":{const t=_(s(r.SERVER_URL||"",l));e.path=t.path+e.authority+e.path,e.protocol=t.protocol,e.authority=t.authority;break}case"cloudservice":{const t=_(s(r.SERVER_URL||"",l));e.path=`/${e.authority}${e.path}`,e.protocol=t.protocol,e.authority=t.authority;break}case"mineservice":{const t=_(s(r.SERVICE_URL||"",l));e.path=t.path+e.path,e.protocol=t.protocol,e.authority=t.authority;break}}if(!r.REQUIRE_ACCESS_TOKEN)return m(e);if(i=i||r.APP_KEY,n=n||r.SOLU,a=a||r.DATA_VERSION,!(t=t||r.KEY)&&!i&&!r.ACCESS_TOKEN)throw new Error(`需要申请key. ${o}`);if(!n)throw new Error(`需要申请solution id. ${o}`);return t?e.params.push(`key=${t}`):i?e.params.push(`appKey=${i}`):r.ACCESS_TOKEN&&e.params.push(`token=${r.ACCESS_TOKEN}`),e.params.push(`solu=${n}`),a&&e.params.push(`version=${a}`),m(e)}function a(e){return 0===e.indexOf("minemap:")||0===e.indexOf("minemapdata:")||0===e.indexOf("minemapdatad:")||0===e.indexOf("minemapdatam:")||0===e.indexOf("minemapdatao:")||0===e.indexOf("mineserver:")||0===e.indexOf("cloudservice:")||0===e.indexOf("mineservice:")}const l=function(e,t,i){if(!a(e))return e;const r=_(e);return r.path=`/styles/v1${r.path}`,n(r,t,i)},c=function(e){const t=_(e.url);return t.path=`${r.SRC_URL}/sprite/sprite${e.format}${e.extension}`,Array.isArray(r.spriteUrl)&&r.spriteUrl[e.index]&&`${r.spriteUrl[e.index]}${e.format}${e.extension}`||t.path},h=/(\.(png|jpg)\d*)(?=$)/,u=function(t,i,o,s){if(!t||t.indexOf("auth=true")<0&&!a(t))return 0===t.indexOf("//")?`${e.window.document.location.protocol}${t}`:t;const l=_(t);return l.path=l.path.replace(h,`${e.exported.devicePixelRatio>=2||512===o?"@2x":""}${e.exported.supportsWebp?".webp":"$1"}`),function(e){for(let t=0;t<e.length;t++)0===e[t].indexOf("access_token=tk.")&&(e[t]=`access_token=${r.ACCESS_TOKEN||""}`);}(l.params),n(l,void 0,void 0,void 0,void 0,s)},d=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _(e){const t=e.match(d);if(!t){const t=e.match(/^\/\/([^/?]+)(\/[^?]+)?\??(.+)?/);if(!t)throw new Error("Unable to parse URL object");return {protocol:"",authority:t[1],path:t[2]||"/",params:t[3]?t[3].split("&"):[]}}return {protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function m(t){const i=t.params.length?`?${t.params.join("&")}`:"";return t.protocol&&t.protocol.length>0?`${t.protocol}://${t.authority}${t.path}${i}`:`${e.window.document.location.protocol}//${t.authority}${t.path}${i}`}class f{constructor(e,t,i,r,o){this.context=e;const s=e.gl;this.dynamicDraw=Boolean(r),this.type=i,this.unbindVAO(),o?this.buffer=o:(this.buffer=s.createBuffer(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW));}getBuffer(){return this.buffer}unbindVAO(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);}bind(){this.context.bindElementBuffer.set(this.buffer);}updateData(e){const t=this.context.gl;this.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e);}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),this.buffer=null,this.context=null,delete this.buffer);}}class p{constructor(e,t,i,r,o,s){this.attributes=i,this.dynamicDraw=r,this.context=e,this.type=s,this.buffers={},o?this.buffers=o:this._parseAttributesbuffviewObject(t);}getBuffers(){return this.buffers}bind(){this.bindPerAttibuteBufferAndPointer();}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e);}enableAttributes(e,t){this.program=t;}setVertexAttribPointers(e,t,i){}bindPerAttibuteBufferAndPointer(){const e=this.context.gl;for(let t=0;t<this.attributes.length;t++){const i=this.attributes[t];this.context.bindVertexBuffer.set(this.buffers[i.name]);const r=this.program.attributes[i.name];if(void 0!==r)if(i.instance){const t=64;for(let i=0;i<4;++i){const o=r+i;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,4,e.FLOAT,!1,t,16*i),this.context.drawInstance.vertexAttribDivisorANGLE(o,1);}}else e.enableVertexAttribArray(r),e.vertexAttribPointer(r,i.components,i.type,!1,i.byteStride,i.offset);this.context.bindVertexBuffer.set(null);}}_parseAttributesbuffviewObject(t){const i=this.context.gl,r=Object.keys(t);r.forEach(((o,s)=>{const n=t[o];let a,l;a=g(o,"_")?`a${o}`:`a_${o}`;let c,h=s-1,u=!1;for(;h>=0;){if(u=this._findSameBuffer(r[h],o,t),u){c=r[h];break}h--;}if(u)this.buffers[a]=g(c,"_")?this.buffers[`a${c}`]:this.buffers[`a_${c}`];else {if(l=i.createBuffer(),this.context.bindVertexBuffer.set(l),n.type&&"instance"===n.type){let t=[];for(let i=0;i<n.count;i++){const r=(new e.Matrix4).rotateX(Math.PI/2);let o=n.instances[i].modelMatrix;o=o.multiplyRight(r),t=t.concat(o);}i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW);}else i.bufferData(i.ARRAY_BUFFER,null!=n.bufferView?n.bufferView.data:n.value,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW);this.buffers[a]=l;}}));}_findSameBuffer(e,t,i){return "InstanceMatrix4"!==t&&(null!=i[e].bufferView?i[e].bufferView.data===i[t].bufferView.data:i[e].value===i[t].value)}destroy(){const e=this.context.gl;for(const t in this.buffers)e.deleteBuffer(this.buffers[t]),delete this.buffers[t];this.context=null;}}function g(e,t){return e.charAt(0)==t}class v{constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer;}unbindVAO(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);}bind(){this.context.bindElementBuffer.set(this.buffer);}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer);}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);}}const x={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class y{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer;}bind(){this.context.bindVertexBuffer.set(this.buffer);}updateData(e){const t=this.context.gl;this.bind(),t.bufferData(t.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW);}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r);}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const o=this.attributes[r],s=t.attributes[o.name];void 0!==s&&e.vertexAttribPointer(s,o.components,e[x[o.type]],!1,this.itemSize,o.offset+this.itemSize*(i||0));}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);}}class T{constructor(t){this.context=t,this.default=e.Color.transparent,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!0!==this.dirty||(this.context.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1);}}class S{constructor(e){this.context=e,this.default=1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.clearDepth(e),this.current=e,this.dirty=!1);}}class b{constructor(e){this.context=e,this.default=0,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.clearStencil(e),this.current=e,this.dirty=!1);}}class w{constructor(e){this.context=e,this.default=[!0,!0,!0,!0],this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!0!==this.dirty||(this.context.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1);}}class E{constructor(e){this.context=e,this.default=!0,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.depthMask(e),this.current=e,this.dirty=!1);}}class M{constructor(e){this.context=e,this.default=255,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.stencilMask(e),this.current=e,this.dirty=!1);}}class A{constructor(e){this.context=e,this.default={func:e.gl.ALWAYS,ref:0,mask:255},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.func===t.func&&e.ref===t.ref&&e.mask===t.mask&&!0!==this.dirty||(this.context.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1);}}class C{constructor(e){this.context=e;const t=this.context.gl;this.default=[t.KEEP,t.KEEP,t.KEEP],this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&!0!==this.dirty||(this.context.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1);}}class R{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1;}}}class L{constructor(e){this.context=e,this.default=[0,1],this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e[0]===t[0]&&e[1]===t[1]&&!0!==this.dirty||(this.context.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1);}}class P{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1;}}}class I{constructor(e){this.context=e,this.default=e.gl.LESS,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.depthFunc(e),this.current=e,this.dirty=!1);}}class O{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1;}}}class D{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1;}}}class N{constructor(e){this.context=e;const t=this.context.gl;this.default=[t.ONE,t.ZERO],this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e[0]===t[0]&&e[1]===t[1]&&!0!==this.dirty||(this.context.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1);}}class F{constructor(t){this.context=t,this.default=e.Color.transparent,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!0!==this.dirty||(this.context.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1);}}class B{constructor(e){this.context=e,this.default=this.context.gl.FUNC_ADD,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){e===this.current&&!0!==this.dirty||(this.context.gl.blendEquation(e),this.current=e,this.dirty=!1);}}class U{constructor(e){this.context=e,this.current=this.context.gl.CCW,this.default=this.context.gl.CCW,this.dirty=!1;}set(e){e!==this.current&&(this.context.gl.frontFace(e),this.current=e);}get(){return this.current||this.context.gl.CCW}setDefault(){this.set(this.default);}}class z{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.useProgram(e),this.current=e,this.dirty=!1);}}class G{constructor(t){this.context=t,this.default=e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.activeTexture(e),this.current=e,this.dirty=!1);}}class V{constructor(e){this.context=e;const t=this.context.gl;this.default=[0,0,t.drawingBufferWidth,t.drawingBufferHeight],this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!0!==this.dirty||(this.context.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1);}}class k{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1;}}}class H{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1;}}}class X{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1;}}}class j{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1;}}}class Y{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.context.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1;}}class W{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){(this.current!==e&&this.context.extVertexArrayObject||!0===this.dirty)&&(this.context.extVertexArrayObject.bindVertexArrayOES(e),this.current=e,this.dirty=!1);}}class q{constructor(e){this.context=e,this.default=4,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1;}}}class Z{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1;}}}class ${constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1;}}}class Q{constructor(e,t){this.context=e,this.default=null,this.current=this.default,this.dirty=!1,this.parent=t;}get(){return this.current}}class K extends Q{constructor(e,t){super(e,t),this.dirty=!1;}setDefault(){this.set(this.default);}set(e){if(this.dirty||this.current!==e){const t=this.context.gl;this.context.bindFramebuffer.set(this.parent),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1;}}setDirty(){this.dirty=!0;}}class J extends Q{setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;this.context.bindFramebuffer.set(this.parent),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1;}}}class ee extends Q{setDefault(){this.set(this.default);}set(e){if(this.current!==e||!0===this.dirty){const t=this.context.gl;this.context.bindFramebuffer.set(this.parent),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1;}}}class te{constructor(e){this.context=e,this.current=this.context.gl.BACK,this.default=this.context.gl.BACK,this.dirty=!1;}set(e){e!==this.current&&(this.context.gl.cullFace(e),this.current=e);}get(){return this.current}setDefault(){this.set(this.default);}}class ie{constructor(e,t,i,r){this.context=e,this.width=t,this.height=i,this.depthPick=r||!1;const o=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new K(e,o),this.depthAttachment=new J(e,o),this.depthStencilAttachment=new ee(e,o);}destroy(){const e=this.context.gl,t=this.colorAttachment.get();t&&e.deleteTexture(t);const i=this.depthAttachment.get();i&&(this.depthPick?e.deleteTexture(i):e.deleteRenderbuffer(i)),e.deleteFramebuffer(this.framebuffer);}}class re{constructor(t,i){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this._logarithmicDepthBuffer=!1,this.clearColor=new T(this),this.clearDepth=new S(this),this.clearStencil=new b(this),this.colorMask=new w(this),this.depthMask=new E(this),this.cullFace=new O(this),this.cullFaceSide=new te(this),this.frontFace=new U(this),this.stencilMask=new M(this),this.stencilFunc=new A(this),this.stencilOp=new C(this),this.stencilTest=new R(this),this.depthRange=new L(this),this.depthTest=new P(this),this.depthFunc=new I(this),this.blend=new D(this),this.blendFunc=new N(this),this.blendColor=new F(this),this.blendEquation=new B(this),this.program=new z(this),this.activeTexture=new G(this),this.viewport=new V(this),this.bindFramebuffer=new k(this),this.bindRenderbuffer=new H(this),this.bindTexture=new X(this),this.bindVertexBuffer=new j(this),this.bindElementBuffer=new Y(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new W(this),this.pixelStoreUnpack=new q(this),this.pixelStoreUnpackPremultiplyAlpha=new Z(this),this.pixelStoreUnpackFlipY=new $(this),this._Program=void 0;const{testMode:r}=i;this.supportPBR=!0,this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.hasDerivativesExt=t.getExtension("OES_standard_derivatives"),null!=this.hasDerivativesExt||r||(this.supportPBR=!1,e.warnOnce("OES_standard_Derivatives are not supported")),this.drawInstance=t.getExtension("ANGLE_instanced_arrays"),null!=this.drawInstance||r||e.warnOnce("ANGLE_instanced_arraysd"),null!=t.getExtension("EXT_SRGB")||r||(this.supportPBR=!1,e.warnOnce("EXT_SRGB are not supported")),this.hasLODExtension=t.getExtension("EXT_shader_texture_lod"),null!=this.hasLODExtension||r||(this.supportPBR=!1,e.warnOnce("EXT_shader_texture_lod are not supported")),this.extDepthTexture=t.getExtension("WEBGL_depth_texture"),this.extDepthTexture||t.getExtension("WEBKIT_WEBGL_depth_texture"),this.extElementIndexUint||t.getExtension("OES_element_index_uint");const o=t.getSupportedExtensions();for(let e=0;e<o.length;e++)"EXT_frag_depth"===o[e]&&(this.extFragDepth=t.getExtension("EXT_frag_depth"));this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._s3tc=!!oe(t,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!oe(t,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!oe(t,["WEBGL_compressed_texture_etc1"]);}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.cullFace.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;}createIndexBuffer(e,t){return new v(this,e,t)}createVertexBuffer(e,t,i){return new y(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,o=r.createRenderbuffer();return this.bindRenderbuffer.set(o),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),o}createFramebuffer(e,t,i){return new ie(this,e,t,i||!1)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let o=0;e&&(o|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(o|=r.DEPTH_BUFFER_BIT,this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(o|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(o);}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1);}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1);}setColorMode(t){i(t.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask);}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace));}czm_unpackDepth(e){return (e[0]+e[1]/255+e[2]/65025+e[3]/16581375)/255}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);}}function oe(e,t){const i=t.length;for(let r=0;r<i;++r){const i=e.getExtension(t[r]);if(i)return i}}class se{constructor(e,t){this.origin=void 0!==e?e:[0,0,0],this.direction=void 0!==t?t:[0,0,0];}set(t,i){return e.copy(this.origin,t),e.copy(this.direction,i),this}clone(){return new se(this.origin,this.direction)}copy(t){e.copy(this.origin,t.origin),e.copy(this.direction,t.direction);}at(t,i){return void 0===i&&(console.warn("THREE.Ray: .at() target is now required"),i=[0,0,0]),e.copy(i,this.direction),e.scale(i,i,t),e.add(i,i,this.origin),i}lookAt(t){return e.copy(this.direction,t),e.sub(this.direction,this.direction,this.origin),e.normalize(this.direction,this.direction),this}closestPointToPoint(t,i){void 0===i&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=[0,0,0]),e.sub(i,t,this.origin);var r=e.dot(i,this.direction);return r<0?e.copy(i,this.origin):(e.copy(i,this.direction),e.scale(i,i,r),e.add(i,i,this.origin),i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(){var t=[0,0,0],i=e.dot(e.sub(t,point,this.origin),this.direction);return i<0?e.squaredDistance(this.origin,point):(e.copy(t,this.direction),e.scale(t,t,i),e.add(t,t,this.origin),e.squaredDistance(t,point))}distanceSqToSegment(e,t,i,r){var o=[0,0,0],s=[0,0,0],n=[0,0,0];o.copy(e).add(t).multiplyScalar(.5),s.copy(t).sub(e).normalize(),n.copy(this.origin).sub(o);var a,l,c,h,u=.5*e.distanceTo(t),d=-this.direction.dot(s),_=n.dot(this.direction),m=-n.dot(s),f=n.lengthSq(),p=Math.abs(1-d*d);if(p>0)if(l=d*_-m,h=u*p,(a=d*m-_)>=0)if(l>=-h)if(l<=h){var g=1/p;c=(a*=g)*(a+d*(l*=g)+2*_)+l*(d*a+l+2*m)+f;}else l=u,c=-(a=Math.max(0,-(d*l+_)))*a+l*(l+2*m)+f;else l=-u,c=-(a=Math.max(0,-(d*l+_)))*a+l*(l+2*m)+f;else l<=-h?c=-(a=Math.max(0,-(-d*u+_)))*a+(l=a>0?-u:Math.min(Math.max(-u,-m),u))*(l+2*m)+f:l<=h?(a=0,c=(l=Math.min(Math.max(-u,-m),u))*(l+2*m)+f):c=-(a=Math.max(0,-(d*u+_)))*a+(l=a>0?u:Math.min(Math.max(-u,-m),u))*(l+2*m)+f;else l=d>0?-u:u,c=-(a=Math.max(0,-(d*l+_)))*a+l*(l+2*m)+f;return i&&i.copy(this.direction).multiplyScalar(a).add(this.origin),r&&r.copy(s).multiplyScalar(l).add(o),c}intersectSphere(t,i){var r=[0,0,0];e.sub(r,t.center,this.origin);var o=e.dot(r,this.direction),s=e.dot(r,r)-o*o,n=t.radius*t.radius;if(s>n)return null;var a=Math.sqrt(n-s),l=o-a,c=o+a;return l<0&&c<0?null:this.at(l<0?c:l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){var i,r,o,s,n,a,l=1/this.direction[0],c=1/this.direction[1],h=1/this.direction[2],u=this.origin;return l>=0?(i=(e[0][0]-u[0])*l,r=(e[1][0]-u[0])*l):(i=(e[1][0]-u[0])*l,r=(e[0][0]-u[0])*l),c>=0?(o=(e[0][1]-u[1])*c,s=(e[1][1]-u[1])*c):(o=(e[1][1]-u[1])*c,s=(e[0][1]-u[1])*c),i>s||o>r?null:((o>i||i!=i)&&(i=o),(s<r||r!=r)&&(r=s),h>=0?(n=(e[0][2]-u[2])*h,a=(e[1][2]-u[2])*h):(n=(e[1][2]-u[2])*h,a=(e[0][2]-u[2])*h),i>a||n>r?null:((n>i||i!=i)&&(i=n),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,t)))}intersectTriangle(t,i,r,o,s){var n=[0,0,0],a=[0,0,0],l=[0,0,0],c=[0,0,0];e.sub(a,i,t),e.sub(l,r,t),e.cross(c,a,l);var h,u=e.dot(this.direction,c);if(u>0){if(o)return null;h=1;}else {if(!(u<0))return null;h=-1,u=-u;}e.sub(n,this.origin,t);var d=h*e.dot(this.direction,e.cross(l,n,l));if(d<0)return null;var _=h*e.dot(this.direction,e.cross(a,a,n));if(_<0)return null;if(d+_>u)return null;var m=-h*e.dot(n,c);return m<0?null:this.at(m/u,s)}applyMatrix4(t){return e.transformMat4(this.origin,this.origin,t),e.transformMat4(this.direction,this.direction,t),this}equals(e){return e.origin===this.origin&&e.direction===this.direction}}const ne={5120:1,5121:1,5122:2,5123:2,5125:4,5124:4,5126:4},ae={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function le(t,i,r,o,s,n){const a=t.meshes,l=a[i].primitives[r||0].attributes,c=a[i].primitives[r||0].extensions,h=c?c.KHR_draco_mesh_compression:void 0,u=[];for(const e in l){const i=l[e],r=i.bufferView||i.value,s=i.byteOffset?i.byteOffset:0,n=i.componentType,a=ae[i.type]||i.components,c=r.byteStride?r.byteStride:ne[n]*a;h&&(l[e].bufferViewId=t.bufferViews[h.bufferView].id),"POSITION"===e&&(o.VB={offset:s,byteStride:c,type:n}),"_"==e.charAt(0)?u.push({name:`a${e}`,type:n,components:ae[i.type],offset:s,byteStride:c}):u.push({name:`a_${e}`,type:n,components:ae[i.type],offset:s,byteStride:c});}if(s)for(let e=0;e<a[i].primitives[r||0].targets.length;e++){const t=a[i].primitives[r||0].targets[e];for(const i in t){const t=l[i],r=t.bufferView,o=t.componentType,s=t.components;u.push({name:`a_${i}_${e+1}`,type:o,components:ae[t.type],offset:t.byteOffset?t.byteOffset:0,byteStride:r.byteStride?r.byteStride:5121===o?s:5123===o?2*s:4*s});}}return n&&u.push({name:"a_InstanceMatrix4",type:5126,components:4,instance:!0}),e.createLayoutGltf(u)}class ce{constructor(e){this.options=Object.assign({},{closed:!1,state:1},e),this._value=null;}set state(e){this.options.state=e;}get state(){return this.options.state}get times(){return this.options.times}get controlPoint(){return this.options.controlPoint}get points(){return this.options.points}get weights(){return this.options.weights}get interpolation(){return this.options.interpolation}get nodeId(){return this.options.node}get path(){return this.options.path}start(){this._stime=Date.now();}close(){this.options.closed=!0;}open(){this.options.closed=!1;}get value(){return this._value}update(e){this._curtime=e;}getCurrentTick(t){t=t||Date.now(),this._stime||(this._stime=Date.now());const i=this.options.times;let r=0;const o=(t-this._stime)/1e3%i[i.length-1];for(let t=0;t<i.length-1;t++)if(o>=i[t]&&o<=i[t+1])return r=(o-i[t])/(i[t+1]-i[t]),"LINEAR"===this.interpolation?{ratio:r,index:t}:"STEP"===this.interpolation?{ratio:1,index:t}:"CUBICSPLINE"===this.interpolation?{ratio:e.easeCubicInOut(r),index:t}:{ratio:r,index:t};return {ratio:1,index:i.length-2}}evaluate(e){return this.options.closed?(this._value=null,null):(this._value=[],[])}}class he extends ce{constructor(e){super(e);}evaluate(e){return this.options.closed?null:this.controlPoint}}class ue extends ce{constructor(e){super(e);}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),r=this.points,o=new e.Matrix4;if("scale"===this.path){const t=new e.Vector3(r.slice(3*i.index,3*i.index+3));t.lerp(r.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),o.scale(t);}else if("translation"===this.path){const t=new e.Vector3(r.slice(3*i.index,3*i.index+3));t.lerp(r.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),o.translate(t);}this.options.originNodeMatrix&&o.multiplyLeft(this.options.originNodeMatrix),this._value=o;}}class de extends ce{constructor(e){super(e);}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),r=this.points,o=new e.Matrix4,s=new e.Quaternion(r.slice(4*i.index,4*i.index+4));s.slerp(r.slice(4*i.index+4,4*i.index+8),i.ratio),o.fromQuaternion(s),this.options.originNodeMatrix&&o.multiplyLeft(this.options.originNodeMatrix),this._value=o;}}class _e extends ce{constructor(e){super(e);}evaluate(e){if(this.options.closed)return null;const t=this.getCurrentTick(e),i=this.weights,r=i.length/this.times.length,o=[];for(let e=0;e<r;e++)o.push(i[t.index*r+e]*(1-t.ratio)+i[t.index*r+e]*t.ratio);return this._value=o,0}}class me extends e.Evented{constructor(t){super(),this.options=Object.assign({},{animations:[],loop:0,delay:0,multiplier:1,reverse:!1},t),this._animations={},this._defaultAnimations={},this.parseAnimation(this.options.animations),e.autobind_min.autobind(this);}parseAnimation(e){if(!this.parsed)for(let t=0;t<e.length;t++)this.addAnimation(e[t],t);}evaluateActiveAnimations(){const t=Date.now();this.update(t),e.window.requestAnimationFrame(this.evaluateActiveAnimations);}update(e){for(const t in this._animations)this._animations[t].evaluate(e);}play(){this._keyFrame&&(e.window.cancelAnimationFrame(this._keyFrame),this._keyFrame=e.window.requestAnimationFrame(this.evaluateActiveAnimations));}stop(){e.window.cancelAnimationFrame(this._keyFrame);}closeAnimationById(e){this._animations[e]&&this._animations[e].close();}addAnimation(t,i){const r=t.input,o=t.output,s=t.target.path,n=t.interpolation;let a;const l=`${t.target.node}`,c=`animation-${i}-${this.options.nodes[l].properties.name}`,h="HAD"===t.type?this.options.nodes[l].matrix:null;return 1===r.length&&1===o.length?a=new he({id:c,controlPoint:o[0],node:l}):"LINEAR"!==n&&"STEP"!==n||("translation"===s||"scale"===s?a=new ue({id:c,times:r,points:Array.from(o),node:l,interpolation:n,path:s,originNodeMatrix:h}):"rotation"===s?a=new de({id:c,times:r,points:Array.from(o),node:l,interpolation:n,path:s,originNodeMatrix:h}):"weights"===s&&(a=new _e({id:c,times:r,weights:Array.from(o),node:l,interpolation:n,path:s}))),e.defined(a)&&(this._animations[c]=a),c}removeAnimationById(e){this._animations[e]&&(this._animations[e].stop(),delete this._animations[e]);}removeAll(){for(const e in this._animations)this.removeAnimationById(e);}getMorphAnimation(){for(const e in this._animations){const t=this._animations[e];if("weights"===t.path)return t}return null}applyAnimationByNodeId(t){const i=[],r=[];for(const e in this._animations){const o=this._animations[e];o.closed||t!==o.nodeId||("weights"!==o.path?i.push(o):r.push(o));}i.sort(((e,t)=>{const i=e.path;return "translation"===i?-1:"rotation"===i?"scale"===t.path?-1:1:"scale"===i?1:void 0}));const o={};if(i.length>0)if(1===i.length)o.anim=i[0].value;else {const t=new e.Matrix4;for(let e=0;e<i.length;e++)t.multiplyRight(i[e].value);o.anim=t;}return r.length>0&&(o.weights=r[0].value),o}}const fe={nextPowerOfTwo(e){if("number"!=typeof e||e<0||e>2147483648)throw "A number between 0 and 2^31 is required.";return --e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},generateImage(e){const t=document.createElement("canvas");return t.width=fe.nextPowerOfTwo(e.width),t.height=fe.nextPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t},isPowerOfTwo(e){if("number"!=typeof e||e<0||e>4294967295)throw "A number between 0 and (2^32)-1 is required.";return 0!==e&&0==(e&e-1)}};class pe{constructor(e){const{gltf:t,context:i,bufferData:r,source:o,glTFTile:s,filter:n,needTriangle:a,isModelSource:l}=e;this.gltf=t,this.context=i,this.bufferData=r,this.source=o,this.glTFTile=s,this.isModelSource=l,this.filter=n,this.primitiveInd=0,this.primitiveDataInd=0,this.vbuffer={},this.ibuffer={},this.nodeInd=void 0,this.needTriangle=a,this.requestingImageCount=0,this.imageRequestQueueArray=[],this.textureRequestObject={},this.__totalTextureCount=0,this.__beenRequestedTextureCount=0,this.u_HAS_NORMALS=!1,this.u_HAS_TANGENTS=!1,this.u_HAS_VERTEX_COLOR=!1,this.nodeCount=0;}processGLTF(){const{isModelSource:e,glTFTile:t,source:i,gltf:r}=this;this.sceneName=r.scene?r.scene.id:"scene-0";const o=e?i:t;r.scenes.forEach(((e,t)=>{this.processScene(t);})),this._requestAllIndexTextures(),r.materials?r.materials.forEach(((e,t)=>{this.processMaterial(t);})):o.materials=[{pbrMetallicRoughness:{baseColorFactor:[1,1,1,1],metallicFactor:.5,roughnessFactor:.5}}],this.processAnimation(),r.skins&&(o.skins=r.skins.map((e=>{let t;for(let i=0;i<r.nodes.length;i++){const o=r.nodes[i];if(o.skin===e){t=o.id.slice(5);break}}return {id:e.id,inverseBindMatrices:e.inverseBindMatrices.value,joints:e.joints,name:e.name,skeleton:e.skeleton,count:e.joints.length,meshInd:t}}))),r.asset.range&&(o.range=r.asset.range);}processAnimation(){const{isModelSource:t,glTFTile:i,source:r,gltf:o}=this,s=t?r:i;if(o.animations&&0!==o.animations.length){e.defined(s.animationMixers)||(s.animationMixers=[]);for(let e=0;o.animations&&e<o.animations.length;e++){const t=[],i=o.animations[e];for(let e=0;e<i.channels.length;e++){const r=i.channels[e],n=i.samplers[r.sampler],a=o.accessors[n.input];let l=null;r.extras&&r.extras.type&&(l=r.extras.type),t.push({count:a.count,input:a.value,output:o.accessors[n.output].value,target:r.target,interpolation:n.interpolation,type:l}),"weights"!==r.target.path||s.morphSetting||(s.morphSetting={normal:o.nodes[r.target.node]&&o.nodes[r.target.node].mesh.primitives[0]&&o.nodes[r.target.node].mesh.primitives[0].targets[0].NORMAL,tangent:o.nodes[r.target.node]&&o.nodes[r.target.node].mesh.primitives[0]&&o.nodes[r.target.node].mesh.primitives[0].targets[0].TANGENT});}const r=new me({animations:t,nodes:s.nodes});s.animationMixers.push(r);}}}processScene(t){const{isModelSource:i,glTFTile:r,source:o,gltf:s}=this,n=i?o:r,a=s.scenes[t];a.nodes.forEach((t=>{const i=e.createFloat64ArrayIdentityMatrix();this.processNode({node:t,parentMatrix:i,pIdentityMatrix:!0});})),e.defined(s.animations)&&s.animations.length>0&&(!e.defined(s.skins)||0===s.skins.length)&&(n.nodeStructure=this._makeAnimationNodeStructure(a.nodes));}_makeAnimationNodeStructure(t){const{isModelSource:i,glTFTile:r,source:o}=this,s=i?o:r;return t.map((t=>{const i=t.id.slice(5),r=s.nodes[i];let o;return r||(s.nodes[i]={},o={nodeInd:i,localMatrix:e.createFloat64ArrayIdentityMatrix(),parentId:null,matrix:e.createFloat64ArrayIdentityMatrix()}),o={nodeInd:i,localMatrix:r.localMatrix,parentId:r.parentId,matrix:r.matrix},e.defined(t.children)&&(o.children=this._makeAnimationNodeStructure(t.children)),o}))}processNode(t){const{node:i,parentMatrix:r,pIdentityMatrix:o,fatherName:s,parentId:n}=t,a=i.id,l=a.slice(5),{isModelSource:c,glTFTile:h,source:u,filter:d}=this,_=c?u:h;if(_.nodes&&_.nodes.hasOwnProperty(l))return;this.nodeInd=l,_.nodes[l]={};let m,f=!0;i.matrix?(f=!1,i.matrix instanceof e.Matrix4||(i.matrix=new e.Matrix4(i.matrix)),m=i.matrix.clone()):m=new e.Matrix4,!i.translation||0===i.translation[0]&&0===i.translation[1]&&0===i.translation[2]||(m.translate(i.translation),f=!1),i.rotation&&(4===i.rotation.length?(f=!1,m.multiplyRight((new e.Matrix4).fromQuaternion(i.rotation))):(i.rotation[0]&&(f=!1,m.rotateX(i.rotation[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD)),i.rotation[1]&&(f=!1,m.rotateY(i.rotation[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD)),i.rotation[2]&&(f=!1,m.rotateZ(i.rotation[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD)))),!i.scale||1===i.scale[0]&&1===i.scale[1]&&1===i.scale[2]||(m.scale(i.scale),f=!1);let p=e.createFloat64ArrayIdentityMatrix();if((!f||!o&&r)&&(f=!1,p=m.clone(),m.multiplyLeft(r)),i.hasOwnProperty("mesh")){const t=i.name||`${a}`,r=i.extras;let o,c=[];if(d&&!d(new e.EvaluationParameters(17),{properties:{name:t}}))return;i.location&&(c=i.location),i.skin&&(o={id:i.skin.id,inverseBindMatrices:i.skin.inverseBindMatrices.value,count:i.skin.inverseBindMatrices.count,joints:i.skin.joints,name:i.skin.name,skeleton:i.skin.skeleton}),_.nodes[l]=Object.assign({},{nodeInd:l,meshInd:i.mesh,mesh:i.mesh,matrix:m,location:c,identityMatrix:f,skin:o,properties:{name:i.name||`${a}`,sceneName:this.sceneName,fatherName:s,flowTexture:i.flowTexture||!1,flowDirectionWrapT:i.flowDirectionWrapT||!1},userNodeData:r,localMatrix:p,parentId:n}),i.children&&i.children.length>0&&(_.nodes[l].children=i.children.map(((e,t)=>e.id.slice(5)))),this.processMesh(i.mesh);}else _.nodes[l]=Object.assign({},i.children&&i.children.length>0?{hasChild:!0,nodeInd:l,children:i.children.map(((e,t)=>e.id.slice(5))),properties:{name:i.name||`${a}`,sceneName:this.sceneName,fatherName:s},localMatrix:p,parentId:n,matrix:m}:{nodeInd:l,properties:{name:i.name||`${a}`,sceneName:this.sceneName,fatherName:s},localMatrix:p,parentId:n,matrix:m});i.children&&i.children.length>0&&i.children.forEach((e=>{this.processNode({node:e,parentMatrix:m,pIdentityMatrix:f,fatherName:i.name,parentId:l});}));}checkNormalAndTanget(e,t,i,r){const o=e.meshes[t].primitives[i].attributes;for(const e in o){const t=e.toUpperCase();-1!==t.indexOf("NORMAL")&&(r.u_HAS_NORMALS=!0),-1!==t.indexOf("TANGENT")&&(r.u_HAS_TANGENTS=!0),-1!==t.indexOf("COLOR_0")&&(r.u_HAS_VERTEX_COLOR=!0);}}processMesh(t){const{isModelSource:i,glTFTile:r,source:o,gltf:s,context:n,bufferData:a,vbuffer:l,ibuffer:c}=this,h=i?o:r;let u=0;for(let e=0;e<s.meshes.length;e++)if(t===s.meshes[e]){u=e;break}if(!h.meshes[u]){const i={primitivesInd:[],properties:{meshName:t.name||t.id||""}};let o;if(t.primitives&&t.primitives.length>0)for(let d=0;d<t.primitives.length;d++){const _={},m=!!(t.primitives[d].targets&&t.primitives[d].targets.length>0),g=!(!r||"i3dm"!==r.minemap3DType),v={u_HAS_TANGENTS:!1,u_HAS_NORMALS:!1,u_HAS_VERTEX_COLOR:!1};this.checkNormalAndTanget(s,u,d,v);const x=le(s,u,d,_,m,g);let y;const T=!!t.primitives[d].hasOwnProperty("indices");T&&(y=t.primitives[d].indices),t.name&&!t.primitives[d].name&&(t.primitives[d].name=`${t.name}-primitive-${d}`);const S=t.primitives[d].attributes,b=t.primitives[d].mode,w=t.primitives[d].attributes.POSITION||t.primitives[d].attributes.CENTEROFFSETS,E=t.primitives[d].material||0;w.min||(t.primitives[d].boundingBox?(w.min=t.primitives[d].boundingBox.min,w.max=t.primitives[d].boundingBox.max):(w.min=[0,0,0],w.max=[1e4,1e4,1e4]));const M=[w.min.concat(1),w.max.concat(1)];i.primitivesInd.push(this.primitiveInd);const A=null!=w.bufferView?w.bufferView.id:w.bufferViewId;_.VB&&(_.VB.byteOffset=w&&w.byteOffset||0);const C=!l[A+x.key],R=t.primitives[d].targets;if(C&&R&&R.length>0&&R.forEach(((e,t)=>{const i=e;for(const e in i)S[`${e}_${t+1}`]=s.accessors[i[e]];})),g&&(new Float32Array(w.bufferView.data.buffer),S.InstanceMatrix4={instances:r.instances,count:r?r.instances.length:0,type:"instance",center:r.relativeCenter}),o=new p(n,C?S:null,x.members,!1,l[A+x.key],"gltf"),C&&(l[A+x.key]=o.getBuffers()),T){const i=null!=y.bufferView?y.bufferView:{};i&&!i.hasOwnProperty("byteOffset")&&(i.byteOffset=0),i&&void 0===i.id&&(i.id=`bufferView-${u}_${d}`);const s=null!=y.bufferView?y.bufferView.data:y.value,l=y.byteOffset?y.byteOffset:0,p=y.componentType,x=y.count;let T;_.IB={byteStride:2,count:x,type:p,value:y.value},c[i.id]?T=new f(n,null,p,!1,c[i.id]):(T=new f(n,s,p,!1),c[i.id]=T.getBuffer());const S=null!=i.buffer?i.buffer:y.value.buffer;h.primitives[this.primitiveInd]={primitiveInd:this.primitiveInd,gltfVertexBuffer:o,gltfIndexBuffer:T,material:E,aabb:M,mode:void 0===b?n.gl.TRIANGLES:b,offset:l,count:x,intersectOptions:{verticesBufView:null!=w.bufferView?w.bufferView:w.value,bufferDataConfig:_,triangleData:[],placedTriangleData:[]},properties:{primitiveName:t.primitives[d].name||`PrimitiveID${this.primitiveInd}`},isMorphModel:m,u_HAS_NORMALS:v.u_HAS_NORMALS,u_HAS_TANGENTS:v.u_HAS_TANGENTS,u_HAS_VERTEX_COLOR:v.u_HAS_VERTEX_COLOR,triangleData:this.needTriangle?e.readArrayToTriangleFloatArray(a[S],_):void 0,isInstance:g,instancesCount:r?r.instances.length:0};}else h.primitives[this.primitiveInd]={primitiveInd:this.primitiveInd,gltfVertexBuffer:o,material:E,aabb:M,mode:void 0===b?n.gl.TRIANGLES:b,offset:0,count:t.primitives[d].attributes.POSITION.count,intersectOptions:{verticesBufView:null!=w.bufferView?w.bufferView:w.value,bufferDataConfig:_,triangleData:[],placedTriangleData:[]},properties:{primitiveName:t.primitives[d].name||`PrimitiveID${this.primitiveInd}`},isMorphModel:m,u_HAS_NORMALS:v.u_HAS_NORMALS,u_HAS_TANGENTS:v.u_HAS_TANGENTS,u_HAS_VERTEX_COLOR:v.u_HAS_VERTEX_COLOR,isInstance:g,instancesCount:r?r.instances.length:0};this.primitiveInd++,this.primitiveDataInd++;}h.meshes[u]=i;}const d=h.meshes[u];d&&(Array.isArray(h.nodes[this.nodeInd].primitiveStack)||(h.nodes[this.nodeInd].primitiveStack=[]),d.primitivesInd.forEach((e=>{const t={primitiveDataInd:this.primitiveDataInd++,placedTriangleData:[],primitiveInd:e};h.nodes[this.nodeInd].primitiveStack.push(t);})));}_requestAllIndexTextures(){const{gltf:e}=this,t=e.textures;if(t)for(let e=0;e<t.length;e++)this._delegateTextureReq(e);}isUrl(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"==t||"/"==i}_delegateTextureReq(t){const{isModelSource:i,glTFTile:r,source:o,gltf:s,context:n}=this,a=i?o:r,l=n.gl,c=s.textures;if(!a.textures[t]){let r=!1;if(s.extensionsRequired&&(r=!!s.extensionsRequired.filter((e=>e.indexOf("webp")>-1)).length),r);else {const r=c[t].source,o=this._parseSampler(c[t].sampler);let s=r.image,h="";if(r.uri&&this.isUrl(r.uri)&&(h=r.uri.substring(r.uri.lastIndexOf("/")+1)),e.CompressedTextureUtil.isCompressedFormat(s)){const{format:i}=s[0],r=e.TextureManager.getTexture(h,n,s,i,{compressed:!0,useMipmap:!1});r.bind(o.magFilter,o.wrapS),a.textures[t]=r;}else {const c=i?a.useMipmap:a.source.useMipmap,u=i?a.log:a.source.log;if(s&&s.width&&c){const e=!fe.isPowerOfTwo(s.width)||!fe.isPowerOfTwo(s.height);s=e?fe.generateImage(s):s,e&&u&&console.warn(`The model texture 【${r.name?r.name:r.id}】 does not exist to the nth power of 2!`);}const d=e.TextureManager.getTexture(h,n,s,r.mimeType&&-1!==r.mimeType.indexOf("jpeg")?l.RGB:l.RGBA,{useMipmap:c});d.bind(o.magFilter,!0===c?l.REPEAT:o.wrapS),a.textures[t]=d;}}}}_parseSampler(t){return {wrapS:t.wrapS||e.CONSTS.TEXTUREWRAP.REPEAT,wrapT:t.wrapT||e.CONSTS.TEXTUREWRAP.REPEAT,magFilter:t.magFilter||e.CONSTS.TEXTUREMAGNIFICATIONFILTER.LINEAR,minFilter:t.minFilter||e.CONSTS.TEXTUREMINNIFICATIONFILTER.LINEAR}}processMaterial(e){const{isModelSource:t,glTFTile:i,source:r,gltf:o}=this,s=t?r:i;if(o.materials){if(!s.materials[e]){const t=o.materials[e],i={pbrMetallicRoughness:Object.assign({},t.pbrMetallicRoughness),normalTexture:t.normalTexture,occlusionTexture:t.occlusionTexture,emissiveFactor:t.emissiveFactor,emissiveTexture:t.emissiveTexture,alphaMode:t.alphaMode||"OPAQUE",doubleSided:t.doubleSided||!1,materialParams:null,sampler:0,id:t.id,name:t.name};o.textures&&o.textures.length&&(i.sampler=o.textures[t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture?t.pbrMetallicRoughness.baseColorTexture.index:0].sampler),t.materialParams&&(i.materialParams=t.materialParams),s.materials[e]=i;}}else s.state="loaded";}imgQueueProcess(t){const{isModelSource:i,glTFTile:r,source:o}=this,s=i?o:r;if(t&&this.imageRequestQueueArray.push(t),this.requestingImageCount<e.CONSTS.SOURCE.MAX_IMAGE_CONCURRENCY&&this.imageRequestQueueArray.length){const e=this.imageRequestQueueArray[0];this.imageRequestQueueArray.splice(0,1),this.requestingImageCount++,e&&e.uri&&this.requestImage(e),e&&e.imageArrayBuffer&&this.loadArrayBufferImage(e);}this.__beenRequestedTextureCount===this.gltf.textures.length&&(s.state="loaded",this.textureRequestObject={});}requestImage(t){const{index:i}=t,{isModelSource:r,glTFTile:o,source:s,context:n,gltf:a}=this,{gl:l}=n,c=r?s:o;let h=`${c.modelFolder}/${t.uri}`;r||(h=c.modelType===e.CONSTS.MODEL_TYPE.OSGB?`${c.modelFolder}/${c._getGltfFolder(a.nodes[0].name,s)}/${t.uri}`:`${c.modelFolder}/${t.uri}`);const u=e.exported.resolveURL(h);if(this.textureRequestObject[u])return this.textureRequestObject[u].indexes.push(i),this.requestingImageCount--,void this.imgQueueProcess();this.textureRequestObject[u]||(this.textureRequestObject[u]={indexes:[i]}),e.getImage({url:u},((i,r)=>{const o=this.textureRequestObject[u].indexes;if(this.__beenRequestedTextureCount+=o.length,this.requestingImageCount--,i)c.fire(new e.ErrorEvent(i));else if(r){const i=new e.Texture(n,r,l.RGBA,{useMipmap:c.useMipMap,TexUrl:t.uri});i.bind(l.LINEAR,l.CLAMP_TO_EDGE);for(let e=0;e<o.length;e++)c.textures[o[e]]=i;c.fire(new e.Event("data",{data:"texture"}));}this.imgQueueProcess();}));}loadArrayBufferImage(t){const{isModelSource:i,glTFTile:r,source:o,context:s,gltf:n}=this,{gl:a}=s,l=i?o:r,c=new e.window.Image,h=e.window.URL||e.window.webkitURL;if(c.onload=()=>{const i=new e.Texture(s,c,a.RGBA,{useMipmap:l.useMipMap});i.bind(a.LINEAR,a.CLAMP_TO_EDGE),l.textures[t.index]=i,l.fire(new e.Event("data",{data:"texture"})),h.revokeObjectURL(c.src),this.requestingImageCount--,this.__beenRequestedTextureCount++,this.imgQueueProcess();},!n.images[t.index])return;const u=new e.window.Blob([new Uint8Array(t.imageArrayBuffer)],{type:n.images[t.index].mimeType});c.src=t.imageArrayBuffer.length?h.createObjectURL(u):e.CONSTS.SOURCE.TRANSPARENT_PNG_URL;}}class ge{constructor(t){const{tileID:i,modelFolder:r,modelType:o,noHighlighting:s,boundingVolume:n,minemap3DType:a,instances:l,normalRight:c,normalUp:h,relativeCenter:u}=t;this.tileID=i,this.uid=e.uniqueId(),this.uses=0,this.expirationTime=null,this.queryPadding=0,this.boundingVolume=n,this.expiredRequestCount=0,this.state="loading",this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this._materials=[],this.result={},this.content={},this.modelFolder=r,this.modelType=o||e.CONSTS.MODEL_TYPE.OSGB,this.identityMatrix=!0,this.noHighlighting=s||!1,this.finishedImages=0,this.requestImages=0,this.tileType="tiles",this.cartographicOrigin=[],this.modelMatrix=[],this.childTiles=[],this.minemap3DType=a,this.instances=l,this.normalRight=c,this.normalUp=h,this.relativeCenter=u,this.useTextureMatrix=!1;}set materials(e){this._materials=e;}get materials(){return this._materials}registerFadeDuration(e){}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e){this.result=e.gltf,this.content=e.content||e,this.cartographicOrigin=e.cartographicOrigin,this.modelMatrix=e.modelMatrix,this.cartesianModelMatrix=e.cartesianModelMatrix,this.state="data-down-finished";}unloadVectorData(){for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++){const i=this.primitives[t.primitiveStack[e].primitiveInd];i.gltfIndexBuffer&&i.gltfIndexBuffer.destroy(),i.gltfVertexBuffer.destroy();}}this.uploaded=!1;for(let t=0;t<this.textures.length;t++){const i=this.textures[t].name;""==i?this.textures[t].destroy():e.TextureManager.freeTexture(i);}this.content=null,this.nodes=[],this.meshes=[],this.primitives=[],this.matrix=null,this.result=null,this.gltfParser=null,this.state="unloaded",this._materials=[],this.boundingVolume=null,this.materials=[];}upload(e,t){this._processGLBuffers(this.result,e,t);}_processGLBuffers(e,t,i){if("data-down-finished"!==this.state)throw new Error(`${this.state},Illegal parsing`);if(this.source=i,!e||"data-down-finished"!==this.state)return;const r=e;this.samplers=r.samplers||[{magFilter:9729,minFilter:9986,wrapS:t.gl.CLAMP_TO_EDGE,wrapT:10497}],this.checkTextureMatrix(r),this.gltfParser=new pe({gltf:r,context:t,glTFTile:this,filter:null,needTriangle:!1,isModelSource:!1}),this.state="parsing",this.gltfParser.processGLTF(),this.result={},this.content={};}_getGltfFolder(e){const t=e.split(/(\\|\/)/g);for(let e=0;e<t.length;e++)for(const i in this.source.tileJson.chd){const r=i.substring(0,i.lastIndexOf("~00"));if(t[e]===r)return r}return this.tileID.split("~")[0]}fire(e){this.source.fire(e);}queryRenderedFeatures(t,i,r,o,s,n){const a=[];let l,c=[],h=1/0;const u=this.nodes;for(let t=0;t<u.length;t++){const i=u[t];let r=i?i.meshInd:null;if(!r||!r.id)continue;r=r.id.match(/\d+/g);const o=this.meshes[r];if(i.primitiveStack)for(let t=0;t<o.primitivesInd.length;t++){const r=this.primitives[o.primitivesInd[t]],u=e.calcNodeBBox({source:n._source,tile:this,node:i,inputData:r.aabb});for(let o=0;o<u.length;o++)if(s.intersectTriangle(...u[o],!1,[])){const o=e.readArrayToTriangleFloatArrayCesium(r.intersectOptions);let u=e.calcPrimitivePositionOfWorld({source:n._source,tile:this,inputData:o});for(let o=0;o<u.length;o++){const n=s.intersectTriangle(...u[o],!1,[]);if(n){const o=new e.Vector3(s.origin).distance(n);o<h&&(c=n,h=o,a[0]=this.meshes[t],l=i.properties,l.mesh=i.mesh,l.primitiveName=r.properties.primitiveName);}}u=null;}}}return a[0]?[{_parent:this,properties:l,intersectionPoint:c,intersectionZ:h}]:a}highlightMesh(e){if(this.clearPick(),!this.noHighlighting&&e)for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++)t.primitiveStack[e].highlight=!0;}}clearPick(){for(let e=0;e<this.meshes.length;e++)this.meshes[e].highlight=!1;}querySourceFeatures(){}clearMask(){}setMask(e,t){}hasData(){return "loaded"===this.state||"reloading"===this.state||"expired"===this.state}setExpiryData(e){}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){}setCenter(e){this._center=[e[0],e[1],e[2]||0],this.location=this._center;}getCenter(){return this._center}setTranslation(e){this._translation=e;}getTranslation(){return this._translation}setScale(e){this._scale=e;}getScale(){return this._scale}setRotation(e){this._rotation=e;}getRotation(){return this._rotation}checkTextureMatrix(e){this.useTextureMatrix=!!e?.meshes[0]?.primitives[0]?.attributes?._TEXTURE_TRANSFORM_1;}}function ve(e,t,i){if(e.byteLength<=t+i)return "";const r=new DataView(e);let o="";for(let e=0;e<i;e++)o+=String.fromCharCode(r.getUint8(t+e));return o}function xe(e,t){return e+(t-1)&~(t-1)}function ye(t,i,r){return e.sliceArrayBuffer(t,i,r)}function Te(e,t,i){let r;return r=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer||e.arrayBuffer,e.byteOffset,e.byteLength),t.set(r,i),i+xe(r.byteLength,4)}function Se(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(0,t):""}function be(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function we(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6;}else e=Date.now();return e}class Ee{constructor(e,t){be(this,"name",void 0),be(this,"type",void 0),be(this,"sampleSize",1),be(this,"time",void 0),be(this,"count",void 0),be(this,"samples",void 0),be(this,"lastTiming",void 0),be(this,"lastSampleTime",void 0),be(this,"lastSampleCount",void 0),be(this,"_count",0),be(this,"_time",0),be(this,"_samples",0),be(this,"_startTime",0),be(this,"_timerPending",!1),this.name=e,this.type=t,this.reset();}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=we(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(we()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0);}}class Me{constructor(e){be(this,"id",void 0),be(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this);}get(e){return this._getOrCreate({name:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t]);}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0};})),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((e=>this._getOrCreate(e)));}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:i}=e;return this.stats[t]||(this.stats[t]=e instanceof Ee?e:new Ee(t,i)),this.stats[t]}}const Ae={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Ce{constructor(e={}){this.props={...Ae,...e},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new Me({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null;}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,getPriority:t},r=new Promise((e=>(i.resolve=e,i)));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:t,resolve:i}=e;let r=!1;const o=()=>{r||(r=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests());};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0));}_issueNewRequestsAsync(){this._deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t)if(this.requestQueue.length>0){const e=this.requestQueue.shift();this._issueRequest(e);}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--);}e.sort(((e,t)=>e.priority-t.priority));}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0&&(e.resolve(null),1))}}function Re(e){if(!e||!e.POSITION)return null;let t=1/0,i=1/0,r=1/0,o=-1/0,s=-1/0,n=-1/0;const a=e.POSITION.value,l=a&&a.length;if(!l)return null;for(let e=0;e<l;e+=3){const l=a[e],c=a[e+1],h=a[e+2];t=l<t?l:t,i=c<i?c:i,r=h<r?h:r,o=l>o?l:o,s=c>s?c:s,n=h>n?h:n;}return [[t,i,r],[o,s,n]]}class Le{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;}bind(e,t,i,r,o,s,n,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===o&&this.boundVertexOffset===s&&this.boundDynamicVertexBuffer===n&&this.boundDynamicVertexBuffer2===a?(e.bindVertexArrayOES.set(this.vao),n&&n.bind(),o&&o.dynamicDraw&&o.bind(),a&&a.bind()):this.freshBind(t,i,r,o,s,n,a);}freshBind(e,t,i,r,o,s,n){let a;const l=e.numAttributes,c=this.context,h=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=o,this.boundDynamicVertexBuffer=s,this.boundDynamicVertexBuffer2=n;else {a=c.currentNumAttributes||0;for(let e=l;e<a;e++)h.disableVertexAttribArray(e);}t.enableAttributes(h,e);for(const t of i)t.enableAttributes(h,e);s&&s.enableAttributes(h,e),n&&n.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,o);for(const t of i)t.bind(),t.setVertexAttribPointers(h,e,o);s&&(s.bind(),s.setVertexAttribPointers(h,e,o)),r&&r.bind(),n&&(n.bind(),n.setVertexAttribPointers(h,e,o)),c.currentNumAttributes=l;}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);}remove(){this.destroy(),this.context=null,this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=null,this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.boundDynamicVertexBuffer2=null;}}const Pe="KHR_binary_glTF",Ie="KHR_draco_mesh_compression",Oe="KHR_lights_punctual",De="KHR_materials_unlit",Ne="KHR_techniques_webgl";let Fe;const Be=["","WEBKIT_","MOZ_"],Ue={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ze=null;const Ge={etc1:{basisFormat:0,compressed:!0},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:e.GL.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:e.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0},"astc-4x4":{basisFormat:10,compressed:!0},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Ve(e,t,i,r){const o=e.getImageWidth(t,i),s=e.getImageHeight(t,i),n=e.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=function(e,t){let i=e&&e.basis&&e.basis.format;return "object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),Ge[i]}(r,n),h=e.getImageTranscodedSizeInBytes(t,i,c),u=new Uint8Array(h);return e.transcodeImage(u,t,i,c,0,0)?{width:o,height:s,data:u,compressed:a,hasAlpha:n,format:l}:null}const ke={name:"Basis",id:"basis",module:"textures",version:e.VERSION,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(t,i){const{BasisFile:r}=await async function(t){const i=t.modules||{};return i.basis?i.basis:(Fe=Fe||async function(t){let i=null,r=null;return [i,r]=await Promise.all([await e.loadLibrary("basis_transcoder.js","textures",t),await e.loadLibrary("basis_transcoder.wasm","textures",t)]),i=i||globalThis.BASIS,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{const{BasisFile:i,initializeBasis:r}=e;r(),t({BasisFile:i});}));}))}(i,r)}(t),await Fe)}(i),o=new r(new Uint8Array(t));try{if(!o.startTranscoding())return null;const e=o.getNumImages(),t=[];for(let r=0;r<e;r++){const e=o.getNumLevels(r),s=[];for(let t=0;t<e;t++)s.push(Ve(o,r,t,i));t.push(s);}return t}finally{o.close(),o.delete();}}},He={131:e.GL.COMPRESSED_RGB_S3TC_DXT1_EXT,132:e.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:e.GL.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:e.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:e.GL.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:e.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:e.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:e.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:e.GL.COMPRESSED_RED_RGTC1_EXT,140:e.GL.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:e.GL.COMPRESSED_RED_GREEN_RGTC2_EXT,142:e.GL.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:e.GL.COMPRESSED_RGB8_ETC2,148:e.GL.COMPRESSED_SRGB8_ETC2,149:e.GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:e.GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:e.GL.COMPRESSED_RGBA8_ETC2_EAC,152:e.GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:e.GL.COMPRESSED_R11_EAC,154:e.GL.COMPRESSED_SIGNED_R11_EAC,155:e.GL.COMPRESSED_RG11_EAC,156:e.GL.COMPRESSED_SIGNED_RG11_EAC,157:e.GL.COMPRESSED_RGBA_ASTC_4x4_KHR,158:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:e.GL.COMPRESSED_RGBA_ASTC_5x4_KHR,160:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:e.GL.COMPRESSED_RGBA_ASTC_5x5_KHR,162:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:e.GL.COMPRESSED_RGBA_ASTC_6x5_KHR,164:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:e.GL.COMPRESSED_RGBA_ASTC_6x6_KHR,166:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:e.GL.COMPRESSED_RGBA_ASTC_8x5_KHR,168:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:e.GL.COMPRESSED_RGBA_ASTC_8x6_KHR,170:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:e.GL.COMPRESSED_RGBA_ASTC_8x8_KHR,172:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:e.GL.COMPRESSED_RGBA_ASTC_10x5_KHR,174:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:e.GL.COMPRESSED_RGBA_ASTC_10x6_KHR,176:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:e.GL.COMPRESSED_RGBA_ASTC_10x8_KHR,178:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:e.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,180:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:e.GL.COMPRESSED_RGBA_ASTC_12x10_KHR,182:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:e.GL.COMPRESSED_RGBA_ASTC_12x12_KHR,184:e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:e.GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:e.GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:e.GL.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:e.GL.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:e.GL.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:e.GL.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:e.GL.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:e.GL.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:e.GL.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:e.GL.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:e.GL.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:e.GL.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:e.GL.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:e.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:e.GL.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:e.GL.COMPRESSED_RGBA_ASTC_12x12_KHR},Xe=[171,75,84,88,32,50,48,187,13,10,26,10],je={0:[e.GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[e.GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[e.GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[e.GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[e.GL.COMPRESSED_RGB_ETC1_WEBGL],7:[e.GL.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[e.GL.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[e.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[e.GL.COMPRESSED_RGB8_ETC2],23:[e.GL.COMPRESSED_RGBA8_ETC2_EAC],24:[e.GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[e.GL.COMPRESSED_R11_EAC],26:[e.GL.COMPRESSED_RG11_EAC],27:[e.GL.COMPRESSED_RGBA_ASTC_4X4_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[e.GL.COMPRESSED_RGBA_ASTC_5X4_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[e.GL.COMPRESSED_RGBA_ASTC_5X5_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[e.GL.COMPRESSED_RGBA_ASTC_6X5_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[e.GL.COMPRESSED_RGBA_ASTC_6X6_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[e.GL.COMPRESSED_RGBA_ASTC_8X5_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[e.GL.COMPRESSED_RGBA_ASTC_8X6_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[e.GL.COMPRESSED_RGBA_ASTC_8X8_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[e.GL.COMPRESSED_RGBA_ASTC_10X5_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[e.GL.COMPRESSED_RGBA_ASTC_10X6_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[e.GL.COMPRESSED_RGBA_ASTC_10X8_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[e.GL.COMPRESSED_RGBA_ASTC_10X10_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[e.GL.COMPRESSED_RGBA_ASTC_12X10_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[e.GL.COMPRESSED_RGBA_ASTC_12X12_KHR,e.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},Ye={0:We,1:We,2:qe,3:qe,6:Ze,7:Ze,9:$e,11:$e,22:Ze,23:$e,24:Ze,25:Ze,26:$e,27:$e,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function We(e,t){return (e=Math.max(e,16))*(t=Math.max(t,8))/4}function qe(e,t){return (e=Math.max(e,8))*(t=Math.max(t,8))/2}function Ze(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function $e(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}const Qe={name:"Texture Containers",id:"compressed-texture",module:"textures",version:e.VERSION,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["application/octet-stream","image/vnd-ms.dds","image/ktx","image/ktx2"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/"}},parse:async(t,i)=>function(t){if(function(e){const t=new Uint8Array(e.buffer||e,e.byteOffset||0,Xe.length);return !(t[0]!==Xe[0]||t[1]!==Xe[1]||t[2]!==Xe[2]||t[3]!==Xe[3]||t[4]!==Xe[4]||t[5]!==Xe[5]||t[6]!==Xe[6]||t[7]!==Xe[7]||t[8]!==Xe[8]||t[9]!==Xe[9]||t[10]!==Xe[10]||t[11]!==Xe[11])}(t))return function(t){const i=new Uint8Array(t),r=e.p(i),o=Math.max(1,r.levels.length);return e.extractMipmapImages(r.levels,{mipMapLevels:o,width:r.pixelWidth,height:r.pixelHeight,sizeFunction:e=>e.uncompressedByteLength,internalFormat:He[r.vkFormat]})}(t);if(e.isDDS(t))return e.parseDDS(t);if(function(e){const t=new Uint32Array(e,0,13)[0];return 55727696===t||1347834371===t}(t))return function(t){const i=new Uint32Array(t,0,13),r=i[2],o=je[r]||[],s=o.length>1&&i[4]?o[1]:o[0],n=Ye[r],a=i[11],l=i[7],c=i[6],h=new Uint8Array(t,52+i[12]);return e.extractMipmapImages(h,{mipMapLevels:a,width:l,height:c,sizeFunction:n,internalFormat:s})}(t);throw new Error("Texture container format not recognized")}(t)};function Ke(e,t,i){const r=e.bufferViews[i],o=t[r.buffer];return new Uint8Array(o.arrayBuffer,(r.byteOffset||0)+o.byteOffset,r.byteLength)}let Je;const et={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},tt={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class it{constructor(e){this.draco=e,this.drawMode="TRIANGLE",this.metadataQuerier={};}destroy(){}parseSync(e,t={}){this.metadataQuerier=new this.draco.MetadataQuerier;const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength);const r=new this.draco.Decoder,o={};let s,n,a;try{const e=r.GetEncodedGeometryType(i);switch(e){case this.draco.TRIANGULAR_MESH:n=new this.draco.Mesh,s=r.DecodeBufferToMesh(i,n),a={type:0,faceCount:n.num_faces(),attributeCount:n.num_attributes(),vertexCount:n.num_points()};break;case this.draco.POINT_CLOUD:n=new this.draco.PointCloud,s=r.DecodeBufferToPointCloud(i,n),a={type:1,attributeCount:n.num_attributes(),vertexCount:n.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!s.ok()||!n.ptr){const e=`DRACO decompression failed: ${s.error_msg()}`;throw n&&this.draco.destroy(n),new Error(e)}o.loaderData={header:a},this._extractDRACOGeometry(r,n,e,o,t);const l=this._getGeometryMetadata(r,n);o.header={vertexCount:a.vertexCount,boundingBox:Re(o.attributes),metadata:l};}finally{this.draco.destroy(r),this.draco.destroy(i),this.draco.destroy(n),this.draco.destroy(this.metadataQuerier);}return o}_extractDRACOGeometry(e,t,i,r,o){const s=this._getAttributes(e,t,o);if(!s.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return i===this.draco.TRIANGULAR_MESH?(s.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(e,t):this._getMeshFaceIndices(e,t),r.mode="TRIANGLE_STRIP"===this.drawMode?5:4):r.mode=0,s.indices&&(r.indices={value:s.indices,size:1},delete s.indices),r.attributes=s,r}getPositionAttributeMetadata(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let e=0;e<3;++e)this.metadata.attributes.position.minValues[e]=t.min_value(e);}this.draco.destroy(t);}_getAttributes(e,t,i){const r={},o=t.num_points();for(let s=0;s<t.num_attributes();s++){const n=e.GetAttribute(t,s),a=this._getAttributeMetadata(e,t,s),l={uniqueId:n.unique_id(),attributeType:n.attribute_type(),dataType:tt[n.data_type()],size:n.size(),numComponents:n.num_components(),byteOffset:n.byte_offset(),byteStride:n.byte_stride(),normalized:n.normalized(),metadata:a},c=this._deduceAttributeName(l,i),{typedArray:h}=this._getAttributeTypedArray(e,t,n,c);r[c]={value:h,size:h.length/o,metadata:a};}return r}_getMeshFaceIndices(e,t){const i=3*t.num_faces(),r=4*i,o=this.draco._malloc(r);e.GetTrianglesUInt32Array(t,r,o);const s=new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice();return this.draco._free(o),s}_getMeshStripIndices(e,t){const i=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,i);const r=new Uint32Array(i.size());for(let e=0;e<i.size();++e)r[e]=i.GetValue(e);return this.draco.destroy(i),r}_getAttributeTypedArray(e,t,i,r){if(0===i.ptr)throw new Error(`DRACO decode bad attribute ${r}`);const o=tt[i.data_type()],s=i.num_components(),n=t.num_points()*s,a=n*o.BYTES_PER_ELEMENT,l=this._getDracoDataType(o),c=this.draco._malloc(a);e.GetAttributeDataArrayForAllPoints(t,i,l,a,c);const h=new o(this.draco.HEAPF32.buffer,c,n).slice();return this.draco._free(c),{typedArray:h,components:s}}_getDracoDataType(e){switch(e){case Float32Array:return this.draco.DT_FLOAT32;case Int8Array:return this.draco.DT_INT8;case Int16Array:return this.draco.DT_INT16;case Int32Array:return this.draco.DT_INT32;case Uint8Array:return this.draco.DT_UINT8;case Uint16Array:return this.draco.DT_UINT16;case Uint32Array:return this.draco.DT_UINT32;default:return this.draco.DT_INVALID}}_deduceAttributeName(e,t){const{extraAttributes:i={}}=t;if(i&&"object"==typeof i)for(const[t,r]of Object.entries(i))if(r===e.uniqueId)return t;for(const t in et)if(e.attributeType===this.draco[t])return et[t];if(e.metadata){const i=t.attributeNameEntry||"name";if(e.metadata[i])return e.metadata[i].string}return `CUSTOM_ATTRIBUTE_${e.uniqueId}`}_getGeometryMetadata(e,t){const i=e.GetMetadata(t);return this._queryDracoMetadata(i)}_getAttributeMetadata(e,t,i){const r=e.GetAttributeMetadata(t,i);return this._queryDracoMetadata(r)}_queryDracoMetadata(e){if(!e||!e.ptr)return {};const t={},i=this.metadataQuerier.NumEntries(e),r=new this.draco.DracoInt32Array;for(let o=0;o<i;o++){const i=this.metadataQuerier.GetEntryName(e,o);this.metadataQuerier.GetIntEntryArray(e,i,r);const s=r.size(),n=new Int32Array(s);for(let e=0;e<s;e++)n[e]=r.GetValue(e);t[i]={int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:n};}return this.draco.destroy(r),t}decode(e,t){return this.parseSync(e,t)}}const rt={name:"Draco",id:"draco",module:"draco",version:e.VERSION$1,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{}}},parse:async function(t,i,r,o){const{draco:s}=await async function(t){const i=t.modules||{};return Je=i.draco3d?Je||i.draco3d.createDecoderModule({}).then((e=>({draco:e}))):Je||async function(t){let i,r;return "js"===(t.draco&&t.draco.decoderType)?i=await e.loadLibrary("/draco/versioned/decoders/1.4.1/draco_decoder.js","draco",t):[i,r]=await Promise.all([await e.loadLibrary("/draco/versioned/decoders/1.4.1/draco_wasm_wrapper.js","draco",t),await e.loadLibrary("/draco/versioned/decoders/1.4.1/draco_decoder.wasm","draco",t)]),i=i||globalThis.DracoDecoderModule,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e({...i,onModuleLoaded:e=>t({draco:e})});}))}(i,r)}(t),await Je}(i),n=new it(s);try{return n.parseSync(t,{extraAttributes:i.draco&&i.draco.extraAttributes||null,...i.parseOptions||{}})}finally{n.destroy();}}},ot=["SCALAR","VEC2","VEC3","VEC4"],st=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],nt=new Map(st),at={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ct={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ht(e){return ot[e-1]||ot[0]}function ut(e){const t=nt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function dt(e,t){const i=at[e.type];return {ArrayType:ct[e.componentType],length:e.count*i,byteLength:e.count*i*lt[e.componentType]}}class _t{constructor(e){if(e instanceof _t)return e;e||(e={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},buffers:[]}),this.sourceBuffers=[],this.byteLength=0,e.buffers&&e.buffers[0]&&(this.byteLength=e.buffers[0].byteLength,this.sourceBuffers=[e.buffers[0]]),this.gltf=e;}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return (this.json.extras||{})[e]}getExtension(e){return this.getUsedExtensions().find((t=>t===e))?(this.json.extensions||{})[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find((t=>t===e))?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return (e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getCamera(e){return null}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=this.gltf.buffers[e.buffer];return new Uint8Array(t.arrayBuffer,(e.byteOffset||0)+t.byteOffset,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,{ArrayType:r,length:o}=dt(e);return new r(i,t.byteOffset+e.byteOffset,o)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer);return new Uint8Array(i.data,t.byteOffset||0,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){(e.extensions||{})[t]=i;}removeObjectExtension(e,t){const i=e.extensions||{},r=i[t];return delete i[t],r}addExtension(e,t={}){return this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e);}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e);}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e];}setDefaultScene(e){this.json.scene=e;}addScene({nodeIndices:e}){return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode({meshIndex:e,matrix:t=null}){this.json.nodes=this.json.nodes||[];const i={mesh:e};return t&&(i.matrix=t),this.json.nodes.push(i),this.json.nodes.length-1}addMesh({attributes:e,indices:t,material:i,mode:r=4}){const o={primitives:[{attributes:this._addAttributes(e),mode:r}]};if(t){const e=this._addIndices(t);o.primitives[0].indices=e;}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(t,i){i=i||function(t){const i=e.getBinaryImageMetadata(t);return i?i.mimeType:null}(t);const r={bufferView:this.addBufferView(t),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){const t=e.byteLength;this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=xe(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:ht(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let r={min:t.min,max:t.max};r.min&&r.max||(r=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:ut(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(o,t))}addTexture({imageIndex:e}){const t={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t),r=this.sourceBuffers||[];let o=0;for(let e=0;e<r.length;e++)o=Te(r[e],i,o);this.json.buffers[0]=this.json.buffers[0]||{},this.json.buffers[0].byteLength=e,this.gltf.binary=t,this.sourceBuffers=[t];}_removeStringFromArray(e,t){let i=!0;for(;i;){const r=e.indexOf(t);r>-1?e.splice(r,1):i=!1;}}_addAttributes(e={}){const t={};for(const i in e){const r=e[i],o=this._getGltfAttributeName(i),s=this.addBinaryBuffer(r.value,r);t[o]=s;}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return "POSITION";case"normal":case"normals":return "NORMAL";case"color":case"colors":return "COLOR_0";case"texcoord":case"texcoords":return "TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const r=e.subarray(0,t);for(const e of r)i.min.push(e),i.max.push(e);for(let r=t;r<e.length;r+=t)for(let o=0;o<t;o++)i.min[0+o]=Math.min(i.min[0+o],e[r+o]),i.max[0+o]=Math.max(i.max[0+o],e[r+o]);return i}}function mt(e,t){const{buffer:i,size:r,count:o}=function(e,t){let i=e,r=1,o=0;return e&&e.value&&(i=e.value,r=e.size||1),i&&(ArrayBuffer.isView(i)||(i=function(e,t,i=!1){return e?Array.isArray(e)?new t(e):!i||e instanceof t?e:new t(e):null}(i,Float32Array)),o=i.length/r),{buffer:i,size:r,count:o}}(e);return {value:i,size:r,bufferView:null,byteOffset:0,count:o,type:ht(r),componentType:ut(i)}}async function ft(e,t,i,r){const o=t.getObjectExtension(e,Ie),s=t.getTypedArrayForBufferView(o.bufferView),n=ye(s.buffer,s.byteOffset),{parse:a}=r,l={...i};delete l["3d-tiles"];const c=await a(n,rt,l,r);e.attributes=function(e){const t={};for(const i in e){const r=e[i];if("indices"!==i){const e=mt(r);t[i]=e;}}return t}(c.attributes),e.boundingBox={min:c.header.boundingBox[0],max:c.header.boundingBox[1]},c.indices&&(e.indices=mt(c.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(e);}function pt(e,t,i=4,r,o){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=r.DracoWriter.encodeSync({attributes:e}),{parseSync:n}=o,a=n({attributes:e}),l=r._addFauxAttributes(a.attributes),c=r.addBufferView(s);return {primitives:[{attributes:l,mode:i,extensions:{[Ie]:{bufferView:c,attributes:l}}}]}}var gt=Object.freeze({__proto__:null,decode:async function(e,t,i){if(!t.gltf.decompressMeshes)return;const r=new _t(e),o=[];for(const e of function*(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e;}(r))r.getObjectExtension(e,Ie)&&o.push(ft(e,r,t,i));await Promise.all(o),r.removeExtension(Ie);},encode:function(e,t={}){const i=new _t(e);for(const e of i.json.meshes||[])pt(e),i.addRequiredExtension(Ie);}}),vt=Object.freeze({__proto__:null,decode:function(e,t){const i=new _t(e),{json:r}=i,o=i.getExtension(Oe);o&&(i.json.lights=o.lights,i.removeExtension(Oe));for(const e of r.nodes||[]){const t=i.getObjectExtension(e,Oe);t&&(e.light=t.light),i.removeObjectExtension(e,Oe);}},encode:function(e,t){const i=new _t(e),{json:r}=i;if(r.lights&&(i.addExtension(Oe).lights=r.lights,delete r.lights),i.json.lights){for(const e of i.json.lights)i.addObjectExtension(e.node,Oe,e);delete i.json.lights;}}}),xt=Object.freeze({__proto__:null,decode:function(e,t){const i=new _t(e),{json:r}=i;i.removeExtension(De);for(const e of r.materials||[])e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),i.removeObjectExtension(e,De);},encode:function(e,t){const i=new _t(e),{json:r}=i;if(i.materials)for(const e of r.materials)e.unlit&&(delete e.unlit,i.addObjectExtension(e,De,{}),i.addExtension(De));}});function yt(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in i)&&(i[t]=e.uniforms[t].value);})),Object.keys(i).forEach((e=>{"object"==typeof i[e]&&void 0!==i[e].index&&(i[e].texture=t.getTexture(i[e].index));})),i}var Tt=Object.freeze({__proto__:null,decode:function(e,t){const i=new _t(e),{json:r}=i,o=i.getExtension(Ne);if(o){const e=function({programs:e=[],shaders:t=[],techniques:i=[]},r){const o=new TextDecoder;return t.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=o.decode(r.getTypedArrayForBufferView(e.bufferView));})),e.forEach((e=>{e.fragmentShader=t[e.fragmentShader],e.vertexShader=t[e.vertexShader];})),i.forEach((t=>{t.program=e[t.program];})),i}(o,i);for(const t of r.materials||[]){const r=i.getObjectExtension(t,Ne);r&&(t.technique=Object.assign({},r,e[r.technique]),t.technique.values=yt(t.technique,i)),i.removeObjectExtension(t,Ne);}i.removeExtension(Ne);}},encode:function(e,t){}});const St={KHR_draco_mesh_compression:gt,KHR_lights_punctual:vt,KHR_materials_unlit:xt,KHR_techniques_webgl:Tt},bt={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},wt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Et{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(e,t){const i=new _t(e),{json:r}=i;for(const e of r.images||[]){const t=i.removeObjectExtension(e,Pe);t&&Object.assign(e,t);}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,i.removeExtension(Pe);}(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i),e.buffers=i.buffers,e.images=i.images;}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl";}_convertTopLevelObjectsToArrays(e){for(const t in bt)this._convertTopLevelObjectToArray(e,t);}_convertTopLevelObjectToArray(e,t){const i=e[t];if(i&&!Array.isArray(i)){e[t]=[];for(const r in i){const o=i[r];o.id=o.id||r;const s=e[t].length;e[t].push(o),this.idToIndexMap[t][r]=s;}}}_convertObjectIdsToArrayIndices(e){for(const t in bt)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t);}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"));}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:i,material:r}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"));}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))));}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))));}_convertIdsToIndices(e,t){e[t]||(e[t]=[]);for(const i of e[t])for(const e in i){const t=this._convertIdToIndex(i[e],e);i[e]=t;}}_convertIdToIndex(e,t){const i=wt[t];if(i in this.idToIndexMap){const r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return r}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type;}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=t.values&&t.values.tex,r=e.textures.findIndex((e=>e.id===i));-1!==r&&(t.pbrMetallicRoughness.baseColorTexture={index:r});}}}const Mt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},At={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ct={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Rt={magFilter:Ct.TEXTURE_MAG_FILTER,minFilter:Ct.TEXTURE_MIN_FILTER,wrapS:Ct.TEXTURE_WRAP_S,wrapT:Ct.TEXTURE_WRAP_T},Lt={[Ct.TEXTURE_MAG_FILTER]:Ct.LINEAR,[Ct.TEXTURE_MIN_FILTER]:Ct.NEAREST_MIPMAP_LINEAR,[Ct.TEXTURE_WRAP_S]:Ct.REPEAT,[Ct.TEXTURE_WRAP_]:Ct.REPEAT};class Pt{postProcess(e,t={}){const{json:i,buffers:r=[],images:o=[],baseUri:s=""}=e;return this.baseUri=s,this.json=i,this.buffers=r,this.images=o,this.json.textureByteSize=e.textureByteSize,this._resolveTree(this.json,t),this.json}_resolveTree(e,t={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(e.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(e.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(e.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(e.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(e.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(e.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(e.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t)))),e.skins&&(e.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(e.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene]);}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return "object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){return e.id=e.id||`node-${t}`,e.children&&(e.children=e.children.map((e=>this.getNode(e)))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce(((e,t)=>{const i=this.getMesh(t);return e.id=i.id,e.primitives=e.primitives.concat(i.primitives),e}),{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||`skin-${t}`,e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||`mesh-${t}`,e.primitives&&(e.primitives=e.primitives.map((e=>{const t=(e={...e}).attributes;e.attributes={};for(const i in t)e.attributes[i]=this.getAccessor(t[i]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e}))),e}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index));}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=At[e.componentType],e.components=Mt[e.type],e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:i,byteLength:r}=dt(e),o=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset,s=t.arrayBuffer.slice(o,o+r);e.value=new i(s);}return e}_resolveTexture(e,t){return e.id=e.id||`texture-${t}`,e.sampler="sampler"in e?this.getSampler(e.sampler):Lt,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const t in e){const i=this._enumSamplerParameter(t);void 0!==i&&(e.parameters[i]=e[t]);}return e}_enumSamplerParameter(e){return Rt[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[t];return i&&(e.image=i),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;const i=e.buffer;e.buffer=this.buffers[i];let r=this.buffers[i].byteOffset||0;return "byteOffset"in e&&(r+=e.byteOffset),e.data=new Uint8Array(this.buffers[i].arrayBuffer,r,e.byteLength),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e}}function It(e,t){return (new Pt).postProcess(e,t)}const Ot=1735152710,Dt=!0;function Nt(e,t,i,r,o){const s=new Uint8Array(t.buffer,i,r),n=new TextDecoder("utf8").decode(s);return e.json=JSON.parse(n),xe(r,4)}function Ft(e,t,i,r,o){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:r,arrayBuffer:t.buffer}),xe(r,4)}const Bt={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635};var Ut={ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,RGB_DXT1:33776,RGBA_DXT1:33777,RGBA_DXT3:33778,RGBA_DXT5:33779,RGB_PVRTC_4BPPV1:35840,RGB_PVRTC_2BPPV1:35841,RGBA_PVRTC_4BPPV1:35842,RGBA_PVRTC_2BPPV1:35843,RGB_ETC1:36196,isCompressedFormat:function(e){let t;return t=Array.isArray(e)&&e.length>0?e[0].format:e.format||"",t===Ut.RGB_DXT1||t===Ut.RGBA_DXT1||t===Ut.RGBA_DXT3||t===Ut.RGBA_DXT5||t===Ut.RGB_PVRTC_4BPPV1||t===Ut.RGB_PVRTC_2BPPV1||t===Ut.RGBA_PVRTC_4BPPV1||t===Ut.RGBA_PVRTC_2BPPV1||t===Ut.RGB_ETC1},isDXTFormat:function(e){return e===Ut.RGB_DXT1||e===Ut.RGBA_DXT1||e===Ut.RGBA_DXT3||e===Ut.RGBA_DXT5},isPVRTCFormat:function(e){return e===Ut.RGB_PVRTC_4BPPV1||e===Ut.RGB_PVRTC_2BPPV1||e===Ut.RGBA_PVRTC_4BPPV1||e===Ut.RGBA_PVRTC_2BPPV1},isETC1Format:function(e){return e===Ut.RGB_ETC1},compressedTextureSizeInBytes:function(e,t,i){switch(e){case Ut.RGB_DXT1:case Ut.RGBA_DXT1:case Ut.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case Ut.RGBA_DXT3:case Ut.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case Ut.RGB_PVRTC_4BPPV1:case Ut.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case Ut.RGB_PVRTC_2BPPV1:case Ut.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},componentsLength:function(e){switch(e){case Ut.RGB:return 3;case Ut.RGBA:return 4;case Ut.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes:function(e,t,i,r){var o=Ut.componentsLength(e);return Ut.isPacked(t)&&(o=1),o*Ut.sizeInBytes(t)*i*r},sizeInBytes:function(e){switch(e){case Bt.UNSIGNED_BYTE:return 1;case Bt.UNSIGNED_SHORT:case Bt.UNSIGNED_SHORT_4_4_4_4:case Bt.UNSIGNED_SHORT_5_5_5_1:case Bt.UNSIGNED_SHORT_5_6_5:case Bt.HALF_FLOAT:return 2;case Bt.UNSIGNED_INT:case Bt.FLOAT:case Bt.UNSIGNED_INT_24_8:return 4}},isPacked:function(e){return e===Bt.UNSIGNED_INT_24_8||e===Bt.UNSIGNED_SHORT_4_4_4_4||e===Bt.UNSIGNED_SHORT_5_5_5_1||e===Bt.UNSIGNED_SHORT_5_6_5}};const zt=new Map;async function Gt(t,i,r,o,s){const{fetch:n,parse:a}=s;let l,c;if(i.uri&&function(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"===t||"/"===i}(i.uri)){const h=e.resolveUrl(i.uri,o),u=h.lastIndexOf("/")+1;if(c=h.substring(u),zt.has(c)){const e=zt.get(c),i={name:"",imageParsed:null,gltf:null,index:-1};e[0].imageParsed?(i.name=c,i.gltf=t,i.index=r,i.imageParsed=e[0].imageParsed,i.gltf.images[i.index]=e[0].imageParsed,e.push(i)):(i.name=c,i.gltf=t,i.index=r,e.push(i));}else {const o={name:"",imageParsed:null,gltf:null,index:-1};o.name=c,o.gltf=t,o.index=r;const u=[];u.push(o),zt.set(c,u);const d=await n(h);if(l=await d.arrayBuffer(),Number.isFinite(i.bufferView)){const e=Ke(t.json,t.buffers,i.bufferView);l=ye(e.buffer,e.byteOffset,e.byteLength);}try{const t=await a(l,e.ImageLoader,{},s);zt.get(c).forEach((e=>{e.imageParsed=t,e.gltf.images[e.index]=t;}));}catch(e){throw new Error(`存在无法解析的纹理图片格式，模型纹理图片格式必须是下述格式之一"png、jpeg、bmp";图片信息为：${i.uri}`)}}}else {if(i.uri){const t=e.resolveUrl(i.uri,o),r=await n(t);l=await r.arrayBuffer();}if(Number.isFinite(i.bufferView)){const e=Ke(t.json,t.buffers,i.bufferView);l=ye(e.buffer,e.byteOffset,e.byteLength);}let c;switch(i.mimeType){case"image/ktx":c=await a(l,Qe,{},s);const{ktxformat:r,ktxwidth:o,ktxheight:n}=c[0];t.textureByteSize+=Ut.compressedTextureSizeInBytes(r,o,n);break;case"image/crn":c=await a(l,e.CrunchWorkerLoader,{worker:!0},s);const{crnformat:h,crnwidth:u,crnheight:d}=c[0];t.textureByteSize+=Ut.compressedTextureSizeInBytes(h,u,d);break;case"image/basis":case"image/ktx2":ke.options.basis.format=function(e,t){let i=e&&e.basis&&e.basis.format;return "auto"===i&&(i=function(){const e=function(e){if(!ze){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}(),ze=new Set;for(const t of Be)for(const i in Ue)e&&e.getExtension(`${t}${i}`)&&ze.add(Ue[i]);}return ze}();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),i}(ke.options,!1),c=await a(l,ke,s),t.textureByteSize+=c[0].data.byteLength;break;default:try{c=await a(l,e.ImageLoader,{},s);const{width:i,height:r}=c;t.textureByteSize+=Ut.textureSizeInBytes(6408,5121,i,r);break}catch(e){throw new Error(`存在无法解析的纹理图片格式，模型纹理图片格式必须是下述格式之一"png、jpeg、bmp";图片信息为:${i.uri}`)}}t.images[r]=c;}}const Vt={name:"glTF",id:"gltf",module:"gltf",version:e.VERSION$2,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,i={},r){(i={...Vt.options,...i}).gltf={...Vt.options.gltf,...i.gltf},function(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess);}(i);const{byteOffset:o=0}=i,s=e.decodeGLB(t);return await async function(t,i,r=0,o,s){if(function(e,t,i,r){if(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!function(e,t=0,i={}){const r=new DataView(e),{magic:o=Ot}=i,s=r.getUint32(t,!1);return s===o||s===Ot}(t,i,r)&&(t=(new TextDecoder).decode(t)),"string"==typeof t)e.json=function(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){return "string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?ve(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ve(e,0,t):""}(e)}"`)}}(t);else if(t instanceof ArrayBuffer){const o={};i=function(e,t,i=0,r={}){const o=new DataView(t);e.type=function(e,t=0){return `${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(o,i+0),e.version=o.getUint32(i+4,Dt);const s=o.getUint32(i+8,Dt);switch(e.header={byteOffset:i,byteLength:s},e.json={},e.binChunks=[],i+=12,e.version){case 1:return function(e,t,i,r){const o=t.getUint32(i+0,Dt);return t.getUint32(i+4,Dt),Nt(e,t,i+=8,o),(i+=o)+Ft(e,t,i,e.header.byteLength)}(e,o,i);case 2:return function(e,t,i,r){return function(e,t,i,r){for(;i+8<=e.header.byteLength;){const o=t.getUint32(i+0,Dt),s=t.getUint32(i+4,Dt);switch(i+=8,s){case 1313821514:Nt(e,t,i,o);break;case 5130562:Ft(e,t,i,o);break;case 0:r.glb.strict||Nt(e,t,i,o);break;case 1:r.glb.strict||Ft(e,t,i,o);}i+=xe(o,4);}}(e,t,i,{}),i+e.header.byteLength}(e,o,i);default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}(o,t,i,r),e._glb=o,e.json=o.json;}if(e.buffers=new Array((e.json.buffers||[]).length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength};}e.images=new Array((e.json.images||[]).length).fill({});}(t,i,r,o),"1.0"===t.json?.asset?.version){const e=s.url;throw new Error(`The【${e.slice(e.lastIndexOf("/")+1)}】 version is ${t.json.asset.version}, minemap is not supported!`)}!function(e,t={}){(new Et).normalize(e,t);}(t,{normalize:o.gltf.normalize});const n=[];if(o.gltf.loadBuffers&&t.json.buffers&&await async function(t,i,r){for(let o=0;o<t.json.buffers.length;++o){const s=t.json.buffers[o];if(s.uri){const{fetch:n}=r,a=e.resolveUrl(s.uri,i),l=await n(a),c=await l.arrayBuffer();t.buffers[o]={arrayBuffer:c,byteOffset:0,byteLength:c.byteLength},delete s.uri;}}}(t,o,s),o.gltf.loadImages){const e=async function(e,t,i){const r=e.json.images||[],o=[];for(let s=0;s<r.length;++s)o.push(Gt(e,r[s],s,t,i));return await Promise.all(o)}(t,o,s);n.push(e);}const a=async function(e,t={},i){t.gltf=t.gltf||{};for(const r in St){const o=t.gltf.excludeExtensions||{};if(!(r in o)||o[r]){const o=St[r];await o.decode(e,t,i);}}}(t,o,s);return n.push(a),await Promise.all(n),o.gltf.postProcess?It(t,o):t}({textureByteSize:0},s,o,i,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};class kt{get length(){return this._values.length}get values(){return this._values}constructor(){this._values=[],this._hash={};}contains(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");return e.defined(this._hash[t])}set(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._values.push(t));}get(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");return this._hash[e]}remove(t){if(e.defined(t)&&"string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");const i=this._hash[t],r=e.defined(i);if(r){const e=this._values;e.splice(e.indexOf(i),1),delete this._hash[t];}return r}removeAll(){const e=this._values;e.length>0&&(this._hash={},e.length=0);}}function Ht(e,t,i,r,o){const{gl:s}=i;e.gltfIndexBuffer?(t.bind(i,r,e.gltfVertexBuffer,[],e.gltfIndexBuffer),e.isInstance?i.drawInstance.drawElementsInstancedANGLE(e.mode,e.count,e.gltfIndexBuffer.type,0,e.instancesCount):s.drawElements(o?s.LINES:e.mode||0,e.count,e.gltfIndexBuffer.type,e.offset)):(t.bind(i,r,e.gltfVertexBuffer,[],null),e.isInstance?i.drawInstance.drawArraysInstancedANGLE(o?s.LINES:e.mode,0,e.count,e.instancesCount):s.drawArrays(o?s.LINES:e.mode||0,e.offset,e.count));}function Xt(t,i,r,o,s){const n=o.context,a=n.gl;o.context.setCullFace(e.CullFaceMode.disabled),t.bind(n,i,r,[],null),n.activeTexture.set(a.TEXTURE0),s.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.uniform1i(i.uniforms.u_HAS_BASECOLORMAP,!0),a.uniform1i(i.uniforms.u_BaseColorSampler,0),a.uniform4fv(i.uniforms.u_BaseColorFactor,[1,1,1,1]),n.setColorMode(e.ColorMode.alphaBlended),a.drawArrays(a.TRIANGLE_FAN,0,4);}class jt{constructor(t){if(this.options=t,!this.options.canvasContent&&!this.options.htmlNode)throw new Error({type:"三维看板添加错误",info:"没有画板内容，并且没有html渲染内容"});t.lngLat&&(this.options.lngLat=e.LngLat.convert(t.lngLat)),this._calcModelMatrix();}static createGlBuffer(t,i){const r=new e.StructArrayLayout5f20;let o=0,s=0;switch(t){case"bottom":break;case"bottom-left":o=.5;break;case"bottom-right":o=-.5;break;case"center":s=-.5;break;case"left":o=.5,s=-.5;break;case"right":o=-.5,s=-.5;break;case"top":s=-1;break;case"top-left":o=.5,s=-1;break;case"top-right":o=-.5,s=-1;}return r.emplaceBack(-.5+o,1+s,0,0,0),r.emplaceBack(.5+o,1+s,0,1,0),r.emplaceBack(.5+o,0+s,0,1,1),r.emplaceBack(-.5+o,0+s,0,0,1),i.createVertexBuffer(r,e.sphereGltfAttributes.members)}static renderContentToImage(t,i){const r=t;if(r.options.canvasContent)r._canvasInfo||(r._canvasInfo={drawn:!1,imageLoadState:"init",image:null}),"init"===r._canvasInfo.imageLoadState&&(r._canvasInfo.image=e.DOM.create("img","minemap-display-board-img"),r._canvasInfo.imageLoadState="loading",r._canvasInfo.image.setAttribute("crossOrigin","anonymous"),r._canvasInfo.image.onload=()=>{r._canvasInfo.imageLoadState="loaded",r.canvas||(r.canvas=e.DOM.create("canvas","minemap-display-board"));const t=e.exported.devicePixelRatio,o=r.options.canvasContent,s=r.options.width*t,n=r.options.height*t;r.canvas.width=s,r.canvas.height=n;const a=r.canvas.getContext("2d");a.globalAlpha=0,a.fillStyle="#ffffff",a.clearRect(0,0,s,n),a.globalAlpha=1,a.drawImage(r._canvasInfo.image,0,0,s,n),a.fillStyle=o.fontColor||"white",a.font=`${parseInt(o.fontSize)*t}px ${o.fontFamily||"微软雅黑"}`,a.textBaseline="middle",a.textAlign="center",a.fillText(o.text,s/2,(o.textTop||0)*t,s),r._canvasInfo.drawn=!0,r.texture=new e.Texture(i,r.canvas,i.gl.RGBA),e.DOM.remove(r.canvas),r.canvas=null,e.DOM.remove(r._canvasInfo.image),r._canvasInfo.image=null;},r._canvasInfo.image.src=r.options.canvasContent.backgroundImage);else {if(!r.options.htmlNode)throw new Error("Unable to create texture image of 3D display board");e.html2canvas(r.options.htmlNode).then((t=>{r.texture?r.texture.update(t):r.texture=new e.Texture(i,t,i.gl.RGBA);}));}}loaded(){return this._canvasInfo.drawn&&"loaded"===this._canvasInfo.imageLoadState}render(e,t,i){if(!this.texture)return;const r=this._map.painter,o=this._map.transform,{context:s}=r,{gl:n}=s,a=o.calculateVPMatrix().clone().multiplyRight(this.modelMatrix);n.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(a.toArray())),Xt(e,t,i,r,this.texture);}setHtmlNode(t){this.options.htmlNode!==t&&(this.options.htmlNode&&e.DOM.remove(this.options.htmlNode),this.options.htmlNode=t,this._map.getCanvasContainer().appendChild(this.options.htmlNode)),jt.renderContentToImage(this,this._map.painter.context);}setCanvasContent(e){this._canvasInfo={drawn:!1,imageLoadState:"init",image:null},this.options.canvasContent=e,jt.renderContentToImage(this,this._map.painter.context);}setLngLat(t){t&&(this.options.lngLat=e.LngLat.convert(t),this._calcModelMatrix());}_calcModelMatrix(){this._createScaleMatrix();const t=new e.Matrix4,i=this.options.translation;!i||0===i[0]&&0===i[1]&&0===i[2]||t.translate(i);const r=this.options.rotation;r&&(4===r.length?t.multiplyRight((new e.Matrix4).fromQuaternion(r)):(r[0]&&t.rotateX(r[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r[1]&&t.rotateX(r[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r[2]&&t.rotateZ(r[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD))),this.nodeMatrix=t.multiplyRight(this.scaleMatrix),this.options.lngLat&&(this.modelMatrix=e.calc3dModelTranslateMatrix(!1,{location:this.options.lngLat.toArray(),translation:[0,0,0]},e.createFloat64ArrayIdentityMatrix()),this.modelMatrix.multiplyRight(this.nodeMatrix));}setRotation(e){this.options.rotation=e,this._calcModelMatrix();}setTranslation(e){this.options.translation=e,this._calcModelMatrix();}setScale(e){this.options.scale=e,this._calcModelMatrix();}_createScaleMatrix(){const t=new e.Matrix4,i=new e.Matrix4;t.scale([this.options.width,this.options.height,1]);const r=this.options.scale;!r||1===r[0]&&1===r[1]&&1===r[2]?this.scaleMatrix=t:(i.scale(r),this.scaleMatrix=i.multiplyRight(t));}remove(){this._map&&this._map.painter&&this._map.painter.removeDisplayBoard(this),this.vertexBuffer&&this.vertexBuffer.destroy(),this.texture&&this.texture.destroy(),this.canvas&&(e.DOM.remove(this.canvas),e.DOM.remove(this._canvasInfo.image)),this.options.htmlNode&&e.DOM.remove(this.options.htmlNode),this.options=null,this._canvasInfo=null,this.canvas=null,this._map=null;}addTo(e){return this._map=e,this.options.htmlNode&&e.getCanvasContainer().appendChild(this.options.htmlNode),this.vertexBuffer=jt.createGlBuffer(this.options.anchor,this._map.painter.context),jt.renderContentToImage(this,this._map.painter.context),this._map.painter.addDisplayBoard(this),this}getVertexBuffer(){return this.vertexBuffer}}class Yt extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this.type="3d-model",this.minzoom=15,this.maxzoom=22,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=r,this.setEventedParent(o),this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this.materials=[],this._loadedTextures={},this.nodeStructure={},this._data=i.data,this._options=e.extend({},i),this.location=i.location||[0,0],this.upAxis=i["up-axis"]||"Y-UP",this.modelFolder=i.modelFolder,this.scale=i.scale,this.rotation=i.rotation,this.translation=i.translation||[0,0,0],this.noBox=i.noBox,this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.filter=i.filter,this._pickable=i.pickable||!1,this.boolAABBCalculated=!1,this.priorityRequest=i.priorityRequest||!1,this.log=i.log||!1,this.useMipmap=void 0===i.useMipmap||i.useMipmap,this.noQuery=!!i.hasOwnProperty("noQuery")&&i.noQuery,this.workerOptions=e.extend({location:this.location,upAxis:this.upAxis},i.workerOptions),this.filter&&this.setFilter(this.filter),i.aabbFilter&&this.setAABBFilter(i.aabbFilter),this.clampPlane=i.clampPlane||null,this._clampEnabled=i.clampEnabled||!1,i.hasOwnProperty("clampBox")&&(this.ratioRange=i.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=i.clampBox||null,this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.maxClampBounds=[-1/0,-1/0,-1/0],this.minClampBounds=[1/0,1/0,1/0]),this.uploaded=!1,this.isModeling=i.isModeling,this.configuration=i.configuration?"string"==typeof i.configuration?JSON.parse(i.configuration):i.configuration:{},this.configuration.timestamp=Date.now(),this.identityMatrix=!0,this.noHighlighting=i.noHighlighting||!1,this.classificationData=i.classificationData,this.videoMatchOption=i.videoMatchOption,this.activeClipVideo=i.activeClipVideo||!1,this._useVideoProject=!!i.useVideoProject&&i.useVideoProject,this.prepareClassificationData();}get useVideoProject(){return this._useVideoProject}set useVideoProject(e){"boolean"==typeof e&&(this._useVideoProject=e);}prepareClassificationData(){if(this.classificationData){this.processedClassificationDataArray||(this.processedClassificationDataArray=[]);for(let t=0;t<this.classificationData.features.length;t++){const i=this.classificationData.features[t],r=i.geometry.coordinates[0],o=[],s=[],n=e.earcut_1.flatten(i.geometry.coordinates);for(let t=0;t<n.vertices.length;t+=n.dimensions||2){const r=e.transformECEFToGeographic([],[n.vertices[t],n.vertices[t+1]],i.properties.top*e.CONSTS.TRANSFORM.R_SCALE+e.CONSTS.TRANSFORM.R);o.push(r);const a=e.transformECEFToGeographic([],[n.vertices[t],n.vertices[t+1]],i.properties.bottom*e.CONSTS.TRANSFORM.R_SCALE+e.CONSTS.TRANSFORM.R);s.push(a);}const a=e.earcut_1(n.vertices,n.holes,n.dimensions);this.processedClassificationDataArray.push({topPoints:o,bottomPoints:s,properties:i.properties,originData:r,holes:n.holes,indexes:a});}this.classificationData=null;}}queryIntersectedClassificationFeature(t){if(!this.processedClassificationDataArray||0===this.processedClassificationDataArray.length)return null;let i=null,r=1/0;for(let o=0;o<this.processedClassificationDataArray.length;o++){const s=this.processedClassificationDataArray[o],n=s.properties,a=this._getClassificationTriangles(s.topPoints,s.bottomPoints,s.holes,s.indexes);for(let o=0;o<a.length;o++){const l=t.intersectTriangle(...a[o],!1,[]);if(l){const o=new e.Vector3(t.origin).distance(l);o<r&&(r=o,i={properties:n,data:s.originData});}}}return i}_getClassificationTriangles(e,t,i,r){const o=[];for(let i=0;i<r.length;i+=3){const s=r[i],n=r[i+1],a=r[i+2];o.push([e[s],e[n],e[a]]),o.push([t[s],t[n],t[a]]);}let s=0,n=0;for(let r=1;r<e.length;r++){if(0!==i.length)if(0===s)s=i[n++];else if(r===s){n<=i.length-1&&(s=i[n++]);continue}o.push([e[r],e[r-1],t[r-1]]),o.push([e[r],t[r-1],t[r]]);}return o}set clampEnabled(e){this._clampEnabled=e;}get clampEnabled(){return this._clampEnabled&&(this.clampPlane||this.clampBox)}setClampRange(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new e.Event("data",{data:t})));}setClampBox(t){t instanceof Object||(console.warn("Parameter should be a crop box object"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(e.defined(this.clampBox)?this.clampBox:{},t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.loadClampBounds(),this.fire(new e.Event("data",{data:this.clampBox}));}getClampBoxMatrix(t,i){let{rotateX:r,rotateY:o,rotateZ:s,anchor:n,translation:a}=t;a&&(n=e.getTranslatedLngLatPoint(n,a));const l=new e.Matrix4;l.rotateZ(-s*e.CONSTS.TRANSFORM.DEG_TO_RAD),l.rotateX(-r*e.CONSTS.TRANSFORM.DEG_TO_RAD),l.rotateY(-o*e.CONSTS.TRANSFORM.DEG_TO_RAD);const c=e.calcLocalCoords(n,i);return l.translate([-c[0],-c[1],-c[2]]),l}setClampPlane(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new e.Event("data",{data:t})));}clearClampPlane(){this.clampPlane=null,this.fire(new e.Event("data",{data:this.clampPlane}));}clearClampBox(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new e.Event("data",{data:this.clampBox}));}setFilter(t){this._featureFilter=e.createFilter(t),this.boolAABBCalculated=!1;}enablePick(){this._pickable=!0;}setAABBFilter(t){this._aabbFilter=e.createFilter(t);}disablePick(){this._pickable=!1;}clearPick(){for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++)t.primitiveStack[e].highlight=!1;}this.fire(new e.Event("data",{}));}highlightModel(){for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++)t.primitiveStack[e].highlight=!0;}this.fire(new e.Event("data",{}));}queryRenderedFeatures(t,i,r,o,s,n){let a,l;if(this.configuration.realtime)for(const t in this.configuration.matrixObject){const i=e.findTrackModelMatchNodes(this.nodes,t),r=this._intersectNodes(i,s,this.configuration.matrixObject[t]);r.flag&&(l=r,a=t.split("::")[0]);}else l=this._intersectNodes(this.nodes,s);if(!l)return [];const{intersectionZ:c,intersectionPoint:h,_properties:u,nodeIndex:d,result:_}=l;return _[0]?[{_parent:this,properties:Object.assign({equip_id:a},u),primitiveData:_[0],intersectionPoint:h,intersectionZ:c,nodeIndex:d,highlightRange:r.highlightRange}]:[]}_intersectNodes(t,i,r){let o=!1,s=-1;const n=[];let a,l,c=1/0;for(let h=0;h<t.length;h++){const u=t[h];let d=u?u.meshInd:null;if(!d||!d.id)continue;d=d.id.match(/\d+/g);const _=this.meshes[d];if(u.primitiveStack)for(let t=0;t<_.primitivesInd.length;t++){const d=this.primitives[_.primitivesInd[t]];let m;m=this.configuration.realtime?e.calcTrackModelBBox(d.aabb,r):e.calcNodeBBox({source:this,node:u,inputData:d.aabb});for(let _=0;_<m.length;_++)if(i.intersectTriangle(...m[_],!1,[])){const _=e.readArrayToTriangleFloatArrayCesium(d.intersectOptions);let m=[];m=this.configuration.realtime?e.calcTrackModelSpaceTriangles(_,r):e.calcPrimitivePositionOfWorld({source:this,node:u,inputData:_});for(let r=0;r<m.length;r++){const _=i.intersectTriangle(...m[r],!1,[]);if(_){const r=new e.Vector3(i.origin).distance(_);r<c&&(a=_,c=r,n[0]=u.primitiveStack[t],l=u.properties,l.meshName=`${u.mesh.name?u.mesh.name:u.mesh.id}`,l.primitiveName=d.properties.primitiveName,o=!0,s=h);}}m=null;}m=null;}}return {flag:o,intersectionPoint:a,intersectionZ:c,_properties:l,result:n,nodeIndex:s}}highlightMesh(t){if(this.clearPick(),!this.noHighlighting&&t)for(let i=0;i<this.nodes.length;i++){const r=this.nodes[i];if(r.primitiveStack)for(let o=0;o<r.primitiveStack.length;o++){const s=r.primitiveStack[o];if(t.highlightRange!==e.CONSTS.HIGHLIGHT_TYPE.PRIMITIVE&&t.highlightRange)t.highlightRange===e.CONSTS.HIGHLIGHT_TYPE.NODE?t.nodeIndex===i&&(s.highlight=!0):s.highlight=!0;else if(s.primitiveDataInd===t.primitiveData.primitiveDataInd)return void(s.highlight=!0)}}}setGltfData(e){for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++){const i=this.primitives[t.primitiveStack[e].primitiveInd];i.gltfIndexBuffer&&i.gltfIndexBuffer.destroy(),i.gltfVertexBuffer.destroy();}}this.nodes=[],this.meshes=[],this.primitives=[];for(let e=0;e<this.textures.length;e++)this.textures[e].destroy();this.textures=[],this.materials=[],e&&e.data&&(this._data=e.data,this.modelFolder=e.modelFolder||this.modelFolder,this.load());}loadTextures(t,i){const r={},o=[];if(!t||0===t.length)throw new Error("The URL array of loadtextures method does not exist or is empty");for(let i=0;i<t.length;i++){const r=e.load(t[i],e.ImageLoader,{},null,this.modelFolder);o.push(r);}(function(e,t){let i=Promise.resolve();return e.forEach(((e,o)=>{i=i.then((()=>e)).then((e=>(r[t[o]]=e,r))).catch((e=>(r[t[o]]=e,Promise.resolve())));})),i})(o,t).then((e=>{this._loadedTextures=e,i(null,e);})).catch((e=>{i(e,r);}));}changeGltfMaterialByNodeName(e){if(!e||!("nodeName"in e))return;const{material:t,changeType:i}=e;for(let r=0;r<this.nodes.length;r++){const o=this.nodes[r];if(o.properties.name===e.nodeName&&o.mesh)return this.changeGltfMaterialByPrimitiveName({primitiveName:o.mesh.primitives[0].name,material:t,changeType:i})}}changeGltfMaterialByPrimitiveName(t){if(!e.defined(t))return;const{primitiveName:i,material:r,changeType:o}=t;let s;for(let e=0;e<this.primitives.length;e++){const t=this.primitives[e];if(t.properties.primitiveName===i){s=t;break}}if(s){if("add"!==o||s.material._copied||(s.material=Object.assign({_copied:!0},e.deepCopy(s.material))),r.pbrMetallicRoughness&&r.pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.url){this.materialTextureCache||(this.materialTextureCache={});const t=r.pbrMetallicRoughness.baseColorTexture.url;this.materialTextureCache[t]||this._loadedTextures[t]?!this.materialTextureCache[t]&&this._loadedTextures[t]?this._changeTextureOfMaterial(this._loadedTextures[t],o,s,t):(s.material.pbrMetallicRoughness.baseColorTexture.index=this.materialTextureCache[t].index,this.map.triggerRepaint()):e.load(t,e.ImageLoader,{},null,this.modelFolder).then((e=>{this._changeTextureOfMaterial(e,o,s,t);}));}r.pbrMetallicRoughness&&r.pbrMetallicRoughness.baseColorFactor&&(s.material.pbrMetallicRoughness.baseColorFactor=r.pbrMetallicRoughness.baseColorFactor,this.map.triggerRepaint());}}_changeTextureOfMaterial(t,i,r,o){if(!t)throw new Error("Picture data acquisition error");{const s=this.textures[r.material.pbrMetallicRoughness.baseColorTexture.index],n=s.context;if("replace"===i)s.update(t);else {const i=new e.Texture(n,t,n.gl.RGBA);this.textures.push(i),this.materialTextureCache[o]=i,this.materialTextureCache[o].index=this.textures.length-1,this._loadedTextures&&this._loadedTextures[o]&&delete this._loadedTextures[o],r.material.pbrMetallicRoughness.baseColorTexture.index=this.textures.length-1;}this.map.triggerRepaint();}}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this.state="dataloading",this._updateModelData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i)),this.state="loaded";}));}onAdd(e){this.map=e,this.load();}setLocation(t){return this.location=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateModelData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i)),this.state="loaded";})),this}prepare(){this.uploaded||(this._processGLBuffers(),this.uploaded=!0);}_reUploadTexture(){const e=this.map.painter.context;this.videoTextures.forEach(((t,i)=>{e.activeTexture.set(t.textureUnit.VALUE),t.bind(e.gl.LINEAR,e.gl.CLAMP_TO_EDGE);}));}async _updateModelData(t){const i=e.extend({},this.workerOptions);if(i.location=this.location,i.source=this.id,this.state="parsing","string"==typeof this._data){i.request=this.map._transformRequest(e.exported.resolveURL(this._data),e.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming;const r=await e.load(i.request.url,Vt,{gltf:{postProcess:!0,loadImages:!0}},null,this.modelFolder);if(r){if(this._removed||r&&r.abandoned)return;this._loaded=!0,this.result=r,this._processGLBuffers(),t(null,{gltf:r});}else t({msg:"loaders.gl load data fail"},null);}else {if(this._data.byteLength)return this._data=await e.parse(this._data,Vt,{gltf:{postProcess:!0,loadImages:!0}},null,this.modelFolder),this.result=this._data,this._processGLBuffers(),void t(null,{gltf:this.result});let i;i=this._data.buffers[0].data?e.processModelingDataBuffersToLoadersBuffers(this._data.buffers):e.processBase64BuffersToLoadersBuffers(this._data.buffers),this._data.buffers=i,this._data.images&&this._data.images.length>0?e.processModelingImageToLoadersImages(this._data.images,{modelFolder:this.modelFolder},(e=>{this.result=It({json:this._data,buffers:this._data.buffers,images:e,baseUri:this.modelFolder}),this._processGLBuffers();})):(this.result=It({json:this._data,buffers:this._data.buffers,baseUri:this.modelFolder}),this._processGLBuffers());}}calcBaseMatrix(){}updateConfiguration(e){e&&(this.configuration=Object.assign({},this.configuration,e),e.hasOwnProperty("trackData")&&(this.configuration.timestamp=Date.now()),this._updateTrackDataCount||(this._updateTrackDataCount=1),this._updateTrackDataCount++,60===this._updateTrackDataCount&&(this._updateTrackDataCount=0,this.removeAllDisplayBoards()));}_processExtensionPbrSpecularGlossiness(e){const t=e.extensionsUsed;for(let i=0;i<t.length;i++)if("KHR_materials_pbrSpecularGlossiness"===t[i]){const t=e.materials;for(let i=0;i<t.length;i++){const r=t[i];if(r?.extensions?.KHR_materials_pbrSpecularGlossiness){const t=r.extensions.KHR_materials_pbrSpecularGlossiness;t.diffuseTexture&&(e.materials[i].pbrMetallicRoughness.baseColorTexture=t.diffuseTexture),t.diffuseFactor&&(e.materials[i].pbrMetallicRoughness.baseColorFactor=t.diffuseFactor),t.glossinessFactor&&(e.materials[i].pbrMetallicRoughness.roughnessFactor=1-t.glossinessFactor);}}break}return e}_processGLBuffers(){let t=this.result;if(!t)return;t.extensionsUsed&&(t=this._processExtensionPbrSpecularGlossiness(t)),this.gltfModelVAO||(this.gltfModelVAO=new Le);const i=this.map.painter.context;this.samplers=t.samplers||[{magFilter:e.WebGLConstants.LINEAR,minFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE}],this.gltfParser=new pe({gltf:t,context:i,bufferData:t.buffers,source:this,filter:this._featureFilter,needTriangle:"airline"===this.configuration.renderType,isModelSource:!0}),this.gltfParser.processGLTF(),t.scenes[0].extras&&(this.sceneConf=t.scenes[0].extras),this.loadClampBounds();}loadClampBounds(){if(this.clampEnabled&&!this.minClampBounds&&!this.maxClampBounds){const t=e.calcSpaceEnvelopeOfGltf(this,!1);this.minClampBounds=[t.getXmin(),t.getYmin(),t.getZmin()],this.maxClampBounds=[t.getXmax(),t.getYmax(),t.getZmax()];}}loadTile(e,t){e.state="loaded";}abortTile(e){e.aborted=!0;}unloadGPUData(){for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];if(t.primitiveStack)for(let e=0;e<t.primitiveStack.length;e++){const i=this.primitives[t.primitiveStack[e].primitiveInd];i.gltfIndexBuffer&&i.gltfIndexBuffer.destroy(),i.gltfVertexBuffer.destroy();}}this.uploaded=!1;for(let t=0;t<this.textures.length;t++){const i=this.textures[t].name;""==i?this.textures[t].destroy():e.TextureManager.freeTexture(i);}this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this.state="unloaded";}unloadTile(e){}onRemove(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}getDisplayBoard(t,i,r){if(!t||0===t.length)return null;this._displayBoardMap||(this._displayBoardMap={});const o=this.configuration.bgImageMathOptions;let s;s=r&&e.defined(o.fontColorMatchKey)&&"string"!=typeof o.fontColor?o.fontColor[r[0]]||"white":"string"==typeof o.fontColor?o.fontColor:"white";const n=`${t}:${i}:${s}`;return this._displayBoardMap[n]||(this._displayBoardMap[n]=new jt({width:o.width,height:o.height,scale:o.scale,rotation:o.rotation,canvasContent:{backgroundImage:i,fontSize:o.fontSize,fontColor:s,text:t,textTop:o.textTop,textLeft:o.textLeft}}),jt.renderContentToImage(this._displayBoardMap[n],this.map.painter.context)),this._displayBoardMap[n]}removeAllDisplayBoards(){if(this._displayBoardMap){for(const e in this._displayBoardMap)this._displayBoardMap[e].remove();this._displayBoardMap={};}}serialize(){return e.extend({},this._options,{type:this.type,data:this._data,maxzoom:this.maxzoom,bounds:this.bounds,location:this.location,"up-axis":this.upAxis})}hasTransition(){return !1}isEarthSource(){return !0}}function Wt(t,i,r){if(t.length<i)return;let o=!0;for(let e=0;e<t.length;e++){if(t[e].error)return r(t[e].error);t[e].image&&t[e].json||(o=!1);}if(!o)return;const s={};for(let i=0;i<t.length;i++){const r=t[i],o=e.exported.getImageData(r.image),n=r.json;for(const t in n){const{width:i,height:r,x:a,y:l,sdf:c,pixelRatio:h,stretchX:u,stretchY:d,content:_}=n[t],m=new e.RGBAImage({width:i,height:r});e.RGBAImage.copy(o,m,{x:a,y:l},{x:0,y:0},{width:i,height:r}),s[t]={data:m,pixelRatio:h,sdf:c,stretchX:u,stretchY:d,content:_};}}r(null,s);}function qt(e){const{userImage:t}=e;return !!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Zt extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0;}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[];}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t);}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return !0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return !1;i=r[1];}return !0}_validateContent(e,t){return !(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0;}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove();}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t});}_notify(t,i){const r={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?r[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);}i(null,r);}getPixelSize(){const{width:e,height:t}=this.atlasImage;return {width:e,height:t}}getPattern(t){const i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else {const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:o};}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE);}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:r}=e.potpack(t),o=this.atlasImage;o.resize({width:i||1,height:r||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],r=i.x+1,s=i.y+1,n=this.images[t].data,a=n.width,l=n.height;e.RGBAImage.copy(n,o,{x:0,y:0},{x:r,y:s},{width:a,height:l}),e.RGBAImage.copy(n,o,{x:0,y:l-1},{x:r,y:s-1},{width:a,height:1}),e.RGBAImage.copy(n,o,{x:0,y:0},{x:r,y:s+l},{width:a,height:1}),e.RGBAImage.copy(n,o,{x:a-1,y:0},{x:r-1,y:s},{width:1,height:l}),e.RGBAImage.copy(n,o,{x:0,y:0},{x:r+a,y:s},{width:1,height:l});}this.dirty=!0;}beginFrame(){this.callbackDispatchedThisFrame={};}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];qt(e)&&this.updateImage(t,e);}}}var $t=1e20;function Qt(e,t,i,r,o,s){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=o||"sans-serif",this.fontWeight=s||"normal",this.radius=i||8;const n=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.ctx.font=`${this.fontWeight} ${this.fontSize}px ${this.fontFamily}`,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(n*n),this.gridInner=new Float64Array(n*n),this.f=new Float64Array(n),this.d=new Float64Array(n),this.z=new Float64Array(n+1),this.v=new Int16Array(n),this.middle=Math.round(n/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1));}function Kt(e,t,i,r,o,s,n){for(var a=0;a<t;a++){for(var l=0;l<i;l++)r[l]=e[l*t+a];for(Jt(r,o,s,n,i),l=0;l<i;l++)e[l*t+a]=o[l];}for(l=0;l<i;l++){for(a=0;a<t;a++)r[a]=e[l*t+a];for(Jt(r,o,s,n,t),a=0;a<t;a++)e[l*t+a]=Math.sqrt(o[a]);}}function Jt(e,t,i,r,o){i[0]=0,r[0]=-$t,r[1]=+$t;for(var s=1,n=0;s<o;s++){let t=(e[s]+s*s-(e[i[n]]+i[n]*i[n]))/(2*s-2*i[n]);for(;t<=r[n];)n--,t=(e[s]+s*s-(e[i[n]]+i[n]*i[n]))/(2*s-2*i[n]);i[++n]=s,r[n]=t,r[n+1]=+$t;}for(s=0,n=0;s<o;s++){for(;r[n+1]<s;)n++;t[s]=(s-i[n])*(s-i[n])+e[i[n]];}}Qt.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=t.data[4*r+3]/255;this.gridOuter[r]=1===o?0:0===o?$t:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=1===o?$t:0===o?0:Math.pow(Math.max(0,o-.5),2);}for(Kt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Kt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)i[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return i};class ei{constructor(e,t){this.requestTransform=e,this.localIdeographFontFamily=t,this.entries={};}setURL(e){this.url=e;}getGlyphs(t,i){const r=[];for(const e in t)for(const i of t[e])r.push({stack:e,id:i});e.asyncAll(r,(({stack:e,id:t},i)=>{let r=this.entries[e];r||(r=this.entries[e]={glyphs:{},requests:{}});let o=r.glyphs[t];if(void 0!==o)return void i(null,{stack:e,id:t,glyph:o});if(o=this._tinySDF(r,e,t),o)return void i(null,{stack:e,id:t,glyph:o});const s=Math.floor(t/256);if(256*s>65535)return void i(new Error("glyphs > 65535 not supported"));let n=r.requests[s];n||(n=r.requests[s]=[],ei.loadGlyphRange(e,s,this.url,this.requestTransform,((e,t)=>{if(t)for(const e in t)r.glyphs[+e]=t[+e];for(const i of n)i(e,t);delete r.requests[s];}))),n.push(((r,o)=>{r?i(r):o&&i(null,{stack:e,id:t,glyph:o[t]||null});}));}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:o}of t)(e[i]||(e[i]={}))[r]=o&&{id:o.id,bitmap:o.bitmap.clone(),metrics:o.metrics};i(null,e);}}));}_tinySDF(t,i,r){const o=this.localIdeographFontFamily;if(!o)return;if(!e.unicodeBlockLookup["CJK Unified Ideographs"](r)&&!e.unicodeBlockLookup["Hangul Syllables"](r))return;let s=t.tinySDF;return s||(s=t.tinySDF=new ei.TinySDF(24,3,10,.25,o,"600")),{id:r,bitmap:new e.AlphaImage({width:30,height:30},s.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}}ei.loadGlyphRange=function(t,i,o,s,n){const l=256*i,c=l+255,h=s(function(e){if(!a(e)&&!r.fontsUrl)return e;const t=_(e);return r.fontsUrl&&`${r.fontsUrl}/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`||`${r.SRC_URL}/fonts/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`}(o).replace("//fonts","/fonts").replace("{fontstack}",t).replace("{range}",`${l}-${c}`),e.ResourceType.Glyphs);e.getArrayBuffer(h,((t,i)=>{if(t)n(t);else if(i){const t={};for(const r of e.parseGlyphPBF(i))t[r.id]=r;n(null,t);}}));},ei.TinySDF=Qt;const ti=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position;}possiblyEvaluate(t,i){return e.sphericalToCartesian(t.expression.evaluate(i))}interpolate(t,i,r){return {x:e.number(t.x,i.x,r),y:e.number(t.y,i.y,r),z:e.number(t.z,i.z,r)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),ii="-transition";class ri extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(ti),this.setLight(t),this._transitioning=this._transitionable.untransitioned();}getLight(){return this._transitionable.serialize()}setLight(t){if(!this._validate(e.validateLight,t))for(const i in t){const r=t[i];e.endsWith(i,ii)?this._transitionable.setTransition(i.slice(0,-ii.length),r):this._transitionable.setValue(i,r);}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}_validate(t,i){return e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class oi{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={};}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const r=[];let o=e.length%2==1?-e[e.length-1]*i:0,s=e[0]*i,n=!0;r.push({left:o,right:s,isDash:n,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){n=!n;const l=e[t];o=a*i,a+=l,s=a*i,r.push({left:o,right:s,isDash:n,zeroLength:0===l});}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const o=this.width*(this.nextRow+i+t);let s=0,n=e[s];for(let a=0;a<this.width;a++){a/n.right>1&&(n=e[++s]);const l=Math.abs(a-n.left),c=Math.abs(a-n.right),h=Math.min(l,c);let u;const d=t/i*(r+1);if(n.isDash){const e=r-Math.abs(d);u=Math.sqrt(h*h+e*e);}else u=r-Math.sqrt(h*h+d*d);this.data[o+a]=Math.max(0,Math.min(255,u+128));}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1));}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let t=0;t<this.width;t++){t/s.right>1&&(s=e[++o]);const i=Math.abs(t-s.left),n=Math.abs(t-s.right),a=Math.min(i,n);this.data[r+t]=Math.max(0,Math.min(255,(s.isDash?a:-a)+128));}}addDash(t,i){const r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return e.warnOnce("LineAtlas out of space"),null;let s=0;for(let e=0;e<t.length;e++)s+=t[e];if(0!==s){const e=this.width/s,o=this.getDashRanges(t,this.width,e);i?this.addRoundDash(o,e,r):this.addRegularDash(o);}const n={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:s};return this.nextRow+=o,this.dirty=!0,n}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data));}}function si(t,i,r){const o=function(t,i){if(t)return r(t);if(i){const t=e.pick(i,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);i.vector_layers&&(t.vectorLayers=i.vector_layers,t.vectorLayerIds=t.vectorLayers.map((e=>e.id))),r(null,t);}};return t.url?e.getJSON(i(function(e,t,i){if(!a(e))return e;const r=_(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),n(r,void 0,void 0)}(t.url),e.ResourceType.Source),o):e.exported.frame((()=>o(null,t)))}class ni{constructor(t,i,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24;}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=Math.floor(this.lngX(this.bounds.getWest(),e.z)),i=Math.floor(this.latY(this.bounds.getNorth(),e.z)),r=Math.ceil(this.lngX(this.bounds.getEast(),e.z)),o=Math.ceil(this.latY(this.bounds.getSouth(),e.z));return e.x>=t&&e.x<r&&e.y>=i&&e.y<o}lngX(e,t){return (e+180)*(Math.pow(2,t)/360)}latY(t,i){const r=e.clamp(Math.sin(Math.PI/180*t),-.9999,.9999),o=Math.pow(2,i)/(2*Math.PI);return Math.pow(2,i-1)+.5*Math.log((1+r)/(1-r))*-o}}class ai{constructor(){this.state={},this.stateChanges={},this.deletedStates={};}updateState(t,i,r){const o=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][o]=this.stateChanges[t][o]||{},e.extend(this.stateChanges[t][o],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==o&&(this.deletedStates[t][e]=null);}else if(this.deletedStates[t]&&null===this.deletedStates[t][o]){this.deletedStates[t][o]={};for(const e in this.state[t][o])r[e]||(this.deletedStates[t][o][e]=null);}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][o]&&null===this.deletedStates[t][o][e]&&delete this.deletedStates[t][o][e];}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null;}getState(t,i){const r=String(i),o=e.extend({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return {};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return {};for(const t in e)delete o[t];}return o}initializeTileState(e,t){e.setFeatureState(this.state,t);}coalesceChanges(t,i){const r={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const r in this.stateChanges[t])this.state[t][r]||(this.state[t][r]={}),e.extend(this.state[t][r],this.stateChanges[t][r]),i[r]=this.state[t][r];r[t]=i;}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e];}r[t]=r[t]||{},e.extend(r[t],i);}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const e in t)t[e].setFeatureState(r,i);}}class li{constructor(t,i,r,o){this.tileID=t,this.uid=e.uniqueId(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading",this.projType=r||e.ProjectionType.MERCATOR,this.isRaster=o||!1,this.terrainFlag=!1;}registerFadeDuration(t){const i=t+this.timeAdded;i<e.exported.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i);}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayers=e.filter((e=>e.isStateDependent()));for(const t of e)i[t.id]=r;}}return i}(t.buckets,i.style),r)for(const t in this.buckets){const i=this.buckets[t];(i instanceof e.SphereSymtrackingBucket||i instanceof e.SphereSymbolBucket)&&(i.justReloaded=!0);}this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.SphereSymbolBucket){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0;}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.SphereSymbolBucket&&i.hasRTLText){this.hasRTLText=!0,e.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t.layerIds[0]).queryRadius(t));}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new e.CollisionBoxArray;}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasImage&&(this.glyphAtlasImage=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.terrainData&&(this.terrainData=null,this.sttc&&this.sttc.removeTerrainTile(this.tileID.key)),this.texture&&(this.texture.destroy(),this.texture=null),this.latestFeatureIndex=null,this.sttc=null,this.state="unloaded";}loadImgAOTerrainData(t){const i=t.painter,r=i.context,o=t.data,s=t.renderWithTerrain,n=t.translation,a=t.sttc,l=t.callback,c=t.url,h=t.demDataMaxZoom;if(o.img)if(e.window.hasOwnProperty("createImageBitmap"))e.window.createImageBitmap(o.img).then((t=>{const o=r.gl;this.texture=i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new e.Texture(r,t,o.RGBA,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),this.state="loaded",l(null);}));else {const t=r.gl;this.texture=new e.Texture(r,o.img,t.RGBA,{useMipmap:!0}),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.state="loaded";}else e.getImage({url:c},((t,i)=>{if(t)throw new Error(t);const o=r.gl;this.texture=new e.Texture(r,i,o.RGBA,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.state="loaded",l(null);}));this.terrainFlag=!!s,s&&(this.sttc=a,this.tileID.overscaledZ>h?(o.terrainData&&(this.terrainData=a.addTerrainTile(this.tileID.scaledTo(h),o,r,n),a.updateRequestingParentTile(this.tileID.scaledTo(h),e.SharedTerrainTileCache.REMOVE,null,r,h)),this.notifyDEMParentDataFinished(a,r,h)):this.terrainData=a.addTerrainTile(this.tileID,o,r,n));}_cutToChildTile(e){const t=e.sttc,i=e.context,r=t.getTerrainTileByID(e.parentId)?t.getTerrainTileByID(e.parentId).terrainJson:void 0;if(void 0===r)return;const o=Object.assign({},r,{x:e.childId.canonical.x,y:e.childId.canonical.y,z:e.childId.canonical.z,isEastChild:e.childId.canonical.x%2>0,isNorthChild:e.childId.canonical.y%2==0,projectionType:this.projType}),s=t.mmDemTile.createChildTerrain(o),n=t.parseTerrainTile(s,i);return t._addTileByKey(e.childId.key,n),n}notifyDEMParentDataFinished(t,i,r){let o=this.tileID,s=this.tileID.overscaledZ-r;const n=[this.tileID];for(;s>0;){const i=e.OverscaledTileID.getParentTileId(o);if(t.hasTile(i.key)){n.push(e.OverscaledTileID.getParentTileId(o));break}n.push(e.OverscaledTileID.getParentTileId(o)),s--,o=i;}for(let e=n.length-1;e>=1;e--)1===e?this.terrainData=this._cutToChildTile({sttc:t,context:i,parentId:n[e],childId:n[e-1]}):this._cutToChildTile({sttc:t,context:i,parentId:n[e],childId:n[e-1]});}getBucket(e){return this.buckets[e.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t);}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new e.Texture(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.Texture(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null);}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture);}queryRenderedFeatures(e,t,i,r,o,s,n,a,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:o,tileSize:this.tileSize,posMatrix:l,transform:n,params:s,queryPadding:this.queryPadding*a},e,t):{}}querySourceFeatures(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=this.latestFeatureIndex.loadVTLayers(),o=r._geojsonTileLayer||r[i?i.sourceLayer:""];if(!o)return;const s=e.createFilter(i&&i.filter),n={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y};for(let i=0;i<o.length;i++){const r=o.feature(i);if(s(new e.EvaluationParameters(this.tileID.overscaledZ),r)){const i=new e.Feature(r,n.z,n.x,n.y);i.tile=n,t.push(i);}}}clearMask(){this.segments&&(this.segments.destroy(),delete this.segments),this.sphereSegments&&(this.sphereSegments.destroy(),delete this.sphereSegments),this.sphereMaskedBoundsBuffer&&(this.sphereMaskedBoundsBuffer.destroy(),delete this.sphereMaskedBoundsBuffer),this.sphereMaskedIndexBuffer&&(this.sphereMaskedIndexBuffer.destroy(),delete this.sphereMaskedIndexBuffer);}setMask(t,r){if(this.terrainFlag)return;if(i(this.mask,t))return;if(this.mask=t,this.clearMask(),i(t,{0:!0}))return;const o=new e.StructArrayLayout5f20,s=new e.StructArrayLayout3ui6;this.sphereSegments=new e.SegmentVector,this.sphereSegments.prepareSegment(0,o,s);const n=Object.keys(t),a=e.getProjection(this.projType),l=[];for(let i=0;i<n.length;i++){const r=t[n[i]],c=e.EXTENT>>r.z,h=new e.pointGeometry3d(r.x*c,r.y*c),u=new e.pointGeometry3d(h.x+c,h.y+c),d=Math.pow(2,this.tileID.canonical.z);let _=2;_=this.tileID.canonical.z<e.CONSTS.TILE_GRIDSAMPLES_SPLIT.SMALL?e.CONSTS.TILE_GRIDSAMPLES_SPLIT.SMALL_Z_SAMPLES>>r.z:this.tileID.canonical.z<e.CONSTS.TILE_GRIDSAMPLES_SPLIT.MIDDLE?e.CONSTS.TILE_GRIDSAMPLES_SPLIT.MIDDLE_Z_SAMPLES>>r.z:this.tileID.canonical.z<e.CONSTS.TILE_GRIDSAMPLES_SPLIT.LARGE?e.CONSTS.TILE_GRIDSAMPLES_SPLIT.LARGE_Z_SAMPLES>>r.z:e.CONSTS.TILE_GRIDSAMPLES_SPLIT.LARGE_S_Z_SAMPLES>>r.z,_<e.CONSTS.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(_=e.CONSTS.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);for(let e=0;e<_;e++){const t=_*(u.y-h.y),i=this.sphereSegments.prepareSegment(2*(_+1),o,s);this._xyToECEF(l,h.x,h.y+e/t,a,d),o.emplaceBack(l[0],l[1],l[2],h.x,h.y+e/t),this._xyToECEF(l,h.x,h.y+(e+1)/t,a,d),o.emplaceBack(l[0],l[1],l[2],h.x,h.y+(e+1)/t),i.vertexLength+=2;for(let r=1;r<=_;r++){this._xyToECEF(l,h.x+r/t,h.y+e/t,a,d),o.emplaceBack(l[0],l[1],l[2],h.x+r/t,h.y+e/t),this._xyToECEF(l,h.x+r/t,h.y+(e+1)/t,a,d),o.emplaceBack(l[0],l[1],l[2],h.x+r/t,h.y+(e+1)/t);const n=i.vertexLength;s.emplaceBack(n-2,n-1,n),s.emplaceBack(n,n-1,n+1),i.vertexLength+=2,i.primitiveLength+=2;}}}this.sphereMaskedBoundsBuffer=r.createVertexBuffer(o,e.sphereRasterBoundsAttributes.members),this.sphereMaskedIndexBuffer=r.createIndexBuffer(s);}_xyToECEF(t,i,r,o,s){const n=this._xToLng(o,i,s),a=this._yToLat(o,r,s);e.transformECEFToGeographic(t,[n,a],e.CONSTS.TRANSFORM.R);}_xToLng(t,i,r){return t.xLng(this.tileID.canonical.x+i/e.EXTENT,r)}_yToLat(t,i,r){return t.yLat(this.tileID.canonical.y+i/e.EXTENT,r)}hasData(){return "loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.parseCacheControl(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let r=!1;if(this.expirationTime>t)r=!1;else if(i)if(this.expirationTime<i)r=!0;else {const o=this.expirationTime-i;o?this.expirationTime=t+Math.max(o,e.CONSTS.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):r=!0;}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){const o=this.buckets[r],s=o.layers[0].sourceLayer||"_geojsonTileLayer",n=i[s],a=e[s];n&&a&&0!==Object.keys(a).length&&(o.update(a,n),t&&t.style&&(this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(o.layerIds[0]).queryRadius(o))));}}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i;}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return !0}return !1}}class ci extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!1,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.noLowLevelCover=!!i.noLowLevelCover,this._options=e.extend({},i),e.extend(this,e.pick(i,["url","scheme","tileSize","tiles","renderWithTerrain","terrainTiles","translation"])),this.demDataMaxZoom=i.demDataMaxZoom||14,this.priorityRequest=i.priorityRequest||!1,this.translation||(this.translation=[0,0,0]),this._useVideoProject=!!i.useVideoProject&&i.useVideoProject;}get useVideoProject(){return this._useVideoProject}set useVideoProject(e){"boolean"==typeof e&&(this._useVideoProject=e);}setSharedTerrainTileCache(e){this.sttc=e;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=si(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new ni(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=this.sttc;let o=!1;if(t.tileID.canonical.z>this.demDataMaxZoom){const i=t.tileID;r.hasTile(i.scaledTo(this.demDataMaxZoom).key)?o=!0:(o=!!r.hasRequestingParentTile(i.scaledTo(this.demDataMaxZoom)),r.updateRequestingParentTile(i.scaledTo(this.demDataMaxZoom),e.SharedTerrainTileCache.REQUEST,t));}this._renderWithTerrain=this.renderWithTerrain&&this.terrainTiles&&this.terrainTiles.length;const s=this.renderWithTerrain&&!o,n=t.tileID.canonical.toRealCoord(this.scheme),a=u(t.tileID.canonical.url(this.tiles,this.scheme),0,this.tileSize,n);let l="";if(this._renderWithTerrain)if(t.tileID.canonical.z>this.demDataMaxZoom){const e=t.tileID.scaledTo(this.demDataMaxZoom);l=u(e.canonical.url(this.terrainTiles,this.scheme),0,this.tileSize,n);}else l=u(t.tileID.canonical.url(this.terrainTiles,this.scheme),0,this.tileSize,n);const c={request:this.map._transformRequest(a,e.ResourceType.Tile),terrainRequest:{url:l},renderWithTerrain:s,demDataMaxZoom:this.demDataMaxZoom,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function h(e,r){return r||i(e,r),r&&r.terrainData&&(t.demHeight=r.terrainData.maximumHeight),t.aborted?i(null):e?i(e):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadImgAOTerrainData({data:r,painter:this.map.painter,justReloaded:!1,renderWithTerrain:this._renderWithTerrain,translation:this.translation,sttc:this.sttc,demDataMaxZoom:this.demDataMaxZoom,callback:i,url:a}),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}c.request.headers={Accept:"image/webp,*/*"},void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",c,h.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",c,h.bind(this),t.workerID);}abortTile(e,t){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),t();}unloadTile(e,t){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),t();}hasTransition(){return !1}isEarthSource(){return !0}_clearSourceCacheTiles(){const e=this._eventedParent;for(const t in e._tiles)e._removeTile(t);e._cache&&e._cache.reset();}setRenderWithTerrain(e){this.terrainTiles&&this.terrainTiles.length&&(this.renderWithTerrain=e,this._clearSourceCacheTiles(),this.load());}getRenderWithTerrain(){return this.renderWithTerrain}setTerrainTiles(e){if(!(e instanceof Array))throw new Error("terrainTiles should be an Array!");this.renderWithTerrain=!!e.length,this.terrainTiles=e,this._clearSourceCacheTiles(),this.load();}removeTerrainTiles(){this.setTerrainTiles([]);}}var hi=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ui=e.createLayout([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]);class di extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.coordinates=i.coordinates,this.grid=i.grid,this.wms=!!i.wms&&i.wms,this.url=i.url,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.heightOffset=i["image-height-offset"]||1,this.priorityRequest=i.priorityRequest||!1,this.setEventedParent(o),this.options=i,e.autobind_min.autobind(this);}_moveFn(){const e=this.map,t=e.unproject([0,0]),i=e.unproject([e.transform.width,0]),r=e.unproject([e.transform.width,e.transform.height]),o=e.unproject([0,e.transform.height]),s=Math.min(t.lat,i.lat,r.lat,o.lat),n=Math.min(t.lng,i.lng,r.lng,o.lng),a=Math.max(t.lat,i.lat,r.lat,o.lat),l=Math.max(t.lng,i.lng,r.lng,o.lng),c=`${n},${s},${l},${a}`,h=Math.ceil(e.transform.width),u=Math.ceil(e.transform.height),d=Math.ceil(e.transform.zoom);this.options.url=this.wmsUrl.replace("{bbox}",c).replace("{width}",h.toString()).replace("{height}",u.toString()).replace("{z}",d.toString()),this.setUrl(this.options.url,[[n,a],[l,a],[l,s],[n,s]]);}setUrl(t,i){this.url=t,this.options.url=t,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),((t,r)=>{t?this.fire(new e.ErrorEvent(t)):r&&(this.image=e.exported.getImageData(r),delete this.texture,i&&(this.coordinates=i),this._finishLoading());}));}load(t,i){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),((r,o)=>{this._loaded=!0,r?this.fire(new e.ErrorEvent(r)):o&&(this.image=o,t&&(this.coordinates=t),i&&i(),this._finishLoading());}));}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null;})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));}onAdd(e){if(this.map=e,this.wms){this.wmsUrl||(this.wmsUrl=this.options.url);const t=Math.ceil(e.transform.width),i=Math.ceil(e.transform.height),r=Math.ceil(e.transform.zoom),o=`${e.getBounds()._sw.lng},${e.getBounds()._sw.lat},${e.getBounds()._ne.lng},${e.getBounds()._ne.lat}`;this.options.url=this.wmsUrl.replace("{bbox}",o).replace("{width}",t.toString()).replace("{height}",i.toString()).replace("{z}",r.toString()),this.coordinates=[e.getBounds().getNorthWest().toArray(),e.getBounds().getNorthEast().toArray(),e.getBounds().getSouthEast().toArray(),e.getBounds().getSouthWest().toArray()],this.setCoordinates(this.coordinates),this.map.on("moveend",this._moveFn);}this.load();}onRemove(){this.map.off("moveend",this._moveFn);}setCoordinates(t){this.coordinates=t;const i=this.map,r=t.map((t=>i.transform.locationCoordinate(e.LngLat.convert(t)).zoomTo(0))),o=this.centerCoord=e.getCoordinatesCenter(r);o.column=Math.floor(o.column),o.row=Math.floor(o.row),this.tileID=new e.CanonicalTileID(o.zoom,o.column,o.row),this.minzoom=this.maxzoom=o.zoom;const s=r.map((t=>{const i=t.zoomTo(o.zoom);return new e.pointGeometry3d(Math.round((i.column-o.column)*e.EXTENT),Math.round((i.row-o.row)*e.EXTENT))})),n=[s[3].x,s[3].y],a=[s[2].x,s[2].y],l=[s[0].x,s[0].y],c=[s[1].x,s[1].y];let h=!1,u=null;h=!0,this._sphereBoundsArray=new e.StructArrayLayout5f20,this._sphereIndexArray=new e.StructArrayLayout3ui6,this.sphereSegments=new e.SegmentVector,this.sphereSegments.prepareSegment(0,this._sphereBoundsArray,this._sphereIndexArray),u=this.sphereSegments.prepareSegment(4,this._sphereBoundsArray,this._sphereIndexArray),this._boundsArray=new e.StructArrayLayout4i8,this._indexArray=new e.StructArrayLayout3ui6,this.segments=new e.SegmentVector,this.segments.prepareSegment(0,this._boundsArray,this._indexArray);const d=this.segments.prepareSegment(4,this._boundsArray,this._indexArray),_=19,m=this.heightOffset;for(let t=0;t<=_;t++){const i=[n[0]+(l[0]-n[0])/_*t,n[1]+(l[1]-n[1])/_*t],r=[a[0]+(c[0]-a[0])/_*t,a[1]+(c[1]-a[1])/_*t];for(let s=0;s<=_;s++){const n=[i[0]+(r[0]-i[0])/_*s,i[1]+(r[1]-i[1])/_*s],a=[s/_*e.EXTENT,(1-t/_)*e.EXTENT];this._boundsArray.emplaceBack(parseInt(n[0]),parseInt(n[1]),parseInt(a[0]),parseInt(a[1])),d.vertexLength++;{const t=e.getSpherePos(n[0],n[1],m,o.column,o.row,o.zoom,this.map.transform.projection);this.spaceBasePos||(this.spaceBasePos=t,this.matrix=new e.Matrix4(e.calc3dVectorTileTranslateMatrix([],this.spaceBasePos))),this._sphereBoundsArray.emplaceBack(t[0]-this.spaceBasePos[0],t[1]-this.spaceBasePos[1],t[2]-this.spaceBasePos[2],parseInt(a[0]),parseInt(a[1])),u.vertexLength++;}const l=s+20*t;t!==_&&s!==_&&(this._indexArray.emplaceBack(l,l+20+1,l+20),this._indexArray.emplaceBack(l,l+1,l+20+1),d.primitiveLength+=2,this._sphereIndexArray.emplaceBack(l,l+20+1,l+20),this._sphereIndexArray.emplaceBack(l,l+1,l+20+1),u.primitiveLength+=2);}}return this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.indexBuffer&&(this.indexBuffer.destroy(),delete this.indexBuffer),this.sphereBoundsBuffer&&(this.sphereBoundsBuffer.destroy(),delete this.sphereBoundsBuffer),this.sphereIndexBuffer&&(this.sphereIndexBuffer.destroy(),delete this.sphereIndexBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,hi.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,ui.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture||(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null));}serialize(){return {type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return !1}isEarthSource(){return !0}}class _i{static setUniforms(e){const{painter:t,program:i,videoMatchOptions:r,videoTextures:o}=e,s=[],n=[],a=[],l=[],c=[],h=new Float32Array(3*r.length);r.forEach(((e,t)=>{const i=e.enabled,r=e.clipVideo;l.push(e.videoAlpha),s.push(e.videoMatrix),n.push(o[t].textureUnit.INDEX),a.push(!!i),c.push(r?1:0),e.color&&(h[3*t]=e.color[0],h[3*t+1]=e.color[1],h[3*t+2]=e.color[2]);})),_i.uploadUniforms({painter:t,program:i,videoMats:s,videoClips:c,videoMatchMaps:a,textureUnits:n,videoAlphas:l,clipColors:h});}static uploadUniforms(e){const{painter:t,program:i,videoMats:r,videoClips:o,videoMatchMaps:s,textureUnits:n,videoAlphas:a,clipColors:l}=e,{gl:c}=t.context;c.uniform1iv(c.getUniformLocation(i.program,"u_VideoSampler"),n),c.uniform1iv(c.getUniformLocation(i.program,"u_HAS_VIDEOMATCHMAP"),s),c.uniform3fv(c.getUniformLocation(i.program,"u_clipColors"),l),t._map.activeClipVideo&&(c.uniform2fv(i.uniforms.u_texture_Size,[t.fbManager.maskFramebuffer.width,t.fbManager.maskFramebuffer.height]),c.uniform1fv(c.getUniformLocation(i.program,"u_active_clip_videoTexture"),o)),c.uniform1fv(c.getUniformLocation(i.program,"u_Alpha"),a),r.forEach(((e,t)=>{c.uniformMatrix4fv(c.getUniformLocation(i.program,`u_VIDEOMATCH_MVPMATRIX[${t}]`),!1,e.toFloat32Array());}));}reset(){}destroy(){}}class mi{constructor(e){this.context=e.context;const{gl:t}=e.context;this.usedUnitCount=0,this.maxTexture=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._groupId=0,this._createUnitObjectArray();}_createUnitObjectArray(){this.unUsedUnitObjectArray=[],this.usedUnitObjectArray=[];for(let t=0;t<this.maxTexture;t++)this.unUsedUnitObjectArray.push({VALUE:e.WebGLConstants.TEXTURE0+t,INDEX:t,USED:!1,DRAW_CALL_GROUP:-1});}genCurrentDrawCallGroupId(){return ++this._groupId}releaseCurrentDrawCallTextureUnitsByGroupId(e){const t=[];for(let i=0;i<this.usedUnitObjectArray.length;i++){const r=this.usedUnitObjectArray[i];e===r.DRAW_CALL_GROUP&&t.push(r);}for(;t.length>0;)this.releaseOneUnit(t[0]),t.splice(0,1);}getOneUnit(){if(this.unUsedUnitObjectArray.length>0){const e=this.unUsedUnitObjectArray.splice(0,1)[0];return e.USED=!0,this.usedUnitCount+=1,e.DRAW_CALL_GROUP=this._groupId,this.usedUnitObjectArray.push(e),e}throw new Error("当前申请纹理单元超过了GPU的最大纹理支持能力")}releaseOneUnit(e){if(e)for(let t=0;t<this.usedUnitObjectArray.length;t++){const i=this.usedUnitObjectArray[t];if(i.INDEX===e.INDEX&&i.VALUE===e.VALUE&&i.USED===e.USED){this.usedUnitCount-=1,this.usedUnitObjectArray.splice(t,1),e.USED=!1,e.DRAW_CALL_GROUP=-1,this.unUsedUnitObjectArray.push(e);break}}}static copy(e,t){const i=new mi({context:t});return e.usedUnitObjectArray.forEach((e=>{i.getOneUnit();})),i}reset(){this.usedUnitCount=0,this._createUnitObjectArray();}}function fi(e,t){return null!=e?e:t}fi.EMPTY_OBJECT=Object.freeze({});class pi{constructor(t){if(!t.videoPlayer)throw new Error("videoPlayer is null!");if(!t.videoParams.location)throw new Error("location is null!");this.videoPlayer=t.videoPlayer,this._enabled=fi(t.enabled,!1),this._location=t.videoParams.location,this._pitch=fi(t.videoParams.pitch,0),this._bearing=fi(t.videoParams.bearing,0),this._roll=fi(t.videoParams.roll,0),this._altitude=fi(t.videoParams.altitude,30),this._aspectRatio=fi(t.videoParams.aspectRatio,e.window.document.body.clientWidth/e.window.document.body.clientHeight),this._fov=fi(t.videoParams.fov,45),this._videoAlpha=fi(t.videoParams.alpha,1),this.scheduleOptions=fi(t.videoParams.scheduleOptions,{isVisable:!0,duration:0}),this.clipVideo=fi(t.clip,!0),this.userKey=fi(t.clipOptions.userKey,"1"),this.sceneId=fi(t.clipOptions.sceneId,"37"),this.polygonGeo=fi(t.clipOptions.polygonGeo,[]),this.key=fi(t.key,void 0),this.videoMatrix=void 0,this.videoTexture=void 0,this.painter=void 0,this._oldTransform=void 0,this._oldPitch=this.pitch,this._oldBearing=this.bearing,this._oldRoll=this.bearing,this._oldLocation=this.location,this._oldAltitude=this.altitude,this._oldFov=this.fov,this._oldAspectRatio=this.aspectRatio,this._transform=void 0,this._oldTransform=void 0;}get enabled(){return this._enabled}set enabled(e){"boolean"==typeof e&&(this._enabled=e);}get location(){return this._location}set location(e){Array.isArray(e)&&(this._oldLocation=this._location,this._location=e);}get pitch(){return this._pitch}set pitch(t){e.isNumber(t)&&(this._oldpitch=this._pitch,this._pitch=t);}get bearing(){return this._bearing}set bearing(t){e.isNumber(t)&&(this._oldBearing=this._bearing,this._bearing=t);}get roll(){return this._roll}set roll(t){e.isNumber(t)&&(this._oldRoll=this._roll,this._roll=t);}get altitude(){return this._altitude}set altitude(t){e.isNumber(t)&&(this._oldAltitude=this._altitude,this._altitude=t);}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){e.isNumber(t)&&(this._oldAspectRatio=this._aspectRatio,this._aspectRatio=t);}get fov(){return this._fov}set fov(t){e.isNumber(t)&&(this._oldFov=this._fov,this._fov=t);}get videoAlpha(){return this._videoAlpha}set videoAlpha(t){e.isNumber(t)&&(this._videoAlpha=t);}update(){this.updateVideoTexture(),this.updateTransform();}updateTransform(){if(this._transform=this.painter.transform,this.location!==this._oldLocation||this.pitch!==this._oldPitch||this.bearing!==this._oldBearing||this.roll!==this._oldRoll||this.altitude!==this._oldAltitude||this.aspectRatio!==this._oldAspectRatio||this._oldTransform!==this._transform){this._oldTransform=void 0,this._oldPitch=this.pitch,this._oldBearing=this.bearing,this._oldRoll=this.bearing,this._oldLocation=this.location,this._oldAltitude=this.altitude,this._oldFov=this.fov,this._oldAspectRatio=this.aspectRatio,this._oldTransform=this._transform;const t=new e.Matrix4,i=new e.Vector4([0,0,0,1]),r=new e.Vector4([0,0,-1,1]),o=new e.Vector4([0,1,0,1]),s=this._transform._getEarthMatrix({lng:this.location[0]?this.location[0]:this.location.lng,lat:this.location[1]?this.location[1]:this.location.lat,pitch:this.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,bearing:this.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,roll:this.roll*e.CONSTS.TRANSFORM.DEG_TO_RAD,altitude:this.altitude*e.CONSTS.TRANSFORM.R_SCALE});i.transform(s),r.transform(s),o.transform(s),t.lookAt(i,r,[o[0]-i[0],o[1]-i[1],o[2]-i[2]]);const n=new e.Matrix4;n.perspective({fov:this.fov*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:this.aspectRatio,near:.1*e.CONSTS.TRANSFORM.R_SCALE,far:1e4*e.CONSTS.TRANSFORM.R_SCALE}),this.videoMatrix=n.multiplyRight(t);}}updateVideoTexture(){(void 0!==this.videoPlayer&&this._enabled||void 0===this.videoTexture)&&(this.videoTexture=this.videoPlayer.getVideo());}}class gi{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!r||!r.flipY),this.update(t,r);}update(t,i){const{context:r}=this,{gl:o}=r;r.pixelStoreUnpackFlipY.set(this.flipY),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!i||!1!==i.premultiply)),o.bindTexture(o.TEXTURE_CUBE_MAP,this.texture);const s=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS;for(let e=0;e<6;e++)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t[s[e]]);o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.bindTexture(o.TEXTURE_CUBE_MAP,null);}bind(){const{context:e}=this,{gl:t}=e;t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture);}destroy(){if(!this.context)return;const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null,this.context=null;}}class vi extends e.Evented{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.type="sphere-image",this.minzoom=0,this.maxzoom=22,this.setEventedParent(r),this._options=t,this.renderAtmosphere=t.renderAtmosphere||!1,this.dayTextureUrl=t.dayTextureUrl||null,this.nightTextureUrl=t.nightTextureUrl||null,this.cloudTextureUrl=t.cloudTextureUrl||null,this.priorityRequest=t.priorityRequest||!1,this.isCubeMap="object"==typeof this._options.url,this.brdfUrl=this._options.brdfUrl,this.cloudTime=0,this.skyTime=0;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this._options.url;const t=[];if(this.isCubeMap){const i=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS;this.image||(this.image={});for(let r=0;r<6;r++)(i=>{e.getImage(this.map._transformRequest(this.url.maps[i],e.ResourceType.Image),((r,o)=>{r?this.fire(new e.ErrorEvent(r)):o&&(this.image[i]=o),t.push(0),this._promiseDelegate(t);}));})(i[r]);if(this.dayTextureUrl){this.dayTextureImage||(this.dayTextureImage={});for(let r=0;r<6;r++)(i=>{e.getImage(this.map._transformRequest(this.dayTextureUrl[i],e.ResourceType.Image),((r,o)=>{r?this.fire(new e.ErrorEvent(r)):o&&(this.dayTextureImage[i]=o),t.push(0),this._promiseDelegate(t);}));})(i[r]);}else if(this.nightTextureUrl){this.nightTextureImage||(this.nightTextureImage={});for(let r=0;r<6;r++)(i=>{e.getImage(this.map._transformRequest(this.nightTextureUrl[i],e.ResourceType.Image),((r,o)=>{r?this.fire(new e.ErrorEvent(r)):o&&(this.nightTextureImage[i]=o),t.push(0),this._promiseDelegate(t);}));})(i[r]);}}else e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),((i,r)=>{i?this.fire(new e.ErrorEvent(i)):r&&(this.image=r),t.push(0),this._promiseDelegate(t);})),this.cloudTextureUrl&&e.getImage(this.map._transformRequest(this.cloudTextureUrl,e.ResourceType.Image),((i,r)=>{i?this.fire(new e.ErrorEvent(i)):r&&(this.cloudImage=r),t.push(0),this._promiseDelegate(t);})),this.dayTextureUrl&&e.getImage(this.map._transformRequest(this.dayTextureUrl,e.ResourceType.Image),((i,r)=>{i?this.fire(new e.ErrorEvent(i)):r&&(this.dayTextureImage=r),t.push(0),this._promiseDelegate(t);})),this.nightTextureUrl&&e.getImage(this.map._transformRequest(this.nightTextureUrl,e.ResourceType.Image),((i,r)=>{i?this.fire(new e.ErrorEvent(i)):r&&(this.nightTextureImage=r),t.push(0),this._promiseDelegate(t);}));}_promiseDelegate(e){if(this.isCubeMap){if(this.dayTextureUrl&&e.length!==2*(this.isCubeMap?6:1))return;if(this.nightTextureUrl&&e.length!==2*(this.isCubeMap?6:1))return;if(this.isCubeMap&&6!==e.length)return}else {const t=[this.cloudTextureUrl,this.nightTextureUrl,this.dayTextureUrl,this.url];let i=0;for(let e=0;e<t.length;e++)null!=t[e]&&null!=t[e]&&i++;if(e.length!=i)return}this._finishLoading();}_finishLoading(){this.map&&(this.prepare(),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));}onAdd(e){this.map=e,this.load();}prepare(){const t=this.map.painter.context,i=t.gl;!this.texture&&this.image&&(this.isCubeMap?(this.texture=new gi(t,this.image,i.RGBA),this.texture.bind()):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))),!this.cloudTexture&&this.cloudImage&&(this.cloudTexture=new e.Texture(t,this.cloudImage,i.RGBA),this.cloudTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.id===e.CONSTS.SOURCE.SKYBOX_SOURCE_ID&&this.map.painter.setSkyBoxMapTexture(this.texture,this.isCubeMap),this.dayTextureImage&&!this.dayTexture&&(this.isCubeMap?(this.dayTexture=new gi(t,this.dayTextureImage,i.RGBA),this.dayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)):(this.dayTexture=new e.Texture(t,this.dayTextureImage,i.RGBA),this.dayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE))),this.nightTextureImage&&!this.nightTexture&&(this.isCubeMap?(this.nightTexture=new gi(t,this.nightTextureImage,i.RGBA),this.nightTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)):(this.nightTexture=new e.Texture(t,this.nightTextureImage,i.RGBA),this.nightTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)));}serialize(){return {type:"sphere-image",url:this._options.url,renderInner:this._options.renderInner,radius:this._options.radius,gridSamples:this._options.gridSamples,extractRadius:this._options.extractRadius,debug:this._options.debug||!1,renderAtmosphere:this._options.renderAtmosphere||!1,dayTextureUrl:this._options.dayTextureUrl||null,nightTextureUrl:this._options.nightTextureUrl||null}}loadTile(){}hasTransition(){return !1}isEarthSource(){return !0}}class xi extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.type="panorama",this.minzoom=0,this.maxzoom=22,this._pictureFloder=i.pictureFloder||"pano",this.dataType=i.dataType||"equirectangular",this.setEventedParent(o),this._options=i,this._location=i.location,this._photoId=i.photoId,this._staticImgUrl=`${this._options.url.substring(0,this._options.url.indexOf("get-panorama"))}static/${this._pictureFloder}/`,this._strictRefresh=!0,this._eles=[],e.autobind_min.autobind(this);}_animateMapZoom(e,t,i,r){this._frame&&this.map._cancelRenderFrame(this._frame);const o=Date.now()-this._startTime;o<1e3?(this.map.setZoom(o/1e3*6.5),this._frame=this.map._requestRenderFrame(this._animateMapZoom.bind(this,e,t,i,r))):this.setPhotoId(e,t,i,r);}_distanceMouseMoveCallBack(t){const i=this.map;if(!this._panoJson||!i.panoramaMode)return;const r=this._panoJson.properties.angle.pitch*Math.sin(Math.abs(t.lngLat.lat/2));if(!i.panoramaMode||t.lngLat.lat-r<0||t.lngLat.lat-r>17)return void(this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="none"));this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="block"),this._distanceNodeElementWrapper||(this._distanceNodeElementWrapper=e.DOM.create("div","minemap-panorama-distance-wrapper",i.getCanvasContainer()),this._distanceNodeElement=e.DOM.create("div","minemap-panorama-distance-circle",this._distanceNodeElementWrapper),this._distanceNodeText=e.DOM.create("div","minemap-panorama-distance-text",this._distanceNodeElementWrapper),this._distanceNodeText.innerText="向前移动5米",this._distanceNodeElement.extra={distance:0,directional:"front",directionalId:"",directionalChange:0},e.DOM.addEventListener(this._distanceNodeElement,"click",this._panoControlCallBack));const o=this._panoJson.properties.links;let s=null;const n=t.lngLat.lng;for(let e=0;e<o.length;e++){const t=o[e].angleRange;t.min>t.max?(n>=-180&&n<=t.max||n>=t.min&&n<=180)&&(s=o[e]):n>=t.min&&n<=t.max&&(s=o[e]);}if(!s)return this._distanceNodeElement.extra={distance:0,directional:null,directionalId:"",directionalChange:0},void(this._distanceNodeElementWrapper.style.display="none");this._distanceNodeElementWrapper.style.top=t.point.y-80+"px",this._distanceNodeElementWrapper.style.left=t.point.x-80+"px",this._distanceNodeElement.style["background-size"]=`${100-(18-t.lngLat.lat)/18*100}% ${100-(18-t.lngLat.lat)/18*100}%`,this._wrapperDOM&&"block"===this._wrapperDOM.style.display&&parseInt(this._wrapperDOM.style.top)-parseInt(this._distanceNodeElementWrapper.style.top)<4&&(this._distanceNodeElementWrapper.style.display="none");const a=(18-t.lngLat.lat)/18*100;this._distanceNodeText.innerText=`向前移动${a.toFixed(0)}米`,this._distanceNodeElement.extra={distance:a,directional:s.directional,directionalId:s.name,directionalChange:s.directionalChange,dir:s.dir},e.DOM.setTransform(this._distanceNodeElement,"rotateX(75deg) rotateZ(0deg)");}_mouseOverCallBack(){this._showControlBtn();}_panoControlCallBack(e){const t=e.target.extra;if(t.hasOwnProperty("distance")){if(t.distance<=2)return;this._startTime=Date.now(),this.map.transform.panoAnyWhereMoveAngle=-t.dir+this._panoAngleYaw+180,this._animateMapZoom(t.directionalId,t.directional,t.distance,t.directionalChange);}else {const e=t.name;this._startTime=Date.now(),this.map.transform.panoAnyWhereMoveAngle=-t.dir+this._panoAngleYaw+180,this._animateMapZoom(e);}}_parseControlBtn(t){const i=this.map;if(this._eles&&this._eles.length>0){for(let t=0;t<this._eles.length;t++)e.DOM.removeEventListener(this._eles[t],"click",this._panoControlCallBack),e.DOM.remove(this._eles[t]);e.DOM.remove(this._wrapperDOM);}this._distanceNodeElement&&(e.DOM.removeEventListener(this._distanceNodeElement,"click",this._panoControlCallBack),this._distanceNodeElementWrapper&&e.DOM.remove(this._distanceNodeElementWrapper),this._distanceNodeElementWrapper=null),this._eles=[],this._wrapperDOM=e.DOM.create("div","minemap-panorama-wrapper",this.map.getCanvasContainer()),this._wrapperDOM.style.top=i.transform.height/2+150+"px",this._wrapperDOM.style.left=i.transform.width/2-150+"px",this._wrapperDOM.style.display="none";for(let i=0;i<t.length;i++){const r=e.DOM.create("div","minemap-panorama",this._wrapperDOM);r.innerText=t[i]&&t[i].dirName,r.style.transform=`rotateZ(${t[i].dir-this._panoAngleYaw+180}deg) translateY(-100px)`,r.extra=t[i];let o=t[i].dir-this._panoAngleYaw-20,s=t[i].dir-this._panoAngleYaw+20;for(;o>180;)o-=360;for(;o<-180;)o+=360;for(;s>180;)s-=360;for(;s<-180;)s+=360;t[i].angleRange={min:o,max:s},e.DOM.addEventListener(r,"click",this._panoControlCallBack),this._eles.push(r);}e.DOM.setTransform(this._wrapperDOM,`rotateX(75deg) rotateZ(${this.map.getCenter().lng+90}deg)`);}_showControlBtn(){this._wrapperDOM&&(this._wrapperDOM.style.display="block");}_hideControlBtn(){this._wrapperDOM&&(this._wrapperDOM.style.display="none");}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this._location?this._options.url.replace("{location}",this._location).replace("{photoId}",-1).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0):this._directional?this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",this._directional).replace("{distance}",this._distance).replace("{directionalChange}",this._directionalChange):this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0),e.getJSON(this.map._transformRequest(this.url,e.ResourceType.PanoramaJson),((t,i)=>{if(t)return void this.fire(new e.ErrorEvent(t));this._panoAngleYaw=i.properties.angle.yaw,this._parseControlBtn(i.properties.links),this._panoJson=i;const r=this.map._transformRequest(this._staticImgUrl+i.properties.name+i.properties.suffix,e.ResourceType.PanoramaImage);r.imageBitmapOptions={imageOrientation:"flipY"},e.getImage(r,((i,r)=>{i?this.fire(new e.ErrorEvent(t)):(r&&(this.image=r),this._finishLoading());}));}));}setLocation(e){e&&(this._strictRefresh=!0,this._location=e,this.load());}setPhotoId(e,t,i,r){e&&(this._strictRefresh=!0,this._photoId=e,this._directional=t,this._distance=i,this._location=null,this._directionalChange=r,this.load());}_finishLoading(){this.map&&(this.sphereArray?this.prepare(!0):(this.sphereArray=new e.StructArrayLayout5f20,e.sphereGenerator(1,7,256,e.ProjectionType.LATLON,this.sphereArray),this.prepare(!0),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"}))));}_panoUpdateArrowDirCallBack(){const t=this.map;this._wrapperDOM&&(t.transform._center.lat>30||t.transform._center.lat<-8||!t.panoramaMode?this._hideControlBtn():(this._showControlBtn(),e.DOM.setTransform(this._wrapperDOM,`rotateX(${60-t.transform._center.lat}deg) rotateZ(${this.map.getCenter().lng+90}deg)`)),this.map.fire(new e.Event("panorama-change-bearing",{angle:-this._panoAngleYaw+t.getCenter().lng+90})));}_panoUpdateArrowMoveednCallBack(){}_panoDragPan(){let t;this.map.getCenter().lng<=0&&this.map.getCenter().lng>=-180?t=360+this.map.getCenter().lng:this.map.getCenter().lng>0&&this.map.getCenter().lng<=180&&(t=this.map.getCenter().lng),this.map.fire(new e.Event("panorama-drag",{angle:t,lng:this.map.getCenter().lng}));}onAdd(e){this.map=e,e.on("move",this._panoUpdateArrowDirCallBack),e.on("mousemove",this._distanceMouseMoveCallBack),e.on("drag",this._panoDragPan),this.load();}onRemove(){this.map.off("move",this._panoUpdateArrowDirCallBack),this.map.off("mousemove",this._distanceMouseMoveCallBack),this.map.off("drag",this._panoDragPan);for(let t=0;t<this._eles.length;t++)e.DOM.removeEventListener(this._eles[t],"click",this._panoControlCallBack),e.DOM.remove(this._eles[t]);this.map._cancelRenderFrame(this._frame),this._eles=[],this.map=null;}setNewDataCallback(e){this._newDataCallback=e;}prepare(t){const i=this.map.painter.context,r=i.gl;this._strictRefresh&&t&&this.sphereArray&&(this.sphereBuffer||(this.sphereBuffer=i.createVertexBuffer(this.sphereArray,ui.members)),this.sphereVAO||(this.sphereVAO=new Le),!this.texture&&this.image?(this.texture=new e.Texture(i,this.image,r.RGBA,{flipY:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.fire(new e.Event("data",{type:"panoram-changed"}))):(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),i.pixelStoreUnpackFlipY.set(!0),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.image),this.map._cancelRenderFrame(this._frame),this._newDataCallback&&this._newDataCallback(this._panoJson.properties.name),this.map.setCenter([90,this.map.getCenter().lat]),this.map.fire(new e.Event("panorama-change-bearing",{angle:90-this._panoAngleYaw+180})),this.map.setZoom(0),this.fire(new e.Event("data",{type:"panoram-changed"}))),this._strictRefresh=!1);}serialize(){return {type:"panorama",url:this._options.url,debug:this._options.debug||!1}}hasTransition(){return !1}isEarthSource(){return !0}}class yi extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this.dispatcher=r,this.type="3d-tile",this.minzoom=15,this.maxzoom=22,this.scheme="xyz",this.reparseOverscaled=!0,this.isTileClipped=!0,this.tileJson={},this.vectorLayerIds=[],this.identityMatrix=!0,e.extend(this,e.pick(i,["url","scheme","modelFolder","location","translation","filter","minzoom","maxzoom"])),this._options=e.extend({type:this.type},i),this.translation||(this.translation=[0,0,0]),this.flipYZ=i.flipYZ||!1,this.noQuery=!i.hasOwnProperty("noQuery")||i.noQuery,this.videoMatchOption=i.videoMatchOption,this.activeClipVideo=i.activeClipVideo||!1,this._useVideoProject=!!i.useVideoProject&&i.useVideoProject,this.priorityRequest=i.priorityRequest||!1,this.ratioRange=i.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=i.clampBox||{x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0,translation:[0,0,0]},this.location&&(this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location)),this.clampPlane=i.clampPlane||[0,0,0,0],this._clampEnabled=i.clampEnabled||!1,this.noHighlighting=i.noHighlighting,this.maxTiles=i.maxTiles||4,this._pickable=i.pickable||!1,this._collectResourceTiming=i.collectResourceTiming,this.filter&&this.setFilter(this.filter),this.classificationData=i.classificationData,this.prepareClassificationData(),this.setEventedParent(o);}get useVideoProject(){return this._useVideoProject}set useVideoProject(e){"boolean"==typeof e&&(this._useVideoProject=e);}prepareClassificationData(){if(this.classificationData){this.processedClassificationDataArray||(this.processedClassificationDataArray=[]);for(let t=0;t<this.classificationData.features.length;t++){const i=this.classificationData.features[t],r=i.geometry.coordinates[0],o=[],s=[],n=e.earcut_1.flatten(i.geometry.coordinates);for(let t=0;t<n.vertices.length;t+=n.dimensions||2){const r=e.transformECEFToGeographic([],[n.vertices[t],n.vertices[t+1]],i.properties.top*e.CONSTS.TRANSFORM.R_SCALE+e.CONSTS.TRANSFORM.R);o.push(r);const a=e.transformECEFToGeographic([],[n.vertices[t],n.vertices[t+1]],i.properties.bottom*e.CONSTS.TRANSFORM.R_SCALE+e.CONSTS.TRANSFORM.R);s.push(a);}const a=e.earcut_1(n.vertices,n.holes,n.dimensions);this.processedClassificationDataArray.push({topPoints:o,bottomPoints:s,properties:i.properties,originData:r,holes:n.holes,indexes:a});}this.classificationData=null;}}queryIntersectedClassificationFeature(t){if(!this.processedClassificationDataArray||0===this.processedClassificationDataArray.length)return null;let i=null,r=1/0;for(let o=0;o<this.processedClassificationDataArray.length;o++){const s=this.processedClassificationDataArray[o],n=s.properties,a=this._getClassificationTriangles(s.topPoints,s.bottomPoints,s.holes,s.indexes);for(let o=0;o<a.length;o++){const l=t.intersectTriangle(...a[o],!1,[]);if(l){const o=new e.Vector3(t.origin).distance(l);o<r&&(r=o,i={properties:n,data:s.originData});}}}return i}_getClassificationTriangles(e,t,i,r){const o=[];for(let i=0;i<r.length;i+=3){const s=r[i],n=r[i+1],a=r[i+2];o.push([e[s],e[n],e[a]]),o.push([t[s],t[n],t[a]]);}let s=0,n=0;for(let r=1;r<e.length;r++){if(0!==i.length)if(0===s)s=i[n++];else if(r===s){n<=i.length-1&&(s=i[n++]);continue}o.push([e[r],e[r-1],t[r-1]]),o.push([e[r],t[r-1],t[r]]);}return o}set clampEnabled(e){this._clampEnabled=e;}get clampEnabled(){return this._clampEnabled}enableVideoMatch(){this.videoMatchOption&&(this.videoMatchEnabled=!0);}disableVideoMatch(){this.videoMatchEnabled=!1;}setClampRange(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new e.Event("data",{data:t})));}setClampBox(t){!t instanceof Object&&(console.warn("Parameter should be a crop box object"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(this.clampBox,t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.fire(new e.Event("data",{data:this.clampBox}));}getClampBoxMatrix(t,i){let{rotateX:r,rotateY:o,rotateZ:s,anchor:n,translation:a}=t;const l=new e.Matrix4;a&&(n=e.getTranslatedLngLatPoint(n,a)),l.rotateZ(-s*e.CONSTS.TRANSFORM.DEG_TO_RAD),l.rotateX(-r*e.CONSTS.TRANSFORM.DEG_TO_RAD),l.rotateY(-o*e.CONSTS.TRANSFORM.DEG_TO_RAD);const c=e.calcLocalCoords(n,i,!1);return l.translate([-c[0],-c[1],-c[2]]),l}setClampPlane(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new e.Event("data",{data:t})));}clearClampPlane(){this.clampPlane=[0,0,0,0],this.fire(new e.Event("data",{data:this.clampPlane}));}clearClampBox(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new e.Event("data",{data:this.clampBox}));}enablePick(){this._pickable=!0;}disablePick(){this._pickable=!1;}clearPick(){}setFilter(t){this._featureFilter=e.createFilter(t);}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=e.getJSON(this.map._transformRequest(u(this._options.url||""),e.ResourceType.Source),((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(this.tileJson=i,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}prepare(){this.gltfModelVAO||(this.gltfModelVAO=new Le);}_reUploadTexture(){const e=this.map.painter.context;this.videoTextures.forEach(((t,i)=>{e.activeTexture.set(t.textureUnit.VALUE),t.bind(e.gl.LINEAR,e.gl.CLAMP_TO_EDGE);}));}hasTile(e){return !0}onAdd(e){this.map=e,this.load();}onRemove(e){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(e,t){}abortTile(e,t){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e,t){e.unloadVectorData(),this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}}const Ti={vector:class extends e.Evented{constructor(t,i,r,o){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._minMax3dtileBoundHeight={minHeight:0,maxHeight:0},e.extend(this,e.pick(i,["url","scheme","tileSize"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.promoteId=i.promoteId,this.priorityRequest=i.priorityRequest||!1,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this._adcode=i.adcode,this.setEventedParent(o);}set adcode(e){this._adcode!==e&&(this._adcode=e,this._eventedParent&&this._eventedParent.reload&&this._eventedParent.reload(!0));}get adcode(){return this._adcode}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=si(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new ni(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(t,i){const r=t.tileID.canonical.toRealCoord(this.scheme);let o=u(t.tileID.canonical.url(this.tiles,this.scheme),0,void 0,r);this._adcode&&(o=`${o}&admincode=${this._adcode}`);const s={request:this.map._transformRequest(o,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,demHeight:this.demHeight,minMax3dtileBoundHeight:this._minMax3dtileBoundHeight};function n(e,r){return t.aborted?i(null):e?i(e):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}s.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",s,n.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",s,n.bind(this),t.workerID);}abortTile(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}},raster:ci,geojson:class extends e.Evented{constructor(t,i,r,o){super(),this.id=t,this._minMax3dtileBoundHeight={minHeight:0,maxHeight:0},this.type="geojson",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.priorityRequest=i.priorityRequest||!1,this.dispatcher=r,this.setEventedParent(o),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.noBox=i.noBox;const s=e.EXTENT/this.tileSize;this.promoteId=i.promoteId,this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*s,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),this._timestamp=Date.now();}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i));}));}onAdd(e){this.map=e,this.load();}setData(t){return this._data=t,this._timestamp=Date.now(),this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i)),this._eventedParent&&this._eventedParent.reload&&this._eventedParent.reload(!0);})),this}getClusterExpansionZoom(e,t){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t,this.workerID),this}getClusterChildren(e,t){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t,this.workerID),this}getClusterLeaves(e,t,i,r){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},r,this.workerID),this}_updateWorkerData(t){const i=e.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._transformRequest(e.exported.resolveURL(r),e.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.workerID=this.dispatcher.send(`${this.type}.loadData`,i,((e,r)=>{this._removed||r&&r.abandoned||(this._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[this.id]&&(this._resourceTiming=r.resourceTiming[this.id].slice(0)),this.dispatcher.send(`${this.type}.coalesce`,{source:i.source},null,this.workerID),t(e));}),this.workerID);}loadTile(t,i){const r=void 0===t.workerID?"loadTile":"reloadTile";t.workerID=this.dispatcher.send(r,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,demHeight:this.demHeight,minMax3dtileBoundHeight:this._minMax3dtileBoundHeight},((e,o)=>(t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(o,this.map.painter,"reloadTile"===r),i(null)))),this.workerID);}abortTile(e){e.aborted=!0;}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID);}onRemove(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return !1}isEarthSource(){return !0}},video:class extends di{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t;}load(){const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint();})),this.map&&this.video.play(),this._finishLoading());}));}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,hi.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,ui.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},"video-project":class{constructor(e,t){this.id=e,this.type=t.type,this._videoMatchOptions=new kt,this.map=void 0,this.videoTextures=[],this._textureMangeBackUp=void 0,this.available=!1,t.videoMatchOptions&&this._parseVideoMatchOptions(t.videoMatchOptions),this.state="loaded";}_parseVideoMatchOptions(e){e.forEach(((e,t)=>{e.key=t+1;const i=new pi(e);this._videoMatchOptions.set(i.userKey,i);}));}prepare(){this._videoMatchOptions.values.forEach((e=>{void 0===e.painter&&(e.painter=this.map.painter),e.update();})),this.available||(this.available=!0);}_parseVideoTexture(t,i,r){if(void 0===this.map)throw new Error("当前souruce的map没有准备好!");if(this._videoMatchOptions&&this._videoMatchOptions.length>0){const o=this.map.painter.context,s=o._Program.textureUnitManager,n=o.gl;this._videoMatchOptions.values&&this._videoMatchOptions.length>0&&this._videoMatchOptions.values.forEach(((t,i)=>{this.videoTextures[i]?(this.videoTextures[i].textureUnit=s.getOneUnit(),this.videoTextures[i].bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,t.videoTexture)):(this.videoTextures[i]=new e.Texture(o,t.videoTexture,n.RGB),this.videoTextures[i].textureUnit=s.getOneUnit(),this.videoTextures[i].bind(n.LINEAR,n.CLAMP_TO_EDGE));})),r=!0,_i.setUniforms({painter:t,program:i,videoMatchOptions:this._videoMatchOptions.values,videoTextures:this.videoTextures});}return r}_reUploadTexture(e){this.videoTextures.forEach(((t,i)=>{e.activeTexture.set(t.textureUnit.VALUE),t.bind(e.gl.LINEAR,e.gl.CLAMP_TO_EDGE);}));}uploadTexture(e,t){const i=e.context,r=i.gl;if(this._textureMangeBackUp&&(t.textureUnitManager=mi.copy(this._textureMangeBackUp,i)),this._videoMatchOptions&&this._videoMatchOptions.length>0)if(this._reUploadTexture(i),e._map.activeClipVideo){const o=t.textureUnitManager.getOneUnit();i.activeTexture.set(o.VALUE),r.bindTexture(r.TEXTURE_2D,e.fbManager.maskFramebuffer.colorAttachment.get()),r.uniform1i(t.uniforms.u_maskSample,o.INDEX),r.uniform1f(t.uniforms.u_clip_video,!0),e.fbManager.maskFramebuffer.vpMatrix&&r.uniformMatrix4fv(t.uniforms.u_clip_Mattrix,!1,e.fbManager.maskFramebuffer.vpMatrix.toFloat32Array());}else r.uniform1f(t.uniforms.u_clip_video,!1);}getVideoOptionByKey(e){const t=[];return e&&this._videoMatchOptions.length>0&&this._videoMatchOptions.values.forEach((i=>{i.userKey!==e&&i.userKey!==e.toString()||t.push(i);})),t}addVideoOption(e,t){return e&&t?(t=new pi(t),this._videoMatchOptions.set(e,t),t):void 0}removeVideoOptionBykey(e){if(this._videoMatchOptions.contains(e)){let t=0;for(let i=0;i<this._videoMatchOptions.length;i++)if(this._videoMatchOptions.values[i].userKey===e){t=i;break}return this._videoMatchOptions.remove(e),this.videoTextures.splice(t,1),!0}return !1}load(e){}onAdd(e){this.map=e,this.load(e);}serialize(){return {type:"video-project",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return !1}},image:di,canvas:class extends di{constructor(t,i,r,o){super(t,i,r,o),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate;}load(){this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint();},this.pause=function(){this._playing=!1;},this._finishLoading());}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play();}onRemove(){this.pause();}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,hi.members)),this.boundsVAO||(this.boundsVAO=new Le),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.canvas)):(this.texture=new e.Texture(i,this.canvas,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of [this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return !0;return !1}isEarthSource(){return !1}},"sphere-image":vi,"3d-model":Yt,"3d-tiles":class extends yi{constructor(e,t,i,r){super(e,t,i,r),this.type="3d-tiles",this.priorityRequest=t.priorityRequest||!1,this.layers=t.urls,this.log=t.log||!1,this.useMipmap=void 0!==t.useMipmap&&t.useMipmap,this.useRegularEllipsoid=t.useRegularEllipsoid||!1;}load(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"}));}loadTile(e,t,i){}},panorama:xi},Si=function(t,i,r,o){const s=new Ti[i.type](t,i,r,o);if(s.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${s.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],s),s};function bi(t,i){const r=new e.Matrix4;return r.translate([1,1,0]),r.scale([.5*t.width,.5*t.height,1]),r.multiplyRight(t.calculatePosMatrix(i.toUnwrapped()))}function wi(e,t,i,r,o){const s=function(e,t,i){if(e)for(const r of e){const e=t[r];if(e&&e.source===i&&("extrusion"===e.type||"histogram"===e.type))return !0}else for(const e in t){const r=t[e];if(r.source===i&&("extrusion"===r.type||"histogram"===r.type))return !0}return !1}(r&&r.layers,t,e.id),n=o.maxPitchScaleFactor(),a=e.tilesIn(i,n,s);a.sort(Ri);const l=[];for(const i of a)l.push({wrappedTileID:i.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,e._state,i.queryGeometry,i.cameraQueryGeometry,i.scale,r,o,n,bi(e.transform,i.tileID))});const c=function(e){const t={},i={};for(const r of e){const e=r.queryResults,o=r.wrappedTileID,s=i[o]=i[o]||{};for(const i in e){const r=e[i],o=s[i]=s[i]||{},n=t[i]=t[i]||[];for(const e of r)o[e.featureIndex]||(o[e.featureIndex]=!0,e.feature.intersectionZ=e.intersectionZ,n.push(e.feature));}}return t}(l);for(const t in c)c[t].forEach((t=>{const i=e.getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=i;}));return c}function Ei(t,i,r,o,s,n){const a={};if(!o.layers)return {};for(let l=0;l<o.layers.length;l++){const c=o.layers[l];if("extrusion"===i[c].type){const o=t.tilesInOfSphereExtrusion(r,s,i[c]),l=[];let h,u=1/0;o.map((t=>((t?t.featureTrangles:[]).map((t=>{const i=t.triangles;for(let r=0;r<i.length;r++){const o=n.intersectTriangle(...i[r],!1,[]);if(o){const i=new e.Vector3(n.origin).distance(o);i<u&&(u=i,h=t.feature);}}return null})),null))),h&&l.push({feature:h,intersectionZ:u}),a[`${c}`]=l;}}return a}function Mi(e,t,i,r,o,s,n){let a=[];const l=e.getSource();let c="";for(const i in t)t[i].source===e.id&&(c=i);const h={};let u=!1;if(e._source.processedClassificationDataArray&&e._source.processedClassificationDataArray.length>0){const t=e._source.queryIntersectedClassificationFeature(s);return h[c]=t?[t]:[],h}for(const n in t){const l=t[n];l.source===e.id&&(c=n,l.useLayerPosition&&(u=!0,l.clearPick(),a=a.concat(l.queryLayerRenderedFeatures(t,i,r,o,s,e))));}return u||(a=l.queryRenderedFeatures(t,i,r,o,s,e)),0===a.length?(l.clearPick(),null):(u&&(a.sort(((e,t)=>e.intersectionZ-t.intersectionZ)),c=a[0].layer),n&&a[0]._parent.highlightMesh(a[0]),h[c]=a,h)}function Ai(e,t,i,r,o,s,n){let a="";for(const i in t)t[i].source===e.id&&(a=i);const l={};if(e._source.processedClassificationDataArray&&e._source.processedClassificationDataArray.length>0){const t=e._source.queryIntersectedClassificationFeature(s);return l[a]=t?[t]:[],l}{const c=e.tilesIn(i,0,!0);let h=[];for(const n of c){const a=n.queryRenderedFeatures(t,i,r,o,s,e);h=h.concat(a),n.clearPick();}let u=1/0,d=0;for(let e=0;e<h.length;e++)h[e].intersectionZ<u&&(d=e,u=h[e].intersectionZ);if(0===h.length)return null;const _=h[d];return n?_._parent.highlightMesh(_):_._parent=null,l[a]=[_],l}}function Ci(e,t,i,r,o,s,n,a){const l={};let c=[];if(n&&a)for(let e=0;e<i.length;e++){const t=n.pointLocation(i[e],a.z_ndc);if(!t)continue;const r=n.coordinatePoint(n.locationCoordinate(t));c.push(r);}else c=i;const h=o.queryRenderedSymbols(c),u=[];for(const e of Object.keys(h).map(Number))u.push(s[e]);u.sort(Ri);for(const t of u){const i=t.featureIndex.lookupSymbolFeatures(h[t.bucketInstanceId],t.bucketIndex,t.sourceLayerIndex,r.filter,r.layers,e);for(const e in i){const r=l[e]=l[e]||[],o=i[e];o.sort(((e,i)=>{const r=t.featureSortOrder;if(r){const t=r.indexOf(e.featureIndex);return r.indexOf(i.featureIndex)-t}return i.featureIndex-e.featureIndex}));for(const e of o)r.push(e.feature);}}for(const i in l)l[i].forEach((r=>{const o=t[e[i].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o;}));return l}function Ri(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function Li(){return new e.window.Worker(Xc.workerUrl)}const Pi="mapboxgl_preloaded_worker_pool";class Ii{constructor(){this.active={};}acquire(e){if(!this.workers){const e=Ii.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new Li);}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((e=>{e.terminate();})),this.workers=null);}isPreloaded(){return !!this.active[Pi]}numActive(){return Object.keys(this.active).length}}const Oi=Math.floor(e.exported.hardwareConcurrency/2)-1;let Di;function Ni(){return Di||(Di=new Ii),Di}function Fi(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(r[e]=i[e]);})),r}function Bi(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Fi(e[i],t[e[i].ref]));return e}Ii.workerCount=Math.max(Math.min(Oi,6),1);const Ui={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zi(e,t,i,r){i.push({command:Ui.addSource,args:[e,t[e],{isOriginal:r}]});}function Gi(e,t,i){t.push({command:Ui.removeSource,args:[e]}),i[e]=!0;}function Vi(e,t,i,r,o){Gi(e,i,r),zi(e,t,i,o);}function ki(e,t,r){let o;for(o in e[r])if(e[r].hasOwnProperty(o)&&"data"!==o&&!i(e[r][o],t[r][o]))return !1;for(o in t[r])if(t[r].hasOwnProperty(o)&&"data"!==o&&!i(e[r][o],t[r][o]))return !1;return !0}function Hi(e,t,r,o,s,n){let a;for(a in t=t||{},e=e||{})e.hasOwnProperty(a)&&(i(e[a],t[a])||r.push({command:n,args:[o,a,t[a],s]}));for(a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(i(e[a],t[a])||r.push({command:n,args:[o,a,t[a],s]}));}function Xi(e){return e.id}function ji(e,t){return e[t.id]=t,e}class Yi{constructor(e,t,i){const r=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0;}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,o){this._forEachCell(t,i,r,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o);}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r);}_insertBoxCell(e,t,i,r,o,s){this.boxCells[o].push(s);}_insertCircleCell(e,t,i,r,o,s){this.circleCells[o].push(s);}_query(e,t,i,r,o,s){if(i<0||e>this.width||r<0||t>this.height)return !o&&[];const n=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(o)return !0;for(let e=0;e<this.boxKeys.length;e++)n.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];n.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r});}return s?n.filter(s):n}return this._forEachCell(e,t,i,r,this._queryCell,n,{hitTest:o,seenUids:{box:{},circle:{}}},s),o?n.length>0:n}_queryCircle(e,t,i,r,o){const s=e-i,n=e+i,a=t-i,l=t+i;if(n<0||s>this.width||l<0||a>this.height)return !r&&[];const c=[];return this._forEachCell(s,a,n,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},o),r?c.length>0:c}query(e,t,i,r,o){return this._query(e,t,i,r,!1,o)}hitTest(e,t,i,r,o){return this._query(e,t,i,r,!0,o)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,o,s,n,a){const l=n.seenUids,c=this.boxCells[o];if(null!==c){const o=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=o[c+2]&&t<=o[c+3]&&i>=o[c+0]&&r>=o[c+1]&&(!a||a(this.boxKeys[h]))){if(n.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[h],x1:o[c],y1:o[c+1],x2:o[c+2],y2:o[c+3]});}}}const h=this.circleCells[o];if(null!==h){const o=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(o[h],o[h+1],o[h+2],e,t,i,r)&&(!a||a(this.circleKeys[c]))){if(n.hitTest)return s.push(!0),!0;{const e=o[h],t=o[h+1],i=o[h+2];s.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i});}}}}}_queryCellCircle(e,t,i,r,o,s,n,a){const l=n.circle,c=n.seenUids,h=this.boxCells[o];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return s.push(!0),!0}}const u=this.circleCells[o];if(null!==u){const e=this.circles;for(const t of u)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return s.push(!0),!0}}}_forEachCell(e,t,i,r,o,s,n,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),h=this._convertToXCellCoord(i),u=this._convertToYCellCoord(r);for(let d=l;d<=h;d++)for(let l=c;l<=u;l++)if(o.call(this,e,t,i,r,this.xCellCount*l+d,s,n,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,o,s){const n=r-e,a=o-t,l=i+s;return l*l>n*n+a*a}_circleAndRectCollide(e,t,i,r,o,s,n){const a=(s-r)/2,l=Math.abs(e-(r+a));if(l>a+i)return !1;const c=(n-o)/2,h=Math.abs(t-(o+c));if(h>c+i)return !1;if(l<=a||h<=c)return !0;const u=l-a,d=h-c;return u*u+d*d<=i*i}}const Wi=e.properties.layout;function qi(t,i,r,o,s){const n=new e.Matrix4;return i?(n.scale([1/s,1/s,1]),r||n.rotateZ(o.angle)):(n.scale([o.width/2,-o.height/2,1]),n.translate([1,-1,0]),n.multiplyRight(t)),n}function Zi(t,i,r,o,s,n){const a=new e.Matrix4;return i?(n||a.multiplyRight(t),a.scale([s,s,1]),r||a.rotateZ(-o.angle)):(a.scale([1,-1,1]),a.translate([-1,-1,0]),a.scale([2/o.width,2/o.height,1])),a}function $i(t,i){const r=[t.x,t.y,0,1];nr(r,r,i);const o=r[3];return {point:new e.pointGeometry3d(r[0]/o,r[1]/o),signedDistanceFromCamera:o}}function Qi(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function Ki(t,i,r,o,s,n,a,l){const c=o?t.textSizeData:t.iconSizeData,h=e.evaluateSizeForZoom(c,r.transform.zoom,Wi&&Wi.properties&&Wi.properties[o?"text-size":"icon-size"]),u=[256/r.width*2+1,256/r.height*2+1],d=o?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;d.clear();const _=t.lineVertexArray,m=o?t.text.placedSymbolArray:t.icon.placedSymbolArray,f=r.transform.width/r.transform.height;let p=!1;for(let o=0;o<m.length;o++){const g=m.get(o);if(g.hidden||g.writingMode===e.WritingMode.vertical&&!p){sr(g.numGlyphs,d);continue}p=!1;const v=new e.Vector4([g.anchorX,g.anchorY,0,1]);if(v.transform(i),!Qi(v,u)){sr(g.numGlyphs,d);continue}const x=.5+v[3]/r.transform.cameraToCenterDistance*.5,y=e.evaluateSizeForFeature(c,h,g),T=a?y*x:y/x,S=new e.pointGeometry3d(g.anchorX,g.anchorY),b=$i(S,s).point,w={},E=tr(g,T,!1,l,i,s,n,t.glyphOffsetArray,_,d,b,S,w,f,t instanceof e.SphereSymbolBucket?t:null);p=E.useVertical,(E.notEnoughRoom||p||E.needsFlipping&&tr(g,T,!0,l,i,s,n,t.glyphOffsetArray,_,d,b,S,w,f,t instanceof e.SphereSymbolBucket?t:null).notEnoughRoom)&&sr(g.numGlyphs,d);}o?t.text.dynamicLayoutVertexBuffer.updateData(d):t.icon.dynamicLayoutVertexBuffer.updateData(d);}function Ji(e,t,i,r,o,s,n,a,l,c,h,u){const d=a.glyphStartIndex+a.numGlyphs,_=a.lineStartIndex,m=a.lineStartIndex+a.lineLength,f=t.getoffsetX(a.glyphStartIndex),p=t.getoffsetX(d-1),g=rr(e*f,i,r,o,s,n,a.segment,_,m,l,c,h,u);if(!g)return null;const v=rr(e*p,i,r,o,s,n,a.segment,_,m,l,c,h,u);return v?{first:g,last:v}:null}function er(t,i,r,o){return t===e.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*o?{useVertical:!0}:(t===e.WritingMode.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function tr(t,i,r,o,s,n,a,l,c,h,u,d,_,m,f){const p=i/24,g=t.lineOffsetX*i,v=t.lineOffsetY*i;let x;if(t.numGlyphs>1){const e=t.glyphStartIndex+t.numGlyphs,i=t.lineStartIndex,s=t.lineStartIndex+t.lineLength,h=Ji(p,l,g,v,r,u,d,t,c,n,_,!1);if(!h)return {notEnoughRoom:!0};const f=$i(h.first.point,a).point,y=$i(h.last.point,a).point;if(o&&!r){const e=er(t.writingMode,f,y,m);if(e)return e}x=[h.first];for(let o=t.glyphStartIndex+1;o<e-1;o++)x.push(rr(p*l.getoffsetX(o),g,v,r,u,d,t.segment,i,s,c,n,_,!1));x.push(h.last);}else {if(o&&!r){const i=$i(d,s).point,r=t.lineStartIndex+t.segment+1,o=new e.pointGeometry3d(c.getx(r),c.gety(r)),n=$i(o,s),a=n.signedDistanceFromCamera>0?n.point:ir(d,o,i,1,s),l=er(t.writingMode,i,a,m);if(l)return l}const i=rr(p*l.getoffsetX(t.glyphStartIndex),g,v,r,u,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,n,_,!1);if(!i)return {notEnoughRoom:!0};x=[i];}for(const t of x)f?e.addDynamicAttributes(h,t.point,t.angle,t.anchorPoint):e.addDynamicAttributes(h,t.point,t.angle);return {}}function ir(e,t,i,r,o){const s=$i(e.add(e.sub(t)._unit()),o).point,n=i.sub(s);return i.add(n._mult(r/n.mag()))}function rr(t,i,r,o,s,n,a,l,c,h,u,d,_){const m=o?t-i:t+i;let f=m>0?1:-1,p=0;o&&(f*=-1,p=Math.PI),f<0&&(p+=Math.PI);let g=f>0?l+a:l+a+1;const v=g;let x=s,y=s,T=0,S=0;const b=Math.abs(m);for(;T+S<=b;){if(g+=f,g<l||g>=c)return null;if(y=x,x=d[g],void 0===x){const t=new e.pointGeometry3d(h.getx(g),h.gety(g)),i=$i(t,u);if(i.signedDistanceFromCamera>0)x=d[g]=i.point;else {const i=g-f;x=ir(0===T?n:new e.pointGeometry3d(h.getx(i),h.gety(i)),t,y,b-T+1,u);}}T+=S,S=y.dist(x);}const w=(b-T)/S,E=x.sub(y),M=E.mult(w)._add(y);return M._add(E._unit()._perp()._mult(r*f)),{point:M,angle:p+Math.atan2(x.y-y.y,x.x-y.x),anchorPoint:s,tileDistance:_?{prevTileDistance:g-f===v?0:h.gettileUnitDistanceFromAnchor(g-f),lastSegmentViewportDistance:b-T}:null}}const or=new Float64Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function sr(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(or,3*e);}}function nr(e,t,i){const r=t[0],o=t[1];return e[0]=i[0]*r+i[4]*o+i[12],e[1]=i[1]*r+i[5]*o+i[13],e[3]=i[3]*r+i[7]*o+i[15],e}const ar=100;class lr{constructor(e,t=new Yi(e.width+200,e.height+200,25),i=new Yi(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ar,this.screenBottomBoundary=e.height+ar,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200;}placeCollisionBox(e,t,i,r,o){const s=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY),n=i*s.perspectiveRatio,a=e.x1*n+s.point.x,l=e.y1*n+s.point.y,c=e.x2*n+s.point.x,h=e.y2*n+s.point.y;return !this.isInsideGrid(a,l,c,h)||!t&&this.grid.hitTest(a,l,c,h,o)?{box:[],offscreen:!1}:{box:[a,l,c,h],offscreen:this.isOffscreen(a,l,c,h)}}approximateTileDistance(e,t,i,r,o){const s=e.lastSegmentViewportDistance*i;return e.prevTileDistance+s+((o?1:r/this.pitchfactor)-1)*s*Math.abs(Math.sin(t))}placeCollisionCircles(t,i,r,o,s,n,a,l,c,h,u,d,_,m){const f=[],p=this.projectAnchor(h,n.anchorX,n.anchorY),g=c/24,v=n.lineOffsetX*c,x=n.lineOffsetY*c,y=new e.pointGeometry3d(n.anchorX,n.anchorY),T=Ji(g,l,v,x,!1,$i(y,u).point,y,n,a,u,{},!0);let S=!1,b=!1,w=!0;const E=p.perspectiveRatio*o,M=1/(o*r);let A=0,C=0;T&&(A=this.approximateTileDistance(T.first.tileDistance,T.first.angle,M,p.cameraDistance,_),C=this.approximateTileDistance(T.last.tileDistance,T.last.angle,M,p.cameraDistance,_));for(let e=0;e<t.length;e+=5){const r=t[e],o=t[e+1],s=t[e+2],n=t[e+3];if(!T||n<-A||n>C){cr(t,e,!1);continue}const a=this.projectPoint(h,r,o),l=s*E;if(f.length>0){const i=a.x-f[f.length-4],r=a.y-f[f.length-3];if(l*l*2>i*i+r*r&&e+8<t.length){const i=t[e+8];if(i>-A&&i<C){cr(t,e,!1);continue}}}f.push(a.x,a.y,l,e/5),cr(t,e,!0);const c=a.x-l,u=a.y-l,_=a.x+l,p=a.y+l;if(w=w&&this.isOffscreen(c,u,_,p),b=b||this.isInsideGrid(c,u,_,p),!i&&this.grid.hitTestCircle(a.x,a.y,l,m)){if(!d)return {circles:[],offscreen:!1};S=!0;}}return {circles:S||!b?[]:f,offscreen:w}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return {};const i=[];let r=1/0,o=1/0,s=-1/0,n=-1/0;for(const a of t){const t=new e.pointGeometry3d(a.x+ar,a.y+ar);r=Math.min(r,t.x),o=Math.min(o,t.y),s=Math.max(s,t.x),n=Math.max(n,t.y),i.push(t);}const a=this.grid.query(r,o,s,n).concat(this.ignoredGrid.query(r,o,s,n)),l={},c={};for(const t of a){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const o=[new e.pointGeometry3d(t.x1,t.y1),new e.pointGeometry3d(t.x2,t.y1),new e.pointGeometry3d(t.x2,t.y2),new e.pointGeometry3d(t.x1,t.y2)];e.polygonIntersectsPolygon(i,o)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex));}return c}insertCollisionBox(e,t,i,r,o){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:o},e[0],e[1],e[2],e[3]);}insertCollisionCircles(e,t,i,r,o){const s=t?this.ignoredGrid:this.grid,n={bucketInstanceId:i,featureIndex:r,collisionGroupID:o};for(let t=0;t<e.length;t+=4)s.insertCircle(n,e[t],e[t+1],e[t+2]);}projectAnchor(e,t,i){const r=[t,i,0,1];return nr(r,r,e),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5,cameraDistance:r[3]}}projectPoint(t,i,r){const o=[i,r,0,1];return nr(o,o,t),new e.pointGeometry3d((o[0]/o[3]+1)/2*this.transform.width+ar,(-o[1]/o[3]+1)/2*this.transform.height+ar)}projectAndGetPerspectiveRatio(t,i,r){const o=[i,r,0,1];nr(o,o,t);const s=new e.pointGeometry3d((o[0]/o[3]+1)/2*this.transform.width+ar,(-o[1]/o[3]+1)/2*this.transform.height+ar);let n=1;return e.exported.devicePixelRatio-1<.1&&(n=.75),{point:s,perspectiveRatio:(.5+this.transform.cameraToCenterDistance/o[3]*.5)*n}}isOffscreen(e,t,i,r){return i<ar||e>=this.screenRightBoundary||r<ar||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}function cr(e,t,i){e[t+4]=i?1:0;}function hr(t,i,r){return i*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}const ur=e.properties.layout;class dr{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i;}isHidden(){return 0===this.opacity&&!this.placed}}class _r{constructor(e,t,i,r,o){this.text=new dr(e?e.text:null,t,i,o),this.icon=new dr(e?e.icon:null,t,r,o);}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mr{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i;}}class fr{constructor(e,t,i,r,o){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=o;}}class pr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={};}get(e){if(this.crossSourceCollisions)return {ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t};}return this.collisionGroups[e]}}class gr{constructor(e,t,i){this.transform=e,this.collisionIndex=new lr(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new pr(i);}placeLayerTile(t,i,r,o){const s=i.getBucket(t),n=i.latestFeatureIndex;if(!s||!n||t.id!==s.layerIds[0])return;const a=i.collisionBoxArray,l=s.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/e.EXTENT,u=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),d=qi(u,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,hr(i,1,this.transform.zoom)),_=qi(u,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.transform,hr(i,1,this.transform.zoom));this.retainedQueryData[s.bucketInstanceId]=new fr(s.bucketInstanceId,n,s.sourceLayerIndex,s.index,i.tileID),this.placeLayerBucket(s,u,d,_,c,h,r,o,a);}placeLayerBucket(t,i,r,o,s,n,a,l,c){const h=t.layers[0].layout,u=e.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,ur&&ur.properties&&ur.properties["text-size"]),d=h.get("text-optional"),_=h.get("icon-optional"),m=this.collisionGroups.get(t.sourceID);for(const o of t.symbolInstances)if(!l[o.crossTileID]){let f=!1,p=!1,g=!0,v=null,x=null,y=null,T=0,S=0;o.collisionArrays||(o.collisionArrays=t.deserializeCollisionBoxes(c,o.textBoxStartIndex,o.textBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex)),o.collisionArrays.textFeatureIndex&&(T=o.collisionArrays.textFeatureIndex),o.collisionArrays.textBox&&(v=this.collisionIndex.placeCollisionBox(o.collisionArrays.textBox,h.get("text-allow-overlap"),n,i,m.predicate),f=v.box.length>0,g=g&&v.offscreen);const b=o.collisionArrays.textCircles;if(b){const l=t.text.placedSymbolArray.get(o.placedTextSymbolIndices[0]),c=e.evaluateSizeForFeature(t.textSizeData,u,l);x=this.collisionIndex.placeCollisionCircles(b,h.get("text-allow-overlap"),s,n,o.key,l,t.lineVertexArray,t.glyphOffsetArray,c,i,r,a,"map"===h.get("text-pitch-alignment"),m.predicate),f=h.get("text-allow-overlap")||x.circles.length>0,g=g&&x.offscreen;}o.collisionArrays.iconFeatureIndex&&(S=o.collisionArrays.iconFeatureIndex),o.collisionArrays.iconBox&&(y=this.collisionIndex.placeCollisionBox(o.collisionArrays.iconBox,h.get("icon-allow-overlap"),n,i,m.predicate),p=y.box.length>0,g=g&&y.offscreen);const w=d||0===o.numGlyphVertices&&0===o.numVerticalGlyphVertices,E=_||0===o.numIconVertices;w||E?E?w||(p=p&&f):f=p&&f:p=f=p&&f,f&&v&&this.collisionIndex.insertCollisionBox(v.box,h.get("text-ignore-placement"),t.bucketInstanceId,T,m.ID),p&&y&&this.collisionIndex.insertCollisionBox(y.box,h.get("icon-ignore-placement"),t.bucketInstanceId,S,m.ID),f&&x&&this.collisionIndex.insertCollisionCircles(x.circles,h.get("text-ignore-placement"),t.bucketInstanceId,T,m.ID),this.placements[o.crossTileID]=new mr(f,p,g||t.justReloaded),l[o.crossTileID]=!0;}t.justReloaded=!1;}commit(e,t){this.commitTime=t;let i=!1;const r=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,o=e?e.opacities:{};for(const e in this.placements){const t=this.placements[e],s=o[e];s?(this.opacities[e]=new _r(s,r,t.text,t.icon),i=i||t.text!==s.text.placed||t.icon!==s.icon.placed):(this.opacities[e]=new _r(null,r,t.text,t.icon,t.skipFade),i=i||t.text||t.icon);}for(const e in o){const t=o[e];if(!this.opacities[e]){const o=new _r(t,r,!1,!1);o.isHidden()||(this.opacities[e]=o,i=i||t.text.placed||t.icon.placed);}}i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t);}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,r.collisionBoxArray);}}updateBucketOpacities(e,t,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();const r=e.layers[0].layout,o=new _r(null,0,!1,!1,!0),s=new _r(null,0,r.get("text-allow-overlap"),r.get("icon-allow-overlap"),!0);for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances[r],a=t[n.crossTileID];let l=this.opacities[n.crossTileID];a?l=o:l||(l=s,this.opacities[n.crossTileID]=l),t[n.crossTileID]=!0;const c=n.numIconVertices>0;if(n.numGlyphVertices>0||n.numVerticalGlyphVertices>0){const t=Mr(l.text),i=(n.numGlyphVertices+n.numVerticalGlyphVertices)/4;for(let r=0;r<i;r++)e.text.opacityVertexArray.emplaceBack(t);for(const t of n.placedTextSymbolIndices)e.text.placedSymbolArray.get(t).hidden=l.text.isHidden();}if(c){const t=Mr(l.icon);for(let i=0;i<n.numIconVertices/4;i++)e.icon.opacityVertexArray.emplaceBack(t);e.icon.placedSymbolArray.get(r).hidden=l.icon.isHidden();}n.collisionArrays||(n.collisionArrays=e.deserializeCollisionBoxes(i,n.textBoxStartIndex,n.textBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex));const h=n.collisionArrays;if(h){h.textBox&&e.hasCollisionBoxData()&&vr(e.collisionBox.collisionVertexArray,l.text.placed,!1),h.iconBox&&e.hasCollisionBoxData()&&vr(e.collisionBox.collisionVertexArray,l.icon.placed,!1);const t=h.textCircles;if(t&&e.hasCollisionCircleData())for(let i=0;i<t.length;i+=5)vr(e.collisionCircle.collisionVertexArray,l.text.placed,a||0===t[i+4]);}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray);}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e){return "undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>e}setStale(){this.stale=!0;}}function vr(e,t,i){e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0);}const xr=Math.pow(2,25),yr=Math.pow(2,24),Tr=Math.pow(2,17),Sr=Math.pow(2,16),br=Math.pow(2,9),wr=Math.pow(2,8),Er=Math.pow(2,1);function Mr(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*xr+t*yr+i*Tr+t*Sr+i*br+t*wr+i*Er+t}class Ar{constructor(){this._currentTileIndex=0,this._seenCrossTileIDs={};}continuePlacement(e,t,i,r,o){for(;this._currentTileIndex<e.length;)if(t.placeLayerTile(r,e[this._currentTileIndex],i,this._seenCrossTileIDs),this._currentTileIndex++,o())return !0}}class Cr{constructor(e,t,i,r,o,s){this.placement=new gr(e,o,s),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1;}isDone(){return this._done}continuePlacement(t,i,r){const o=e.exported.now(),s=()=>{const t=e.exported.now()-o;return !this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if(("symbol"===e.type||"symtracking"===e.type)&&(!e.minzoom||e.minzoom<=o)&&(!e.maxzoom||e.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new Ar),this._inProgressLayer.continuePlacement(r[e.source],this.placement,this._showCollisionBoxes,e,s))return;delete this._inProgressLayer;}this._currentPlacementIndex--;}this._done=!0;}commit(e,t){return this.placement.commit(e,t),this.placement}}const Rr=512/e.EXTENT/2;class Lr{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(const i of t){const t=i.key;this.indexedSymbolInstances[t]||(this.indexedSymbolInstances[t]=[]),this.indexedSymbolInstances[t].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)});}}getScaledCoordinates(t,i){const r=Rr/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=t.anchor;return {x:Math.floor((i.canonical.x*e.EXTENT+o.x)*r),y:Math.floor((i.canonical.y*e.EXTENT+o.y)*r)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(const o of e){if(o.crossTileID)continue;const e=this.indexedSymbolInstances[o.key];if(!e)continue;const s=this.getScaledCoordinates(o,t);for(const t of e)if(Math.abs(t.coord.x-s.x)<=r&&Math.abs(t.coord.y-s.y)<=r&&!i[t.crossTileID]){i[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class Pr{constructor(){this.maxCrossTileID=0;}generate(){return ++this.maxCrossTileID}}class Ir{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const o=i[e];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),r[o.tileID.key]=o;}this.indexes[e]=r;}this.lng=e;}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return !1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key]);}for(const e of t.symbolInstances)e.crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const o=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in o){const s=o[i];s.tileID.isChildOf(e)&&s.findMatches(t.symbolInstances,e,r);}else {const s=o[e.scaledTo(Number(i)).key];s&&s.findMatches(t.symbolInstances,e,r);}}for(const e of t.symbolInstances)e.crossTileID||(e.crossTileID=i.generate(),r[e.crossTileID]=!0);return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Lr(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const r of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][r.crossTileID];}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const o in r)e[r[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[o]),delete r[o],t=!0);}return t}}class Or{constructor(){this.layerIndexes={},this.crossTileIDs=new Pr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};}addLayer(e,t,i){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Ir);let o=!1;const s={};r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0);}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0;}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e];}}class Dr{constructor(e,t){this.max=e,this.onRemove=t,this.reset();}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const o={value:t,timeout:void 0};if(void 0!==i&&(o.timeout=setTimeout((()=>{this.remove(e,o);}),i)),this.data[r].push(o),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),o=this.data[i][r];return this.data[i].splice(r,1),o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(o.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e);}}class Nr extends e.Evented{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform));})),this.on("error",(()=>{this._sourceErrored=!0;}));const o=Si(e,t,i,this);this._source=o,this._source instanceof ci&&(this._source.setSharedTerrainTileCache(r),this.sttc=r),this._tiles={},this._cache=new Dr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new ai,this._demMaxHeight=0,this.sourceType=t.type,this._demMaxHeightNeedUpdate=!0,this._minMax3dtileBoundHeight={minHeight:0,maxHeight:0};}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){if(this._sourceErrored)return !0;if(("3d-model"===this._source.type||"video-project"===this._source.type)&&"loaded"===this._source.state)return this._sourceLoaded=!0,!0;if(!this._sourceLoaded)return !1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return !1}return "3d-model"!==this._source.type||"loaded"===this._source.state}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}_loadTile(e,t){return this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles)this._tiles[t].upload(e),this._tiles[t].prepare(this.map.style.imageManager);}getIds(){return Object.keys(this._tiles).map(String).sort(((e,t)=>this._tiles[e].tileID.overscaledZ-this._tiles[t].tileID.overscaledZ))}getRenderableIds(){return this.getIds().filter(this._isIdRenderable)}hasRenderableParent(e){const t=this.findLoadedParent(e,0,{});return !!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else if(this._cache.reset(),this._source instanceof Yt&&(this._source.unloadGPUData(),this._source.prepare()),e)for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"expired");else for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading");}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)));}_tileLoaded(t,i,r,o){if(o)return t.state="errored",void(404!==o.status?this._source.fire(new e.ErrorEvent(o,{tile:t})):this.update(this.transform));t.timeAdded=e.exported.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null);}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}getZoom(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)}_findLoadedChildren(e,t,i){let r=!1;for(const o in this._tiles){let s=this._tiles[o];if(i[o]||!s.hasData()||s.tileID.overscaledZ<=e.overscaledZ||s.tileID.overscaledZ>t)continue;const n=Math.pow(2,s.tileID.canonical.z-e.canonical.z);if(Math.floor(s.tileID.canonical.x/n)===e.canonical.x&&Math.floor(s.tileID.canonical.y/n)===e.canonical.y)for(i[o]=s.tileID,r=!0;s&&s.tileID.overscaledZ-1>e.overscaledZ;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);if(!e)break;s=this._tiles[e.key],s&&s.hasData()&&(delete i[o],i[e.key]=e);}}return r}findLoadedParent(e,t,i){for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r);if(!t)return;const o=String(t.key),s=this._tiles[o];if(s&&s.hasData())return i[o]=t,s;if(this._cache.has(t))return i[o]=t,this._cache.get(t)}}updateCacheSize(e){const t=Math.ceil(e.width/this._source.tileSize)+1,i=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(t*i*5),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o);}update(t,i,r){if(this.transform=t,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this._coveredTiles={},this.used?"3d-model"===this._source.type?o=[]:this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(o=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover,zoomOffset:0}),this._source.hasTile&&(o=o.filter((e=>this._source.hasTile(e))))):o=[];const s=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),n=Math.max(s-Nr.maxOverzooming,this._source.minzoom),a=Math.max(s+Nr.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(o,s),c={};if(Br(this._source.type)&&!i){const t=Object.keys(l);for(let i=0;i<t.length;i++){const r=t[i],o=l[r],s=this._tiles[r];if(s&&(void 0===s.fadeEndTime||s.fadeEndTime>=e.exported.now())){this._findLoadedChildren(o,a,l)&&(l[r]=o);const e=this.findLoadedParent(o,n,c);e&&this._addTile(e.tileID);}}}let h;for(h in c)l[h]||(this._coveredTiles[h]=!0);for(h in c)l[h]=c[h];const u=e.keysDifference(this._tiles,l);for(let e=0;e<u.length;e++)this._removeTile(u[e]);this._source.renderWithTerrain&&this._getDemMaxHeight(),this._get3dtileMinMaxHeight();}_getDemMaxHeight(){for(const e in this._tiles)if(Object.hasOwnProperty.call(this._tiles,e)){const t=this._tiles[e];t.demHeight&&this._demMaxHeight<t.demHeight&&(this._demMaxHeight=t.demHeight),this.loaded()||(this._demMaxHeight=0,this._demMaxHeightNeedUpdate=!0);}if(this._demMaxHeight>0&&this.loaded()&&this._demMaxHeightNeedUpdate)for(const e in this.map.style.sourceCaches)if(Object.hasOwnProperty.call(this.map.style.sourceCaches,e)){const t=this.map.style.sourceCaches[e];if("geojson"===t.sourceType||"vector"===t.sourceType){Math.floor(this.transform.zoom),t._source.demHeight=this._demMaxHeight,this._demMaxHeightNeedUpdate=!1;for(const e in t._tiles)"errored"!==t._tiles[e].state&&t._reloadTile(e,"reloading");}}}_get3dtileMinMaxHeight(){if(this.map&&this._minMax3dtileBoundHeight.maxHeight!=this.map._minMax3dtileBoundHeight.maxHeight&&this._minMax3dtileBoundHeight.minHeight!=this.map._minMax3dtileBoundHeight.minHeight){this._minMax3dtileBoundHeight.maxHeight=0==this._minMax3dtileBoundHeight.maxHeight?this.map._minMax3dtileBoundHeight.maxHeight:Math.max(this._minMax3dtileBoundHeight.maxHeight,this.map._minMax3dtileBoundHeight.maxHeight),this._minMax3dtileBoundHeight.minHeight=0==this._minMax3dtileBoundHeight.minHeight?this.map._minMax3dtileBoundHeight.minHeight:Math.max(this._minMax3dtileBoundHeight.minHeight,this.map._minMax3dtileBoundHeight.minHeight);for(const e in this.map.style.sourceCaches)if(Object.hasOwnProperty.call(this.map.style.sourceCaches,e)){const t=this.map.style.sourceCaches[e];if("geojson"===t.sourceType||"vector"===t.sourceType){t._source&&t._source._minMax3dtileBoundHeight&&(t._source._minMax3dtileBoundHeight.minHeight=this._minMax3dtileBoundHeight.minHeight,t._source._minMax3dtileBoundHeight.maxHeight=this._minMax3dtileBoundHeight.maxHeight);for(const e in t._tiles)"errored"!==t._tiles[e].state&&t._reloadTile(e,"reloading");}}}}_updateRetainedTiles(e,t){const i={},r={},o=Math.max(t-Nr.maxOverzooming,this._source.minzoom),s=Math.max(t+Nr.maxUnderzooming,this._source.minzoom);for(let n=0;n<e.length;n++){const a=e[n];let l=this._addTile(a),c=!1;if(l.hasData())i[a.key]=a;else {c=l.wasRequested(),i[a.key]=a;let e=!0;if(t+1>this._source.maxzoom){const t=a.children(this._source.maxzoom)[0],r=this.getTile(t);r&&r.hasData()?i[t.key]=t:e=!1;}else {this._findLoadedChildren(a,s,i);const t=a.children(this._source.maxzoom);for(let r=0;r<t.length;r++)if(!i[t[r].key]){e=!1;break}}if(!e)for(let e=a.overscaledZ-1;e>=o;--e){const t=a.scaledTo(e);if(r[t.key])break;if(r[t.key]=!0,l=this.getTile(t),!l&&c&&(l=this._addTile(t)),l&&(i[t.key]=t,c=l.wasRequested(),l.hasData()))break}}}return i}_addTile(t){let i=this._tiles[t.key];if(i)return i.tileID=t,i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const r=Boolean(i);return r||(i=new li(t,this._source.tileSize*t.overscaleFactor(),this.map.projection,"raster"===this._source.type),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))),i?(i.uses++,this._tiles[t.key]=i,r||this._source.fire(new e.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e];}),i));}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))));}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache&&this._cache.reset(),this._source.unloadGPUData&&this._source.unloadGPUData();}tilesInOfSphereExtrusion(e,t,i){const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover}),o=[];for(let e=0;e<r.length;e++){const t=this.getTile(r[e]);t&&o.push(t.getBucket(i));}return o}tilesIn(t,i,r){const o=[],s=this.transform;if(!s)return o;const n=r?s.getCameraQueryGeometry(t):t,a=t.map((e=>s.pointCoordinate(e))),l=n.map((e=>s.pointCoordinate(e))),c=this.getIds();let h=1/0,u=1/0,d=-1/0,_=-1/0;const m=a[0].zoom;for(const e of l)h=Math.min(h,e.column),u=Math.min(u,e.row),d=Math.max(d,e.column),_=Math.max(_,e.row);for(let t=0;t<c.length;t++){const r=this._tiles[c[t]],n=r.tileID,f=Math.pow(2,s.zoom-r.tileID.overscaledZ),p=i*r.queryPadding*e.EXTENT/r.tileSize/f,g=[Fr(n,new e.Coordinate(h,u,m)),Fr(n,new e.Coordinate(d,_,m))];if(g[0].x-p<e.EXTENT&&g[0].y-p<e.EXTENT&&g[1].x+p>=0&&g[1].y+p>=0){const t=a.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))})),i=l.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))}));o.push({tile:r,tileID:n,queryGeometry:t,cameraQueryGeometry:i,scale:f});}}return o}getVisibleCoordinates(e){const t=this.getRenderableIds().map((e=>this._tiles[e].tileID));if(e)for(const e of t)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return !0;if(Br(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.exported.now())return !0}return !1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i);}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i);}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i);}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)));}}function Fr(t,i){const r=i.zoomTo(t.canonical.z);return new e.pointGeometry3d((r.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*e.EXTENT,(r.row-t.canonical.y)*e.EXTENT)}function Br(e){return "raster"===e||"image"===e||"video"===e}Nr.maxOverzooming=10,Nr.maxUnderzooming=3;class Ur{constructor(e,t,i){this.item=e,this.previous=t,this.next=i;}}class zr{constructor(){this.head=null,this.tail=null,this._length=0;}get length(){return this._length}add(e){const t=new Ur(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length);}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t));}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length;}}function Gr(e){return null!=e}class Vr{constructor(){this._list=new zr,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1;}reset(){this._list.splice(this._list.tail,this._sentinel);}touch(e){const t=e._cacheNode;Gr(t)&&this._list.splice(this._sentinel,t);}add(e,t,i){Gr(t._cacheNode)||(t._cacheNode=this._list.add(t),i&&i(e,t));}unloadTile(e,t,i){const r=t._cacheNode;Gr(r)&&(this._list.remove(r),t._cacheNode=void 0,i&&i(e,t));}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const r=1024*e.maximumMemoryUsage*1024,o=this._sentinel;let s=this._list.head;for(;s!==o&&(e.gpuMemoryUsageInBytes>r||i);){const i=s.item;s=s.next,this.unloadTile(e,i,t);}}trim(){this._trimTiles=!0;}}new e.Vector3,new e.Vector3;const kr=new e.CullingVolume([new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane]);function Hr(t,i){for(let i=0;i<t.frustum.planes.length;i++){const r=t.frustum.planes[i];kr.planes[i]=new e.Plane([r.normal.x,r.normal.y,r.normal.z],r.constant);}return t.cullingVolume=kr,{camera:{position:t.camerapos,direction:new e.Vector3(t.dir[0],t.dir[1],t.dir[2]),up:new e.Vector3(t.up[0],t.up[1],t.up[2]),fov:60},viewport:t,height:t.height,cullingVolume:kr,frameNumber:i,sseDenominator:1.15}}const Xr=6356752.314245179,jr=new e.Vector3,Yr="I3S",Wr="TILES3D",qr="geometricError";function Zr(e){return null!=e}const $r=new e.Vector3,Qr=new e.Vector3,Kr=new e.Vector3;function Jr(t,i,r){if(t.box)return function(t,i,r){const o=new e.Vector3(t[0],t[1],t[2]);i.transform(o,o);let s=[];if(10===t.length){const i=t.slice(3,6),r=new e.Quaternion;r.fromArray(t,6);const o=new e.Vector3([1,0,0]),n=new e.Vector3([0,1,0]),a=new e.Vector3([0,0,1]);o.transformByQuaternion(r),o.scale(i[0]),n.transformByQuaternion(r),n.scale(i[1]),a.transformByQuaternion(r),a.scale(i[2]),s=[...o.toArray(),...n.toArray(),...a.toArray()];}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const n=i.transformAsVector(s.slice(0,3)),a=i.transformAsVector(s.slice(3,6)),l=i.transformAsVector(s.slice(6,9)),c=new e.Matrix3([n[0],n[1],n[2],a[0],a[1],a[2],l[0],l[1],l[2]]);return Zr(r)?(r.center=o,r.halfAxes=c,r):new e.OrientedBoundingBox(o,c)}(t.box,i,r);if(t.region){const[i,r,o,s,n,a]=t.region,l=e.Ellipsoid.WGS84.cartographicToCartesian([e.degrees(i),e.degrees(s),n],Qr),c=e.Ellipsoid.WGS84.cartographicToCartesian([e.degrees(o),e.degrees(r),a],Kr),h=(new e.Vector3).addVectors(l,c).multiplyScalar(.5),u=(new e.Vector3).subVectors(l,c).len()/2;return eo([h[0],h[1],h[2],u],new e.Matrix4)}if(t.sphere)return eo(t.sphere,i,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function eo(t,i,r){const o=new e.Vector3(t[0],t[1],t[2]);i.transform(o,o);const s=i.getScale($r),n=Math.max(Math.max(s[0],s[1]),s[2]),a=t[3]*n;return Zr(r)?(r.center=o,r.radius=a,r):new e.BoundingSphere(o,a)}new e.Matrix4,new e.Vector3,new e.Vector3,new e.Matrix4,new e.Vector3,new e.Vector3,new e.Vector3;const to=6378137,io=Math.PI/2;function ro([t,i,r]){const o=e.toRadians(t),s=e.toRadians(i),n=1+r/to,a=n*Math.cos(s);return [t=a*Math.cos(o),i=a*Math.sin(o),r=n*Math.sin(s)]}function oo([e,t,i=0],[r,o,s=0]){const n=ro([r,o,s]),a=ro([e,t,i]),l=a[0]-n[0],c=a[1]-n[1],h=a[2]-n[2];return l*l+c*c+h*h}function so(e,t){const i=t.viewport,r=e.header.mbs[3],o=[e.header.mbs[0],e.header.mbs[1],e.header.mbs[2]],s=oo(i.unprojectPosition(i.cameraPosition),o),n=r/to,a=s-n*n;if(a<=0)return 170141175e30;let l=function(e,t){const{width:i,height:r,pixelProjectionMatrix:o}=t.viewport,s=Math.tan(Math.atan(Math.sqrt(1/(o[0]*o[0])+1/(o[5]*o[5]))));return Math.sqrt(r*r+i*i)/s}(0,t);return l*=n/Math.sqrt(a)/i.scale,l}const no=new e.Vector3;function ao(e){return null!=e}class lo{constructor(e,t,i,r,o){this.header=t,this.tileset=e,this.id=o||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this._depth=0,this.contentUrl=t.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),this.userData={},this._updatedVisibilityFrame=0,this._shouldSelect=!1,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._screenSpaceErrorProgressiveResolution=0,this.priorityDeferred=!1,Object.seal(this);}destroy(){this.header=null;}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return !this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get boundingSphere(){return this.boundingVolume.getBoundingSphere()}get contentFailed(){return 5===this.contentState}get extras(){return this.header.extras}getScreenSpaceError(e,t){switch(this.tileset.type){case Yr:return so(this,e);case Wr:return function(e,t,i){const r=e.tileset,o=i&&e.parent&&e.parent.lodMetricValue||e.lodMetricValue;if(0===o)return 0;const s=Math.max(e._distanceToCamera,1e-7),{height:n,sseDenominator:a}=t;let l=o*n/(s*a);return l-=function(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorFactor,r=function(e,t){const i=e*t;return 1-Math.exp(-i*i)}(t,e._dynamicScreenSpaceErrorComputedDensity)*i;return r}return 0}(r,s),l}(this,e,t);default:throw new Error("Unsupported tileset type")}}_getPriority(){const e=this.tileset._traverser;if(0===this.contentState)return -1;if(this.tileset.frameNumber-this._touchedFrame>=1)return -1;const t=this.parent;return Math.max((e.root?e.root._screenSpaceError:0)-(t&&(0===this._screenSpaceError||t.hasTilesetContent)?t._screenSpaceError:this._screenSpaceError),0)}async loadContent(){if(this.hasEmptyContent)return !1;if(this.content)return !0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);if(!t)return this.contentState=0,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,o={fetch:this.tileset.fetchOptions,[r.id]:{isTileset:"json"===this.type,...this._getLoaderSpecificOptions(r.id)}};return this.content=await e.load(i,r,o),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,Se(this.contentUrl)),this.contentState=3,this._onContentLoaded(),!0}catch(e){throw this.contentState=5,e}finally{t.done();}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const r=this.parent,o=r?r._visibilityPlaneMask:e.CullingVolume.MASK_INDETERMINATE;this._updateTransform(r?r.computedTransform:this.tileset.modelMatrix),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,o),this._visible=this._visibilityPlaneMask!==e.CullingVolume.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i;}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,t)}contentVisibility(t){if(!ao(this.boundingVolume))return 1;if(this._visibilityPlaneMask===e.CullingVolume.MASK_INSIDE)return 1;const i=t.cullingVolume,r=this.boundingVolume,o=this.tileset,s=o.clippingPlanes;if(ao(s)&&s.enabled){const e=s.computeIntersectionWithBoundingVolume(r,o.clippingPlanesOriginMatrix);if(this._isClipped=1!==e,-1===e)return -1}return i.computeVisibility(r)}distanceToTile(e){return Math.sqrt(Math.max(this.boundingVolume.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){return no.subVectors(this.boundingVolume.center,e.position),e.direction.dot(no)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return !t||0===t.distanceToCamera(e.camera.position)}_initializeLodMetric(e){this.lodMetricType="lodMetricType"in e?e.lodMetricType:this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,this.lodMetricValue="lodMetricValue"in e?e.lodMetricValue:this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue;}_initializeTransforms(t){this.transform=t.transform?new e.Matrix4(t.transform):new e.Matrix4;const i=this.parent,r=this.tileset,o=i&&i.computedTransform?i.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new e.Matrix4(o).multiplyRight(this.transform);const s=i&&i._initialTransform?i._initialTransform.clone():new e.Matrix4;this._initialTransform=new e.Matrix4(s).multiplyRight(this.transform);}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e);}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1);}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=e.CullingVolume.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0;}_getRefine(e){return e||this.parent&&this.parent.refine||2}_isTileset(){return -1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0;}this._isTileset()&&(this.hasTilesetContent=!0);}_updateBoundingVolume(e){this.boundingVolume=Jr(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=Jr(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=Jr(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)));}_updateTransform(t=new e.Matrix4){const i=t.clone().multiplyRight(this.transform);!i.equals(this.computedTransform)&&(this.computedTransform=i,this._updateBoundingVolume(this.header));}_getLoaderSpecificOptions(e){return "i3s"===e?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t;}updateExpiration(){if(ao(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=4,this._expiredContent=this.content);}}getPriorityReverseScreenSpaceError(e,t){const i=t.parent,r=ao(i)&&(!e._skipLevelOfDetail||0===t._screenSpaceError||i.hasTilesetContent);return e.root._screenSpaceError-(r?i._screenSpaceError:t._screenSpaceError)}isPriorityProgressiveResolution(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return !1;let i=t._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;const r=t.parent,o=e._maximumScreenSpaceError,s=t._screenSpaceErrorProgressiveResolution<=o,n=ao(r)&&r._screenSpaceErrorProgressiveResolution>o;return s&&n&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}isPriorityDeferred(t,i){const r=t.tileset,o=i.camera,s=t.boundingSphere,n=s.radius,a=new e.Vector3(o.direction[0]*t._centerZDepth,o.direction[1]*t._centerZDepth,o.direction[2]*t._centerZDepth),l=new e.Vector3(o.position[0]+a[0],o.position[1]+a[1],o.position[2]+a[2]).subtract(s.center);if(new e.Vector3(l[0],l[1],l[2]).magnitude()>n){const i=l.normalize(),r=new e.Vector3(i[0]*n,i[1]*n,i[2]*n),a=new e.Vector3(s.center[0]+r[0],s.center[1]+r[1],s.center[2]+r[2]).subtract(o.position).normalize();t._foveatedFactor=1-Math.abs(a.dot(o.direction));}else t._foveatedFactor=0;const c=2===t.refine,h=r.skipLevelOfDetail;if(c&&!h||!r.foveatedScreenSpaceError||1===r.foveatedConeSize||t._priorityProgressiveResolution&&c&&h)return !1;const u=1-Math.cos(.5*o.fov),d=r.foveatedConeSize*u;if(t._foveatedFactor<=d)return !1;const _=this.clamp((t._foveatedFactor-d)/(u-d),0,1),m=this.lerp(r.foveatedMinimumScreenSpaceErrorRelaxation,r.maximumScreenSpaceError,_),f=0===t._screenSpaceError&&ao(t.parent)?.5*t.parent._screenSpaceError:t._screenSpaceError;return r.maximumScreenSpaceError-m<=f}distanceToTileCenter(e){const t=this.boundingVolume.center.subtract(e.camera.position);return e.camera.position.dot(t)}clamp(e,t,i){return e<t?t:e>i?i:e}lerp(e,t,i){return (1-i)*e+i*t}updatePriority(){const e=this.tileset,t=e.preferLeaves,i=e._minimumPriority,r=e._maximumPriority,o=Math.pow(10,8),s=Math.pow(10,9);let n=this.priorityNormalizeAndClamp(this._depth,i.depth,r.depth);n=t?1-n:n;const a=e.skipLevelOfDetail||2!==this.refine?this.priorityNormalizeAndClamp(this._priorityReverseScreenSpaceError,i.reverseScreenSpaceError,r.reverseScreenSpaceError):this.priorityNormalizeAndClamp(this._priorityHolder._distanceToCamera,i.distance,r.distance),l=this.isolateDigits(a,4,0),c=this._priorityProgressiveResolution?0:o,h=this.priorityNormalizeAndClamp(this._priorityHolder._foveatedFactor,i.foveatedFactor,r.foveatedFactor),u=this.isolateDigits(h,4,4);this._priority=n+l+c+u+(this.priorityDeferred?s:0);}isolateDigits(e,t,i){const r=e*Math.pow(10,t);return parseInt(r)*Math.pow(10,i)}priorityNormalizeAndClamp(e,t,i){return Math.max(this.normalize(e,t,i)-1e-7,0)}normalize(e,t,i){return 0===(i=Math.max(i-t,0))?0:this.clamp((e-t)/i,0,1)}}class co{constructor(e=0){this._array=new Array(e),this._map=new Map,this._length=e;}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e);}get values(){return this._array}get(e){return this._array[e]}set(e,t){e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e);}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--);}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t);}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){e>this._array.length&&(this._array.length=e);}resize(e){this.length=e;}trim(e){null==e&&(e=this.length),this._array.length=e;}reset(){this._array=[],this._map=new Map,this._length=0;}find(e){return this._map.has(e)}}class ho{constructor(e){this.options={...e},this.traversal={stack:new co,stackMaximumLength:0},this.emptyTraversal={stack:new co,stackMaximumLength:0},this.descendantTraversal={stack:new co,stackMaximumLength:0},this.selectionTraversal={stack:new co,stackMaximumLength:0,ancestorStack:new co,ancestorStackMaximumLength:0},this.descendantSelectionDepth=2,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.root=void 0,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1;}traverse(e,t,i){this.options={...this.options,...i},this.root=e.root,this.reset(),e._hasMixedContent=!1;const r=e.root;this.updateTile(e,r,t),this.isVisible(r)?r.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError?this.options.onTraversalEnd(t):(this.skipLevelOfDetail(e)?e.immediatelyLoadDesiredLevelOfDetail?this.executeSkipTraversal(e,r,t):this.executeBaseAndSkipTraversal(e,r,t):this.executeBaseTraversal(e,r,t),this.traversal.stack.reset(),this.emptyTraversal.stack.reset(),this.descendantTraversal.stack.reset(),this.selectionTraversal.stack.reset(),this.selectionTraversal.ancestorStack.reset(),this.options.onTraversalEnd&&this.options.onTraversalEnd(t)):this.options.onTraversalEnd(t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={};}executeBaseTraversal(e,t,i){this.executeTraversal(e,t,e._maximumScreenSpaceError,e._maximumScreenSpaceError,i);}executeSkipTraversal(e,t,i){this.executeTraversal(e,t,Number.MAX_VALUE,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}executeBaseAndSkipTraversal(e,t,i){this.executeTraversal(e,t,e.baseScreenSpaceError,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}skipLevelOfDetail(e){return e.skipLevelOfDetail}addEmptyTile(e,t){this.emptyTiles[t.id]=t;}isVisible(e){return e._visible&&e._inRequestVolume}selectTile(e,t,i){-1!==t.contentVisibility(i)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t);}selectDescendants(e,t,i){const r=this.descendantTraversal.stack;for(r.push(t);r.length>0;){this.descendantTraversal.stackMaximumLength=Math.max(this.descendantTraversal.stackMaximumLength,r.length);const o=r.pop().children,s=o.length;for(let n=0;n<s;++n){const s=o[n];this.isVisible(s)&&(s.contentAvailable?(this.updateTile(e,s,i),this.touchTile(e,s,i),this.selectTile(e,s,i)):s.depth-t.depth<this.descendantSelectionDepth&&r.push(s));}}}selectDesiredTile(e,t,i){if(!this.skipLevelOfDetail(e))return void(t.contentAvailable&&this.selectTile(e,t,i));const r=t.contentAvailable?t:t._ancestorWithContentAvailable;uo(r)?r._shouldSelect=!0:this.selectDescendants(e,t,i);}visitTile(e,t,i){t._visitedFrame=i.frameNumber;}touchTile(e,t,i){t._touchedFrame!==i.frameNumber&&(t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber);}updateMinimumMaximumPriority(e,t){e._maximumPriority.distance=Math.max(t._priorityHolder._distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(t._priorityHolder._distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(t.depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(t.depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(t._priorityHolder._foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(t._priorityHolder._foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.reverseScreenSpaceError=Math.max(t._priorityReverseScreenSpaceError,e._maximumPriority.reverseScreenSpaceError),e._minimumPriority.reverseScreenSpaceError=Math.min(t._priorityReverseScreenSpaceError,e._minimumPriority.reverseScreenSpaceError);}isOnScreenLongEnough(e,t,i){if(!e._cullRequestsWhileMoving)return !0;const r=Math.max(2*t.boundingSphere.radius,1),o=i.camera;return e.cullRequestsWhileMovingMultiplier*(0!==o.positionWCDeltaMagnitude?o.positionWCDeltaMagnitude:o.positionWCDeltaMagnitudeLastFrame)/r<1}loadTile(e,t,i){t._requestedFrame!==i.frameNumber&&(this.hasUnloadedContent(t)||t.contentExpired)&&(t._priority=this.getPriority(t),t._requestedFrame=i.frameNumber,this.requestedTiles[t.id]=t);}updateVisibility(e,t,i){if(t._updatedVisibilityFrame===e._updatedVisibilityFrame)return;const r=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===i.viewport.id&&r.push(e);else r.push(i.viewport.id);t.updateVisibility(i,r),t._updatedVisibilityFrame=e._updatedVisibilityFrame;}anyChildrenVisible(e,t,i){let r=!1;const o=t.children,s=o.length;for(let t=0;t<s;++t){const s=o[t];this.updateVisibility(e,s,i),r=r||this.isVisible(s);}return r}meetsScreenSpaceErrorEarly(e,t,i){const r=t.parent;return !(!uo(r)||r.hasTilesetContent||1!==r.refine)&&t.getScreenSpaceError(i,!0)<=e._maximumScreenSpaceError}updateTileVisibility(e,t,i){if(this.updateVisibility(e,t,i),!this.isVisible(t))return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const r=t.children[0];return this.updateTileVisibility(e,r,i),void(t._visible=r._visible)}this.meetsScreenSpaceErrorEarly(e,t,i)?t._visible=!1:2===t.refine&&r&&(this.anyChildrenVisible(e,t,i)||(t._visible=!1));}updateTile(e,t,i){this.updateTileVisibility(e,t,i),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,t._shouldSelect=!1,t._finalResolution=!0;}updateTileAncestorContentLinks(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;const i=e.parent;if(uo(i)){const r=!this.hasUnloadedContent(i)||i._requestedFrame===t.frameNumber;e._ancestorWithContent=r?i:i._ancestorWithContent,e._ancestorWithContentAvailable=i.contentAvailable?i:i._ancestorWithContentAvailable;}}hasEmptyContent(e){return e.hasEmptyContent||e.hasTilesetContent}hasUnloadedContent(e){return !this.hasEmptyContent(e)&&e.contentUnloaded}reachedSkippingThreshold(e,t){const i=t._ancestorWithContent;return !e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||uo(i)&&t._screenSpaceError<i._screenSpaceError/e.skipScreenSpaceErrorFactor&&t.depth>i.depth+e.skipLevels)}updateAndPushChildren(e,t,i,r){let o;const s=2===t.refine,n=t.children,a=n.length;for(o=0;o<a;++o)this.updateTile(e,n[o],r);n.sort(_o);const l=!this.skipLevelOfDetail(e)&&s&&!this.hasEmptyContent(t);let c,h=!0,u=!1;for(o=0;o<a;++o){var d;c=n[o],this.isVisible(c)?(i.push(c),u=!0):(l||e.loadSiblings)&&(this.loadTile(e,c,r),this.touchTile(e,c,r)),l&&(d=!!c._inRequestVolume&&(this.hasEmptyContent(c)?this.executeEmptyTraversal(e,c,r):c.contentAvailable),h=h&&d);}return u||(h=!1),h}inBaseTraversal(e,t,i){return !this.skipLevelOfDetail(e)||!e.immediatelyLoadDesiredLevelOfDetail&&(!uo(t._ancestorWithContent)||(0===t._screenSpaceError?t.parent._screenSpaceError>i:t._screenSpaceError>i))}canTraverse(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError)}executeTraversal(e,t,i,r,o){const s=this.traversal.stack;for(s.push(t);s.length>0;){this.traversal.stackMaximumLength=Math.max(this.traversal.stackMaximumLength,s.length);const t=s.pop();this.updateTileAncestorContentLinks(t,o);const r=this.inBaseTraversal(e,t,i),n=1===t.refine,a=2===t.refine,l=t.parent,c=!uo(l)||l._refines;let h=!1;this.canTraverse(e,t)&&(h=this.updateAndPushChildren(e,t,s,o)&&c);const u=!h&&c;this.hasEmptyContent(t)?(this.addEmptyTile(e,t),this.loadTile(e,t,o),u&&this.selectDesiredTile(e,t,o)):n?(this.selectDesiredTile(e,t,o),this.loadTile(e,t,o)):a&&(r?(this.loadTile(e,t,o),u&&this.selectDesiredTile(e,t,o)):u?(this.selectDesiredTile(e,t,o),this.loadTile(e,t,o)):this.reachedSkippingThreshold(e,t)&&this.loadTile(e,t,o)),this.visitTile(e,t,o),this.touchTile(e,t,o),t._refines=h;}}executeEmptyTraversal(e,t,i){let r=!0;const o=this.emptyTraversal.stack;for(o.push(t);o.length>0;){this.emptyTraversal.stackMaximumLength=Math.max(this.emptyTraversal.stackMaximumLength,o.length);const t=o.pop(),s=t.children,n=s.length,a=this.hasEmptyContent(t)&&this.canTraverse(e,t);if(a||t.contentAvailable||(r=!1),this.updateTile(e,t,i),this.isVisible(t)||(this.loadTile(e,t,i),this.touchTile(e,t,i)),a)for(let e=0;e<n;++e)o.push(s[e]);}return r}traverseAndSelect(e,t,i){const r=this.selectionTraversal.stack,o=this.selectionTraversal.ancestorStack;let s;for(r.push(t);r.length>0||o.length>0;){if(this.selectionTraversal.stackMaximumLength=Math.max(this.selectionTraversal.stackMaximumLength,r.length),this.selectionTraversal.ancestorStackMaximumLength=Math.max(this.selectionTraversal.ancestorStackMaximumLength,o.length),o.length>0){const t=o.peek();if(t._stackLength===r.length){o.pop(),t!==s&&(t._finalResolution=!1),this.selectTile(e,t,i);continue}}const t=r.pop();if(!uo(t))continue;const n=1===t.refine,a=t._shouldSelect,l=t.children,c=l.length,h=this.canTraverse(e,t);if(a)if(n)this.selectTile(e,t,i);else {if(t._selectionDepth=o.length,t._selectionDepth>0&&(e._hasMixedContent=!0),s=t,!h){this.selectTile(e,t,i);continue}o.push(t),t._stackLength=r.length;}if(h)for(let e=0;e<c;++e){const t=l[e];this.isVisible(t)&&r.push(t);}}}getPriority(e){const{options:t}=this;switch(e.refine){case 1:return e._distanceToCamera;case 2:const{parent:i}=e;return this.root._screenSpaceError-(!i||t.skipLevelOfDetail&&0!==e._screenSpaceError&&!i.hasTilesetContent?e._screenSpaceError:i._screenSpaceError);default:return assert(!1)}}}function uo(e){return null!=e}function _o(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}const mo={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class fo{constructor(e){this.options={...mo,...e},this._traversalStack=new co,this._emptyTraversalStack=new co,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={};}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset();}executeTraversal(e,t){const i=this._traversalStack;for(i.push(e);i.length>0;){const e=i.pop();let r=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),r=this.updateAndPushChildren(e,t,i));const o=e.parent,s=Boolean(!o||o._shouldRefine),n=!r;e.hasRenderContent?1===e.refine?(this.loadTile(e,t),this.selectTile(e,t)):2===e.refine&&(this.loadTile(e,t),n&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),n&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=r&&s;}this.options.onTraversalEnd&&this.options.onTraversalEnd(t);}updateChildTiles(e,t){const i=e.children;for(const e of i)this.updateTile(e,t);return !0}updateAndPushChildren(e,t,i){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,s=e.children;s.sort(this.compareDistanceToCamera);const n=!o&&2===e.refine&&e.hasRenderContent;let a=!1;for(const e of s)if(e.isVisibleAndInRequestVolume?(i.find(e)&&i.delete(e),i.push(e),a=!0):(n||r)&&(this.loadTile(e,t),this.touchTile(e,t)),n){let i;if(i=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),!i)return i}return a}updateTile(e,t){this.updateTileVisibility(e,t);}selectTile(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e);}loadTile(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e);}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber;}canTraverse(e,t,i=!1,r=!1){return !(!r&&!e.isVisibleAndInRequestVolume)&&!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,i))}shouldLoadTile(e,t){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i){let r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(t,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===t.viewport.id&&i.push(e);else i.push(t.viewport.id);e.updateVisibility(t,i);}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}getPriority(t){const{options:i}=this;switch(t.refine){case 1:return t._distanceToCamera;case 2:const{parent:r}=t;return this.root._screenSpaceError-(!r||i.skipLevelOfDetail&&0!==t._screenSpaceError&&!r.hasTilesetContent?t._screenSpaceError:r._screenSpaceError);default:return e.assert(!1)}}anyChildrenVisible(e,t){let i=!1;for(const r of e.children)r.updateVisibility(t),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const r=this._emptyTraversalStack;for(;r.length>0;){const e=r.pop();this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t));const o=!e.hasRenderContent&&this.canTraverse(e,t,!1,!0);if(o||e.contentAvailable||(i=!1),o){const t=e.children.filter((e=>e));for(const e of t)r.find(e)&&r.delete(e),r.push(e);}}return i}}class po{constructor(){this._statusMap={};}add(e,t,i,r){this._statusMap[t]||(this._statusMap[t]={request:e,callback:i,key:t,frameState:r,status:"REQUESTED"},e().then((e=>{this._statusMap[t].status="COMPLETED",this._statusMap[t].callback(e,r);})).catch((e=>{this._statusMap[t].status="ERROR",i(e);})));}update(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t);}find(e){return this._statusMap[e]}}class go extends fo{constructor(e){super(e),this._tileManager=new po;}shouldRefine(e,t){return e._lodJudge=function(e,t){const i=t.viewport,r=i.metersPerPixel,o=e.header.mbs[1],s=e.header.mbs[0],n=e.header.mbs[2],a=e.header.mbs[3],{height:l,width:c,latitude:h,longitude:u}=i,d=[u,h],_=[s,o,n],m=[u,o],f=[s,h],p=Math.sqrt(l*l+c*c)*r[0],g=oo(d,_),v=.5*l+a/to,x=.5*c+a/to;if(g>p+a/to)return "OUT";if(oo(d,m)>v)return "OUT";if(oo(d,f)>x)return "OUT";if(0===e.lodMetricValue)return "DIG";let y=so(e,t);return y*=io,y<.5?"OUT":!e.header.children||y<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const i=e.header.children||[],r=e.children,o=e.tileset;for(const s of i){const i=`${s.id}-${t.viewport.id}`,n=r&&r.find((e=>e.id===i));if(n)n&&this.updateTile(n,t);else {let r=()=>this._loadTile(s.id,o);this._tileManager.find(i)?this._tileManager.update(i,t):(o.tileset.nodePages&&(r=()=>o.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(r,i,(t=>this._onTileLoad(t,e,i)),t));}}}async _loadTile(t,i){const{loader:r}=i,o=i.getTileUrl(`${i.url}/nodes/${t}`),s={i3s:{...i.fetchOptions,isTileHeader:!0,loadContent:!1}};return await e.load(o,r,s)}_onTileLoad(e,t,i){const r=new lo(t.tileset,e,t,this.options.basePath,i);t.children.push(r);const o=this._tileManager.find(r.id).frameState;this.updateTile(r,o),this._frameNumber===o.frameNumber&&this.executeTraversal(r,o);}}const vo="Tiles In Tileset(s)",xo="Tiles In Memory",yo="Tiles In View",To="Tiles To Render",So="Tiles Loaded",bo="Tiles Loading",wo="Tiles Unloaded",Eo="Failed Tile Loads",Mo="Points",Ao="Tile Memory Use",Co={ellipsoid:e.Ellipsoid.WGS84,modelMatrix:new e.Matrix4,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(e,t,i)=>{},maximumScreenSpaceError:8};class Ro{constructor(e,t={}){this.options={...Co,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Se(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new Vr,this._requestScheduler=new Ce({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.frameStateData={},this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new Me({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this.preferLeaves=this.options.preferLeaves,this.progressiveResolutionHeightFraction=this.options.progressiveResolutionHeightFraction,this.loadSiblings=this.options.loadSiblings,this.skipLevelOfDetail=this.options.skipLevelOfDetail,this.baseScreenSpaceError=this.options.baseScreenSpaceError,this._updatedVisibilityFrame=0,this.skipLevels=this.options.skipLevels,this.skipScreenSpaceErrorFactor=this.options.skipScreenSpaceErrorFactor,this.immediatelyLoadDesiredLevelOfDetail=this.options.immediatelyLoadDesiredLevelOfDetail,this._hasMixedContent=!1,this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._initializeTileSet(e,this.options);}isLoaded(){return 0===this._pendingCount}destroy(){this._destroy();}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}setOptions(e){this.options={...this.options,...e};}getTileUrl(e){return e.startsWith("data:")?e:`${e}${this.queryParams}`}update(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;e instanceof Array||(e=[e]),this._cache.reset(),this._frameNumber++,++this._updatedVisibilityFrame,this.traverseCounter=e.length;const t=[];for(const i of e){const e=i.id;this._needTraverse(e)?t.push(e):this.traverseCounter--;}for(const i of e){const e=i.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null,this.basePath)),!t.includes(e))continue;const r=Hr(i,this._frameNumber);this._traverser.traverse(this.roots[e].tileset,r,this.options);}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles);i.selectedTiles=r,i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles();}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles);}for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats();}_tilesChanged(e,t){if(e.length!==t.length)return !0;const i=new Set(e.map((e=>e.id))),r=new Set(t.map((e=>e.id)));let o=e.filter((e=>!r.has(e.id))).length>0;return o=o||t.filter((e=>!i.has(e.id))).length>0,o}_loadTiles(){this._requestedTiles.sort(((e,t)=>e._priority-t._priority));for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e);}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)));}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&(e++,i.content.pointCount&&(t+=i.content.pointCount));this.stats.get(yo).count=this.selectedTiles.length,this.stats.get(To).count=e,this.stats.get(Mo).count=t;}_initializeTileSet(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===Wr&&this._initializeCesiumTileset(e),this.type===Yr&&this._initializeI3STileset(e),this._calculateViewProps();}_calculateViewProps(){const t=this.root,{center:i}=t.boundingVolume;if(!i)return this.cartographicCenter=new e.Vector3,void(this.zoom=1);this.cartographicCenter=e.Ellipsoid.WGS84.cartesianToCartographic(i,new e.Vector3),this.cartesianCenter=i,this.zoom=function(e){const{halfAxes:t,radius:i,width:r,height:o}=e;if(t){const e=function(e){e.getColumn(0,jr);const t=e.getColumn(1),i=e.getColumn(2);return jr.add(t).add(i).len()}(t);return Math.log2(Xr/e)}return i?Math.log2(Xr/i):o&&r?(Math.log2(6378137/r)+Math.log2(6378137/o))/2:1}(t.boundingVolume);}_initializeStats(){this.stats.get(vo),this.stats.get(bo),this.stats.get(xo),this.stats.get(yo),this.stats.get(To),this.stats.get(So),this.stats.get(wo),this.stats.get(Eo),this.stats.get(Mo,"memory"),this.stats.get(Ao,"memory");}_initializeTileHeaders(e,t,i){const r=new lo(this,e.root,t,i);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===Wr){const e=[];for(e.push(r);e.length>0;){const t=e.pop();this.stats.get(vo).incrementCount();const r=t.header.children||[];for(const o of r){const r=new lo(this,o,t,i);t.children.push(r),r.depth=t.depth+1,e.push(r);}}}return r}_initializeTraverser(){let e;switch(this.type){case Wr:e=ho;break;case Yr:e=go;break;default:e=fo;}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e);}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent();}catch(t){this._onTileLoadError(e,t);}finally{this._onEndTileLoading(),this._onTileLoad(e,t);}}_onTileLoadError(e,t){this.stats.get(Eo).incrementCount();const i=t.message||t.toString(),r=e.url;console.warn(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,r);}_onTileLoad(t,i){i&&(t&&t.content&&function(t,i){let r,o;"cmpt"===i.type?(o=void 0,r=i.tiles[0].gltfUpAxis):(o=i.rtcCenter,r=i.gltfUpAxis);const{computedTransform:s,boundingVolume:{center:n}}=t;let a=new e.Matrix4(s);switch(o&&a.translate(o),r){case"Z":break;case"Y":const t=(new e.Matrix4).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const i=(new e.Matrix4).rotateY(-Math.PI/2);a=a.multiplyRight(i);}i.isQuantized&&a.translate(i.quantizedVolumeOffset).scale(i.quantizedVolumeScale);const l=new e.Vector3(n);i.cartesianModelMatrix=a,i.cartesianOrigin=l;const c=e.Ellipsoid.WGS84.cartesianToCartographic(l,new e.Vector3),h=e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(l).invert();i.cartographicModelMatrix=h.multiplyRight(a),i.cartographicOrigin=c,i.modelMatrix=i.cartographicModelMatrix;}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t));}_onStartTileLoading(){this._pendingCount++,this.stats.get(bo).incrementCount();}_onEndTileLoading(){this._pendingCount--,this.stats.get(bo).decrementCount();}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)));}_updateCacheStats(e){this.stats.get(So).incrementCount(),this.stats.get(xo).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.gpuMemoryUsageInBytes+=e.content.gltf?e.content.gltf.textureByteSize:0,this.stats.get(Ao).count=this.gpuMemoryUsageInBytes;}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.content.byteLength||0,this.gpuMemoryUsageInBytes-=e.content.gltf?e.content.gltf.textureByteSize:0,this.stats.get(xo).decrementCount(),this.stats.get(wo).incrementCount(),this.stats.get(Ao).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent();}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t);}this.root=null;}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const t of e.children)i.push(t);e!==t&&this._destroyTile(e);}t.children=[];}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy();}_initializeCesiumTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras;}_initializeI3STileset(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema;}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(e){const t=[];for(const i of Object.keys(e))t.push(`${i}=${e[i]}`);switch(t.length){case 0:return "";case 1:return `?${t[0]}`;default:return `?${t.join("&")}`}}(this._queryParams)),this._queryParamsString}}const Lo="undefined"!=typeof __VERSION__?__VERSION__:"latest";function Po(e,t,i){const r=new TextDecoder("utf8"),o=new Uint8Array(e,t,i);return r.decode(o)}const Io={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Oo={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...Io},Do={[Io.DOUBLE]:Float64Array,[Io.FLOAT]:Float32Array,[Io.UNSIGNED_SHORT]:Uint16Array,[Io.UNSIGNED_INT]:Uint32Array,[Io.UNSIGNED_BYTE]:Uint8Array,[Io.BYTE]:Int8Array,[Io.SHORT]:Int16Array,[Io.INT]:Int32Array},No={DOUBLE:Io.DOUBLE,FLOAT:Io.FLOAT,UNSIGNED_SHORT:Io.UNSIGNED_SHORT,UNSIGNED_INT:Io.UNSIGNED_INT,UNSIGNED_BYTE:Io.UNSIGNED_BYTE,BYTE:Io.BYTE,SHORT:Io.SHORT,INT:Io.INT},Fo="Failed to convert GL type";class Bo{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in Do)if(Do[t]===e)return t;throw new Error(Fo)}static fromName(e){const t=No[e];if(!t)throw new Error(Fo);return t}static getArrayType(e,t=!1){switch(e){case Io.UNSIGNED_SHORT_5_6_5:case Io.UNSIGNED_SHORT_4_4_4_4:case Io.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=Do[e];if(!t)throw new Error(Fo);return t}}static getByteSize(e){return Bo.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(Bo.getArrayType(e))}static createTypedArray(e,t,i=0,r){return void 0===r&&(r=(t.byteLength-i)/Bo.getByteSize(e)),new(Bo.getArrayType(e))(t,i,r)}}function Uo(e,t=[0,0,0]){const i=e>>5&63,r=31&e;return t[0]=(e>>11&31)<<3,t[1]=i<<2,t[2]=r<<3,t}function zo(t,i=255){return e.clamp$1(t,0,i)/i*2-1}function Go(e){return e<0?-1:1}new e.Vector2,new e.Vector3,new e.Vector2,new e.Vector2;class Vo{constructor(e,t){this.json=e,this.buffer=t,this.featuresLength=0,this._cachedTypedArrays={};}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=Oo.UNSIGNED_INT,i=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,r.byteOffset):r}getPropertyArray(e,t,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=Bo.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}getProperty(e,t,i,r,o){const s=this.json[e];if(!s)return s;const n=this.getPropertyArray(e,t,i);if(1===i)return n[r];for(let e=0;e<i;++e)o[e]=n[i*r+e];return o}_getTypedArrayFromBinary(e,t,i,r,o){const s=this._cachedTypedArrays;let n=s[e];return n||(n=Bo.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,r*i),s[e]=n),n}_getTypedArrayFromArray(e,t,i){const r=this._cachedTypedArrays;let o=r[e];return o||(o=Bo.createTypedArray(t,i),r[e]=o),o}}const ko={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ho={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Xo={SCALAR:(e,t,i)=>{t[i]=e;},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1];},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2];},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9];},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15];}},jo=e=>void 0!==e;function Yo(e,t,i){if(!e)return;const r=e.parentCounts;return e.parentIds?i(e,t):r>0?function(e,t,i){const r=e.parentCounts,o=e.parentIds,s=e.parentIndexes,n=scratchVisited;n.length=Math.max(n.length,e.classIds.length);const a=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(n[t=l.pop()]===a)continue;n[t]=a;const c=i(e,t);if(jo(c))return c;const h=r[t],u=s[t];for(let e=0;e<h;++e){const i=o[u+e];i!==t&&l.push(i);}}return null}(e,t,i):function(e,t,i){let r=!0;for(;r;){const o=i(e,t);if(jo(o))return o;const s=e.parentIds[t];r=s!==t,t=s;}throw new Error("traverseHierarchySingleParent")}(e,t,i)}function Wo(e,t,i){const r=e.parentCounts,o=e.parentIds,s=e.parentIndexes;if(!jo(o))return;i.push(t);const n=jo(r)?r[t]:1,a=jo(r)?s[t]:t;for(let r=0;r<n;++r){const s=o[a+r];s!==t&&Wo(e,s,i);}i.pop(t);}function qo(e){return null!=e}const Zo=(e,t)=>e,$o={HIERARCHY:!0,extensions:!0,extras:!0};class Qo{constructor(e,t,i,r={}){this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=this.json&&this.json.extensions||{},this._properties={};for(const e in this.json)$o[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(e,t,i){if(!t)return null;let r=e.getExtension("3DTILES_batch_table_hierarchy");const o=t.HIERARCHY;return o&&(t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=o,r=o),r?function(e,t){let i,r,o;const s=e.instancesLength,n=e.classes;let a,l=e.classIds,c=e.parentCounts,h=e.parentIds,u=s;if(jo(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,o=getBinaryAccessor(l),l=o.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,s)),jo(c))for(jo(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,o=getBinaryAccessor(c),c=o.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),u=0,i=0;i<s;++i)a[i]=u,u+=c[i];jo(h)&&jo(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,o=getBinaryAccessor(h),h=o.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,u));const d=n.length;for(i=0;i<d;++i){const e=n[i].instances,r=getBinaryProperties(n[i].length,e,t);n[i].instances=combine(r,e);}const _=new Array(d).fill(0),m=new Uint16Array(s);for(i=0;i<s;++i)r=l[i],m[i]=_[r],++_[r];const f={classes:n,classIds:l,classIndexes:m,parentCounts:c,parentIndexes:a,parentIds:h};return function(e){const t=e.classIds.length;for(let i=0;i<t;++i)Wo(e,i,stack);}(f),f}(r,i):null}(this,this.json,this.binary));}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),!!this._hierarchy&&qo(Yo(this._hierarchy,e,((e,i)=>e.classes[e.classIds[i]].name===t)))}isExactClass(e,t){return this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[e]].name}hasProperty(e,t){return this._checkBatchId(e),qo(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=qo(t)?t:[]).length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),this._binaryProperties){const i=this._binaryProperties[t];if(qo(i))return this._getBinaryProperty(i,e)}const i=this._properties[t];if(qo(i))return Zo(i[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(qo(i))return i}}setProperty(e,t,i){const r=this.featureCount;if(this._checkBatchId(e),this._binaryProperties){const r=this._binaryProperties[t];if(r)return void this._setBinaryProperty(r,e,i)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let o=this._properties[t];qo(o)||(this._properties[t]=new Array(r),o=this._properties[t]),o[e]=Zo(i);}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t);}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._initializeBinaryProperty(t,this._properties[t]);i&&(e=e||{},e[t]=i);}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const e=function(e,t,i,r){const{componentType:o}=e,s="string"==typeof o?Bo.fromName(o):o,n=ko[e.type],a=Ho[e.type],l=Xo[e.type];return {values:Bo.createTypedArray(s,t,i+=e.byteOffset,n*r),type:s,size:n,unpacker:a,packer:l}}(t,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return {typedArray:e.values,componentCount:e.size,unpack:e.unpacker,pack:e.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return !1;const i=Yo(this._hierarchy,e,((e,i)=>qo(e.classes[e.classIds[i]].instances[t])));return qo(i)}_getPropertyNamesInHierarchy(e,t){Yo(this._hierarchy,e,((e,i)=>{const r=e.classes[e.classIds[i]].instances;for(const e in r)r.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e);}));}_getHierarchyProperty(e,t){return Yo(this._hierarchy,e,((e,i)=>{const r=e.classIndexes[i],o=e.classes[e.classIds[i]].instances[t];return qo(o)?qo(o.typedArray)?this._getBinaryProperty(o,r):Zo(o[r]):null}))}_setHierarchyProperty(e,t,i,r){const o=Yo(this._hierarchy,t,((e,t)=>{const o=e.classIndexes[t],s=e.classes[e.classIds[t]].instances[i];return !!qo(s)&&(qo(s.typedArray)?this._setBinaryProperty(s,o,r):s[o]=Zo(r),!0)}));return qo(o)}}function Ko(e,t,i=0){const r=new DataView(t);if(e.magic=r.getUint32(i,!0),e.version=r.getUint32(i+=4,!0),e.byteLength=r.getUint32(i+=4,!0),i+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return i}function Jo(e,t,i){const r=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=r.getUint32(i,!0),e.header.featureTableBinaryByteLength=r.getUint32(i+=4,!0),e.header.batchTableJsonByteLength=r.getUint32(i+=4,!0),e.header.batchTableBinaryByteLength=r.getUint32(i+=4,!0),i+4}function es(e,t,i,r){return i=function(e,t,i,r){const{featureTableJsonByteLength:o,featureTableBinaryByteLength:s}=e.header;if(e.featureTableJson={BATCH_LENGTH:0},o>0){const r=Po(t,i,o);e.featureTableJson=JSON.parse(r);}return i+=o,e.featureTableBinary=new Uint8Array(t,i,s),i+s}(e,t,i),i=function(e,t,i,r){const{batchTableJsonByteLength:o,batchTableBinaryByteLength:s}=e.header;if(o>0){const r=Po(t,i,o);e.batchTableJson=JSON.parse(r),i+=o,s>0&&(e.batchTableBinary=new Uint8Array(t,i,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=s);}return i}(e,t,i),i}function ts(e,t,i){if(!(t||e&&e.batchIds&&i))return null;const{batchIds:r,isRGB565:o,pointCount:s}=e;if(r&&i){const e=new Uint8ClampedArray(3*s);for(let t=0;t<s;t++){const o=i.getProperty(r[t],"dimensions").map((e=>255*e));e[3*t]=o[0],e[3*t+1]=o[1],e[3*t+2]=o[2];}return {type:Oo.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(o){const e=new Uint8ClampedArray(3*s);for(let i=0;i<s;i++){const r=Uo(t[i]);e[3*i]=r[0],e[3*i+1]=r[1],e[3*i+2]=r[2];}return {type:Oo.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*s?{type:Oo.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Oo.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const is=new e.Vector3;function rs(e,t,i,r){e.rotateYtoZ=!0;const o=e.byteOffset+e.byteLength-i;if(0===o)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=ye(t,i,o),e.gltfByteOffset=0,e.gltfByteLength=o,e.byteOffset+e.byteLength}async function os(e,t,i,r){const o=i["3d-tiles"]||{};if(function(e,t,i){switch(t){case 0:const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(t);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case 1:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),o.loadGLTF){const{parse:t,fetch:o}=r;e.gltfUrl&&(e.gltfArrayBuffer=await o(e.gltfUrl,i),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.gltf=await t(e.gltfArrayBuffer,Vt,i,r),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength);}}function ss(t,i,r){return i=i||0,r||(r=new e.Vector3),r.x=t[i++],r.y=t[i++],r.z=t[i],r}function ns(t,i,r,o){o||(o=new e.Matrix4);const s=r.x,n=r.y,a=r.z,l=i.x*i.x,c=i.x*i.y,h=i.x*i.z,u=i.x*i.w,d=i.y*i.y,_=i.y*i.z,m=i.y*i.w,f=i.z*i.z,p=i.z*i.w,g=i.w*i.w,v=2*(c-p),x=2*(h+m),y=2*(c+p),T=-l+d-f+g,S=2*(_-u),b=2*(h-m),w=2*(_+u),E=-l-d+f+g;return o[0]=(l-d-f+g)*s,o[1]=y*s,o[2]=b*s,o[3]=0,o[4]=v*n,o[5]=T*n,o[6]=w*n,o[7]=0,o[8]=x*a,o[9]=S*a,o[10]=E*a,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,o}async function as(t,i=0,r,o,s={}){switch(s.byteOffset=i,s.type=function(e,t=0){const i=new DataView(e);return `${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}(t,i),s.type){case"cmpt":return await async function(e,t,i,r,o,s){i=Ko(e,t,i);const n=new DataView(t);for(e.tilesLength=n.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength;){const n={};e.tiles.push(n),i=await s(t,i,r,o,n);}return i}(s,t,i,r,o,as);case"b3dm":return await async function(e,t,i,r,o){i=function(e,t,i,r,o){i=rs(e,t,i=es(e,t,i=Jo(e,t,i=Ko(e,t,i))),r);const s=new Vo(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",Oo.FLOAT,3),i}(e,t,i,r),await os(e,1,r,o);const{extensions:s}=e.gltf||{};return s&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),i}(s,t,i,r,o);case"i3dm":return await async function(t,i,r,o,s){return r=function(t,i,r,o,s){if(r=Ko(t,i,r),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=Jo(t,i,r);const n=new DataView(i);if(t.gltfFormat=n.getUint32(r,!0),r=rs(t,i,r=es(t,i,r+=4),o),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new Vo(t.featureTableJson,t.featureTableBinary),l=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",Oo.FLOAT,3),new Qo(t.batchTableJson,t.batchTableBinary,l),function(t,i,r,o){const s=new Array(o),n=new e.Vector3,a=new e.Vector3,l=new e.Vector3,c=new e.Vector3,h=new e.Matrix3,u=new e.Quaternion,d=new e.Vector3,_={},m=new e.Matrix4,f=[],p=[],g=new e.Vector3,v=new e.Vector3;for(let r=0;r<o;r++){let o;if(i.hasProperty("POSITION"))o=i.getProperty("POSITION",Oo.FLOAT,3,r,n);else if(i.hasProperty("POSITION_QUANTIZED")){o=i.getProperty("POSITION_QUANTIZED",Oo.UNSIGNED_SHORT,3,r,n);const e=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Oo.FLOAT,3,g);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const t=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Oo.FLOAT,3,v);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const s=65535;for(let i=0;i<3;i++)o[i]=o[i]/s*t[i]+e[i];}if(!o)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(o),_.translation=n,t.normalUp=i.getProperty("NORMAL_UP",Oo.FLOAT,3,r,f),t.normalRight=i.getProperty("NORMAL_RIGHT",Oo.FLOAT,3,r,p),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");ss(t.normalUp,0,l),ss(t.normalRight,0,a),t.hasCustomOrientation=!0;}else {if(t.octNormalUp=i.getProperty("NORMAL_UP_OCT32P",Oo.UNSIGNED_SHORT,2,f),t.octNormalRight=i.getProperty("NORMAL_RIGHT_OCT32P",Oo.UNSIGNED_SHORT,2,p),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(n,m),m.getRotationMatrix3(h)):h.identity();}t.hasCustomOrientation&&(c.copy(a).cross(l).normalize(),h.setColumn(0,a),h.setColumn(1,l),h.setColumn(2,c)),u.fromMatrix3(h),_.rotation=u,d.set(1,1,1);const x=i.getProperty("SCALE",Oo.FLOAT,1,r);Number.isFinite(x)&&d.multiplyByScalar(x);const y=i.getProperty("SCALE_NON_UNIFORM",Oo.FLOAT,3,r,f);y&&d.scale(y),_.scale=d;let T=i.getProperty("BATCH_ID",Oo.UNSIGNED_SHORT,1,r);void 0===T&&(T=r),(new e.Matrix4).fromQuaternion(_.rotation);const S=ns(_.translation,_.rotation,_.scale,new e.Matrix4).clone();s[r]={modelMatrix:S,batchId:T};}t.instances=s;}(t,a,0,l),r}(t,i,r,o),await os(t,t.gltfFormat,o,s),r}(s,t,i,r,o);case"pnts":return await async function(t,i,r,o,s){r=es(t,i,r=Jo(t,i,r=Ko(t,i,r))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1;}(t);const{featureTable:n,batchTable:a}=function(e){const t=new Vo(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Oo.FLOAT,3);const r=function(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Oo.UNSIGNED_SHORT,1),e.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:o,batchTableBinary:s}=e;i=new Qo(o,s,r);}return i}(e,t);return {featureTable:t,batchTable:r}}(t);return await async function(t,i,r,o,s){let n,a,l;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(l=c.properties);const h=i.getExtension("3DTILES_draco_point_compression");if(h){a=h.properties;const e=h.byteOffset,i=h.byteLength;if(!a||!Number.isFinite(e)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=t.featureTableBinary.slice(e,e+i),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA);}if(!n)return !0;const u={buffer:n,properties:{...a,...l},featureTableProperties:a,batchTableProperties:l,dequantizeInShader:!1};return await async function(t,i,r,o){const{parse:s}=o,n={...r,draco:{...r.draco,extraAttributes:i.batchTableProperties||{}}};delete n["3d-tiles"];const a=await s(i.buffer,rt,n),l=a.attributes.POSITION&&a.attributes.POSITION.value,c=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,h=a.attributes.NORMAL&&a.attributes.NORMAL.value,u=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,d=h&&a.attributes.NORMAL.value.quantization;if(l&&a.attributes.POSITION.value.quantization){const i=a.POSITION.data.quantization,r=i.range;t.quantizedVolumeScale=new e.Vector3(r,r,r),t.quantizedVolumeOffset=new e.Vector3(i.minValues),t.quantizedRange=(1<<i.quantizationBits)-1,t.isQuantizedDraco=!0;}d&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const _={};if(i.batchTableProperties)for(const e of Object.keys(i.batchTableProperties))a.attributes[e]&&a.attributes[e].value&&(_[e.toLowerCase()]=a.attributes[e].value);t.attributes={positions:l,colors:ts(t,c),normals:h,batchIds:u,..._};}(t,u,o,s)}(t,n,0,o,s),function(t,i,r){if(!t.attributes.positions)if(i.hasProperty("POSITION"))t.attributes.positions=i.getPropertyArray("POSITION",Oo.FLOAT,3);else if(i.hasProperty("POSITION_QUANTIZED")){const o=i.getPropertyArray("POSITION_QUANTIZED",Oo.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Oo.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Oo.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,i,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,i){const r=new e.Vector3,o=new Float32Array(3*t.pointCount);for(let e=0;e<t.pointCount;e++)r.set(i[3*e],i[3*e+1],i[3*e+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(o,3*e);return o}(t,i)):{type:Oo.UNSIGNED_SHORT,value:i,size:3,normalized:!0}:i}(t,o,r);}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,n,o),function(e,t,i){if(!e.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",Oo.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",Oo.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",Oo.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=ts(e,r,i);}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Oo.UNSIGNED_BYTE,4));}(t,n,a),function(e,t){if(!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",Oo.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",Oo.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const i=new Float32Array(3*e.pointsLength);for(let r=0;r<e.pointsLength;r++)((function(e,t,i,r){if(e<0||e>i||t<0||t>i)throw new Error("x and y must be unsigned normalized integers between 0 and 255");if(r.x=zo(e,i),r.y=zo(t,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const e=r.x;r.x=(1-Math.abs(r.y))*Go(e),r.y=(1-Math.abs(e))*Go(r.y);}r.normalize();}))(t[2*r],t[2*r+1],255,is),is.toArray(i,3*r);return {type:Oo.FLOAT,size:2,value:i}}return {type:Oo.FLOAT,size:2,value:t}}(e,i);}}(t,n),r}(s,t,i,r,o);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}function ls(e,t){return e&&e.content&&(e.contentUrl=`${t.basePath}/${e.content.uri||e.content.url}`),e.id=e.contentUrl,e.lodMetricType=qr,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return "empty";const t=e.contentUrl.split(".").pop();switch(t){case"pnts":return "pointcloud";case"i3dm":case"b3dm":return "scenegraph";default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return e}}(e.refine),e}const cs={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Lo,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t,i,r){const o=t["3d-tiles"]||{};let s;return s="auto"===o.isTileset?i.url&&-1!==i.url.indexOf(".json"):o.isTileset,e=s?await async function(e,t,i){const r=JSON.parse((new TextDecoder).decode(e));return r.loader=t.loader||cs,r.url=i.url,r.basePath=Se(r.url),r.root=function(e){const t=e.basePath,i=ls(e.root,e),r=[];for(r.push(i);r.length>0;){const e=r.pop().children||[];for(const i of e)ls(i,{basePath:t}),r.push(i);}return i}(r),r.type=Wr,r.lodMetricType=qr,r.lodMetricValue=r.root.lodMetricValue,r}(e,t,i):await async function(e,t,i){const r={content:{segmentationData:null}};return await as(e,0,t,i,r.content),r.content}(e,t,i),e},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},hs={...cs,id:"cesium-ion",name:"Cesium Ion",preload:async function(t,i={}){i=i["cesium-ion"]||{};const{accessToken:r}=i;let o=i.assetId;if(!Number.isFinite(o)){const e=t.match(/\/([0-9]+)\/tileset.json/);o=e&&e[1];}return async function(t,i){if(!i){const r=await async function(t){const i={Authorization:`Bearer ${t}`},r=await e.fetchFile("https://api.cesium.com/v1/assets",{headers:i,throws:!0});return await r.json()}(t);for(const e of r.items)"3DTILES"===e.type&&(i=e.id);}const r=await async function(t,i){const r={Authorization:`Bearer ${t}`},o=`https://api.cesium.com/v1/assets/${i}`;let s=await e.fetchFile(`${o}`,{headers:r,throws:!0}),n=await s.json();s=await e.fetchFile(`${o}/endpoint`,{headers:r,throws:!0});const a=await s.json();return n={...n,...a},n}(t,i);return r.headers={Authorization:`Bearer ${r.accessToken}`},r}(r,o)},parse:async(e,t,i,r)=>(t["3d-tiles"]=t["cesium-ion"],t.loader=hs,cs.parse(e,t,i)),options:{"cesium-ion":{...cs.options["3d-tiles"],accessToken:null}}},us=new e.Vector3,ds=new e.Vector3;class _s{constructor(t=new e.Vector3(1,0,0),i=0){this.normal=t,this.constant=i;}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=us.subVectors(i,t).cross(ds.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.len();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(t,i){return void 0===i&&(console.warn("THREE.Plane: .projectPoint() target is now required"),i=new e.Vector3),i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,i){void 0===i&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new e.Vector3);const r=t.delta(us),o=this.normal.dot(r);if(0===o)return 0===this.distanceToPoint(t.start)?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?null:i.copy(r).multiplyScalar(s).add(t.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new e.Vector3),t.copy(this.normal).multiplyScalar(-this.constant)}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return (new this.constructor).copy(this)}}_s.prototype.isPlane=!0;class ms{constructor(){this.planes=[new _s,new _s,new _s,new _s,new _s,new _s];}updateFrustumPlanes(e){const t=e[0],i=e[1],r=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],_=e[12],m=e[13],f=e[14],p=e[15];this.planes[0].setComponents(o-t,l-s,d-c,p-_).normalize(),this.planes[1].setComponents(o+t,l+s,d+c,p+_).normalize(),this.planes[2].setComponents(o+i,l+n,d+h,p+m).normalize(),this.planes[3].setComponents(o-i,l-n,d-h,p-m).normalize(),this.planes[4].setComponents(o-r,l-a,d-u,p-f).normalize(),this.planes[5].setComponents(o+r,l+a,d+u,p+f).normalize();}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<r)return !1;return !0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return !1;return !0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const o=i[r],s=new e.Vector3;if(s.x=o.normal.x>0?t.max.x:t.min.x,s.y=o.normal.y>0?t.max.y:t.min.y,s.z=o.normal.z>0?t.max.z:t.min.z,o.distanceToPoint(s)<0)return !1}return !0}}class fs{constructor(e,t){this.frustum=new ms,this.camerapos=void 0,this.height=e,this.prjMatrix=t,this.viewPrjMatrix=[],this.cullingVolume=void 0,this.dir=void 0,this.up=void 0,this.id="3dtile";}updateCullingVolume(t,i,r){t=e.CoordsUntils.WGS84.cartographicToCartesian(t),this.camerapos=t,i=e.CoordsUntils.WGS84.cartographicToCartesian(i),r=new e.Vector3(e.CoordsUntils.WGS84.cartographicToCartesian(r)).sub(t).toArray();const o=new e.Matrix4;o.lookAt(t,i,r),this.viewPrjMatrix=this.prjMatrix.clone().multiplyRight(o),this.frustum.updateFrustumPlanes(this.viewPrjMatrix),this.dir=new e.Vector3(i).sub(t).toArray(),this.up=r;}}class ps{constructor(t,i){let r=new e.Matrix4(e.Matrix4.IDENTITY);t&&t.mCurTrans&&(r=t.mCurTrans),this.mOriTrans=i.transformMatrix&&t?(new e.Matrix4).copy(i.transformMatrix):new e.Matrix4(e.Matrix4.IDENTITY),this.mCurTrans=new e.Matrix4(e.Matrix4.IDENTITY),this.mCurTrans.copy(r),this.mCurTrans.multiplyRight(this.mOriTrans);}buildChildInfo(e,t){if(e.children&&e.children.length>0){this.mChildArray=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],o=new ps(this,r);this.mChildArray.push(o),o.buildChildInfo(r,t);}}else t.set(e.id,this);}}class gs{constructor(){this.mTileNodeInfoMap=new Map;}buildTree(t){const i=new ps(null,t);if(t.boundingVolume.box){const r=t.boundingVolume.box;i.mCenter=new e.Vector3(r[0],r[1],r[2]),i.mRadius=new e.Vector3(r[3],r[7],r[11]);}this.mRootNode=i,i.buildChildInfo(t,this.mTileNodeInfoMap);}getNodeMatrix(t){const i=this.mTileNodeInfoMap.get(t);return i?i.mCurTrans:new e.Matrix4(e.Matrix4.IDENTITY)}}class vs extends e.Evented{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this._fristLoadingTilesFlag=!0,this.mTilesInfo=new gs,this._minMax3dtileBoundHeight={minHeight:void 0,maxHeight:void 0},this.on("data",(e=>{"cesium-tile"===e.dataType&&this.transform&&this.update(this.transform);})),this.on("error",(()=>{this._sourceErrored=!0;}));const r=Si(e,t,i,this);this._source=r,this._tiles={},this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this.idealTileIDs=[],this._cesiumGltfTileObj={},this.viewport=void 0,this._cesiumTiles=[],this._preCesiumTiles=[],this._cacheTile=new kt,this._geoCenters=[],this._geoBounds=[],this.loadTileset(t);}_verifiableSourceUrls(e,t){const i=[];if(t&&i.push({url:t}),e&&e.length)for(let r=0;r<e.length;r++){const o=e[r];t!==o.url&&o.url&&i.push(o);}return i.length?i:{msg:"urls 和 url 参数至少配置一个"}}async loadTileset(t){const{url:i,urls:r,maximumScreenSpaceError:o,throttleRequests:s,maximumMemoryUsage:n,preferLeaves:a,progressiveResolutionHeightFraction:l,loadSiblings:c,skipLevelOfDetail:h,baseScreenSpaceError:u,skipLevels:d,skipScreenSpaceErrorFactor:_,immediatelyLoadDesiredLevelOfDetail:m,sourceLoaded:f,heightOffset:p}=t,g=[],v=this._verifiableSourceUrls(r,i);if(!(v instanceof Array))throw new Error(v.msg);for(let t=0;t<v.length;t++)g.push(await e.load(v[t].url,cs));if(0==g.length)throw new Error("Error getting tileset data");{const t=g[0],i=this._unionBoundingVolume(g);let r;if(t.geometricError=i.geometricError,t.root.children=i.children,t.root.transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mTilesInfo.buildTree(t.root),p>-5e3){const t=e.Ellipsoid.WGS84.cartesianToCartographic(i.boundingVolume.center,new e.Vector3),o=e.Ellipsoid.WGS84.cartographicToCartesian(new e.Vector3(t.x,t.y,0),new e.Vector3),s=e.Ellipsoid.WGS84.cartographicToCartesian(new e.Vector3(t.x,t.y,p),new e.Vector3),n=s.subVectors(s,o);r=e.Matrix4.fromRotationTranslation(e.Matrix3.IDENTITY,n,new e.Matrix4);}this.tileset3d=new Ro(t,{onTileLoad:e=>{this.update(this.transform);},onTileUnload:e=>{this._unloadTiles(e);},maximumScreenSpaceError:o||16,throttleRequests:s||!1,maximumMemoryUsage:n||64,preferLeaves:a||!1,progressiveResolutionHeightFraction:l||.3,loadSiblings:c||!1,skipLevelOfDetail:h||!1,baseScreenSpaceError:u||1024,skipLevels:d||1,skipScreenSpaceErrorFactor:_||16,immediatelyLoadDesiredLevelOfDetail:m||!1,modelMatrix:r||e.Matrix4.IDENTITY}),this.tileset3d.root.boundingVolume=i.boundingVolume,this._geoCenters=i.tileCenters,this._geoBounds=i.tileBounds,this.sourceLoadedCallback=f,this.sourceLoadedCallback&&this.sourceLoadedCallback(this);}}update(t,i,r){if(this.transform=t,this._paused||!this.used)return;if(this.previousCameraStore||(this.previousCameraStore={pos:t.camera_currentPos.toArray(),up:t.camera_upwardPos.toArray(),forward:t.camera_forwardPos.toArray()}),this._checkCameraStatusChanged())this.previousCameraStore={pos:t.camera_currentPos.toArray(),up:t.camera_upwardPos.toArray(),forward:t.camera_forwardPos.toArray()};else if(this.tileset3d&&this.viewport)return this.tileset3d.update(this.viewport),void(this._tilesVisible=this.tileset3d.tiles.filter((e=>e.selected)));const o=[],s=[],n=[];e.transformGeographicToECEF(o,[t.camera_currentPos[0],t.camera_currentPos[1],t.camera_currentPos[2]]),e.transformGeographicToECEF(n,[t.camera_upwardPos[0],t.camera_upwardPos[1],t.camera_upwardPos[2]]),e.transformGeographicToECEF(s,[t.camera_forwardPos[0],t.camera_forwardPos[1],t.camera_forwardPos[2]]),this.viewport?(this.viewport.prjMatrix=t.td_projectionMatrix,this.viewport.updateCullingVolume(o,s,n)):(this.viewport=new fs(t.height,t.td_projectionMatrix),this.viewport.updateCullingVolume(o,s,n)),this.tileset3d&&(this.tileset3d.update(this.viewport),this._tilesVisible=this.tileset3d.tiles.filter((e=>e.selected)));}_checkCameraStatusChanged(){for(let e=0;e<3;e++){const t=this.previousCameraStore.up,i=this.previousCameraStore.forward;if(this.previousCameraStore.pos[e]!==this.transform.camera_currentPos[e]||t[e]!==this.transform.camera_upwardPos[e]||i[e]!==this.transform.camera_forwardPos[e])return !0}return !1}_unloadTiles(e){this._removeTile(e.id);}_tileLoaded(t){t.contentAvailable&&t.isVisibleAndInRequestVolume&&!this._cesiumGltfTileObj[t.id]&&(this._cesiumGltfTileObj[t.id]=new ge({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume}),this._cesiumGltfTileObj[t.id].loadVectorData(t.content),this._cesiumGltfTileObj[t.id].upload(this._context,this._source),this.fire(new e.Event("data",{dataType:"cesium-tile"})));}prepare(e){this._source.prepare&&this._source.prepare(),this._context||(this._context=e);}get tilesForRender(){if(this._update3dtileMinMaxHeight(),this._cesiumTiles=[],this._tilesVisible){let e;for(let t=0;t<this._tilesVisible.length;++t){let i=!1;e=this._tilesVisible[t];const r=this._cacheTile.get(e.id);if(r)r.childTiles.length>0?r.childTiles.forEach((e=>{this._cesiumTiles.push(e);})):this._cesiumTiles.push(r);else {if(e.content.gltf&&e.content.gltf.images){for(let t=0;t<e.content.gltf.images.length;++t){const r=e.content.gltf.images[t];if(!r.image.width&&r.uri){const e=r.uri.lastIndexOf("/")+1,t=r.uri.substring(e),o=zt.get(t);if(!o[0].imageParsed){i=!0;continue}r.image=o[0].imageParsed;}}if(i)continue}this.buildCesiumGltfTile(e);}}}return this.tileset3d&&this.tileset3d.stats.get("Tiles Loading"),this.fire(new e.Event("data",{dataType:"cesium-tile"})),this._cesiumTiles}tilesIn(e,t,i){return this._cesiumTiles}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);}buildCesiumGltfTile(e){if("cmpt"===e.type){const t=new ge({tileID:e.id,modelFolder:this._source.modelFolder,boundingVolume:e.boundingVolume,minemap3DType:e.type,instances:e.instances||[],normalRight:e.normalRight||[],normalUp:e.normalUp||[],relativeCenter:e.relativeCenter||[]});this._cacheTile.set(e.id,t);const i=e.content.tiles;for(let r=0;r<i.length;r++){const o=i[r],s=new ge({tileID:e.id+r,modelFolder:this._source.modelFolder,boundingVolume:e.boundingVolume,minemap3DType:o.type,instances:o.instances||[],normalRight:o.normalRight||[],normalUp:o.normalUp||[],relativeCenter:e.relativeCenter||[]});s.loadVectorData({gltf:o.gltf,content:e.content,modelMatrix:e.content.modelMatrix,cartographicOrigin:e.content.cartographicOrigin,cartesianModelMatrix:e.content.cartesianModelMatrix}),s.upload(this._context,this._source),this._cesiumTiles.push(s),t.childTiles.push(s);}}else {const t=new ge({tileID:e.id,modelFolder:this._source.modelFolder,boundingVolume:e.boundingVolume,minemap3DType:e.content.type,instances:e.instances||[],normalRight:e.normalRight||[],normalUp:e.normalUp||[],relativeCenter:e.relativeCenter||[]});this._cacheTile.set(e.id,t),t.loadVectorData(e.content),t.upload(this._context,this._source),this._cesiumTiles.push(e);}}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}serialize(){return this._source.serialize()}_isIdRenderable(e){}reload(){}getZoom(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)}updateCacheSize(e){}hasTransition(){return !1}setFeatureState(e,t,i){}getFeatureState(e,t){}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._cacheTile._hash)this._removeTile(e);}_removeTile(e){const t=this._cacheTile._hash[e];t&&(t.childTiles.length>0&&t.childTiles.forEach((e=>{e.unloadVectorData();})),t.unloadVectorData(),this._cacheTile.remove(e));}_update3dtileMinMaxHeight(){if(!this._minMax3dtileBoundHeight.maxHeight&&this.tileset3d&&this.tileset3d.root){const e=this.tileset3d.root.boundingVolume;this._minMax3dtileBoundHeight.minHeight=e.center[2]-e.radius,this._minMax3dtileBoundHeight.maxHeight=e.center[2]+e.radius,this.map._minMax3dtileBoundHeight.maxHeight!=this._minMax3dtileBoundHeight.maxHeight&&this.map._minMax3dtileBoundHeight.minHeight!=this._minMax3dtileBoundHeight.minHeight&&(this.map._minMax3dtileBoundHeight.maxHeight=0===this.map._minMax3dtileBoundHeight.maxHeight?this._minMax3dtileBoundHeight.maxHeight:Math.max(this.map._minMax3dtileBoundHeight.maxHeight,this._minMax3dtileBoundHeight.maxHeight),this.map._minMax3dtileBoundHeight.minHeight=0===this.map._minMax3dtileBoundHeight.minHeight?this._minMax3dtileBoundHeight.minHeight:Math.min(this.map._minMax3dtileBoundHeight.minHeight,this._minMax3dtileBoundHeight.minHeight));}}getLocation(t,i){const{urls:r=[],url:o}=this._source._options,s=this.map.transform;o&&(r.filter((e=>e.url===o)).length||r.push({name:"custom-tiles",url:o}));const n=r.map(((t,i)=>{let r=e.getZoomFromDistance(s._fov,this._geoCenters[i][2]+e.CONSTS.TRANSFORM.R+1e3,e.CONSTS.TRANSFORM.R);return r=isNaN(r)?s._maxZoom-1:r,{center:this._geoCenters[i],bounds:this._geoBounds.length?this._geoBounds[i]:null,zoom:r,...t}}));return t&&"string"==typeof t?n.filter((e=>e[i]===t)):n}getTilesSourceConfig(e,t="name"){return this.getLocation(e,t)}_unionBoundingVolume(t){let i,r=0;const o=[],s=[],n=[];let a;for(let l=0;l<t.length;l++){if(t[l].asset.hasOwnProperty("gltfUpAxis")||(t[l].asset.gltfUpAxis="Y"),t[l].root.children){let i;e.defined(a)?t[l].asset.gltfUpAxis.toUpperCase()!==a&&(i="Z"===a?(new e.Matrix4).rotateX(Math.PI/2):(new e.Matrix4).rotateX(-Math.PI/2)):a=t[l].asset.gltfUpAxis||"Y";for(let e=0;e<t[l].root.children.length;e++){const r=t[l].root.children[e];void 0===r.transform&&(r.transform=t[l].root.transform),i&&(r.transform=i.clone().multiplyLeft(r.transform)),o.push(r);}}r=Math.max(r,t[l].root.geometricError);const c=new e.Matrix4(t[l].root.transform);let h,u;const d=Jr(t[l].root.boundingVolume,c);if(d.halfAxes){const t=new e.OrientedBoundingBox(d.center,d.halfAxes);u=t.getBoundingMaximum(3),h=t.getBoundingSphere();}else h=d,u=null;if(0===l?i=new e.BoundingSphere(h.center,h.radius):i.union(h),u){const t=e.CoordsUntils.cartesian3ToCartographicInWGS84(u.boundingMaxValue),i=e.CoordsUntils.cartesian3ToCartographicInWGS84(u.boundingMinValue),r=new e.LngLatBounds([i[0],i[1]],[t[0],t[1]]);n.push(r);}s.push(e.CoordsUntils.cartesian3ToCartographicInWGS84(h.center));}return {geometricError:r,children:o,boundingVolume:i,tileCenters:s,tileBounds:n}}}vs.maxOverzooming=10,vs.maxUnderzooming=3;class xs{constructor(e){}}class ys{constructor(e){}}class Ts{constructor(e){}}function Ss(t,i){return t===e.CONSTS.PERFORMANCE.MODE.FLIGHT?new ys(i):t===e.CONSTS.PERFORMANCE.MODE.MANUAL?new Ts(i):void 0}function bs(t){const i=t.transform.getCameraPos(),r=new se(i,ws(t.canvasX,t.canvasY,.999999,t.transform)).intersectSphere({center:[0,0,0],radius:e.CONSTS.TRANSFORM.R+(t.alt?t.alt*e.CONSTS.TRANSFORM.R_SCALE:0)},[0,0,0]);return !r||isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?{lngLat:null,intersectPoint:null}:t.transform.Zup?{lngLat:e.LngLat.convert(e.transformGeographicToECEF([],r)),intersectPoint:r}:{lngLat:e.LngLat.convert(e.transformGeographicToECEFforYup([],r)),intersectPoint:r}}function ws(t,i,r,o){const s=o.getCameraPos();let n=[2*t/o.width-1,1-2*i/o.height,r,1];return n=function(t,i){const r=new e.Vector4(t).transform(i.td_projectionInverseMatrix);return r.scale(1/r[3]),r.transform(i.td_viewInverseMatrix),r.toArray()}(n,o),new e.Vector3(n).sub(s).normalize().toArray()}function Es(e,t,i){return function(e,t){const i=e.calcPoints,r=i.length,o=t.calcPoints,s=o.length;for(let s=0;s<r;s++)if(Ls(e.pos,t.pos,i,o,e.normals[s]))return !1;for(let r=0;r<s;r++)if(Ls(e.pos,t.pos,i,o,t.normals[r]))return !1;return !0}(new Ms(i,e),new Ms(i,t))}function Ms(t,i){this.pos=t||new e.Vector2,this.angle=0,this.offset=new e.Vector2,this.setPoints(i||[]);}Ms.prototype.setPoints=Ms.prototype.setPoints=function(t){if(!this.points||this.points.length!==t.length){let i;const r=this.calcPoints=[],o=this.edges=[],s=this.normals=[];for(i=0;i<t.length;i++){const n=t[i],a=i<t.length-1?t[i+1]:t[0];n===a||n.x!==a.x||n.y!==a.y?(r.push(new e.Vector2),o.push(new e.Vector2),s.push(new e.Vector2)):(t.splice(i,1),i-=1);}}return this.points=t,this._recalc(),this},Ms.prototype._recalc=function(){const e=this.calcPoints,t=this.edges,i=this.normals,r=this.points,o=this.offset,s=this.angle,n=r.length;let a;for(a=0;a<n;a++){const t=e[a].copy(r[a]);t.x+=o.x,t.y+=o.y,0!==s&&t.rotate(s);}for(a=0;a<n;a++){const r=e[a],o=t[a].copy(a<n-1?e[a+1]:e[0]).sub(r);i[a].copy(o).perp().normalize();}return this};const As=[];for(let t=0;t<10;t++)As.push(new e.Vector2);const Cs=[];for(let e=0;e<5;e++)Cs.push([]);function Rs(e,t,i){let r=Number.MAX_VALUE,o=-Number.MAX_VALUE;const s=e.length;for(let i=0;i<s;i++){const s=e[i].dot(t);s<r&&(r=s),s>o&&(o=s);}i[0]=r,i[1]=o;}function Ls(e,t,i,r,o){const s=Cs.pop(),n=Cs.pop(),a=As.pop().copy(t).sub(e),l=a.dot(o);return Rs(i,o,s),Rs(r,o,n),n[0]+=l,n[1]+=l,s[0]>n[1]||n[0]>s[1]?(As.push(a),Cs.push(s),Cs.push(n),!0):(As.push(a),Cs.push(s),Cs.push(n),!1)}class Ps{constructor(e){const{transform:t,rect:i,z:r,outTileObj:o,viewBound:s,viewBoundObj:n,isCross:a,tileSize:l}=e;this.transform=t,this.rect=i,this.z=r,this.viewBound=s,this.viewBoundObj=n,this.outTileObj=o,this.isCross=a,this._tileSizeZOff=Math.log2(512/l),this.deep_dist=this.deepDistance(),this.deep_view_bound=[];}genDeepTileNumArray(){let e=this.z-this.root_zoom;return 0===e&&(e=1),[3,6,9,12,15,50].splice(0,e)}min_deep_tile(){let t,i;for(let r=this.z;r>=0;r--){if(i=this.transform.locationCoordinate(new e.LngLat(this.rect.east,this.rect.south))._zoomTo(r),t=this.transform.locationCoordinate(new e.LngLat(this.rect.west,this.rect.north))._zoomTo(r),Math.floor(t.column)===Math.floor(i.column)&&Math.floor(t.row)===Math.floor(i.row)){this.root_zoom=r;break}0===r&&(this.root_zoom=r);}this.deep_tile_nums=this.genDeepTileNumArray(),0!==this.root_zoom&&t?(this.deepTree(),this.recursion(Math.floor(t.column),Math.floor(t.row),this.root_zoom)):(this.deepTree(),this.recursion(0,0,this.root_zoom));}deepTree(){for(let t=0;t<this.deep_tile_nums.length&&(this.deep_dist>this.deep_tile_nums[t]||t<=this.deep_tile_nums.length-1&&t>0&&this.deep_dist<this.deep_tile_nums[t]&&this.deep_dist>this.deep_tile_nums[t-1]||0===t&&this.deep_dist<this.deep_tile_nums[0]);t++){const i=this.deepViewBound(this.deep_tile_nums[t]);this.deep_view_bound.push([new e.Vector2(i.bottomRight[0],i.bottomRight[1]),new e.Vector2(i.topRight[0],i.topRight[1]),new e.Vector2(i.topLeft[0],i.topLeft[1]),new e.Vector2(i.bottomLeft[0],i.bottomLeft[1])]);}if(this.deep_view_bound.length>1){const t=[];for(let i=0;i<this.viewBound.length;i++)0!==this.viewBound[i].length&&this.viewBound[i][0]&&this.viewBound[i][1]&&t.push(new e.Vector2(this.viewBound[i][0],this.viewBound[i][1]));this.deep_view_bound.push(t);}}deepDistance(){const t=this.transform.locationCoordinate(new e.LngLat(this.viewBoundObj.topMiddle[0],this.viewBoundObj.topMiddle[1]))._zoomTo(this.z),i=this.transform.locationCoordinate(new e.LngLat(this.viewBoundObj.bottomMiddle[0],this.viewBoundObj.bottomMiddle[1]))._zoomTo(this.z);return Math.sqrt(Math.pow(t.column-i.column,2)+Math.pow(t.row-i.row,2))}deepViewBound(e){const t=[this.viewBoundObj.bottomLeft[0],this.viewBoundObj.bottomLeft[1]],i=[this.viewBoundObj.bottomRight[0],this.viewBoundObj.bottomRight[1]],r=e/this.deep_dist;return {bottomLeft:t,bottomRight:i,topRight:[i[0]+(this.viewBoundObj.topRight[0]-i[0])*r,i[1]+(this.viewBoundObj.topRight[1]-i[1])*r],topLeft:[t[0]+(this.viewBoundObj.topLeft[0]-t[0])*r,t[1]+(this.viewBoundObj.topLeft[1]-t[1])*r]}}recursion(t,i,r){for(let o=0;o<this.deep_view_bound.length;o++)if(this.tileCrossView(t,i,r,this.deep_view_bound[o])){if(r+o>=this.z)this.outTileObj[`${r}-${t}-${i}`]=new e.OverscaledTileID(r,0,r,t,i);else {const e=r+1,o=2*t,s=2*i;this.recursion(o,s,e),this.recursion(o+1,s,e),this.recursion(o,s+1,e),this.recursion(o+1,s+1,e);}return}}tileCrossView(t,i,r,o){const s=this.transform.coordinateLocation(new e.Coordinate(t,i,r)),n=this.transform.coordinateLocation(new e.Coordinate(t+1,i,r)),a=this.transform.coordinateLocation(new e.Coordinate(t+1,i+1,r)),l=this.transform.coordinateLocation(new e.Coordinate(t,i+1,r));return this.isCross&&(s.lng=s.lng<0?360+s.lng:s.lng,n.lng=n.lng<0?360+n.lng:n.lng,a.lng=a.lng<0?360+a.lng:a.lng,l.lng=l.lng<0?360+l.lng:l.lng),Es([new e.Vector2(s.lng,s.lat),new e.Vector2(n.lng,n.lat),new e.Vector2(a.lng,a.lat),new e.Vector2(l.lng,l.lat)],o,new e.Vector2(s.lng,s.lat))}}function Is(t,i,r,o,s,n,a,l){(function(t,i,r,o,s,n){const a=s.coordinateLocation(new e.Coordinate(t,i,r)),l=s.coordinateLocation(new e.Coordinate(t+1,i,r)),c=s.coordinateLocation(new e.Coordinate(t+1,i+1,r)),h=s.coordinateLocation(new e.Coordinate(t,i+1,r));return Es([new e.Vector2(a.lng,a.lat),new e.Vector2(l.lng,l.lat),new e.Vector2(c.lng,c.lat),new e.Vector2(h.lng,h.lat)],o,new e.Vector2(a.lng,a.lat))})(t,i,r,o,a)&&r<n?(Is(2*t+1,2*i+1,r+1,o,s,n,a),Is(2*t,2*i+1,r+1,o,s,n,a),Is(2*t,2*i,r+1,o,s,n,a),Is(2*t+1,2*i,r+1,o,s,n,a)):s[`${r}-${t}-${i}`]=new e.OverscaledTileID(r,0,r,t,i);}class Os{constructor(t,i,r,o,s,n,a,l){this.tileSize=512,this._renderWorldCopies=void 0===r||r,this._minZoom=t||0,this._maxZoom=i||22,this.width=0,this.height=0,this._center=new e.LngLat(0,0),this._zoom=0,this.scale=this.zoomScale(this._zoom),this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={},this.td_projectionInverseMatrix=new e.Matrix4,this.td_viewMatrix=new e.Matrix4,this.td_viewInverseMatrix=new e.Matrix4,this.td_sphereRender=o||!0,this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],this._projection=s,this.td_camPos=[0,0,0,1],this.td_pixelMatrix=new e.Matrix4,this.pixelMatrixInverse=new e.Matrix4,this.td_viewBound=[],this.td_viewBoundRect={north:0,south:0,west:0,east:0},this.last_viewBound=[],this.td_fPEnabled=!1,this.isFlying=!1,this.near=1,this.far=1e4,this.Zup=null==l||l,this.td_camHeightOffset=0,this.maxTiles=0,this.panoAnyWhereMoveAngle=0,this.td_projNeedChange=!0,this.td_projZoomChangeNumber=0,this._calcProjectionsMatrix(),this.savedCoveringTilesWithTileSize={},this._minPitch=null==n?0:n,this._maxPitch=null==a?85:a,this.lockZoom=!1,this.cameraElevationReference="ground",this._centerAltitude=0,this._horizonShift=.1;}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e));}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e));}setMap(e){this._map=e;}setPainter(e){this.painter=e;}clone(){const e=new Os(this._minZoom,this._maxZoom,this._renderWorldCopies,this.sphereRender,this.projection);return e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._calcMatrices(),e.setMap(this._map),e.cameraElevationReference=this.cameraElevationReference,e}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this.alt||(this.td_cameraDistance=e.getCameraDistanceFromZoom(this._fov,this.zoom,e.CONSTS.TRANSFORM.R),this.alt=this.td_cameraDistance-e.CONSTS.TRANSFORM.R),this._calcProjectionsMatrix(),this._calcMatrices();}get zoom(){return this._zoom}set zoom(t){const i=Math.min(Math.max(t,this.minZoom),this.maxZoom);if(this._fov&&this._zoom!==i&&!this.lockZoom){if(this._unmodified=!1,this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom,this.td_cameraDistance=e.getCameraDistanceFromZoom(this._fov,i,e.CONSTS.TRANSFORM.R),this.fPMode){const t=(this.td_cameraDistance-e.CONSTS.TRANSFORM.R+this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE*9)/10;this.alt=t<this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE?this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE:t;}else this.alt=this.td_cameraDistance-e.CONSTS.TRANSFORM.R;this.current_zoom_tangent_angle=Math.PI/2-Math.asin(e.CONSTS.TRANSFORM.R/this.td_cameraDistance),this._constrain(),this._calcMatrices(),this._calcProjectionsMatrix(),this._calcMatrices();}else if(this.fPMode){const t=(9*this.alt+this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE)/10;this.alt=t>this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE?t:this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE;}}_calcProjectionsMatrix(){if(0!==this.width&&0!==this.height){if(this.td_projectionMatrix=new e.Matrix4,this.panoramaMode)this.td_projectionMatrix.perspective({fov:65*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:this.width/this.height,near:.01,far:10});else {let t=1,i=6*this.alt;this.zoom<=5&&(t=this.alt/4,i=this.alt+e.CONSTS.TRANSFORM.R),t<.1&&(t=.1),i<1e3&&(i=1e3),this.near=t,this.far=i,this.td_projectionMatrix=new e.Matrix4(this.td_projectionMatrix).perspective({fov:this._fov,aspect:this.width/this.height,near:t,far:i});}this.td_projectionInverseMatrix=new e.Matrix4(this.td_projectionMatrix).invert(),this.td_pixelMatrix=(new e.Matrix4).scale([this.width/2,-this.height/2,1]),this.td_pixelMatrix=new e.Matrix4(this.td_pixelMatrix).translate([1,-1,0]),this.td_projNeedChange=!1;}}set projection(e){this._projection=e;}get projection(){return this._projection}set sphereRender(t){this.pitch>e.CONSTS.TRANSFORM.PLAIN_MAX_PITCH&&!t&&(this.pitch=e.CONSTS.TRANSFORM.PLAIN_MAX_PITCH),this.td_sphereRender=t;}get sphereRender(){return this.td_sphereRender}locationPoint(e,t){return this.td_sphereRender?this.td_lngLatToScreenPoint(e,t).point:this.coordinatePoint(this.locationCoordinate(e))}locationPointOfScreen(e,t){return this.td_lngLatToScreenPoint(e,t)}td_lngLatToScreenPoint(t,i){t.lng<-180&&(t.lng=t.lng+360),t.lng>180&&(t.lng=t.lng-360);const r=new e.Vector4([0,0,0,1]);return e.transformECEFToGeographic(r,t.toArray(),e.CONSTS.TRANSFORM.R+(i||0)*e.CONSTS.TRANSFORM.R_SCALE),r.transform(this.td_viewMatrix),r.transform(this.td_projectionMatrix),r.transform(this.td_pixelMatrix),{point:new e.pointGeometry3d(r[0]/r[3],r[1]/r[3]),w:r[3]}}checkPositionForeground(t){if(this.td_sphereRender){const i=[0,0,0,1];e.transformECEFToGeographic(i,t.toArray(),e.CONSTS.TRANSFORM.R+this.alt);const r=this.getCameraPos(),o=new e.Vector3(i).normalize().dot(new e.Vector3(r).normalize());return Math.acos(o)<=this.current_zoom_tangent_angle}return !0}coordinatePoint(t){const i=t.zoomTo(this.zoom),r=new e.Vector4([i.column*this.tileSize,i.row*this.tileSize,0,1]);return r.transform(this.pixelMatrix),new e.pointGeometry3d(r[0]/r[3],r[1]/r[3])}lngX(t){return e.getProjection(this._projection).lngX(t,this.worldSize)}lngXRoundZoom(t){return e.getProjection(this._projection).lngX(t,Math.pow(2,Math.floor(this.zoom)))}latY(t){return e.getProjection(this._projection).latY(t,this.worldSize)}latYRoundZoom(t){return e.getProjection(this._projection).latY(t,Math.pow(2,Math.floor(this.zoom)))}xLng(t){return e.getProjection(this._projection).xLng(t,this.worldSize)}yLat(t){return e.getProjection(this._projection).yLat(t,this.worldSize)}get pitch(){return this._pitch*e.CONSTS.TRANSFORM.RAD_TO_DEG}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)*e.CONSTS.TRANSFORM.DEG_TO_RAD;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcProjectionsMatrix(),this._calcMatrices());}get center(){return this._center}set center(t){if(t.lat!==this._center.lat||t.lng!==this._center.lng){if(this.fPMode){const t=this._map.style,i=t?t.getTerrainAltitude():0;this.lockZoom=i*e.CONSTS.TRANSFORM.R_SCALE>this.alt,i!==-e.CONSTS.TRANSFORM.R&&(this.td_camHeightOffset+=(i-this.td_camHeightOffset)/5);}else this.lockZoom=!1;this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices();}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining||this.td_sphereRender)return;this._constraining=!0;let t,i,r,o,s=-90,n=90,a=-180,l=180;const c=this.size,h=this._unmodified;if(this.latRange){const e=this.latRange;s=this.latY(e[1]),n=this.latY(e[0]),t=n-s<c.y?c.y/(n-s):0;}if(this.lngRange){const e=this.lngRange;a=this.lngX(e[0]),l=this.lngX(e[1]),i=l-a<c.x?c.x/(l-a):0;}const u=Math.max(i||0,t||0);if(u)return this.center=this.unproject(new e.pointGeometry3d(i?(l+a)/2:this.x,t?(n+s)/2:this.y)),this.zoom+=this.scaleZoom(u),this._unmodified=h,void(this._constraining=!1);if(this.latRange){const e=this.y,t=c.y/2;e-t<s&&(o=s+t),e+t>n&&(o=n-t);}if(this.lngRange){const e=this.x,t=c.x/2;e-t<a&&(r=a+t),e+t>l&&(r=l-t);}if(void 0!==r||void 0!==o)if(this.td_sphereRender){const t=this.center.lat,i=this.unproject(new e.pointGeometry3d(void 0!==r?r:this.x,void 0!==o?o:this.y));this.center=new e.LngLat(i.lng,this._checkLatRange(t));}else this.center=this.unproject(new e.pointGeometry3d(void 0!==r?r:this.x,void 0!==o?o:this.y));this._unmodified=h,this._constraining=!1;}pointLocation(e,t){return this.td_sphereRender?bs({canvasX:e.x,canvasY:e.y,transform:this,alt:t||0,accurate:!0}).lngLat:this.coordinateLocation(this.pointCoordinate(e))}setLocationAtPoint(t,i){if(this.td_sphereRender){const r=bs({canvasX:i.x,canvasY:i.y,transform:this,accurate:!1});if(r.lngLat&&t){const i=[r.lngLat.lng-t.lng,r.lngLat.lat-t.lat];let o=this.center.lat-i[1];const s=this.center.lng-i[0];o=this._checkLatRange(o),this.center=new e.LngLat(s,o).wrap();}}else {const e=this.pointCoordinate(i)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(e)),this._renderWorldCopies&&(this.center=this.center.wrap());}}setLocation(e){this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap());}_checkLatRange(e){return this.latRange?e>90?90:e<-90?-90:e:e}coveringTiles(t){let i=this.coveringZoomLevel(t)-t.zoomOffset;i=i<1?1:i;const r=i;if(void 0!==t.minzoom&&i<t.minzoom)return [];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const o=this.pointCoordinate(this.centerPoint,i);let s=new e.pointGeometry3d(o.column-.5,o.row-.5);if(this.isFlying)return this._computeZoomTiles(3,s);const n=this.pointCoordinate(this._getEarthViewCalculateCenterPixel(),i);if(n&&(s=new e.pointGeometry3d(n.column,n.row)),this.zoom<4){if(this.last_viewBound!==this.td_viewBound&&(this.savedCoveringTilesWithTileSize={}),this.last_viewBound!==this.td_viewBound||!this.savedCoveringTilesWithTileSize[t.tileSize]){const o=function(t,i){const r=i.td_viewBoundRect,o={};if(i.antimeridian)if(i.centerInWestEast){const s={north:r.north,south:r.south,west:r.west,east:r.east};Is(0,0,0,[new e.Vector2(s.east,s.north),new e.Vector2(s.east,s.south),new e.Vector2(s.west,s.south),new e.Vector2(s.west,s.north)],o,t,i);}else {let s={north:r.north,south:r.south,west:r.east,east:180},n=[new e.Vector2(s.east,s.north),new e.Vector2(s.east,s.south),new e.Vector2(s.west,s.south),new e.Vector2(s.west,s.north)];Is(0,0,0,n,o,t,i),s={north:r.north,south:r.south,west:-180,east:r.west},n=[new e.Vector2(s.east,s.north),new e.Vector2(s.east,s.south),new e.Vector2(s.west,s.south),new e.Vector2(s.west,s.north)],Is(0,0,0,n,o,t,i);}else Is(0,0,0,[new e.Vector2(r.east,r.north),new e.Vector2(r.east,r.south),new e.Vector2(r.west,r.south),new e.Vector2(r.west,r.north)],o,t,i);const s=[];for(const e in o){const i=o[e];i.overscaledZ!==t?s.splice(0,0,i):s.push(i);}return s}(t.reparseOverscaled?r:i,this).sort(((e,t)=>s.dist(e.canonical)-s.dist(t.canonical)));return this.last_viewBound=this.td_viewBound,this.savedCoveringTilesWithTileSize[t.tileSize]=o,this.savedCoveringTilesWithTileSize[t.tileSize]}return this.savedCoveringTilesWithTileSize[t.tileSize]}if(this.last_viewBound!==this.td_viewBound&&(this.savedCoveringTilesWithTileSize={}),this.last_viewBound!==this.td_viewBound||!this.savedCoveringTilesWithTileSize[t.tileSize]){const e=function(e,t,i){const r=t.td_viewBoundRect,o=t.td_viewBound.slice(0),s=Object.assign({},t.td_viewBoundObj),n={};if(!s.topMiddle||0===s.topMiddle.length||!s.bottomMiddle||0===s.bottomMiddle.length)return [];if(t.antimeridian)if(t.centerInWestEast)new Ps({transform:t,rect:r,z:e,outTileObj:n,viewBound:o,viewBoundObj:s,isCross:!1,tileSize:i}).min_deep_tile();else {const o=function(e,t,i){const r={north:e.north,south:e.south,west:e.west<0?e.west+360:e.west,east:e.east},o=["topLeft","topMidL","topMiddle","topMidR","topRight","bottomRight","bottomMiddle","bottomLeft"],s=[],n={};for(const e of o){const t=i[e];if(t){let i=t[0];i<0&&(i+=360),n[e]=[i,t[1]],s.push([i,t[1]]);}}return {rect:r,viewBound:s,viewBoundObj:n}}(r,0,s);new Ps({transform:t,rect:o.rect,z:e,outTileObj:n,viewBound:o.viewBound,viewBoundObj:o.viewBoundObj,isCross:!0,tileSize:i}).min_deep_tile();}else new Ps({transform:t,rect:r,z:e,outTileObj:n,viewBound:o,viewBoundObj:s,isCross:!1,tileSize:i}).min_deep_tile();return Object.keys(n).map((e=>n[e]))}(t.reparseOverscaled?r:i,this,t.tileSize).sort(((e,t)=>s.dist(e.canonical)-s.dist(t.canonical)));return this.last_viewBound=this.td_viewBound,this.savedCoveringTilesWithTileSize[t.tileSize]=e,this.savedCoveringTilesWithTileSize[t.tileSize]}return this.savedCoveringTilesWithTileSize[t.tileSize]}_computeZoomTiles(t,i){const r={},o=[];for(let i=0;i<Math.pow(2,t);i++)for(let s=0;s<Math.pow(2,t);s++){const n=new e.OverscaledTileID(t,0,t,i,s);r[n.key]||(o.push(n),r[n.key]=!0);}return o.sort(((e,t)=>i.dist(e.canonical)-i.dist(t.canonical))).slice(0,40).reverse()}_getEarthViewCalculateCenterPixel(){return new e.pointGeometry3d(this.width/2,this.height)}_getMaxRectBounds(e){let t=1/0,i=-1/0,r=1/0,o=-1/0;for(let s=0;s<e.length;s++){const n=e[s];n&&(n[0]>i&&(i=n[0]),n[0]<t&&(t=n[0]),n[1]>o&&(o=n[1]),n[1]<r&&(r=n[1]));}const s={north:o,south:r,west:t,east:i,antimeridian:!1,centerInWestEast:!1};return this.center.lng>=t&&this.center.lng<=i?t<-180||i>180?(s.antimeridian=!0,s.centerInWestEast=!0):i-t>180&&(s.antimeridian=!0,s.centerInWestEast=!1):(this.center.lng<t||this.center.lng>i)&&(s.antimeridian=!0,s.centerInWestEast=!1),s}computeViewBounds(){const t=this.center.toArray(),i=[],r={},o=e.CONSTS.TRANSFORM.BOUND_KEYS;for(let e=0;e<o.length;e++)r[o[e]]=[];if(this.zoom<4){let i,o,s=this.pointLocation(new e.pointGeometry3d(this.width/2,0)),n=this.pointLocation(new e.pointGeometry3d(this.width/2,this.height));if(s||n){if(!s&&n){let t;for(let i=0;i<=.6;i+=.03){if(t){s=t;break}t=this.pointLocation(new e.pointGeometry3d(this.width/2,i*this.height));}}else if(s&&!n){let t;for(let i=0;i<=.6;i+=.03){if(t){n=t;break}t=this.pointLocation(new e.pointGeometry3d(this.width/2,(1-i)*this.height));}}}else {let t,i;for(let i=0;i<=.6;i+=.03){if(t){s=t;break}t=this.pointLocation(new e.pointGeometry3d(this.width/2,i*this.height));}for(let t=0;t<=.6;t+=.03){if(i){n=i;break}i=this.pointLocation(new e.pointGeometry3d(this.width/2,(1-t)*this.height));}}const a=s.toArray(),l=n.toArray();let c=Math.sqrt(Math.pow(a[0]-l[0],2)+Math.pow(a[1]-l[1],2))/2;c>89.9&&(c=89.9);const h=t[1]+c>85?85:t[1]+c,u=t[1]-c<-85?-85:t[1]-c;let d=this.width/this.height*c;d>89.9&&(d=89.9),i=t[0]-d,o=t[0]+d,o>180&&(o-=360),i<-180&&(i+=360),r.topLeft=[i,h],r.topRight=[o,h],r.bottomRight=[o,u],r.bottomLeft=[i,u];}else {const t=this.pointLocation(new e.pointGeometry3d(0,this.height)),i=this.pointLocation(new e.pointGeometry3d(this.width,this.height)),o=this.pointLocation(new e.pointGeometry3d(this.width/2,this.height));t&&(r.bottomLeft=t.toArray()),i&&(r.bottomRight=i.toArray()),o&&(r.bottomMiddle=o.toArray());let s=this.pointLocation(new e.pointGeometry3d(0,0)),n=this.pointLocation(new e.pointGeometry3d(this.width,0)),a=s,l=n;const c=this.pointLocation(new e.pointGeometry3d(this.width/2,0));if(c)this.tangentPoint=c.toArray(),r.topMiddle=this.tangentPoint;else for(let t=0;t<=1;t+=.03){const i=this.pointLocation(new e.pointGeometry3d(this.width/2,t*this.height));if(i){r.topMiddle=i.toArray();break}}if(s){const e=s.toArray();r.topLeft=e[1]>90?[e[0],90]:e;const t=n.toArray();r.topRight=t[1]>90?[t[0],90]:t;}else for(let t=0;t<1;t+=.025)if(s=this.pointLocation(new e.pointGeometry3d(0,t*this.height)),s){const i=s.toArray();r.topLeft=[i[0]>180?i[0]-360:i[0],i[1]>90?90:i[1]],n=this.pointLocation(new e.pointGeometry3d(this.width,t*this.height));const o=n.toArray();r.topRight=[o[0]>180?o[0]-360:o[0],o[1]>90?90:o[1]];break}if(a){const e=a.toArray();r.topMidL=e[1]>90?[e[0],90]:e;const t=l.toArray();r.topMidR=t[1]>90?[t[0],90]:t;}else for(let t=0;t<1;t+=.025){if(a=this.pointLocation(new e.pointGeometry3d(t*this.width,0)),a){const i=a.toArray();r.topMidL=[i[0]>180?i[0]-360:i[0],i[1]>90?90:i[1]],l=this.pointLocation(new e.pointGeometry3d((1-t)*this.width,0));const o=l.toArray();r.topMidR=[o[0]>180?o[0]-360:o[0],o[1]>90?90:o[1]];break}t+=.02;}}const s=this.zoom>=10?this.getFPBottomLngLatDifData(r):[0,0];for(const t of o)if(r[t]){if("bottomLeft"===t&&this.zoom>=10){const i=[(r.bottomLeft[0]-r.bottomRight[0])/5,(r.bottomLeft[1]-r.bottomRight[1])/5];r[t]=new e.Vector2(r[t]).add(i).add(s).toArray();}if("bottomRight"===t&&this.zoom>=10){const i=[(r.bottomRight[0]-r.bottomLeft[0])/5,(r.bottomRight[1]-r.bottomLeft[1])/5];r[t]=new e.Vector2(r[t]).add(i).add(s).toArray();}i.push(r[t]);}return this._checkAntimeridianAndPole(i),this.td_viewBoundObj=r,i}getFPBottomLngLatDifData(t){if(this._pitch>.5*this._fov){const i=this._pitch-.5*this._fov;let r;if(this.fPMode){const t=this.td_camHeightOffset*e.CONSTS.TRANSFORM.R_SCALE;r=t>this.alt?t:this.alt;}else r=this.alt*Math.cos(this._pitch);const o=r*Math.tan(i),s=[(t.topRight[0]-t.topLeft[0])/2+t.topLeft[0],(t.topRight[1]-t.topLeft[1])/2+t.topLeft[1]],n=[(t.bottomRight[0]-t.bottomLeft[0])/2+t.bottomLeft[0],(t.bottomRight[1]-t.bottomLeft[1])/2+t.bottomLeft[1]],a=o/e.CONSTS.TRANSFORM.R*e.CONSTS.TRANSFORM.RAD_TO_DEG/new e.Vector2(n).sub(s).len(),l=new e.Vector2(n).sub(s).scale(a);return [l[0],l[1]]}return [0,0,0]}_checkAntimeridianAndPole(e){const{north:t,south:i,west:r,east:o,antimeridian:s,centerInWestEast:n}=this._getMaxRectBounds(e);this.inPole=t>=85||i<=-85,this.antimeridian=s,this.centerInWestEast=n,this.inPole?(this.antimeridian=!1,this.td_viewBoundRect={north:t,south:i,west:-180,east:180}):this.td_viewBoundRect={north:t,south:i,west:r,east:o};}pointCoordinate(t,i){if(this.td_sphereRender){const r=bs({canvasX:t.x,canvasY:t.y,transform:this,accurate:!0});return r.lngLat?new e.Coordinate(this.lngX(r.lngLat.lng)/this.tileSize,this.latY(r.lngLat.lat)/this.tileSize,this.zoom)._zoomTo(i||this.zoom):this._delegatePointCoordinate(t,i)}return this._delegatePointCoordinate(t,i)}_delegatePointCoordinate(t,i){void 0===i&&(i=this.tileZoom);const r=new e.Vector4([t.x,t.y,0,1]),o=new e.Vector4([t.x,t.y,1,1]);r.transform(this.pixelMatrixInverse),o.transform(this.pixelMatrixInverse);const s=r[3],n=o[3],a=r[1]/s,l=o[1]/n,c=r[2]/s,h=o[2]/n,u=c===h?0:(0-c)/(h-c);return new e.Coordinate(e.number(r[0]/s,o[0]/n,u)/this.tileSize,e.number(a,l,u)/this.tileSize,this.zoom)._zoomTo(i)}get bearing(){return -this.angle/Math.PI*180}set bearing(t){const i=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=new e.Matrix2,this.rotationMatrix.rotate(this.angle));}_getFirstPersonViewMatrix(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:this.alt,lng:this.center.lng,lat:this.center.lat};const i=(new e.Matrix4).rotateX(t.pitch),r=(new e.Matrix4).translate([0,0,e.CONSTS.TRANSFORM.R+t.altitude]),o=(new e.Matrix4).rotateZ(t.bearing),s=(new e.Matrix4).rotateX((90-t.lat)*e.CONSTS.TRANSFORM.DEG_TO_RAD);return (new e.Matrix4).rotateZ((t.lng+90)*e.CONSTS.TRANSFORM.DEG_TO_RAD).multiplyRight(s).multiplyRight(o).multiplyRight(r).multiplyRight(i)}_getThirdPersonViewMatrix(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:this.alt,lng:this.center.lng,lat:this.center.lat};const i=(new e.Matrix4).translate([0,0,t.altitude]),r=(new e.Matrix4).rotateX(t.pitch),o=(new e.Matrix4).translate([0,0,e.CONSTS.TRANSFORM.R]),s=(new e.Matrix4).rotateZ(t.bearing),n=(new e.Matrix4).rotateX((90-t.lat)*e.CONSTS.TRANSFORM.DEG_TO_RAD);return (new e.Matrix4).rotateZ((t.lng+90)*e.CONSTS.TRANSFORM.DEG_TO_RAD).multiplyRight(n).multiplyRight(s).multiplyRight(o).multiplyRight(r).multiplyRight(i)}_getEarthMatrix(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:this.alt,lng:this.center.lng,lat:this.center.lat};const i=(new e.Matrix4).translate([0,0,t.altitude]),r=(new e.Matrix4).rotateX(t.pitch),o=(new e.Matrix4).translate([0,0,e.CONSTS.TRANSFORM.R]),s=(new e.Matrix4).rotateZ(t.bearing);null==t.roll&&(t.roll=0);const n=(new e.Matrix4).rotateY(t.roll),a=(new e.Matrix4).rotateX((90-t.lat)*e.CONSTS.TRANSFORM.DEG_TO_RAD);return (new e.Matrix4).rotateZ((t.lng+90)*e.CONSTS.TRANSFORM.DEG_TO_RAD).multiplyRight(a).multiplyRight(s).multiplyRight(o).multiplyRight(r).multiplyRight(i).multiplyRight(n)}_getPanoViewMatrix(){const t=new e.Matrix4;let i=.05*(this.zoom-1);i<0?i=0:i>.8&&(i=.8),this.pano_z=i,t.lookAt([0,0,0],[0,0,-1],[0,1,0]),t.rotateX((this.center.lat+90)*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateZ(-this.center.lng*e.CONSTS.TRANSFORM.DEG_TO_RAD);const r=(new e.Vector2).rotate([0,i],[0,0],(-90+this.panoAnyWhereMoveAngle)*e.CONSTS.TRANSFORM.DEG_TO_RAD);return t.translate([r[0],0,r[1]])}_calculateTDSceneMatrix(){let t=new e.Matrix4;const i=new e.Vector4([0,0,0,1]),r=new e.Vector4([0,0,-1,1]),o=new e.Vector4([0,1,0,1]);this.fPMode?(this.td_firstPersonViewMatrix=this._getFirstPersonViewMatrix(),i.transform(this.td_firstPersonViewMatrix),r.transform(this.td_firstPersonViewMatrix),o.transform(this.td_firstPersonViewMatrix),this.camera_upwardPos=o,this.camera_forwardPos=r,this.camera_currentPos=i,t.lookAt(i,r,[o[0]-i[0],o[1]-i[1],o[2]-i[2]])):this.panoramaMode?t=this._getPanoViewMatrix():(this.td_thirdPersonViewMatrix=this._getThirdPersonViewMatrix(),i.transform(this.td_thirdPersonViewMatrix),r.transform(this.td_thirdPersonViewMatrix),o.transform(this.td_thirdPersonViewMatrix),this.camera_upwardPos=o,this.camera_forwardPos=r,this.camera_currentPos=i,t.lookAt(i,r,[o[0]-i[0],o[1]-i[1],o[2]-i[2]])),this.td_viewMatrix=t,this.td_viewInverseMatrix=new e.Matrix4(this.td_viewMatrix).invert(),this.td_camPos=new e.Vector4([0,0,0,1]).transform(this.td_viewInverseMatrix),this.td_camPosNormalized=[this.td_camPos[0]/this.td_camPos[3],this.td_camPos[1]/this.td_camPos[3],this.td_camPos[2]/this.td_camPos[3]],this.td_vpMatrix=(new e.Matrix4).multiplyRight(this.td_projectionMatrix).multiplyRight(this.td_viewMatrix),this.td_viewBound=this.computeViewBounds();const s=(new e.Matrix4).perspective({fov:this._fov,aspect:this.width/this.height,near:.001,far:10}),n=new e.Matrix4;n.lookAt([0,0,1/Math.tan(this._fov/2)],[0,0,0],[0,1,0]);const a=new e.Matrix4;a.rotateX(this._pitch),this.td_symbolMVPMatrix=s.multiplyRight(n).multiplyRight(a);}customLayerMatrix(){return this.calculateVPMatrix().clone()}_calcMatrices(){if(!this.height)return;this._calculateTDSceneMatrix(),this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const t=this._fov/2,i=Math.PI/2+this._pitch,r=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),o=this.x,s=this.y,n=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance);let a=new e.Matrix4;a.perspective({fov:this._fov,aspect:this.width/this.height,near:1,far:n}),a.scale([1,-1,1]),a.translate([0,0,-this.cameraToCenterDistance]),a.rotateX(this.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD),a.rotateZ(this.angle),a.translate([-o,-s,0]),this.td_sphereRender||(this.mercatorMatrix=a.scale([this.worldSize,this.worldSize,this.worldSize]));const l=this.worldSize/(2*Math.PI*e.CONSTS.TRANSFORM.REAL_R*Math.abs(Math.cos(this.center.lat*e.CONSTS.TRANSFORM.DEG_TO_RAD)));a.scale([1,1,l,1]),this.projMatrix=a.clone();const c=this.width%2/2,h=this.height%2/2,u=Math.cos(this.angle),d=Math.sin(this.angle),_=o-Math.round(o)+u*c+d*h,m=s-Math.round(s)+u*h+d*c,f=a.clone();if(f.translate([_>.5?_-1:_,m>.5?m-1:m,0]),this.alignedProjMatrix=f,this.pixelMatrix=new e.Matrix4(this.td_pixelMatrix).multiplyRight(this.projMatrix),a=new e.Matrix4(this.pixelMatrix).invert(),!a&&!this.td_sphereRender)throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={};}calculateAnyCameraMatrix(t){const i=new e.Vector4([0,0,0,1]);let r=new e.Matrix4;const o=new e.Vector4([0,0,0,1]),s=new e.Vector4([0,0,-1,1]),n=new e.Vector4([0,1,0,1]);if(t.id===e.CONSTS.CAMERA.SKYBOX_CAMERA_ID)return;if(t.id===e.CONSTS.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID){const t=1+.035*Math.pow(2,-this.zoom);r=new e.Matrix4(this.td_viewMatrix).scale([-t,t,t]);}else if(t.id===e.CONSTS.CAMERA.SUNLIGHT_CAMERA_ID){const i=t.location||this.center.toArray(),a=this._getThirdPersonViewMatrix({lng:i[0],lat:i[1],pitch:t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*e.CONSTS.TRANSFORM.R_SCALE});o.transform(a),s.transform(a),n.transform(a),r.lookAt(o,s,[n[0]-o[0],n[1]-o[1],n[2]-o[2]]);}else {const i=this._getFirstPersonViewMatrix({lng:t.location[0],lat:t.location[1],pitch:t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*e.CONSTS.TRANSFORM.R_SCALE});o.transform(i),s.transform(i),n.transform(i),r.lookAt(o,s,[n[0]-o[0],n[1]-o[1],n[2]-o[2]]);}const a=r.clone().invert();i.transform(a),this._lastSunLightStatus={lng:this.center.lng,lat:this.center.lat,pitch:t.pitch,bearing:t.bearing,geographic:i.toArray().slice(0,3),camTransformMatrix:r};}calculateVPMatrix(t){if(t){if(this.calculateAnyCameraMatrix(t),t.id===e.CONSTS.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID)return new e.Matrix4(this.td_projectionMatrix).multiplyRight(this._lastSunLightStatus.camTransformMatrix);if(t.id===e.CONSTS.CAMERA.SKYBOX_CAMERA_ID){const i=new e.Matrix4;i.perspective({fov:60*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:this.width/this.height,near:.1,far:5});const r=(new e.Matrix4).lookAt([0,-.1,1],[0,-.1,0],[0,1,0]);return r.rotateX(-(t.pitch-90)*e.CONSTS.TRANSFORM.DEG_TO_RAD),r.rotateY((-this.center.lng-t.bearing)*e.CONSTS.TRANSFORM.DEG_TO_RAD),i.multiplyRight(r)}if(t.useCustomView){const i=new e.Matrix4;return i.perspective({fov:t.hFov*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:t.wFov/t.hFov,near:.1*e.CONSTS.TRANSFORM.R_SCALE,far:10*t.farDistance}),i.multiplyRight(this._lastSunLightStatus.camTransformMatrix)}if("visualDomainView"==t.id){const i=new e.Matrix4;return i.perspective({fov:t.hFov*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:t.wFov/t.hFov,near:.1*e.CONSTS.TRANSFORM.R_SCALE,far:t.farDistance}),i.multiplyRight(this._lastSunLightStatus.camTransformMatrix)}{const i=new e.Matrix4;return i.perspective({fov:this._fov,aspect:this.width/this.height,near:.1*e.CONSTS.TRANSFORM.R_SCALE,far:10*t.farDistance}),i.multiplyRight(this._lastSunLightStatus.camTransformMatrix)}}return new e.Matrix4(this.td_vpMatrix)}getCameraPos(){return this.td_camPosNormalized}get fPMode(){return this.td_fPEnabled}set fPMode(e){this.td_fPEnabled=e;}set cameraHeightOffset(e){this.td_camHeightOffset=e;}get cameraHeightOffset(){return this.td_camHeightOffset}set panoramaMode(e){this._panoramaMode=e,this._calcProjectionsMatrix(),e?this._saveSphereStatus():this._restoreSphereStatus(),this._calcMatrices();}get panoramaMode(){return this._panoramaMode}_saveSphereStatus(){this.sphere_save_transform_status={_zoom:0+this._zoom,_pitch:0+this._pitch,angle:0+this.angle,center:new e.LngLat(this._center.lng,this._center.lat)},this._zoom=0,this._pitch=0,this.angle=0,this.center=new e.LngLat(0,0),this.zoom=0;}_restoreSphereStatus(){this.sphere_save_transform_status&&(this._zoom=this.sphere_save_transform_status._zoom,this._pitch=this.sphere_save_transform_status._pitch,this.angle=this.sphere_save_transform_status.angle,this.center=this.sphere_save_transform_status.center);}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e));}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e));}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e;}get worldSize(){return this.tileSize*this.scale}get centerPoint(){return this.size._div(2)}get size(){return new e.pointGeometry3d(this.width,this.height)}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices());}coveringZoomLevel(e){return (e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize))}getVisibleUnwrappedCoordinates(t){const i=this.pointCoordinate(new e.pointGeometry3d(0,0),0),r=this.pointCoordinate(new e.pointGeometry3d(this.width,0),0),o=Math.floor(i.column),s=Math.floor(r.column),n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(let i=o;i<=s;i++)0!==i&&n.push(new e.UnwrappedTileID(i,t));return n}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){return new e.pointGeometry3d(this.lngX(t.lng),this.latY(t.lat))}unproject(t){return new e.LngLat(this.xLng(t.x),this.yLat(t.y))}get x(){return this.lngX(this.center.lng)}get y(){return this.latY(this.center.lat)}get point(){return new e.pointGeometry3d(this.x,this.y)}locationCoordinate(t){let i;return i=this.projection===e.ProjectionType.LATLON?this.latY(t.lat):t.lat<this.latRange[0]?this.worldSize:t.lat>this.latRange[1]?0:this.latY(t.lat),this.tileZoom||(this.tileZoom=this._zoom),new e.Coordinate(this.lngX(t.lng)/this.tileSize,i/this.tileSize,this.zoom).zoomTo(this.tileZoom)}coordinateLocation(t){const i=t.zoomTo(this.zoom);let r=this.yLat(i.row*this.tileSize);return this.projection===e.ProjectionType.LATLON?(r<-90&&(r=-90),r>90&&(r=90)):(r<this.latRange[0]&&(r=this.latRange[0]),r>this.latRange[1]&&(r=this.latRange[1])),new e.LngLat(this.xLng(i.column*this.tileSize),r)}calculatePosMatrix(t,i=!1){const r=t.key,o=i?this._alignedPosMatrixCache:this._posMatrixCache;if(o[r])return o[r];const s=t.canonical,n=this.worldSize/this.zoomScale(s.z),a=s.x+Math.pow(2,s.z)*t.wrap,l=new e.Matrix4;return l.translate([a*n,s.y*n,0]),l.scale([n/e.EXTENT,n/e.EXTENT,1]),l.multiplyLeft(i?this.alignedProjMatrix:this.projMatrix),o[r]=l.toArray(),o[r]}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e,t){const i=t?Math.cos(t):1;return this.cameraToCenterDistance/this._worldSizeFromZoom(e)*i}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;if(this.pitch>60)return 10;const t=this.pointCoordinate(new e.pointGeometry3d(0,0)).zoomTo(this.zoom);return new e.Vector4([t.column*this.tileSize,t.row*this.tileSize,0,1]).transform(this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry3d(0,t))}getCameraQueryGeometry(t){const i=this.getCameraPoint();if(1===t.length)return [t[0],i];{let r=i.x,o=i.y,s=i.x,n=i.y;for(const e of t)r=Math.min(r,e.x),o=Math.min(o,e.y),s=Math.max(s,e.x),n=Math.max(n,e.y);return [new e.pointGeometry3d(r,o),new e.pointGeometry3d(s,o),new e.pointGeometry3d(s,n),new e.pointGeometry3d(r,n),new e.pointGeometry3d(r,o)]}}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}}class Ds{constructor(t){this.options=t||{},this.layerFadeManager=new xs,this.requestPerformanceManager=new e.RequestPerformanceManger({}),this.modeControl=Ss(t.mode,{}),this.updateSourceCaches=[];}getLayerFadeManager(){return this.layerFadeManager}setMode(e){this.options.mode=e,this.modeControl=Ss(this.options.mode,{});}getMode(){return this.options.mode}prepare(e,t){const i=this.options.style;this.savedZoom=e._zoom,this.updateSourceCaches=[];let r=[];for(const e in i.sourceCaches){const t=i.sourceCaches[e],o=t._source;0===this.updateSourceCaches.length?r.push(t):r=[],o.priorityRequest&&this.updateSourceCaches.push(t);}0===this.updateSourceCaches.length&&(this.updateSourceCaches=r);}run(e,t,i){const r=e._zoom<this.savedZoom;this.savedZoom=e._zoom,this._updateLoop(e,r?1:0,t,i);}beforeStop(e,t){const i=this.options.style;this.updateSourceCaches=[];for(const e in i.sourceCaches)this.updateSourceCaches.push(i.sourceCaches[e]);}_updateLoop(e,t,i,r){if(!e.panoramaMode)for(const o of this.updateSourceCaches)o.update(e,t,i,r);}stop(e,t,i){this._updateLoop(e,0,t,i);}clearUpdateSourceCaches(){this.updateSourceCaches=[];}}class Ns{constructor(t){this._style=t,this.status=3,this.resourcePerformaceManager=new Ds({style:this._style,mode:e.CONSTS.PERFORMANCE.MODE.MANUAL}),this.previousTime=Date.now();}setMode(e){this.resourcePerformaceManager.setMode(e);}getMode(){return this.resourcePerformaceManager.getMode()}startAction(e,t,i){this.noServericeRequest=t,this.forceServericeRequest=i,0!==Object.keys(this._style.sourceCaches).length&&(2!==this.status?(this.status=1,this.resourcePerformaceManager.prepare(e,this.noServericeRequest),this.previousTime=Date.now(),this.animateAction(e)):(this.previousTime=Date.now(),this.animateAction(e)));}animateAction(e){this.status=2,this.resourcePerformaceManager.run(e,this.noServericeRequest,this.forceServericeRequest);}isStopped(){return 3===this.status}stopAction(e){this.status=3,this.resourcePerformaceManager.beforeStop(e,this.noServericeRequest),this.resourcePerformaceManager.stop(e,this.noServericeRequest,this.forceServericeRequest);}}const Fs=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Bs=e.pick(Ui,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Us=e.pick(Ui,["setCenter","setZoom","setBearing","setPitch"]),zs=function(){const t={},i=e.spec.$version;for(const r in e.spec.$root){const o=e.spec.$root[r];if(o.required){let e=null;e="version"===r?i:"array"===o.type?[]:{},null!=e&&(t[r]=e);}}return t}();class Gs extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new e.Dispatcher(Ni(),this),this.imageManager=new Zt,this.imageManager.setEventedParent(this),this.glyphManager=new ei(t._transformRequest,i.localIdeographFontFamily),this.lineAtlas=new oi(256,512),this.crossTileSymbolIndex=new Or,this.classificationLayer=[],this.ignoreClassificationLayer=[],this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this.sttc=new e.SharedTerrainTileCache(this.dispatcher,100),this.shouldUpdateSource=!0,this.fristClassificationTypeId=void 0,this._availableImages=[],this._originalSource=[],this._originalLayer=[],this._videoSource=void 0,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const r=this;this._rtlTextPluginCallback=Gs.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in r.sourceCaches)r.sourceCaches[e].reload();}));})),this.changWorkerProjection(i.projection||e.ProjectionType.MERCATOR),this.performanceManager=new Ns(this),this.on("data",(e=>{if((e.isTdModel||e.isTdTile)&&this.performanceManager.stopAction(this.map.transform),"source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const i=t.getSource();if(i&&i.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===i.id&&this._validateLayer(t);}})),this._performanceManagerEvent=this._performanceManagerEvent.bind(this),this.map.on&&this.map.on("moveend",this._performanceManagerEvent),this.once("load",(()=>{this.performanceManager.stopAction(this.map.transform);}));}_performanceManagerEvent(){this.performanceManager.forceServericeRequest=!0,this.performanceManager.stopAction(this.map.transform);}changWorkerProjection(e){this.dispatcher.broadcast("setProjection",{projection:e},(e=>{}));}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!a(t);t=l(t,i.key,i.appKey);const o=this.map._transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(o,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,r);}));}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate);}));}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(zs,!1);}markOriginalStyle(e){for(const t in e.sourceCaches)this._originalSource.push(t),e.sourceCaches[t]._original_style=!0;for(const t in e._layers)this._originalLayer.push(t),e._layers[t]._original_style=!0;}_load(t,i){if(i&&Fs(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const r=Bi(this.stylesheet.layers);this._order=r.map((e=>e.id)),this._layers={};for(let t of r)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t;this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.markOriginalStyle(this),this.light=new ri(this.stylesheet.light),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"));}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const r=t.sourceLayer;if(!r)return;const o=i.getSource();("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)));}_loadSprite(t){this._spriteRequest=function(t,i,o){const s=[],n=e.exported.devicePixelRatio>1?"@2x":"",l=(e=>{const{url:t}=e;if(!a(t))return t;const i=_(t);return i.path=`${r.SRC_URL}/sprite/sprite`,i.path})({url:t,format:n}),h=Array.isArray(r.spriteUrl)?r.spriteUrl:[r.spriteUrl];r.spriteUrl=h?Array.from(new Set([...h])):l;for(let a=0;a<r.spriteUrl.length;a++)s.push({}),(a=>{const l=c({url:t,format:n,extension:".json",index:a});e.getJSON(i(l,e.ResourceType.SpriteJSON),((e,t)=>{s[a].json=t,s[a].error||(s[a].error=e),Wt(s,r.spriteUrl.length,o);}));const h=c({url:t,format:n,extension:".png",index:a});e.getImage(i(h,e.ResourceType.SpriteImage),((e,t)=>{s[a].image=t,s[a].error||(s[a].error=e),Wt(s,r.spriteUrl.length,o);}));})(a);}(t,this.map._transformRequest,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}));}));}enableSunLight(){this.sunLightFlag=!0;}disableSunLight(){this.sunLightFlag=!1;}getSharedTerrainTileCache(){return this.sttc}loaded(){if(!this._loaded)return !1;if(Object.keys(this._updatedSources).length)return !1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return !1;if(!this.imageManager.isLoaded())return !1;for(const e in this._layers)if(Object.hasOwnProperty.call(this._layers,e)){const t=this._layers[e];if(t.usePBR&&("3d-model"===t.type||"3d-tiles"===t.type)&&(!this.map._iBLtextures||!this.map._iBLtextures.isLoaded))return !1}return !0}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize());}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return !0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return !0;for(const e in this._layers)if(this._layers[e].hasTransition())return !0;return !1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(this._loaded){if(this._changed){const i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);(i.length||r.length)&&this._updateWorkerLayers(i,r);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e);}for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates(),this.fire(new e.Event("data",{dataType:"style"}));}for(const e in this.sourceCaches)this.sourceCaches[e].used=!1;for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0);}this.light.recalculate(t),this.z=t.zoom;}}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies&&this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={};}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t});}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={};}setState(t,r){if(this._checkLoaded(),Fs(this,e.validateStyle(t)))return !1;(t=e.clone(t)).layers=Bi(t.layers);const o=function(e,t,r){if(!e)return [{command:Ui.setStyle,args:[t]}];let o=[];try{if(!i(e.version,t.version))return [{command:Ui.setStyle,args:[t]}];i(e.center,t.center)||o.push({command:Ui.setCenter,args:[t.center]}),i(e.zoom,t.zoom)||o.push({command:Ui.setZoom,args:[t.zoom]}),i(e.bearing,t.bearing)||o.push({command:Ui.setBearing,args:[t.bearing]}),i(e.pitch,t.pitch)||o.push({command:Ui.setPitch,args:[t.pitch]}),i(e.sprite,t.sprite)||o.push({command:Ui.setSprite,args:[t.sprite]}),i(e.glyphs,t.glyphs)||o.push({command:Ui.setGlyphs,args:[t.glyphs]}),i(e.transition,t.transition)||o.push({command:Ui.setTransition,args:[t.transition]}),i(e.light,t.light)||o.push({command:Ui.setLight,args:[t.light]});const s={};t.layers.forEach((e=>{e._original_style=!0;}));for(const e in t.sources)t.sources[e]._original_style=!0;const n=[];!function(e,t,r,o,s){let n;for(n in t=t||{},e=e||{})e.hasOwnProperty(n)&&(s&&!e[n]._original_style||t.hasOwnProperty(n)||Gi(n,r,o));for(n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)?i(e[n],t[n])||("geojson"===e[n].type&&"geojson"===t[n].type&&ki(e,t,n)?r.push({command:Ui.setGeoJSONSourceData,args:[n,t[n].data]}):Vi(n,t,r,o,t[n]._original_style)):zi(n,t,r,!!t[n]._original_style));}(e.sources,t.sources,n,s,r);const a=[];e.layers&&e.layers.forEach((e=>{s[e.source]?o.push({command:Ui.removeLayer,args:[e.id]}):a.push(e);})),o=o.concat(n),r&&a.forEach((e=>{e._original_style||t.layers.push(e);})),function(e,t,r,o){t=t||[];const s=(e=e||[]).map(Xi),n=t.map(Xi),a=e.reduce(ji,{}),l=t.reduce(ji,{}),c=s.slice(),h=Object.create(null);let u,d,_,m,f,p,g;for(u=0,d=0;u<s.length;u++)_=s[u],o&&a.hasOwnProperty(_)&&!a[_]._original_style||l.hasOwnProperty(_)?d++:(r.push({command:Ui.removeLayer,args:[_]}),c.splice(c.indexOf(_,d),1));for(u=0,d=0;u<n.length;u++)_=n[n.length-1-u],c[c.length-1-u]!==_&&(a.hasOwnProperty(_)?(r.push({command:Ui.removeLayer,args:[_]}),c.splice(c.lastIndexOf(_,c.length-d),1)):d++,p=c[c.length-u],r.push({command:Ui.addLayer,args:[l[_],p,{isOriginal:l[_]._original_style}]}),c.splice(c.length-u,0,_),h[_]=!0);for(u=0;u<n.length;u++)if(_=n[u],m=a[_],f=l[_],!h[_]&&!i(m,f))if(i(m.source,f.source)&&i(m["source-layer"],f["source-layer"])&&i(m.type,f.type)){for(g in Hi(m.layout,f.layout,r,_,null,Ui.setLayoutProperty),Hi(m.paint,f.paint,r,_,null,Ui.setPaintProperty),i(m.filter,f.filter)||r.push({command:Ui.setFilter,args:[_,f.filter]}),i(m.minzoom,f.minzoom)&&i(m.maxzoom,f.maxzoom)||r.push({command:Ui.setLayerZoomRange,args:[_,f.minzoom,f.maxzoom]}),m)m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Hi(m[g],f[g],r,_,g.slice(6),Ui.setPaintProperty):i(m[g],f[g])||r.push({command:Ui.setLayerProperty,args:[_,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Hi(m[g],f[g],r,_,g.slice(6),Ui.setPaintProperty):i(m[g],f[g])||r.push({command:Ui.setLayerProperty,args:[_,g,f[g]]}));}else r.push({command:Ui.removeLayer,args:[_]}),p=c[c.lastIndexOf(_)+1],r.push({command:Ui.addLayer,args:[f,p,{isOriginal:l[_]._original_style}]});}(a,t.layers,o,r);}catch(e){o=[{command:Ui.setStyle,args:[t]}];}return o}(this.roughSerialize(),t,r).filter((e=>!(e.command in Us)));if(0===o.length)return !1;const s=o.filter((e=>!(e.command in Bs)));if(s.length>0)throw new Error(`Unimplemented: ${s.map((e=>e.command)).join(", ")}.`);return o.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args);})),this.stylesheet=t,!0}updateImage(e,t){this.imageManager.updateImage(e,t);}addImage(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this._afterImageUpdated(t);}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t),this.fire(new e.Event("data",{dataType:"style"}));}listImages(){return this._checkLoaded(),this._availableImages.slice()}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}));}addSource(e,t,i){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!t.type)throw new Error(`The type property must be defined, but the only the following properties were given: ${Object.keys(t).join(", ")}.`);this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const r=this.sourceCaches[e]=function(e,t,i,r){return "3d-tiles"===t.type?new vs(e,t,i):new Nr(e,t,i,r)}(e,t,this.dispatcher,this.sttc);"video-project"===r.sourceType&&(this._videoSource=r._source),i&&i.isOriginal&&(this.sourceCaches[e]._original_style=!0),r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:e}))),r.onAdd(this.map),this._changed=!0;}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0;}setGeoJSONSourceData(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0;}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(t,i,r){this._checkLoaded();const o=t.id;if(this.getLayer(o))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${o}" already exists on this map`)));let s;if("custom"===t.type)s=e.createStyleLayer(t);else {if("object"==typeof t.source&&(this.addSource(o,t.source),t=e.clone(t),t=e.extend(t,{source:o})),this._validate(e.validateStyle.layer,`layers.${o}`,t,{arrayIndex:-1},r))return;s=e.createStyleLayer(t),this._validateLayer(s),s.setEventedParent(this,{layer:{id:o}});}const n=i?this._order.indexOf(i):this._order.length;if(i&&-1===n)this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));else {if(e.defined(s.classificationType)&&s.classificationType!=e.ClassificationType.NONE&&s.classificationType!=e.ClassificationType.TERRAIN?s.classificationType===e.ClassificationType.IGNORECLASSIFICATION?this.ignoreClassificationLayer.indexOf(o)<0&&this.ignoreClassificationLayer.push(o):this.classificationLayer.indexOf(o)<0&&this.classificationLayer.push(o):this._order.splice(n,0,o),this._updateSpecialLayerIndex(this.classificationLayer),this._updateSpecialLayerIndex(this.ignoreClassificationLayer),this._layerOrderChanged=!0,this._layers[o]=s,r&&r.isOriginal&&(this._layers[o]._original_style=!0),this._removedLayers[o]&&s.source&&"custom"!==s.type){const e=this._removedLayers[o];delete this._removedLayers[o],e.type!==s.type?this._updatedSources[s.source]="clear":(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause());}this._updateLayer(s),s.onAdd&&s.onAdd(this.map);}}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);const o=i?this._order.indexOf(i):this._order.length;i&&-1===o?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(o,0,t),this._layerOrderChanged=!0);}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));this.classificationLayer.length>0&&(this.classificationLayer=this.classificationLayer.filter((e=>e!=t))),this.ignoreClassificationLayer.length>0&&(this.ignoreClassificationLayer=this.ignoreClassificationLayer.filter((e=>e!=t))),i.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map);}getLayer(e){return this._layers[e]}setLayerZoomRange(t,i,r){this._checkLoaded();const o=this.getLayer(t);o?o.minzoom===i&&o.maxzoom===r||(null!=i&&(o.minzoom=i),null!=r&&(o.maxzoom=r),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)));}setSourceFilter(e,t){const i=this.getSource(e);i&&(i.setFilter(t),this._reloadSource(e));}setFilter(t,r){this._checkLoaded();const o=this.getLayer(t);if(o){if(!i(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateStyle.filter,`layers.${o.id}.filter`,r)||(o.filter=e.clone(r),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)));}getFilter(t){return e.clone(this.getLayer(t).filter)}setLayoutProperty(t,r,o){this._checkLoaded();const s=this.getLayer(t);s?i(s.getLayoutProperty(r),o)||(s.setLayoutProperty(r,o),this._updateLayer(s)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)));}getLayoutProperty(t,i){const r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)));}setPaintProperty(t,r,o){this._checkLoaded();const s=this.getLayer(t);s?i(s.getPaintProperty(r),o)||(s.setPaintProperty(r,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)));}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,o=t.sourceLayer,s=this.getSource(r);if(void 0===s)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const n=s.type;"geojson"===n&&o?this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==n||o?(void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[r].setFeatureState(o,t.id,i)):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}removeFeatureState(t,i){this._checkLoaded();const r=t.source,o=this.getSource(r);if(void 0===o)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.type,n="vector"===s?t.sourceLayer:void 0;"vector"!==s||n?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):this.sourceCaches[r].removeFeatureState(n,t.id,i):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,o=this.getSource(i);if(void 0!==o){if("vector"!==o.type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[i].getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.sourceCaches,(e=>e.serialize())),layers:this._serializeLayers(this._order),IBL:this.stylesheet.IBL},(e=>void 0!==e))}roughSerialize(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:this.sourceCaches,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0;}_flattenRenderedFeatures(e){const t=[],i=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];for(const r of e){const e=r[o],s=this._layers[o].type;if(e)if("extrusion"===s||"histogram"===s||"3d-tiles"===s||"3d-model"===s||"raster"===s)for(const t of e)i.push(t);else for(const i of e)t.push(i);}}i.sort(((e,t)=>e.intersectionZ-t.intersectionZ));for(const e of i)t.push(e);return t}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);const o={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const t=this._layers[e];if(!t)return [];o[t.source]=!0;}}const s=[];i.availableImages=this._availableImages,this.ray=this.map.painter.getPickRay(t[0]),this.fire(new e.Event("data",{}));for(const e in this.sourceCaches){if(i.layers&&!o[e])continue;const n=this.sourceCaches[e].getSource(),a=n.type;if("3d-tiles"===a){const o=Ai(this.sourceCaches[e],this._layers,t,i,r,this.ray,!!i.modelHighlight);o&&s.push(o);}else if("3d-model"===a){const o=Mi(this.sourceCaches[e],this._layers,t,i,r,this.ray,!!i.modelHighlight);o&&s.push(o);}else "raster"===a&&n.renderWithTerrain?s.push(this.queryDEMPositionByPoint({point:t[0]},n)):(s.push(Ei(this.sourceCaches[e],this._layers,t,i,r,this.ray)),i.modelHighlight||(s.push(wi(this.sourceCaches[e],this._layers,t,i,r)),this.placement&&s.push(Ci(this._layers,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData,r,this.ray))));}return this._flattenRenderedFeatures(s)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter);const r=this.sourceCaches[t];return r?function(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],o={};for(let e=0;e<i.length;e++){const s=i[e],n=s.tileID.canonical.key;o[n]||(o[n]=!0,s.querySourceFeatures(r,t));}return r}(r,i):[]}querySpherePosition(e,t){return this.ray=this.map.painter.getPickRay(e.point),this.sttc.queryTileIntersectPoint(this.map.transform,t,e,this.ray)}queryDEMPositionByPoint(e,t){const i=this.querySpherePosition(e,t);for(const e in this._layers)if(this._layers[e].source===t.id)return {[e]:[i]};return {}}addSourceType(e,t,i){return Gs.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Gs.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getTerrainAltitude(){for(const e in this.sourceCaches){const t=this.sourceCaches[e]._source;if(t instanceof ci&&t.renderWithTerrain&&t.terrainTiles&&t.terrainTiles.length>0)return this.sttc.queryOneTileIntersectHeight(this.map.transform,t)}return e.CONSTS.TRANSFORM.ERR_TERRAIN_ALT}getLight(){return this.light.getLight()}setLight(t){this._checkLoaded();const r=this.light.getLight();let o=!1;for(const e in t)if(!i(t[e],r[e])){o=!0;break}if(!o)return;const s={now:e.exported.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t),this.light.updateTransitions(s);}_validate(t,i,r,o,s){return (!s||!1!==s.validate)&&Fs(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:r,styleSpec:e.spec},o)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches)this.sourceCaches[e].clearTiles(),this.sourceCaches[e].setEventedParent(null);this.performanceManager.resourcePerformaceManager.updateSourceCaches.length>0&&(this.map.off("moveend",this._performanceManagerEvent),this.performanceManager=null),this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove();}_clearSource(e){this.sourceCaches[e].clearTiles();}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload();}_updateSources(e,t,i){this.performanceManager.startAction(e,t,i),this.pmTimeout&&(clearTimeout(this.pmTimeout),this.pmTimeout=null),this.pmTimeout=setTimeout((()=>{this.performanceManager&&!this.performanceManager.isStopped()&&this.performanceManager.stopAction(e);}),200);}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e);}_updatePlacement(t,i,r,o,s=!1){let n=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type&&"symtracking"!==i.type)continue;if(!l[i.source]){const e=this.sourceCaches[i.source];l[i.source]=e.getRenderableIds().map((t=>e.getTileByID(t))).sort(((e,t)=>("string"!=typeof e.tileID&&"string"!=typeof t.tileID?t.tileID.overscaledZ-e.tileID.overscaledZ:0)||("string"!=typeof e.tileID&&"string"!=typeof t.tileID&&e.tileID.isLessThan(t.tileID)?-1:1)));}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng);n=n||r;}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((s=s||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now()))&&(this.pauseablePlacement=new Cr(t,this._order,s,i,r,o),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,e.exported.now()),a=!0),n&&this.pauseablePlacement.placement.setStale()),a||n)for(const e of this._order){const t=this._layers[e];"symbol"!==t.type&&"symtracking"!==t.type||this.placement.updateLayerOpacities(t,l[t.source]);}return !this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles();}_updateSpecialLayerIndex(e){e.length>0&&(e.forEach((e=>{const t=this._order.indexOf(e);t>-1&&this._order.splice(t,1);})),this._order=this._order.concat(e));}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const r=this.sourceCaches[t.source];r&&r.setDependencies(t.tileID.key,t.type,t.icons);}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i);}getResource(t,i,r){return e.makeRequest(i,r)}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches");}}Gs.getSourceType=function(e){return Ti[e]},Gs.setSourceType=function(e,t){Ti[e]=t;},Gs.registerForPluginStateChange=e.registerForPluginStateChange;var Vs=e.createLayout([{name:"a_pos",type:"Int16",components:2}]),ks="#define GLSLIFY 1\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor){return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0);}float unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}",Hs="#define GLSLIFY 1\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvarying vec2 v_pos;void main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xs="#define GLSLIFY 1\nattribute vec3 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}",js="#define GLSLIFY 1\n#include <variable_pbr_f>\n#include <get_pbr_color>\nvoid main(){vec4 baseColor=vec4(1.0);vec2 temPUV;if(u_useTextureMatrix){temPUV=vec2(fract(v_UV.s)*v_TEXTURE_TRANSFORM_1.x+v_TEXTURE_TRANSFORM_1.z,fract(v_UV.t)*v_TEXTURE_TRANSFORM_1.y+v_TEXTURE_TRANSFORM_1.w);}else{temPUV=v_UV;}\n#ifdef M_HAS_CLIPPING\n#ifdef M_IS_CLIPPING_BOX\nboxClipDiscardPixel(v_clamp_pos,u_clamp_matrix,u_clamp_box,u_clamp_box_inner);\n#endif\n#ifdef M_IS_CLIPPING_PLANE\nplaneClipDiscardPixel(v_clamp_pos,u_clamp_plane);\n#endif\n#ifdef M_IS_CLIPPING_RANGE\nrangeClipDiscardPixel(v_clamp_range,u_x_clamp_range,u_y_clamp_range,u_z_clamp_range);\n#endif\n#endif\nif(u_HAS_BASECOLORMAP){if(u_b_flow_text){if(u_b_flow_text_s){baseColor=SRGBtoLINEAR(texture2D(u_BaseColorSampler,(u_useKhr ? mod(temPUV,1.0): temPUV)+vec2(u_flow_text_off,0.)))*u_BaseColorFactor;}else{baseColor=SRGBtoLINEAR(texture2D(u_BaseColorSampler,(u_useKhr ? mod(temPUV,1.0): temPUV)+vec2(0.,u_flow_text_off)))*u_BaseColorFactor;}}else{baseColor=SRGBtoLINEAR(texture2D(u_BaseColorSampler,abs(mod(temPUV,1.0))))*u_BaseColorFactor;}if(baseColor.a==0.){discard;}}else{baseColor=u_BaseColorFactor;}\n#ifdef M_HAS_SHADOW\nif(u_LayerEnableSM){float ShadowFactor=getShadowColor(v_pos_from_light,u_shadow_sampler,u_shadow_off,gMapSizeInv);const float ambient=0.3;float NL=1.0;float perOrign=NL*ShadowFactor*(1.0-ambient)+ambient;if(u_EnableShadowCenter){float dist=distance(u_ShadowCenter.xyz,v_PosGeo);if(dist<u_ShadowCenter.w){baseColor.rgb=perOrign*baseColor.rgb;}}else{baseColor.rgb=perOrign*baseColor.rgb;}}\n#endif\n#ifdef M_HAS_VIEWSHED\nif(u_OpenViewshed){baseColor=getViewshedColor(baseColor,u_viewshed_samp0,u_shadow_off,u_viewshed_eye0,u_viewshed_dist0,v_viewshed_pos[0],v_view_spacepos[0],u_viewshedVisibleColor,u_viewshedInVisibleColor);}\n#endif\nbaseColor=getHighLightColor(u_hightlight,u_specialindex,u_specialcolor,baseColor);\n#ifdef M_CONVERT_BGR_2_RGB\nbaseColor=baseColor.bgra;\n#endif\n#if (defined M_USE_IBL) && (defined M_TEXTURE_LOD_SUPPORTED)\ngl_FragColor=getPBRColor(baseColor);\n#else\nvec4 temp_baseColor=vec4(pow(baseColor.rgb,vec3(1.0/2.2)),baseColor.a);\n#ifdef M_PHONG_LIGHT\nvec4 phongColor=vec4(Phong(v_Position,v_Normal,u_lightMaterial),1.0);gl_FragColor=temp_baseColor*phongColor;\n#else\ngl_FragColor=temp_baseColor;\n#endif\n#endif\n#ifdef M_VERTEX_COLOR\ngl_FragColor=v_COLOR_0;\n#endif\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_clip_video){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_model_matrix,v_PosOrigin,u_VideoSampler[i],u_Alpha[i],u_clip_Mattrix,u_maskSample,u_texture_Size,u_active_clip_videoTexture[i],u_clipColors[i])){return;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_model_matrix,v_PosOrigin,u_VideoSampler[i],u_Alpha[i],u_clip_Mattrix,u_maskSample,u_texture_Size,false,u_clipColors[i])){return;}}}}\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}",Ys="#define GLSLIFY 1\n#include <variable_pbr_v>\nmat4 calcSkinMatrix(){\n#ifdef M_JOINT_MATRIX_CNT\nmat4 skinMatrix=a_WEIGHTS_0.x*u_jointMatrix[int(a_JOINTS_0.x)].m+a_WEIGHTS_0.y*u_jointMatrix[int(a_JOINTS_0.y)].m+a_WEIGHTS_0.z*u_jointMatrix[int(a_JOINTS_0.z)].m+a_WEIGHTS_0.w*u_jointMatrix[int(a_JOINTS_0.w)].m;return skinMatrix;\n#else\nreturn mat4(1.0);\n#endif\n}void getAnimatedGLPosition(){if(u_has_skinning){gl_Position=u_matrix*calcSkinMatrix()*a_POSITION;}else{\n#ifdef M_USE_MORPHTARGETS\nvec3 transformed=a_POSITION_1.xyz*u_morphTargetInfluences[0];transformed+=a_POSITION_2.xyz*u_morphTargetInfluences[1];gl_Position=u_matrix*vec4(a_POSITION.xyz+transformed,1.0);\n#ifdef M_USE_MORPHNORMALS\nvec3 transformedNormal=a_NORMAL_1.xyz*u_morphTargetInfluences[0];transformedNormal+=a_NORMAL_2.xyz*u_morphTargetInfluences[1];v_Normal=v_Normal+transformedNormal;vec4 v1=a_TANGENT_1;vec4 v2=a_TANGENT_2;\n#endif\n#else\n#ifdef M_INSTANCE_MATRIX\ngl_Position=u_matrix*a_InstanceMatrix4*a_POSITION;\n#else\ngl_Position=u_matrix*a_POSITION;\n#endif\n#endif\n}}void main(){vec4 pos=u_model_matrix*a_POSITION;v_Position=vec3(pos.xyz)/pos.w;v_PosOrigin=a_POSITION;v_COLOR_0=a_COLOR_0;v_TEXTURE_TRANSFORM_1=a_TEXTURE_TRANSFORM_1;v_NormalOrigin=vec3(1);if(u_HAS_NORMALS){v_NormalOrigin=a_NORMAL.xyz;if(u_HAS_TANGENTS){vec3 normalW=normalize(vec3(a_NORMAL.xyz));vec3 tangentW=normalize(vec3(a_TANGENT.xyz));vec3 bitangentW=cross(normalW,tangentW)*a_TANGENT.w;v_TBN=mat3(tangentW,bitangentW,normalW);}else{\n#ifdef M_INSTANCE_MATRIX\nv_Normal=normalize(vec3(u_normal*a_InstanceMatrix4*vec4(a_NORMAL.xyz,0.0)));\n#else\nv_Normal=normalize(vec3(u_normal*vec4(a_NORMAL.xyz,0.0)));\n#endif\n}}v_UV=getKHRCoord(a_TEXCOORD_0,u_useKhr,u_khrValues);\n#ifdef M_HAS_CLIPPING\nv_clamp_pos=vec3(u_clamp_model_matrix*a_POSITION);\n#ifdef M_IS_CLIPPING_RANGE\nv_clamp_range=getClampRange(a_POSITION,u_min_clamp_bounds,u_max_clamp_bounds);\n#endif\n#endif\n#ifdef M_HAS_SHADOW\nv_pos_from_light=u_sun_matrix*u_sceneMatrix*vec4(a_POSITION.xyz,1.0);vec4 PosGeoV4=u_Geo_matrix*vec4(a_POSITION.xyz,1.0);v_PosGeo=PosGeoV4.xyz/PosGeoV4.w;vec4 NormalSceneV4=u_sceneMatrix*vec4(a_NORMAL.xyz,0.0);v_NormalScene=NormalSceneV4.xyz;vec4 PosSceneV4=u_sceneMatrix*vec4(a_POSITION.xyz,1.0);v_PosScene=PosSceneV4.xyz/PosSceneV4.w;\n#endif\n#ifdef M_HAS_VIEWSHED\nv_viewshed_pos[0]=u_viewshed_mat0*a_POSITION;v_view_spacepos[0]=u_model_matrix*a_POSITION;\n#endif\ngetAnimatedGLPosition();\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}",Ws="#define GLSLIFY 1\nattribute vec4 a_Position;attribute vec2 a_TexCoord;varying vec2 v_TexCoord;uniform mat4 u_MvpMatrix;void main(){gl_Position=u_MvpMatrix*a_Position;v_TexCoord=a_TexCoord;}",qs="#ifdef GL_ES\nprecision mediump float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D u_Sampler;varying vec2 v_TexCoord;void main(){gl_FragColor=texture2D(u_Sampler,v_TexCoord);}";const Zs={variable_base:"#define GLSLIFY 1\nuniform mat4 u_matrix;attribute vec3 a_pos;",variable_circle_f:"#define GLSLIFY 1\n#include <variable_reject>\nvarying vec3 v_data;",variable_circle_v:"#define GLSLIFY 1\n#include <variable_reject>\n#include <variable_define>\n#include <variable_base>\n#include <back_of_earth>\nuniform mat4 u_modelMatrix;uniform mat2 u_pixel_matrix;uniform vec2 u_gl_units_to_pixels;attribute vec2 a_extra;varying vec3 v_data;",variable_collision_f:"#define GLSLIFY 1\nvarying float v_placed;varying float v_notUsed;",variable_collision_v:"#define GLSLIFY 1\nattribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;",variable_define:"#define GLSLIFY 1\n#define scale 0.015873016\n#define GAUSS_COEF 0.3989422804014327\n#define ANTIALIASING 1.0 / M_DEVICE_PIXEL_RATIO / 2.0\n#define LINE_DISTANCE_SCALE 2.0\n#define PI 3.141592653589793\n#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/M_DEVICE_PIXEL_RATIO\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;uniform vec2 currentFrustum;\n#endif\nconst highp float ZERO=1.0/255.0/16.0;const float c_MinRoughness=0.04;",variable_extrusion_f:"#define GLSLIFY 1\n#include <struct_Region>\n#include <decode_float>\nvarying vec3 v_normal;varying vec3 v_pos_region;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec2 v_pos;varying highp float v_is_top;uniform vec3 u_LightColor;uniform lowp vec3 u_LightDirection;uniform Region u_regions[M_RADIATION_REGIONS_COUNT];uniform highp float u_region_percent;uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform highp float u_shadow_off;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform sampler2D u_image;uniform sampler2D u_image_top;uniform bool u_top_tex_rend;varying float v_directional;varying float v_opacity;varying vec4 v_color;varying float v_height;uniform lowp float u_depth_render;uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;",variable_extrusion_v:"#define GLSLIFY 1\n#include <variable_base>\n#include <struct_Region>\nuniform mat4 u_normal;uniform mat4 u_model;uniform mat4 u_viewshed_mat0;uniform mat4 u_view_modelmat0;uniform bool u_viewshed_used0;uniform float u_is_max_length;uniform Region u_regions[M_RADIATION_REGIONS_COUNT];attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec3 v_pos_region;varying highp float v_is_top;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec2 v_pos;",variable_fill_f:"#define GLSLIFY 1\n#include <variable_reject>\nuniform sampler2D u_image;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",variable_fill_v:"#define GLSLIFY 1\n#include <variable_reject>\n#include <variable_base>\n#include <back_of_earth>\n#include <get_pattern_pos>\nuniform mat4 u_modelMatrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform vec2 u_world;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",variable_fxaa_f:"#define GLSLIFY 1\nuniform highp vec2 u_resolution;uniform sampler2D u_image;varying vec2 v_coord;",variable_fxaa_v:"#define GLSLIFY 1\nuniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;uniform highp vec2 u_resolution;varying vec2 v_coord;",variable_heatmap_f:"#define GLSLIFY 1\n#include <variable_define>\nuniform highp float u_intensity;uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_extrude;varying vec2 v_pos;",variable_heatmap_v:"#define GLSLIFY 1\n#include <variable_define>\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform vec2 u_world;varying vec2 v_extrude;varying vec2 v_pos;",variable_line_f:"#define GLSLIFY 1\n#include <variable_define>\n#include <write_log_depth>\nuniform mediump float u_hasBorder;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;",variable_line_v:"#define GLSLIFY 1\n#include <variable_define>\n#include <variable_base>\n#include <vertex_log_depth>\nattribute float a_normal;attribute vec4 a_data;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform lowp float u_half_render;uniform lowp float normaldirection;uniform mediump float u_hasBorder;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;",variable_pbr_f:"#define GLSLIFY 1\n#include <variable_define>\n#include <struct_highlight_color_info>\n#include <struct_light_material>\n#include <phong>\n#include <write_log_depth>\n#include <highlight>\n#ifdef M_HAS_CLIPPING\n#include <box_clip_discard_pixel>\n#include <plane_clip_discard_pixel>\n#include <range_clip_discard_pixel>\n#endif\nuniform highp float u_shadow_off;\n#ifdef M_HAS_SHADOW\n#include <get_shadow_color>\nuniform float gMapSizeInv;uniform sampler2D u_shadow_sampler;varying vec4 v_pos_from_light;varying vec3 v_NormalScene;varying vec3 v_PosScene;varying vec3 v_PosGeo;uniform vec4 u_ShadowCenter;uniform bool u_LayerEnableSM;uniform bool u_EnableShadowCenter;uniform vec3 u_SceneLightDir3;\n#endif\n#ifdef M_HAS_VIEWSHED\n#include <get_viewshed_color>\nvarying vec4 v_viewshed_pos[M_VIEWSHED_COUNT];varying vec4 v_view_spacepos[M_VIEWSHED_COUNT];uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform vec3 u_viewshedVisibleColor;uniform vec3 u_viewshedInVisibleColor;uniform bool u_OpenViewshed;\n#endif\n#include <variable_video>\nuniform mat4 u_reverse_rot_mat;uniform bool u_useKhr;uniform bool u_b_flow_text;uniform bool u_b_flow_text_s;uniform float u_flow_text_off;uniform bool u_HAS_NORMALS;uniform bool u_HAS_TANGENTS;uniform vec3 u_LightDirection;uniform vec3 u_LightColor;uniform vec3 u_cam;\n#ifdef M_HAS_CLIPPING\nvarying vec3 v_clamp_pos;\n#ifdef M_IS_CLIPPING_RANGE\nuniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;varying vec3 v_clamp_range;\n#endif\n#ifdef M_IS_CLIPPING_PLANE\nuniform highp vec4 u_clamp_plane;\n#endif\n#ifdef M_IS_CLIPPING_BOX\nuniform highp vec3 u_clamp_box;uniform bool u_clamp_box_inner;uniform mat4 u_clamp_matrix;\n#endif\n#endif\nuniform bool u_hightlight;uniform HighLightColorInfo u_specialcolor[10];uniform int u_specialindex;varying vec3 v_Position;varying vec2 v_UV;varying vec4 v_TEXTURE_TRANSFORM_1;varying mat3 v_TBN;varying vec3 v_Normal;varying vec3 v_NormalOrigin;varying vec4 v_COLOR_0;uniform vec2 u_satExp;uniform vec4 u_diffSpec;uniform float u_reflect;uniform vec4 u_pbrPer;uniform LightMaterial u_lightMaterial;uniform bool u_useTextureMatrix;",variable_pbr_v:"#define GLSLIFY 1\n#include <variable_define>\nattribute vec4 a_POSITION;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;attribute vec2 a_TEXCOORD_0;attribute vec4 a_COLOR_0;attribute vec4 a_TEXTURE_TRANSFORM_1;attribute float a_BATCHID;\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;\n#endif\nuniform mat4 u_matrix;uniform highp mat4 u_model_matrix;uniform mat4 u_normal;uniform bool u_HAS_NORMALS;uniform bool u_HAS_TANGENTS;uniform bool u_useKhr;uniform vec4 u_khrValues;varying vec3 v_Position;varying vec4 v_PosOrigin;varying vec4 v_TEXTURE_TRANSFORM_1;varying vec2 v_UV;varying mat3 v_TBN;varying vec3 v_Normal;varying vec3 v_NormalOrigin;varying vec4 v_COLOR_0;\n#ifdef M_HAS_CLIPPING\nvarying vec3 v_clamp_pos;uniform mat4 u_clamp_model_matrix;\n#ifdef M_IS_CLIPPING_RANGE\nuniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying vec3 v_clamp_range;\n#endif\n#endif\n#include <struct_joint_matrix>\n#include <vertex_log_depth>\nuniform bool u_has_skinning;\n#ifdef M_JOINT_MATRIX_CNT\nuniform JointMatrix u_jointMatrix[M_JOINT_MATRIX_CNT];\n#else\nuniform JointMatrix u_jointMatrix[19];\n#endif\n#ifdef M_USE_MORPHTARGETS\nattribute vec4 a_POSITION_1;attribute vec4 a_POSITION_2;uniform vec2 u_morphTargetInfluences;attribute vec4 a_NORMAL_1;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_1;attribute vec4 a_TANGENT_2;\n#endif\n#ifdef M_HAS_SHADOW\nuniform mat4 u_sun_matrix;varying vec4 v_pos_from_light;uniform mat4 u_sceneMatrix;varying vec3 v_NormalScene;varying vec3 v_PosScene;uniform mat4 u_Geo_matrix;varying vec3 v_PosGeo;\n#endif\n#ifdef M_HAS_VIEWSHED\nuniform mat4 u_viewshed_mat0;varying vec4 v_viewshed_pos[M_VIEWSHED_COUNT];varying vec4 v_view_spacepos[M_VIEWSHED_COUNT];\n#endif\n#include <get_clamp_range>\n#include <get_khr>\n",variable_phong_f:"#include <decode_float>\nprecision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;\n#include <get_shadow_color>\nuniform float gMapSizeInv;uniform float u_shadow_off;uniform sampler2D u_shadow_sampler;varying vec4 v_pos_from_light;varying vec4 v_PosOrigin;varying vec3 v_NormalOrigin;varying vec2 v_UV;varying vec3 v_NormalScene;varying vec3 v_PosScene;uniform vec3 u_SceneLightDir3;",variable_phong_v:"precision highp float;\n#define GLSLIFY 1\nattribute vec4 a_POSITION;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;attribute vec2 a_TEXCOORD_0;uniform mat4 u_matrix;varying vec4 v_PosOrigin;varying vec3 v_NormalOrigin;varying vec2 v_UV;uniform mat4 u_sun_matrix;varying vec4 v_pos_from_light;uniform mat4 u_sceneMatrix;varying vec3 v_NormalScene;varying vec3 v_PosScene;",variable_raster_f:"#define GLSLIFY 1\n#include <variable_define>\n#include <encode_float>\n#include <decode_float>\n#include <blinn_phong_color>\n#include <write_log_depth>\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;uniform float u_brightness_low;uniform float u_brightness_high;uniform bool u_isPole;uniform bool u_isNorth;uniform bool u_draw_to_shadow_fb;uniform vec2 u_resolution;uniform highp float u_shadow_off;uniform highp float u_fog_distance;uniform highp float u_fog_length;uniform bool u_fog_render;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_tile_zoom;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform int u_is_image;uniform bool u_with_light;uniform vec3 u_LightColor;uniform vec3 u_LightDirection;uniform vec3 u_cam;varying vec2 v_pos0;varying vec2 v_pos1;varying highp float v_fog_len;varying highp vec4 v_pos_from_light;varying vec3 v_world_pos;varying vec3 v_normal;varying vec4 v_Color;vec3 Ka=vec3(0.25);vec3 Kd=vec3(0.4);vec3 Ks=vec3(0.774597);vec3 Ke=vec3(0.1,0.1,0.1);float shininess=0.4;",variable_raster_v:"#define GLSLIFY 1\n#include <variable_base>\n#include <variable_define>\n#include <vertex_log_depth>\nuniform highp mat4 u_model_matrix;uniform mat4 u_sun_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform bool u_fog_render;uniform bool u_draw_to_shadow_fb;uniform vec3 u_cam_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;varying float v_fog_len;varying highp vec4 v_pos_from_light;varying vec3 v_normal;varying vec3 v_world_pos;varying vec4 v_Color;uniform mat4 u_sunlight_matrix;uniform bool u_is_dem;varying highp vec4 v_PosOrigin;",variable_reject:"#define GLSLIFY 1\nuniform vec3 u_camPos;uniform float u_tangentAngle;varying float v_front_of_earth;",variable_symbol_f:"#define GLSLIFY 1\n#include <variable_reject>\n#include <variable_define>\nuniform sampler2D u_texture;uniform bool u_is_halo;uniform bool u_is_text;varying vec2 v_tex;varying float v_fade_opacity;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;",variable_symbol_v:"#define GLSLIFY 1\n#include <variable_reject>\n#include <variable_define>\n#include <variable_base>\n#include <back_of_earth>\n#include <atan2>\nattribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute vec3 a_extra;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform vec2 u_gl_units_to_pixels;uniform highp float u_bearing;uniform bool u_along_line;uniform mat4 u_modelMatrix;uniform mat4 u_symbol_mvp_matrix;uniform mat2 u_pitch_matrix;uniform mat2 u_pitch_rot_matrix;uniform mat4 u_pitch_rot_matrix_1;uniform bool u_pitch_with_map;uniform bool u_rotate_with_map;uniform bool u_rotate_symbol;uniform mat2 u_rot_matrix;uniform bool u_is_text;uniform highp float u_pitch;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform float u_display_mode;uniform vec2 u_timestamp_se;uniform highp float u_seq;varying vec2 v_data0;varying vec3 v_data1;varying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;",variable_video:"#define GLSLIFY 1\n#include <pixel_in_video>\nvarying highp vec4 v_PosOrigin;uniform sampler2D u_maskSample;uniform mat4 u_clip_Mattrix;uniform vec2 u_texture_Size;uniform highp mat4 u_model_matrix;uniform bool u_clip_video;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_active_clip_videoTexture[M_NUM_VIDEOS];uniform vec3 u_clipColors[M_NUM_VIDEOS];\n#endif\n",pragma_base_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n",pragma_base_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n",pragma_border_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\n",pragma_border_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\n",pragma_circle_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float radius\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n",pragma_circle_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\n",pragma_extrusion_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n",pragma_extrusion_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n",pragma_heatmap_define:"#define GLSLIFY 1\n#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\n",pragma_heatmap_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\n",pragma_line_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\n#pragma minemap: define lowp float normal_direction\n#pragma minemap: define lowp float speed_factor\n",pragma_line_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\n#pragma minemap: initialize lowp float normal_direction\n#pragma minemap: initialize lowp float speed_factor\n",pragma_symbol_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n",pragma_symbol_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\n",pragma_water_define:"#define GLSLIFY 1\n#pragma minemap: define lowp float watercalm\n#pragma minemap: define lowp float waterspeed\n",pragma_water_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize lowp float watercalm\n#pragma minemap: initialize lowp float waterspeed\n",skin_matrix:"#define GLSLIFY 1\nmat4 calcSkinMatrix(const mat4 u_jointMatrix[10],vec4 a_weight,vec4 a_joint){mat4 skinMatrix=a_weight.x*u_jointMatrix[int(a_joint.x)]+a_weight.y*u_jointMatrix[int(a_joint.y)]+a_weight.z*u_jointMatrix[int(a_joint.z)]+a_weight.w*u_jointMatrix[int(a_joint.w)];return skinMatrix;}",back_of_earth:"#define GLSLIFY 1\nbool isBackOfEarth(vec3 spacePos,vec3 camPos,float tangentAngle){float val=dot(normalize(spacePos),normalize(camPos));float angle=acos(val);return angle>tangentAngle;}",get_amount_in_other_cam:"#define GLSLIFY 1\nfloat getAmountInOtherCam(sampler2D sampler,vec3 shadowCoord,float shadow_off){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-shadow_off>depth){amountInLight=1.0;}return amountInLight;}",get_shadow_color:"#define GLSLIFY 1\n#include <decode_float>\nfloat getShadowColor(vec4 pos_from_light,sampler2D shadow_sampler,float EPSILON,float MapSizeInv){const float minUV=0.01;const float maxUV=0.99;vec3 ProjCoords=pos_from_light.xyz/pos_from_light.w;vec2 UVCoords=0.5*ProjCoords.xy+0.5;float z=0.5*ProjCoords.z+0.005;if(UVCoords.x<minUV||UVCoords.y<minUV||UVCoords.x>maxUV||UVCoords.y>maxUV||z<minUV||z>maxUV){return 1.0;}float Factor=0.0;float xOffset=MapSizeInv;float yOffset=MapSizeInv;float indexIJ[10];indexIJ[0]=-1.0;indexIJ[1]=0.0;indexIJ[2]=0.0;indexIJ[3]=0.0;indexIJ[4]=1.0;indexIJ[5]=0.0;indexIJ[6]=0.0;indexIJ[7]=-1.0;indexIJ[8]=0.0;indexIJ[9]=1.0;for(int i=0;i<5;i++){vec2 Offsets=vec2(indexIJ[2*i]*xOffset,indexIJ[2*i+1]*yOffset);vec2 UVC=vec2(UVCoords+Offsets);vec4 rgbaDepth=texture2D(shadow_sampler,UVC);float Depth=decodeFloat(rgbaDepth);if(Depth+EPSILON>z){Factor+=1.0;}}Factor=Factor*0.2;return Factor;}",get_viewshed_color:"#define GLSLIFY 1\n#include <decode_float>\n#include <get_amount_in_other_cam>\nvec4 getViewshedColor(vec4 baseColor,sampler2D viewshed_samp0,float shadow_off,vec3 viewshed_eye0,float viewshed_dist0,vec4 viewshed_pos,vec4 view_spacepos,vec3 visibleColor,vec3 inVisibleColor){vec3 viewshed_color=baseColor.xyz;if(distance(view_spacepos.xyz,viewshed_eye0)<=viewshed_dist0){vec3 shadowCoord=(viewshed_pos.xyz/viewshed_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInOtherCam(viewshed_samp0,shadowCoord,shadow_off);if(ail==0.0){viewshed_color=visibleColor;}else{viewshed_color=inVisibleColor;}}}return vec4(mix(baseColor.xyz,viewshed_color,0.5),baseColor.a);}",pixel_in_polygon:"#define GLSLIFY 1\nbool pixelInPolygon(mat4 clipMatrix,mat4 clipModelMatrix,vec4 originClipPos,sampler2D clipMaskSampler,vec2 textureSize,bool activeClipVideoStatus){bool result=false;if(!activeClipVideoStatus){return true;}vec2 offsetXY=vec2(1.0/textureSize.x,1.0/textureSize.y);vec4 c_Postion=clipMatrix*clipModelMatrix*originClipPos;c_Postion=c_Postion/c_Postion.w;vec2 c_UV=c_Postion.xy*0.5+0.5;if(c_UV.x>=0.0&&c_UV.x<=1.0&&c_UV.y>=0.0&&c_UV.y<=1.0){vec4 c_Color=texture2D(clipMaskSampler,c_UV);vec4 c_Color1=texture2D(clipMaskSampler,c_UV+vec2(-offsetXY.y,0.0));vec4 c_Color2=texture2D(clipMaskSampler,c_UV+vec2(offsetXY.y,0.0));vec4 c_Color3=texture2D(clipMaskSampler,c_UV+vec2(0.0,-offsetXY.y));vec4 c_Color4=texture2D(clipMaskSampler,c_UV+vec2(0.0,offsetXY.y));vec4 avgColor=(c_Color+c_Color1+c_Color2+c_Color3+c_Color4)/5.0;if((avgColor.x+avgColor.y+avgColor.z)>=0.60){result=true;}}return result;}",pixel_in_video:"#define GLSLIFY 1\nbool pixelInVideo(mat4 videoMatrix,mat4 modelMatrix,vec4 posOrigin,sampler2D videoSampler,float videoAlpha,mat4 clipMatrix,sampler2D maskSample,vec2 textureSize,bool activeClipVideoTexture,vec3 polygonColor){vec4 VideoProjectPostion=videoMatrix*modelMatrix*posOrigin;vec4 clipProjectPostion=clipMatrix*modelMatrix*posOrigin;VideoProjectPostion=VideoProjectPostion/VideoProjectPostion.w;clipProjectPostion=clipProjectPostion/clipProjectPostion.w;vec2 UV=VideoProjectPostion.xy*0.5+0.5;vec2 clipUV=clipProjectPostion.xy*0.5+0.5;UV.y=1.0-UV.y;bool isGap=false;if(UV.x>=0.0&&UV.x<=1.0&&UV.y>=0.0&&UV.y<=1.0){if(activeClipVideoTexture){vec2 offsetXY=vec2(1.5/textureSize.x,1.5/textureSize.y);vec4 c_Color=texture2D(maskSample,clipUV);vec4 c_Color1=texture2D(maskSample,clipUV+vec2(-offsetXY.x,0.0));vec4 c_Color2=texture2D(maskSample,clipUV+vec2(offsetXY.x,0.0));vec4 c_Color3=texture2D(maskSample,clipUV+vec2(0.0,-offsetXY.y));vec4 c_Color4=texture2D(maskSample,clipUV+vec2(0.0,offsetXY.y));vec4 avgZ=(c_Color+c_Color1+c_Color2+c_Color3+c_Color4)/5.0;bool isInPolygon=false;if(sign(polygonColor.z)==0.0){isInPolygon=true;}else if(abs(c_Color.z-polygonColor.z)<0.0001){isInPolygon=true;}else{if(sign(c_Color.z)==0.0){isInPolygon=false;}else if(abs(c_Color1.z-polygonColor.z)<0.0001||abs(c_Color2.z-polygonColor.z)<0.0001||abs(c_Color3.z-polygonColor.z)<0.0001||abs(c_Color4.z-polygonColor.z)<0.0001){isInPolygon=true;}}if(isInPolygon){vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}else{return false;}}else{vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}}return false;}",box_clip_discard_pixel:"#define GLSLIFY 1\nvoid boxClipDiscardPixel(vec3 pos,mat4 clamp_matrix,vec3 clamp_box,bool clamp_box_inner){vec4 invertBoxPos=clamp_matrix*vec4(pos,1);if(clamp_box_inner){if((invertBoxPos.x<clamp_box.x/2.0&&invertBoxPos.x>-clamp_box.x/2.0)&&(invertBoxPos.y<clamp_box.y/2.0&&invertBoxPos.y>-clamp_box.y/2.0)&&(invertBoxPos.z<clamp_box.z/2.0&&invertBoxPos.z>-clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-clamp_box.x/2.0||invertBoxPos.x>clamp_box.x/2.0||invertBoxPos.y<-clamp_box.y/2.0||invertBoxPos.y>clamp_box.y/2.0||invertBoxPos.z<-clamp_box.z/2.0||invertBoxPos.z>clamp_box.z/2.0){discard;}}}",get_clamp_range:"#define GLSLIFY 1\nvec3 getClampRange(vec4 pos,vec3 min_clamp_bounds,vec3 max_clamp_bounds){return vec3((pos.x-min_clamp_bounds.x)/(max_clamp_bounds.x-min_clamp_bounds.x),(pos.y-min_clamp_bounds.y)/(max_clamp_bounds.y-min_clamp_bounds.y),(pos.z-min_clamp_bounds.z)/(max_clamp_bounds.z-min_clamp_bounds.z));}",plane_clip_discard_pixel:"#define GLSLIFY 1\nvoid planeClipDiscardPixel(vec3 pos,vec4 plane){if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){discard;}}",range_clip_discard_pixel:"#define GLSLIFY 1\nvoid rangeClipDiscardPixel(vec3 clamp_range,vec2 x_clamp_range,vec2 y_clamp_range,vec2 z_clamp_range){if(clamp_range.x<x_clamp_range.x||clamp_range.x>x_clamp_range.y||clamp_range.y<y_clamp_range.x||clamp_range.y>y_clamp_range.y||clamp_range.z<z_clamp_range.x||clamp_range.z>z_clamp_range.y){discard;}}",fog:"#define GLSLIFY 1\nvec4 fogFun(float v_fog_len,float fog_distance,float fog_length,float atm_c_percent){float rate=clamp((v_fog_len-fog_distance)/fog_length,0.0,1.0);return mix(calColor,vec4(1.,1.,1.,1.0),rate*atm_c_percent);}",fxaa:"#define GLSLIFY 1\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX 8.0\n#endif\nvec4 fxaa(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),FXAA_REDUCE_MIN);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),max(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}",texcoords:"#define GLSLIFY 1\nvoid texcoords(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}",highlight:"#define GLSLIFY 1\nvec4 getHighLightColor(bool highlight,int specialindex,HighLightColorInfo specialcolor[10],vec4 baseColor){if(highlight){for(int i=0;i<10;i++){if(i==specialindex){return mix(baseColor,specialcolor[i].color,0.4);}}}return baseColor;}",interp_color:"#define GLSLIFY 1\nvec3 get_interp_color(const vec3 in_color,const vec3 out_color,const float percent){return mix(in_color,out_color,percent)/255.0;}",blinn_phong_color:"#define GLSLIFY 1\nvec4 getBlinnPhongColor(vec3 normal,vec3 world_pos,vec3 lightPos,vec3 lightColor,vec3 camPos,vec3 Ka,vec3 Kd,vec3 Ks,vec4 texColor,float shininess){vec3 N=normalize(normal);vec3 L=normalize(lightPos*40.-world_pos);vec3 V=normalize(camPos-world_pos);vec3 H=normalize(L+V);vec3 ambient=Ka*lightColor;float dv=dot(N,L);float diffuseLight=max(dot(N,L),0.);vec3 diffuse=Kd*lightColor*diffuseLight;if(dv<0.){ambient*=(1.+dv*4.0);diffuse*=4.0;}float specularLight=pow(max(dot(H,N),0.),32.*shininess);if(diffuseLight<=0.)specularLight=0.;vec3 specular=Ks*lightColor*specularLight;vec4 color=vec4(1.0);color.xyz=texColor.xyz*(ambient+diffuse+specular);color.w=texColor.a;return color;}",phong:"#define GLSLIFY 1\nvec3 Phong(vec3 pos,vec3 tnormal,LightMaterial lightMaterial){vec3 ambient=lightMaterial.Ambient;vec3 norm=normalize(tnormal);vec3 lightDir=normalize(lightMaterial.Direction);float diff=max(dot(norm,lightDir),0.0);vec3 diffuse=lightMaterial.Diffuse*diff;vec3 viewDir=normalize(lightMaterial.CameraPosition-pos);vec3 reflectDir=reflect(-lightDir,norm);float spec=pow(max(dot(viewDir,reflectDir),0.0),lightMaterial.Shininess);vec3 specular=lightMaterial.SpecularColor*spec;vec3 fColor=ambient+diffuse+specular;return fColor;}",process_normal_light:"#define GLSLIFY 1\nvec3 L_AMBBIENT=vec3(0.19225);vec3 L_DIFFUSE=vec3(0.50754);vec3 L_SPECULAR=vec3(0.508273);float L_SHINESS=0.4;vec3 processNormalLight(vec3 ilight,vec4 t_color,vec3 cam_pos,vec3 frag_pos,vec3 inormal){vec3 ambient=L_AMBBIENT*t_color.rgb;vec3 normal=normalize(inormal);vec3 light=normalize(ilight);float nDotL=max(dot(light,normal),0.0);vec3 diffuse=L_DIFFUSE*t_color.rgb*nDotL;return(ambient+diffuse);}",reverse_log_depth:"#define GLSLIFY 1\nfloat reverseLogDepth(float logZ,vec2 currentFrustum){float near=currentFrustum.x;float far=currentFrustum.y;float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float log2Depth=logZ*log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;return far*(1.0-near/(depthFromNear+near))/(far-near);}",vertex_log_depth:"#define GLSLIFY 1\nvec4 updatePositionDepth(vec4 coords){coords.z=clamp(coords.z/coords.w,-1.0,1.0)*coords.w;return coords;}float vertexLogDepth(vec2 currentFrustum){gl_Position=updatePositionDepth(gl_Position);float depthFromNearPlusOne=(gl_Position.w-currentFrustum.x)+1.0;return depthFromNearPlusOne;}",write_log_depth:"#define GLSLIFY 1\nvoid writeLogDepth(float depth,vec2 currentFrustum){float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float oneOverLog2FarDepthFromNearPlusOne=1.0/log2FarDepthFromNearPlusOne;if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}\n#ifdef M_DEPTH_EXT\ngl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;\n#endif\n}",atan2:"#define GLSLIFY 1\nfloat atan2(float dx,float dy){float ax=abs(dx),ay=abs(dy);float a=min(ax,ay)/(max(ax,ay)+0.00000001);float s=a*a;float r=((-0.0464964749*s+0.15931422)*s-0.327622764)*s*a+a;if(ay>ax)r=1.57079637-r;if(dx<0.)r=3.14159274-r;if(dy<0.)r=-r;return r;}",decode_float:"#define GLSLIFY 1\nfloat decodeFloat(vec4 color){return dot(color,vec4(1.0,1./255.0,1./65025.0,1./16581375.0));}",encode_float:"#define GLSLIFY 1\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}",geographic_2_ecef:"#define GLSLIFY 1\n#include <atan2>\nvec2 transformGeographic2ECEF(vec3 n){float x=n.x,y=n.z,z=n.y;float retZ=sqrt(x*x+y*y+z*z);float ax=atan2(y,x);float ay=asin(z/retZ);ax=(ax+3.14)/6.28;ay=(1.57-ay)/3.14;return vec2(ax,ay);}",geographic_2_ecef_degree:"#define GLSLIFY 1\n#include <atan2>\nvec2 transformGeographic2ECEFDegree(vec3 n){float x=n.x,y=n.z,z=n.y;float retZ=sqrt(x*x+y*y+z*z);float ax=atan2(y,x);float ay=asin(z/retZ);return vec2(ax*360.0/3.14159,ay*360.0/3.14159);}",lnglat_2_3857_coord:"#define GLSLIFY 1\nfloat PI=3.141596;vec2 lnglatTo3857Coord(vec2 n,vec3 coordZXY){float worldSize=pow(2.0,coordZXY[0]);float x=(180.0+n.x)*worldSize/360.0;float y=180.0/PI*log(tan(PI/4.0+n.y*PI/360.0));y=(180.-y)*worldSize/360.0;return vec2(x-coordZXY[1],y-coordZXY[2]);}",lnglat_2_4326_coord:"#define GLSLIFY 1\nvec2 lnglatTo4326Coord(vec2 n,vec3 coordZXY){float worldSize=pow(2.0,coordZXY[0]);float x=(180.0+n.x)*worldSize/360.0;float y=(90.0-n.y)/180.0*worldSize*0.5;return vec2(x-coordZXY[1],y-coordZXY[2]);}",create_rot_matrix:"#define GLSLIFY 1\nmat4 createRotateMat4(float rad,vec3 axis){float x=axis[0],y=axis[1],z=axis[2];float len=sqrt(x*x+y*y+z*z);float s,c,t;float a00,a01,a02,a03;float a10,a11,a12,a13;float a20,a21,a22,a23;float b00,b01,b02;float b10,b11,b12;float b20,b21,b22;if(len<0.00000001){return mat4(0.);};len=1./len;x*=len;y*=len;z*=len;s=sin(rad);c=cos(rad);t=1.-c;a00=1.;a01=0.;a02=0.;a03=0.;a10=0.;a11=1.;a12=0.;a13=0.;a20=0.;a21=0.;a22=1.;a23=0.;b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;mat4 outd=mat4(0.);outd[0][0]=a00*b00+a10*b01+a20*b02;outd[0][1]=a01*b00+a11*b01+a21*b02;outd[0][2]=a02*b00+a12*b01+a22*b02;outd[0][3]=a03*b00+a13*b01+a23*b02;outd[1][0]=a00*b10+a10*b11+a20*b12;outd[1][1]=a01*b10+a11*b11+a21*b12;outd[1][2]=a02*b10+a12*b11+a22*b12;outd[1][3]=a03*b10+a13*b11+a23*b12;outd[2][0]=a00*b20+a10*b21+a20*b22;outd[2][1]=a01*b20+a11*b21+a21*b22;outd[2][2]=a02*b20+a12*b21+a22*b22;outd[2][3]=a03*b20+a13*b21+a23*b22;outd[3][0]=0.;outd[3][1]=0.;outd[3][2]=0.;outd[3][3]=1.;return outd;}",get_pattern_pos:"#define GLSLIFY 1\nvec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos){vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return(tile_units_to_pixels*pos+offset)/pattern_size;}",unpack_depth:"#define GLSLIFY 1\nfloat czm_unpackDepth(vec4 packedDepth){return dot(packedDepth,vec4(1.0,1.0/255.0,1.0/65025.0,1.0/16581375.0));}",decode_color:"#define GLSLIFY 1\nvec4 decode_color(const vec2 encodedColor){return vec4(i_unpack_float(encodedColor[0])/255.0,i_unpack_float(encodedColor[1])/255.0);}",unpack_float:"#define GLSLIFY 1\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}",unpack_mix_vec2:"#define GLSLIFY 1\nfloat unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}",unpack_mix_vec4:"#define GLSLIFY 1\nvec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=i_decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=i_decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}",unpack_opacity:"#define GLSLIFY 1\nvec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}",geometric_occulusion:"#define GLSLIFY 1\nfloat geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}",get_ibl_contrib:"#define GLSLIFY 1\n#include <geographic_2_ecef>\nvec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection,vec2 modelUV,sampler2D brdfLUT,samplerCube diffuseEnvSampler,samplerCube specularEnvSampler){float mipCount=9.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=texture2D(brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 specularLight=textureCubeLodEXT(specularEnvSampler,reflection,lod).rgb;vec3 diffuseLight=textureCube(diffuseEnvSampler,n).rgb;vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}",get_ibl_test:"#define GLSLIFY 1\n#include <geographic_2_ecef>\nvec3 getIBLTest(vec3 reflection,float lod,samplerCube specularEnvSampler){vec3 specularLight=textureCubeLodEXT(specularEnvSampler,reflection,lod).rgb;return specularLight;}",get_khr:"#define GLSLIFY 1\nvec2 getKHRCoord(vec2 a_coord,bool useKhr,vec4 khrValues){vec2 coord=vec2(0.);if(useKhr){mat3 translation=mat3(1,0,0,0,1,0,khrValues.x,khrValues.y,1);mat3 scaleKHR=mat3(khrValues.z,0,0,0,khrValues.w,0,0,0,1);mat3 matrix=translation*scaleKHR;coord=(matrix*vec3(a_coord,1)).xy;}else{coord=a_coord;}return coord;}",get_normal:"#define GLSLIFY 1\nvec3 getNormal(bool hasTangent,bool hasNormal,bool hasNormalMap,vec2 UV,vec3 pos,vec3 normal,mat3 TBN,float normalScale,sampler2D normalSampler){mat3 tbn=mat3(0.0);if(!hasTangent){vec3 pos_dx=dFdx(pos);vec3 pos_dy=dFdy(pos);vec3 tex_dx=dFdx(vec3(UV,0.0));vec3 tex_dy=dFdy(vec3(UV,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=vec3(0.0);if(hasNormal){ng=normalize(normal);}else{ng=cross(pos_dx,pos_dy);}t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));tbn=mat3(t,b,ng);}else{tbn=TBN;}vec3 n=vec3(0.0);if(hasNormalMap){n=texture2D(normalSampler,UV).rgb;n=normalize(tbn*((2.0*n-1.0)));}else{n=normalize(tbn[2].xyz);}return n;}",get_pbr_color:"#define GLSLIFY 1\nuniform samplerCube u_DiffuseEnvSampler;uniform samplerCube u_SpecularEnvSampler;uniform sampler2D u_brdfLUT;uniform bool u_HAS_BASECOLORMAP;uniform sampler2D u_BaseColorSampler;uniform vec4 u_BaseColorFactor;uniform bool u_HAS_NORMALMAP;uniform sampler2D u_NormalSampler;uniform float u_NormalScale;uniform bool u_HAS_EMISSIVEMAP;uniform sampler2D u_EmissiveSampler;uniform vec3 u_EmissiveFactor;uniform bool u_HAS_METALROUGHNESSMAP;uniform sampler2D u_MetallicRoughnessSampler;uniform vec2 u_MetallicRoughnessValues;uniform bool u_HAS_OCCLUSIONMAP;uniform sampler2D u_OcclusionSampler;uniform float u_OcclusionStrength;\n#include <struct_pbr_info>\n#include <srgb_2_linear>\n#if (defined M_USE_IBL) && (defined M_TEXTURE_LOD_SUPPORTED)\n#include <get_ibl_contrib>\n#endif\n#include <pbr_diffuse>\n#include <geometric_occulusion>\n#include <specular_reflection>\n#include <get_normal>\n#include <microfacet_distribution>\nvec4 getPBRColor(vec4 baseColor){float perceptualRoughness=u_MetallicRoughnessValues.y;float metallic=u_MetallicRoughnessValues.x;if(u_HAS_METALROUGHNESSMAP){vec4 mrSample=texture2D(u_MetallicRoughnessSampler,v_UV);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;}perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;vec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal(u_HAS_TANGENTS,u_HAS_NORMALS,u_HAS_NORMALMAP,v_UV,v_PosOrigin.xyz,v_NormalOrigin,v_TBN,u_NormalScale,u_NormalSampler);vec3 v=normalize(u_cam-v_PosOrigin.xyz);vec3 l=normalize(u_LightDirection);vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=F*G*D/(4.0*NdotL*NdotV);vec3 color=NdotL*u_LightColor*(u_pbrPer[1]*diffuseContrib+u_pbrPer[2]*specContrib);\n#if (defined M_USE_IBL) && (defined M_TEXTURE_LOD_SUPPORTED)\nvec3 iblColor=getIBLContribution(pbrInputs,n,reflection,v_UV,u_brdfLUT,u_DiffuseEnvSampler,u_SpecularEnvSampler);color+=u_pbrPer[0]*iblColor;\n#endif\nif(u_HAS_OCCLUSIONMAP){float ao=texture2D(u_OcclusionSampler,v_UV).r;color=mix(color,color*ao,u_OcclusionStrength);}if(u_HAS_EMISSIVEMAP){vec3 emissive=texture2D(u_EmissiveSampler,v_UV).rgb*u_EmissiveFactor;color+=emissive;}color=pow(color,vec3(1.0/2.2));const vec3 luminanceWeight=vec3(0.2125,0.7154,0.0721);float luminance=dot(color,luminanceWeight);vec3 grayColor=vec3(luminance,luminance,luminance);color=mix(grayColor,color,u_satExp[0]);color=u_satExp[1]*color;return vec4(color,baseColor.a);}",get_roughness_metallic:"#define GLSLIFY 1\nconst float c_MinRoughness=0.04;\n#ifdef M_HAS_METALROUGHNESSMAP\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue,sampler2D metallicRoughnessSampler){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;vec4 mrSample=texture2D(metallicRoughnessSampler,v_UV);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#else\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#endif\n",microfacet_distribution:"#define GLSLIFY 1\nfloat microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(PI*f*f);}",pbr_diffuse:"#define GLSLIFY 1\nvec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/PI;}",specular_reflection:"#define GLSLIFY 1\nvec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}",srgb_2_linear:"#define GLSLIFY 1\nvec4 SRGBtoLINEAR(vec4 srgbIn){vec3 linOut=pow(srgbIn.xyz,vec3(2.2));return vec4(linOut,srgbIn.w);return srgbIn;}",struct_clamp_info:"#define GLSLIFY 1\nstruct BoxClampInfo{vec3 pos;vec3 clamp_range;vec3 clamp_box;mat4 clamp_matrix;vec2 x_clamp_range;vec2 y_clamp_range;vec2 z_clamp_range;bool clamp_box_inner;};",struct_highlight_color_info:"#define GLSLIFY 1\nstruct HighLightColorInfo{vec4 color;};",struct_joint_matrix:"#define GLSLIFY 1\nstruct JointMatrix{mat4 m;};",struct_light_material:"#define GLSLIFY 1\nstruct LightMaterial{vec3 Ambient;vec3 Diffuse;float Shininess;vec3 SpecularColor;vec3 CameraPosition;vec3 Direction;};",struct_pbr_info:"#define GLSLIFY 1\nstruct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};",struct_Region:"#define GLSLIFY 1\nstruct Region{bool use;highp vec4 pos;highp vec3 north;highp vec3 cross;bool scan;highp float percent;};"};function $s(e){return en(e)}const Qs=/^[ \t]*#include +<([\w\d./]+)>/gm,Ks={prelude:{fragmentSource:$s("\n#ifdef M_TEXTURE_LOD_SUPPORTED\n#extension GL_EXT_shader_texture_lod:enable\n#endif\n#ifdef M_STANDARD_DERIVATIVES_SUPPORTED\n#extension GL_OES_standard_derivatives:enable\n#endif\n#ifdef M_DEPTH_EXT\n#extension GL_EXT_frag_depth:enable\n#endif\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n"),vertexSource:$s("#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n")},unpackAll:{fragmentSource:$s(ks),vertexSource:$s(ks)},sphereClipping:{fragmentSource:$s("#define GLSLIFY 1\nvoid main(){gl_FragColor=vec4(1.0);}"),vertexSource:$s("#define GLSLIFY 1\nattribute vec3 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereBackground:{fragmentSource:$s("#define GLSLIFY 1\n#include <write_log_depth>\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;uniform vec2 currentFrustum;\n#endif\nvoid main(){gl_FragColor=u_color*u_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_base>\n#include <vertex_log_depth>\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;uniform vec2 currentFrustum;\n#endif\nvoid main(){gl_Position=u_matrix*vec4(a_pos,1.);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereBackgroundPattern:{fragmentSource:$s("#define GLSLIFY 1\nuniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);gl_FragColor=color1*u_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_base>\nuniform float u_zoom;varying vec2 v_pos_a;varying vec2 v_pos_b;attribute vec2 a_texture_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1.0);v_pos_a=a_texture_pos*70.0*u_zoom;v_pos_b=a_texture_pos*70.0*u_zoom;}")},collisionBox:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_collision_f>\nvoid main(){float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){gl_FragColor*=.1;}}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_collision_v>\nvoid main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=a_extrude*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}")},collisionCircle:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_collision_f>\nuniform float u_overscale_factor;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){color=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_collision_v>\nvarying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}")},debug:{fragmentSource:$s("#define GLSLIFY 1\nuniform highp vec4 u_color;void main(){gl_FragColor=u_color;}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_base>\nvoid main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphere:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_define>\n#include <blinn_phong_color>\n#include <geographic_2_ecef>\n#include <write_log_depth>\n#ifdef M_SKYBOX_CUBE_MAP\nuniform samplerCube u_imageGlobal;uniform sampler2D u_imageCloud;uniform sampler2D u_imageNightLight;\n#else\nuniform sampler2D u_imageGlobal;uniform sampler2D u_imageCloud;uniform sampler2D u_imageNightLight;\n#endif\nuniform float time;uniform bool u_withCloud;uniform bool u_with_light;uniform vec3 u_LightColor;uniform vec3 u_LightDirection;uniform vec3 u_cam;uniform bool u_with_nighttexture;uniform highp float u_daytex_percent;uniform bool u_with_daytex;varying vec2 v_pos;varying vec3 v_normal;varying vec3 v_world_pos;vec3 Ka=vec3(0.25);vec3 Kd=vec3(0.4);vec3 Ks=vec3(0.774597);vec3 Ke=vec3(0.1,0.1,0.1);float shininess=0.4;uniform vec4 u_GlobalInnerColor;uniform vec4 u_LightPer;uniform float u_NightGlobalPer;void main(){vec4 globalColor=vec4(1.0);\n#ifdef M_SKYBOX_CUBE_MAP\nglobalColor=textureCube(u_imageGlobal,v_normal);\n#else\nglobalColor=texture2D(u_imageGlobal,v_pos);\n#endif\nglobalColor.xyz=u_LightPer.w*pow(globalColor.xyz,vec3(2.2));vec4 cloudColor=vec4(0.0,0.0,0.0,0.0);if(u_withCloud)cloudColor=texture2D(u_imageCloud,vec2(v_pos.x+time*u_LightPer.y*(1.0-u_daytex_percent),v_pos.y));cloudColor.xyz=u_LightPer.x*pow(cloudColor.xyz,vec3(2.2));vec4 nightLightColor=vec4(0.0,0.0,0.0,0.0);if(u_with_nighttexture)nightLightColor=u_LightPer.z*texture2D(u_imageNightLight,v_pos);vec3 N=normalize(v_normal);vec3 LightDir=normalize(u_LightDirection);vec3 V=normalize(u_cam-v_world_pos);vec3 H=normalize(LightDir+V);float specularPer=pow(max(dot(H,N),0.0),32.0);vec3 specularLight=specularPer*0.0*vec3(1.0,1.0,1.0);float rimPower=u_GlobalInnerColor.w;float ndv=dot(N,V);vec3 innerRing=(u_GlobalInnerColor.xyz*pow(1.0-ndv,rimPower));float NL=dot(LightDir,N);vec3 FinalColor=globalColor.xyz;if(u_with_nighttexture){const float threshold=0.2;if(NL>threshold){FinalColor=globalColor.xyz*NL+u_NightGlobalPer*globalColor.xyz+specularLight+innerRing+cloudColor.xyz;}else if(NL>-threshold){float y=0.5*NL/threshold+0.5;float z=(1.0-y);FinalColor=y*NL*globalColor.xyz+z*nightLightColor.xyz+u_NightGlobalPer*globalColor.xyz+innerRing+y*cloudColor.xyz;}else{FinalColor=nightLightColor.xyz+u_NightGlobalPer*globalColor.xyz+innerRing;}}else{FinalColor=globalColor.xyz+innerRing+cloudColor.xyz;}FinalColor=mix(FinalColor,globalColor.xyz,u_daytex_percent);gl_FragColor=vec4(pow(FinalColor,vec3(1.0/2.2)),1.0);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_define>\n#include <variable_base>\n#include <vertex_log_depth>\nuniform vec3 u_cam_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;varying vec3 v_normal;varying highp float v_fog_len;varying vec3 v_fragPos;varying vec3 v_world_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;v_normal=a_pos;v_world_pos=a_pos;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereSkybox:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_define>\n#include <blinn_phong_color>\n#include <geographic_2_ecef>\n#include <write_log_depth>\n#ifdef M_SKYBOX_CUBE_MAP\nuniform samplerCube u_image0;uniform samplerCube u_image1;uniform samplerCube u_image2;\n#else\nuniform sampler2D u_image0;uniform sampler2D u_image1;uniform sampler2D u_image2;\n#endif\nuniform bool u_with_light;uniform vec3 u_LightColor;uniform vec3 u_LightDirection;uniform vec3 u_cam;uniform bool u_with_nighttexture;uniform highp float u_daytex_percent;uniform bool u_with_daytex;uniform float time;varying vec2 v_pos;varying vec3 v_normal;varying vec3 v_world_pos;vec3 Ka=vec3(0.25);vec3 Kd=vec3(0.4);vec3 Ks=vec3(0.774597);vec3 Ke=vec3(0.1,0.1,0.1);float shininess=0.4;vec4 mixNightTex(vec4 calColor){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_LightColor*nDotL;vec4 nightColor=vec4(1.0);\n#ifdef M_SKYBOX_CUBE_MAP\nnightColor=textureCube(u_image2,v_normal);\n#else\nnightColor=texture2D(u_image2,v_pos);\n#endif\nif(diffuse.x>0.25){calColor=calColor;}else if(diffuse.x<0.02){calColor=nightColor;}else{float t=(diffuse.x-0.02)/0.23;calColor=t*calColor+(1.0-t)*nightColor;}return calColor;}void main(){vec4 calColor=vec4(1.0);\n#ifdef M_SKYBOX_CUBE_MAP\ncalColor=textureCube(u_image0,v_normal);\n#else\nvec2 texCoord=transformGeographic2ECEF(v_normal);calColor=texture2D(u_image0,vec2(texCoord.x,texCoord.y));\n#endif\nvec4 dayColor=vec4(1.0);if(u_with_daytex){\n#ifdef M_SKYBOX_CUBE_MAP\ndayColor=textureCube(u_image1,v_normal);\n#else\ndayColor=texture2D(u_image1,transformGeographic2ECEF(v_normal));\n#endif\ncalColor=mix(calColor,dayColor,u_daytex_percent);}gl_FragColor=calColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_define>\n#include <variable_base>\n#include <vertex_log_depth>\nuniform vec3 u_cam_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;varying vec3 v_normal;varying highp float v_fog_len;varying vec3 v_fragPos;varying vec3 v_world_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;v_normal=a_pos;v_world_pos=a_pos;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereAtmosphere:{fragmentSource:$s("#define GLSLIFY 1\nuniform vec4 u_GlobalOuterColor;void main(){gl_FragColor=vec4(u_GlobalOuterColor.xyz,0.5);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereRaster:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_raster_f>\n#include <variable_video>\nvoid main(){float minVal=0.;float maxVal=1.;vec4 color0,color1;if(u_isPole){if(u_isNorth){color0=texture2D(u_image0,vec2(v_pos0.x,0.0));color1=texture2D(u_image1,vec2(v_pos1.x,0.0));}else{color0=texture2D(u_image0,vec2(v_pos0.x,1.0));color1=texture2D(u_image1,vec2(v_pos1.x,1.0));}}else{color0=texture2D(u_image0,v_pos0);color1=texture2D(u_image1,v_pos1);}if(color0.a>0.0){color0.rgb=color0.rgb/color0.a;}if(color1.a>0.0){color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec4 out_color=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);if(u_draw_to_shadow_fb){gl_FragColor=encodeFloat(gl_FragCoord.z);}else if(u_is_image==1){gl_FragColor=vec4(out_color.xyz,out_color.w*u_opacity);}else{float drawnInShadow=0.;vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;if(u_with_shadow){vec4 rgbaDepth=texture2D(u_shadow_sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){drawnInShadow+=1.0;}}if(u_with_light&&!u_isPole){gl_FragColor=getBlinnPhongColor(v_normal,v_world_pos,u_LightDirection,u_LightColor,u_cam,Ka,Kd,Ks,out_color,shininess);}if(u_with_light&&!u_isPole){;}else{if(u_fog_render){float rate=clamp((v_fog_len-u_fog_distance)/u_fog_length,0.0,1.0);out_color=mix(out_color,vec4(1.,1.,1.,1.0),rate);}gl_FragColor=vec4(out_color.xyz*(1.-0.5*drawnInShadow),out_color.w*u_opacity);}}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_clip_video){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_model_matrix,v_PosOrigin,u_VideoSampler[i],u_Alpha[i],u_clip_Mattrix,u_maskSample,u_texture_Size,u_active_clip_videoTexture[i],u_clipColors[i])){return;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_model_matrix,v_PosOrigin,u_VideoSampler[i],u_Alpha[i],u_clip_Mattrix,u_maskSample,u_texture_Size,false,u_clipColors[i])){return;}}}}\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_raster_v>\nvoid main(){gl_Position=u_matrix*vec4(a_pos,1);v_PosOrigin=vec4(a_pos,1);vec4 geographic=u_model_matrix*vec4(a_pos,1.);v_world_pos=geographic.xyz;if(u_fog_render){v_fog_len=distance(u_cam_pos,geographic.xyz);}if(u_draw_to_shadow_fb){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;if(u_is_dem){v_pos0=(((a_texture_pos/32767.0)-0.5)/u_buffer_scale)+0.5;}else{v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale)+0.5;}v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_model_matrix*vec4(a_pos,1.);v_normal=sunlight_position.xyz;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereTexture:{fragmentSource:$s("#define GLSLIFY 1\nuniform sampler2D u_image;varying vec2 v_pos;void main(){gl_FragColor=texture2D(u_image,v_pos);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform float u_deta_zoom;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos/8192.0*(1.0+u_deta_zoom)/2.0;}")},sphereSymbolIcon:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_symbol_f>\n#include <pragma_base_define>\nvoid main(){\n#include <pragma_base_initialize>\nif(v_front_of_earth<0.){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_symbol_v>\n#include <pragma_base_define>\nvoid main(){\n#include <pragma_base_initialize>\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ? camera_to_anchor_distance/u_camera_to_center_distance : u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=1.0;float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_matrix*u_rot_matrix*a_projected_pos.xy;vec4 added=vec4(u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+u_pitch_matrix*u_rot_matrix*vec2(a_projected_pos.x,a_projected_pos.y)/u_gl_units_to_pixels+vec2(moveDist.y*sin(lineRotAngle),0.)/u_gl_units_to_pixels,0.0,1.0);gl_Position.xyz+=added.xyz/added.w;}else{gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},sphereSymbolSDF:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_symbol_f>\n#include <pragma_symbol_define>\nvoid main(){\n#include <pragma_symbol_initialize>\nif(v_front_of_earth<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/fontScale;lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/fontScale;buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_symbol_v>\n#include <pragma_symbol_define>\nvoid main(){\n#include <pragma_symbol_initialize>\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ? camera_to_anchor_distance/u_camera_to_center_distance : u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(!u_rotate_with_map&&!u_pitch_with_map){angle_sin=0.;angle_cos=1.;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else if(!u_rotate_with_map&&u_pitch_with_map){angle_sin=0.;angle_cos=1.;}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(!u_rotate_with_map&&!u_pitch_with_map){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){vec2 moveDist=u_pitch_rot_matrix*a_projected_pos.xy;vec2 added=u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale+u_pitch_rot_matrix*a_projected_pos.xy+vec2(moveDist.y*sin(lineRotAngle));added-=fract(added);gl_Position.xy+=added/u_gl_units_to_pixels;}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position.xy+=vec4(u_pitch_rot_matrix_1*vec4(a_offset/32.0*fontScale/vec2(u_gl_units_to_pixels.x,-u_gl_units_to_pixels.x),0.,1.)).xy;}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position.xy+=u_pitch_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){float farScale=1.0;bool bScale=false;if(u_pitch>PI/3.0&&gl_Position.y>-0.5){bScale=true;farScale=cos((gl_Position.y+0.5)*3.0*(u_pitch-PI/3.0));}gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels*farScale*0.95+a_projected_pos.xy/u_gl_units_to_pixels*(bScale ? farScale : 1.0);}gl_Position.z=0.0;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);}")},sphereFill:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_define>\n#include <variable_fill_f>\n#include <write_log_depth>\nvoid main(){\n#include <pragma_base_initialize>\nif(v_front_of_earth<0.0){discard;}gl_FragColor=color*opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_v>\n#include <variable_define>\n#include <vertex_log_depth>\nvoid main(){\n#include <pragma_base_initialize>\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereFillPattern:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_f>\nvoid main(){\n#include <pragma_base_initialize>\nif(v_front_of_earth<0.0){discard;}vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_v>\nuniform float u_zoom_factor;void main(){\n#include <pragma_base_initialize>\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;}")},sphereFillOutline:{fragmentSource:$s(Hs),vertexSource:$s(Xs)},sphereFillOutlinePattern:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_f>\nvoid main(){\n#include <pragma_base_initialize>\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_mix)*alpha*opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_v>\nvoid main(){\n#include <pragma_base_initialize>\ngl_Position=u_matrix*vec4(a_pos,1.0);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},sphereFillWater:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_fill_f>\n#include <pragma_water_define>\nuniform float u_time;uniform float u_zoom;uniform vec3 u_camPos;varying vec3 u_light;varying vec3 w_pos;varying vec3 g_a_pos;varying vec3 surfaceX;varying vec3 surfaceY;varying vec3 surfaceZ;vec3 getNoise(in vec2 uv,sampler2D normalSampler,float time,float noiseScale){vec2 uv0=uv*6.0+vec2(time/8.0,time/10.2);vec2 uv1=uv*5.0-vec2(time/-8.5,time/13.0)+vec2(0.23);vec2 uv2=uv*vec2(1.0,1.0)+vec2(time/14.2,time/14.0)+vec2(0.51);vec2 uv3=uv*vec2(2.0,3.0)-vec2(time/7.5,time/-8.2)+vec2(0.71);vec4 noise=texture2D(normalSampler,uv0)+texture2D(normalSampler,uv1)+texture2D(normalSampler,uv2)+texture2D(normalSampler,uv3);return noise.xyz*0.5-1.0;}void sunLight(const vec3 surfaceNormal,const vec3 eyeDirection,in float shiny,in float spec,in float diffuse,inout vec3 diffuseColor,inout vec3 specularColor){vec3 reflection=normalize(reflect(normalize(w_pos-u_light),surfaceNormal));float direction=max(0.0,dot(eyeDirection,reflection));specularColor+=pow(direction,shiny)*spec;diffuseColor+=max(dot(u_light-w_pos,surfaceNormal),0.0)*diffuse;}void main(){\n#include <pragma_base_initialize>\n#include <pragma_water_initialize>\nvec3 worldToEye=u_camPos-w_pos;vec3 eyeDirection=normalize(worldToEye);vec3 Ray=u_camPos-g_a_pos;vec3 RayDirection=normalize(Ray);vec2 uv=v_pos;vec3 noise=getNoise(uv,u_image,u_time*0.5,2.0);vec3 distordCoord=noise.x*surfaceX+noise.y*surfaceY;vec3 distordNormal=distordCoord+surfaceZ;vec3 scatter=max(0.0,dot(distordNormal,RayDirection))*color.rgb;vec3 diffuseLight=vec3(0.0);vec3 specularLight=vec3(0.0);sunLight(distordNormal,eyeDirection,100.0,2.0,0.5,diffuseLight,specularLight);float theta=max(dot(RayDirection,distordNormal),0.0);float reflectance=0.3+(1.0-0.3)*pow((1.0-theta),3.0);vec3 albedo=mix(diffuseLight*0.2+scatter,(vec3(0.1)+color.rgb*0.9+specularLight),reflectance);gl_FragColor=vec4(albedo,1.0)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <pragma_water_define>\n#include <variable_fill_v>\n#include <geographic_2_ecef_degree>\n#include <lnglat_2_4326_coord>\n#include <lnglat_2_3857_coord>\nuniform vec3 u_coordZXY;uniform bool u_is4326;varying vec3 u_light;varying vec3 w_pos;varying vec3 g_a_pos;varying vec3 surfaceX;varying vec3 surfaceY;varying vec3 surfaceZ;vec2 getTexturePosByGeographic(vec3 inCoord){vec2 lngLat=transformGeographic2ECEFDegree(inCoord);vec2 coord=vec2(0.);if(u_is4326){coord=lnglatTo4326Coord(lngLat,u_coordZXY)/2.0;}else{coord=lnglatTo3857Coord(lngLat,u_coordZXY)/2.0;}return coord;}void main(){\n#include <pragma_base_initialize>\n#include <pragma_water_initialize>\nvec4 mirrorCoord=u_modelMatrix*vec4(a_pos,1.0);gl_Position=u_matrix*vec4(a_pos,1.0);w_pos=mirrorCoord.xyz;v_pos=getTexturePosByGeographic(mirrorCoord.xyz);surfaceX=vec3(u_modelMatrix[0][0],u_modelMatrix[0][1],u_modelMatrix[0][2]);surfaceY=vec3(u_modelMatrix[1][0],u_modelMatrix[1][1],u_modelMatrix[1][2]);surfaceZ=vec3(u_modelMatrix[2][0],u_modelMatrix[2][1],u_modelMatrix[2][2]);g_a_pos=a_pos;}")},sphereFillOutlineWater:{fragmentSource:$s(Hs),vertexSource:$s(Xs)},sphereLine:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_f>\nvoid main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color*opacity;\n#else\ngl_FragColor=u_hasBorder==1.0 ? bordercolor*(alpha*borderopacity): color*(alpha*opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_v>\nattribute vec2 a_extra_extrude;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=vec2(a_normal/2.0>=1.0 ? 1.0 : 0.0,mod(a_normal,2.0)==1.0 ? 1.0 :-1.0);v_normal=normal;float constant=width==0.0 ? 0.0 : ANTIALIASING;float inset=0.0;float outset=0.0;float halfwidth=0.0;if(u_hasBorder==1.0){gapwidth=width/2.0;halfwidth=borderwidth;inset=gapwidth+constant;outset=gapwidth+halfwidth+constant;}else{halfwidth=width/2.0;gapwidth=gapwidth/2.0;inset=gapwidth+(gapwidth>0.0 ? constant : 0.0);outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}offset=-1.0*offset;if(u_half_render==1.){if(normal_direction==1.){outset=2.0*(gapwidth+(normal.y>0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}else{outset=2.0*(gapwidth+(normal.y<0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;vec2 extra_extrude=a_extra_extrude.xy-128.0;mediump vec2 extra_dist=u_pixel_matrix*outset*extra_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);if(u_hasBorder==1.0){gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;}else{gl_Position.xy+=(dist+extra_dist)/u_gl_units_to_pixels*gl_Position.w;}float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereAirLine:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_line_f>\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform float u_discard;varying vec2 v_seq;void main(){\n#include <pragma_base_initialize>\nmediump float drive_opacity=1.0;float count_start=mod(u_start,v_seq[1]);float count_end=mod(u_end,v_seq[1]);if(u_discard!=0.0){if(v_seq[0]<count_start||v_seq[0]>count_end){discard;}drive_opacity=(v_seq[0]-count_start)/u_segments;}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*drive_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <variable_line_v>\nattribute vec2 a_normal_vec2;attribute vec2 a_seq;varying highp float v_linesofar;varying vec2 v_seq;void main(){\n#include <pragma_line_initialize>\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereLineSDF:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_f>\nuniform float u_sdfgamma;uniform float u_mix;varying vec2 v_tex_a;varying vec2 v_tex_b;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color*(alpha*opacity);\n#else\ngl_FragColor=u_hasBorder==1.0 ? bordercolor*(alpha*borderopacity): color*(alpha*opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_v>\nuniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;varying vec2 v_tex_a;varying vec2 v_tex_b;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_normal/2.0>=1.0 ? 1.0 : 0.0,mod(a_normal,2.0)==1.0 ? 1.0 :-1.0);v_normal=normal;if(u_hasBorder==1.0){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereLinePattern:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_f>\nuniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_fade;varying float v_linesofar;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/u_pattern_size_a.x,1.0);float x_b=mod(v_linesofar/u_pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_a.y+2.0)/2.0)/u_pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_b.y+2.0)/2.0)/u_pattern_size_b.y);vec2 pos_a=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,vec2(x_b,y_b));color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color*(alpha*opacity);\n#else\ngl_FragColor=u_hasBorder==1.0 ? bordercolor*(alpha*borderopacity): color*(alpha*opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_v>\nvarying float v_linesofar;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_normal/2.0>=1.0 ? 1.0 : 0.0,mod(a_normal,2.0)==1.0 ? 1.0 :-1.0);v_normal=normal;if(u_hasBorder==1.0){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereLineGradient:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_f>\nvarying highp vec2 v_uv;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);color=texture2D(u_image,v_uv);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color*(alpha*opacity);\n#else\ngl_FragColor=u_hasBorder==1.0 ? bordercolor*(alpha*borderopacity): color*(alpha*opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_v>\nattribute float a_uv_x;attribute float a_split_index;uniform float u_image_height;varying highp vec2 v_uv;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);mediump vec2 normal=vec2(a_normal/2.0>=1.0 ? 1.0 : 0.0,mod(a_normal,2.0)==1.0 ? 1.0 :-1.0);v_normal=normal;if(u_hasBorder==1.0){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereHeatmap:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <variable_heatmap_f>\nvarying float v_value;void main(){\n#include <pragma_heatmap_initialize>\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);if(v_value>0.0){gl_FragColor=vec4(val,1.0,0.0,1.0);}else{gl_FragColor=vec4(0.0,0.0,1.0,1.0);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <variable_heatmap_v>\nuniform float u_deviceWidth;uniform float u_deviceHeight;uniform vec3 u_camera_pos;uniform mat2 u_pixel_matrix;attribute vec3 a_pos_vec3;attribute vec2 a_extrude;varying float v_value;void main(void){\n#include <pragma_heatmap_initialize>\nfloat S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=u_pixel_matrix*S*a_extrude;v_value=dot(a_pos_vec3,u_camera_pos);vec4 temppos=vec4(a_pos_vec3,1);vec4 trans_pos=u_matrix*temppos;vec2 screen_pos=vec2(trans_pos.x/trans_pos.w*u_deviceHeight/2.0+v_extrude.x*radius*u_deviceHeight/u_deviceWidth,trans_pos.y/trans_pos.w*u_deviceHeight/2.0+v_extrude.y*radius);gl_Position=vec4(screen_pos*trans_pos.w*2.0/u_deviceHeight,trans_pos.z,trans_pos.w);}")},heatmapTexture:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_heatmap_f>\nvoid main(){float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_heatmap_v>\nvoid main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}")},sphereCircle:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_circle_define>\n#include <variable_circle_f>\nvoid main(){\n#include <pragma_circle_initialize>\nif(v_front_of_earth<0.){discard;}vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_circle_define>\n#include <variable_circle_v>\nvoid main(void){\n#include <pragma_circle_initialize>\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}vec2 extrude=a_extra;mediump vec2 dist=u_pixel_matrix*(radius+stroke_width)*extrude;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;lowp float antialiasblur=1.0/M_DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},sphereExtrusion:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_extrusion_f>\n#include <variable_define>\n#include <pragma_extrusion_define>\n#include <write_log_depth>\n#include <struct_light_material>\n#include <phong>\nuniform bool u_self_bloom;uniform float u_time;uniform float u_bloom_height;uniform float uPureColorHeight;uniform float u_bloom_speed;uniform float uGlowWidth;varying vec4 modelPos;varying vec4 relativePos;uniform LightMaterial u_lightMaterial;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}void main(){\n#include <pragma_extrusion_initialize>\nif(color.a==0.||opacity==0.){discard;}vec4 finalFragColor;\n#ifdef M_PHONG_LIGHT\nvec3 normal=normalize(v_normal);vec4 phongColor=vec4(Phong(modelPos.xyz,normal,u_lightMaterial),1.0);vec4 baseColor=vec4(color.rgb,opacity*color.a);finalFragColor=baseColor*phongColor;\n#else\nfinalFragColor=vec4(color.rgb,opacity*color.a);\n#endif\nfloat inRegion=0.0;for(int i=0;i<M_RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){if(r.scan){float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.pos.w){if((dist>0.09*r.pos.w&&dist<0.1*r.pos.w)||(dist>0.29*r.pos.w&&dist<0.3*r.pos.w)||(dist>0.49*r.pos.w&&dist<0.5*r.pos.w)||(dist>0.69*r.pos.w&&dist<0.7*r.pos.w)||(dist>0.99*r.pos.w&&dist<1.*r.pos.w)){inRegion=0.5;}else{vec3 p_vector=normalize(v_pos_region-r.pos.xyz);vec3 r_vector=normalize(r.north-r.pos.xyz);vec3 cc=cross(p_vector,r_vector);float angle=0.;if(oppositeSigns(cc.x,r.cross.x)||oppositeSigns(cc.y,r.cross.y)||oppositeSigns(cc.z,r.cross.z)){angle=degrees(acos(dot(p_vector,r_vector)))+180.0;}else{angle=-degrees(acos(dot(p_vector,r_vector)))+180.0;}if((angle>r.percent*360.&&angle<(r.percent+0.15)*360.)||(angle>(r.percent-1.0)*360.&&angle<(r.percent-0.85)*360.)){inRegion=0.5;}else{inRegion=0.8;}}}}else{float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.percent*r.pos.w){inRegion=dist/(r.percent*r.pos.w);break;}}}else{break;}}inRegion=inRegion*10.;vec4 finalColor=inRegion>0.0 ? vec4(finalFragColor.rgb*(1.0+inRegion),finalFragColor.a): finalFragColor;\n#ifdef M_OVERDRAW_INSPECTOR\nfinalColor=vec4(1.0);\n#endif\nif(u_self_bloom){float earthR=sqrt(relativePos.x*relativePos.x+relativePos.y*relativePos.y+relativePos.z*relativePos.z);float v_R_h=sqrt(modelPos.x*modelPos.x+modelPos.y*modelPos.y+modelPos.z*modelPos.z);float real_h=v_R_h-earthR;float dt_a12=clamp((real_h/uPureColorHeight),0.0,1.0);finalColor*=vec4(dt_a12,dt_a12,dt_a12,1.0);float dt_a13=fract(u_time/u_bloom_speed);float dt_h=clamp((real_h/u_bloom_height),0.0,1.0);dt_a13=abs(dt_a13-0.5)*2.0;float dt_diff=step(uGlowWidth,abs(dt_h-dt_a13));finalColor.rgb+=finalColor.rgb*(1.0-dt_diff);}\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,currentFrustum);\n#endif\ngl_FragColor=finalColor;}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_define>\n#include <variable_extrusion_v>\n#include <pragma_extrusion_define>\nvarying vec4 modelPos;varying vec4 relativePos;\n#include <vertex_log_depth>\nvoid main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));if(u_regions[0].use){v_pos_region=vec3(u_model*vec4(a_pos,1));}modelPos=u_model*vec4(a_pos,1.0);relativePos=u_model*vec4(0.0,0.0,0.0,1.0);relativePos=relativePos/relativePos.w;modelPos=modelPos/modelPos.w;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(currentFrustum);\n#endif\n}")},sphereExtrusionPattern:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_extrusion_f>\n#include <pragma_extrusion_define>\n#include <struct_light_material>\n#include <phong>\nuniform float u_zoom;uniform LightMaterial u_lightMaterial;varying vec4 modelPos;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}void main(){\n#include <pragma_extrusion_initialize>\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){imagecoord_b=mod(imagecoord_b*pow(2.,u_zoom),1.);pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec4 finalFragColor;\n#ifdef M_PHONG_LIGHT\nvec3 normal=normalize(v_normal);vec4 phongColor=vec4(Phong(modelPos.xyz,normal,u_lightMaterial),1.0);vec4 baseColor=vec4(t_color.rgb,opacity*t_color.a);finalFragColor=baseColor*phongColor;\n#else\nfinalFragColor=vec4(t_color.rgb,opacity*t_color.a);\n#endif\nfloat inRegion=0.0;for(int i=0;i<M_RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){if(r.scan){float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.pos.w){if((dist>0.09*r.pos.w&&dist<0.1*r.pos.w)||(dist>0.29*r.pos.w&&dist<0.3*r.pos.w)||(dist>0.49*r.pos.w&&dist<0.5*r.pos.w)||(dist>0.69*r.pos.w&&dist<0.7*r.pos.w)||(dist>0.99*r.pos.w&&dist<1.*r.pos.w)){inRegion=0.5;}else{vec3 p_vector=normalize(v_pos_region-r.pos.xyz);vec3 r_vector=normalize(r.north-r.pos.xyz);vec3 cc=cross(p_vector,r_vector);float angle=0.;if(oppositeSigns(cc.x,r.cross.x)||oppositeSigns(cc.y,r.cross.y)||oppositeSigns(cc.z,r.cross.z)){angle=degrees(acos(dot(p_vector,r_vector)))+180.0;}else{angle=-degrees(acos(dot(p_vector,r_vector)))+180.0;}if((angle>r.percent*360.&&angle<(r.percent+0.15)*360.)||(angle>(r.percent-1.0)*360.&&angle<(r.percent-0.85)*360.)){inRegion=0.5;}else{inRegion=0.8;}}}}else{float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.percent*r.pos.w){inRegion=dist/(r.percent*r.pos.w);break;}}}else{break;}}inRegion=inRegion*10.;gl_FragColor=inRegion>0.0 ? vec4(finalFragColor.rgb*(1.0+inRegion),finalFragColor.a): finalFragColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nvarying vec4 modelPos;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);modelPos=u_model*vec4(a_pos,1.0);modelPos=modelPos/modelPos.w;v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;if(u_regions[0].use){v_pos_region=vec3(u_model*vec4(a_pos,1));}}")},sphereExtrusionShadow:{fragmentSource:$s("#define GLSLIFY 1\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionPatternShadow:{fragmentSource:$s("#define GLSLIFY 1\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_base>\nvoid main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionCameraView:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_extrusion_f>\n#include <pragma_extrusion_define>\nvarying vec4 v_pos_from_light;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;float getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=u_viewshed_eye0;float my_dist=u_viewshed_dist0;vec4 my_pos=v_viewshed_pos;vec4 my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#include <pragma_extrusion_initialize>\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_LightColor*color.rgb*nDotL;vec3 ambient=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<M_RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;vec4 c=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color :(diffuse+ambient+viewshed_color),opacity);if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=c;}else{float amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4(c.rgb*(1.-amountInLight*0.5),c.a);}}else{gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color :(diffuse+ambient+viewshed_color),opacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nuniform mat4 u_sun_matrix;uniform bool u_with_shadow;varying vec4 v_pos_from_light;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos_region=vec3(u_model*vec4(a_pos,1));if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_model*vec4(a_pos,1.);}}")},sphereExtrusionPatternCameraView:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_extrusion_f>\n#include <pragma_extrusion_define>\nfloat getAmountInLightSimple(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=vec3(0.);float my_dist=0.0;vec4 my_pos=vec4(1.0);vec4 my_spacepos=vec4(1.0);my_eye=u_viewshed_eye0;my_dist=u_viewshed_dist0;my_pos=v_viewshed_pos;my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLightSimple(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#include <pragma_extrusion_initialize>\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_LightColor*t_color.rgb*nDotL;vec3 ambient=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*t_color.rgb;float inRegion=0.0;for(int i=0;i<M_RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color : diffuse+ambient+viewshed_color,opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nvoid main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;for(int i=0;i<M_VIEWSHED_COUNT;i++){if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_view_modelmat0*vec4(a_pos,1.);}}}")},sphereTracking:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <variable_line_f>\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform bool u_reverse;uniform bool u_reserve;varying float v_seq;void main(){\n#include <pragma_line_initialize>\nmediump float drive_opacity=1.0;if(u_reserve){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse){drive_opacity=1.0-drive_opacity;}}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 tmpColor=vec4(color.xyz,0.25);gl_FragColor=tmpColor*(alpha*opacity)*drive_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <variable_line_v>\nattribute vec2 a_normal_vec2;attribute float a_seq;varying float v_seq;void main(){\n#include <pragma_line_initialize>\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSprite:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <variable_line_f>\nvarying float v_opacity;varying float v_discard;void main(){\n#include <pragma_base_initialize>\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*opacity_m;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <variable_line_v>\nattribute vec2 a_normal_vec2;attribute vec3 a_extra_m;uniform float u_count;varying float v_opacity;varying float v_discard;void main(){\n#include <pragma_line_initialize>\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];int speed1;int speed2;int speed3;int speed4;if(speed_factor==1.0){speed1=int(u_count)-(int(u_count)/20)*20;}else if(speed_factor==2.0){speed2=int(u_count)-(int(u_count)/80)*80;}else if(speed_factor==3.0){speed3=int(u_count)-(int(u_count)/150)*150;}else{speed4=int(u_count)-(int(u_count)/240)*240;}speed1=speed1/2;speed2=speed2/8;speed3=speed3/15;speed4=speed4/24;if(status==1.0){if(link_seq!=float(speed1)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=float(speed2)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=float(speed3)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=float(speed4)){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},gltfPBR:{fragmentSource:$s(js),vertexSource:$s(Ys)},gltfPBRI3DM:{fragmentSource:$s(js),vertexSource:$s(Ys)},gltfPhong:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_phong_f>\nvoid main(){vec4 baseColor=texture2D(u_BaseColorSampler,v_UV);if(baseColor.a==0.){discard;}float NL=dot(normalize(v_NormalScene),u_SceneLightDir3);float perOrign;const float ambient=0.4;if(NL<=0.0){perOrign=ambient;}else{float ShadowFactor=getShadowColor(v_pos_from_light,u_shadow_sampler,u_shadow_off,gMapSizeInv);perOrign=NL*ShadowFactor*(1.0-ambient)+ambient;}gl_FragColor=vec4(1.3*perOrign*baseColor.rgb,1.0);}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_phong_v>\nvoid main(){v_PosOrigin=a_POSITION;v_UV=a_TEXCOORD_0;v_NormalOrigin=a_NORMAL.xyz;v_pos_from_light=u_sun_matrix*u_sceneMatrix*vec4(a_POSITION.xyz,1.0);vec4 NormalSceneV4=u_sceneMatrix*vec4(a_NORMAL.xyz,0.0);v_NormalScene=NormalSceneV4.xyz;vec4 PosSceneV4=u_sceneMatrix*vec4(a_POSITION.xyz,1.0);v_PosScene=PosSceneV4.xyz/PosSceneV4.w;gl_Position=u_matrix*vec4(a_POSITION.xyz,1.0);}")},TexturedQuad:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_Sampler;varying vec2 v_TexCoord;void main(){gl_FragColor=texture2D(u_Sampler,v_TexCoord);}"),vertexSource:$s("precision highp float;\n#define GLSLIFY 1\nattribute vec4 a_POSITION;attribute vec2 a_TEXCOORD_0;varying vec2 v_TexCoord;void main(){gl_Position=a_POSITION;v_TexCoord=a_TEXCOORD_0;}")},gltfSkin:{fragmentSource:$s("#define GLSLIFY 1\nvarying vec3 v_normal;varying vec2 v_coord;uniform vec4 u_ambient;uniform vec4 u_diffuse;uniform vec4 u_emission;uniform sampler2D u_texture;void main(void){vec3 normal=normalize(v_normal);if(gl_FrontFacing==false)normal=-normal;vec4 color=texture2D(u_texture,v_coord);vec4 diffuse=vec4(0.,0.,0.,1.);vec4 emission;vec4 ambient;ambient=u_ambient;diffuse=u_diffuse;emission=u_emission;diffuse.xyz*=max(dot(normal,vec3(0.,0.,1.)),0.);color.xyz+=diffuse.xyz;color.xyz+=emission.xyz;color=vec4(color.rgb*diffuse.a,diffuse.a);gl_FragColor=color;}"),vertexSource:$s("#define GLSLIFY 1\nattribute vec3 a_position;attribute vec3 a_normal;varying vec3 v_normal;attribute vec4 a_joint;attribute vec4 a_weight;uniform mat4 u_jointMat[16];uniform mat3 u_normal;uniform mat4 u_matrix;void main(void){mat4 skinMat=a_weight.x*u_jointMat[int(a_joint.x)];skinMat+=a_weight.y*u_jointMat[int(a_joint.y)];skinMat+=a_weight.z*u_jointMat[int(a_joint.z)];skinMat+=a_weight.w*u_jointMat[int(a_joint.w)];v_normal=u_normal*mat3(skinMat)*a_normal;gl_Position=u_matrix*skinMat*vec4(a_position,1.0);}")},gltfShadowEncode:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\n#ifdef M_HAS_CLIPPING\n#include <box_clip_discard_pixel>\n#include <plane_clip_discard_pixel>\n#include <range_clip_discard_pixel>\n#endif\n#include <encode_float>\nvarying vec2 v_coord;varying vec3 v_sceneNormal;uniform sampler2D u_BaseColorSampler;\n#ifdef M_HAS_CLIPPING\nvarying vec3 v_clamp_pos;\n#ifdef M_IS_CLIPPING_RANGE\nuniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;varying vec3 v_clamp_range;\n#endif\n#ifdef M_IS_CLIPPING_PLANE\nuniform highp vec4 u_clamp_plane;\n#endif\n#ifdef M_IS_CLIPPING_BOX\nuniform highp vec3 u_clamp_box;uniform bool u_clamp_box_inner;uniform mat4 u_clamp_matrix;\n#endif\n#endif\nvoid main(){\n#ifdef M_HAS_CLIPPING\n#ifdef M_IS_CLIPPING_BOX\nboxClipDiscardPixel(v_clamp_pos,u_clamp_matrix,u_clamp_box,u_clamp_box_inner);\n#endif\n#ifdef M_IS_CLIPPING_PLANE\nplaneClipDiscardPixel(v_clamp_pos,u_clamp_plane);\n#endif\n#ifdef M_IS_CLIPPING_RANGE\nrangeClipDiscardPixel(v_clamp_range,u_x_clamp_range,u_y_clamp_range,u_z_clamp_range);\n#endif\n#endif\nvec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}gl_FragColor=encodeFloat(gl_FragCoord.z);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("precision highp float;\n#define GLSLIFY 1\nuniform mat4 u_matrix;attribute vec4 a_POSITION;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;attribute vec2 a_TEXCOORD_0;varying vec2 v_coord;uniform mat4 u_sceneMatrix;varying vec3 v_sceneNormal;uniform lowp float u_target_length;uniform vec2 u_weight;uniform bool u_morph_weight;attribute vec4 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec4 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;\n#ifdef M_HAS_CLIPPING\nuniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform mat4 u_clamp_model_matrix;varying vec3 v_clamp_range;varying vec3 v_clamp_pos;\n#include <get_clamp_range>\n#endif\nvoid main(){vec4 TmpWorldNormal=u_sceneMatrix*vec4(a_NORMAL.xyz,0.0);v_sceneNormal=TmpWorldNormal.xyz;if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*u_sceneMatrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]);}else if(u_target_length==2.0){gl_Position=u_matrix*u_sceneMatrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1]);}}else{gl_Position=u_matrix*u_sceneMatrix*vec4(a_POSITION.xyz,1.0);}v_coord=a_TEXCOORD_0;\n#ifdef M_HAS_CLIPPING\nv_clamp_pos=vec3(u_clamp_model_matrix*a_POSITION);v_clamp_range=getClampRange(a_POSITION,u_min_clamp_bounds,u_max_clamp_bounds);\n#endif\n}")},gltfLineModel:{fragmentSource:$s("precision mediump float;\n#define GLSLIFY 1\nuniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;varying vec4 v_Color;varying float v_Counters;varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform bool u_with_light;uniform vec3 u_LightColor;uniform vec3 u_LightDirection;void main(){vec4 tempColor=v_Color;if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);if(u_use_text){vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}if(u_hightlight){t_color=mix(t_color,vec4(1.0,0.2,0.1,1.0),0.4);}vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);vec3 diffuse=u_LightColor*h_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*h_color.rgb;gl_FragColor=vec4(diffuse+ambient,t_color.a);}else{gl_FragColor=u_fill_color;vec3 diffuse=u_LightColor*u_fill_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*u_fill_color.rgb;gl_FragColor=vec4(diffuse+ambient,u_fill_color.a);}}else{if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}gl_FragColor=tempColor;if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("precision highp float;\n#define GLSLIFY 1\nuniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;varying vec4 v_Color;varying float v_Counters;uniform mat4 u_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;varying vec2 v_coord;varying vec3 v_normal;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1./(u_resolution.x*u_proj_matrix[0][0]);v_Color=vec4(u_color,u_opacity);mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));}")},gltfParticleModel:{fragmentSource:$s("precision mediump float;\n#define GLSLIFY 1\nuniform vec4 uColor;uniform highp float uTime;varying float vLifetime;varying vec2 vTextureCoords;uniform sampler2D u_BaseColorSampler;void main(void){float time=mod(uTime,vLifetime);float percentOfLife=time/vLifetime;percentOfLife=clamp(percentOfLife,0.0,1.0);float offset=floor(16.0*percentOfLife);float offsetX=floor(mod(offset,4.0))/4.0;float offsetY=0.75-floor(offset/4.0)/4.0;vec4 texColor=texture2D(u_BaseColorSampler,vec2((vTextureCoords.x/4.0)+offsetX,(vTextureCoords.y/4.0)+offsetY));gl_FragColor=uColor*texColor;gl_FragColor.a*=vLifetime;}"),vertexSource:$s("#define GLSLIFY 1\nuniform float uTime;uniform vec3 uFirePos;attribute float a_LIFETIMES;attribute vec2 a_TEXCOORDS;attribute vec2 a_TRICORNERS;attribute vec3 a_CENTEROFFSETS;attribute vec3 a_VELOCITIES;uniform mat4 u_matrix;uniform mat4 uViewMatrix;uniform bool uUseBillboarding;varying float vLifetime;varying vec2 vTextureCoords;void main(void){float time=mod(uTime,a_LIFETIMES);vec4 position=vec4(uFirePos+a_CENTEROFFSETS+(time*a_VELOCITIES),1.0);vLifetime=1.3-(time/a_LIFETIMES);vLifetime=clamp(vLifetime,0.0,1.0);float size=(vLifetime*vLifetime)*0.05;if(uUseBillboarding){vec3 cameraRight=vec3(uViewMatrix[0].x,uViewMatrix[1].x,uViewMatrix[2].x);vec3 cameraUp=vec3(uViewMatrix[0].y,uViewMatrix[1].y,uViewMatrix[2].y);position.xyz+=(cameraRight*a_TRICORNERS.x*size)+(cameraUp*a_TRICORNERS.y*size);}else{position.xy+=a_TRICORNERS.xy*size;}gl_Position=u_matrix*position;vTextureCoords=a_TEXCOORDS;vLifetime=a_LIFETIMES;}")},simpleModel:{fragmentSource:$s("#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;varying vec2 v_UV;void main(){vec4 baseColor=texture2D(u_BaseColorSampler,v_UV);gl_FragColor=baseColor;}"),vertexSource:$s("#define GLSLIFY 1\nattribute vec4 a_POSITION;attribute vec2 a_TEXCOORD_0;uniform mat4 u_matrix;varying vec2 v_UV;void main(){v_UV=a_TEXCOORD_0;gl_Position=u_matrix*a_POSITION;}")},gltfAirLine:{fragmentSource:$s("#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform bool u_hightlight;uniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;uniform float u_count;uniform float u_segments;varying vec4 vColor;varying float vSeq;varying float vSide;varying float v_Counters;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;void main(){vec4 tempColor=vColor;if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}float startSeq=u_count-u_segments;float endSeq=u_count;if(vSeq<startSeq||vSeq>endSeq){discard;}float drive_opacity=1.0;drive_opacity=(vSeq-startSeq)/u_segments;vec3 color1=tempColor.rgb+(1.0-abs(vSide))*vec3(0.2,0.2,0.2);gl_FragColor=vec4(color1.rgb,(1.0-abs(vSide))*drive_opacity)*tempColor.a;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("precision highp float;\n#define GLSLIFY 1\nattribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;attribute float a_SEQ;uniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;uniform mat4 u_matrix;uniform mat4 u_cam_matrix;uniform mat4 u_normal;varying vec4 vColor;varying float v_Counters;varying float vSeq;varying float vSide;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1.0/(u_resolution.x*u_proj_matrix[0][0]);vColor=vec4(u_color,u_opacity);vSeq=a_SEQ;mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;vSide=a_SIDE;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));v_pos_from_light=u_cam_matrix*vec4(a_POSITION,1.);}")},fxaaFlsify:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_fxaa_f>\nconst float fxaaQualitySubpix=0.5;const float fxaaQualityEdgeThreshold=0.125;const float fxaaQualityEdgeThresholdMin=0.0833;\n#if (M_FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}FxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaTex tex,FxaaFloat2 fxaaQualityRcpFrame_0,FxaaFloat fxaaQualitySubpix_0,FxaaFloat fxaaQualityEdgeThreshold_0,FxaaFloat fxaaQualityEdgeThresholdMin_0){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;FxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame_0.xy));FxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold_0;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin_0,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)return rgbyM;FxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame_0.xy));FxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame_0.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame_0.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame_0.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame_0.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12_1540259130;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12_1540259130;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12_1540259130;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12_1540259130;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix_0;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;return FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);}void main(){vec2 fxaaQualityRcpFrame=vec2(1.0)/u_resolution;vec4 color=FxaaPixelShader(v_coord,u_image,fxaaQualityRcpFrame,fxaaQualitySubpix,fxaaQualityEdgeThreshold,fxaaQualityEdgeThresholdMin);float alpha=texture2D(u_image,v_coord).a;gl_FragColor=vec4(color.rgb,alpha);}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_fxaa_v>\nvoid main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBrightFilter:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\nvarying highp vec2 v_coord;uniform sampler2D u_image;void main(){vec4 c=texture2D(u_image,v_coord);float bright=(c.r*0.2126)+(c.g*0.7152)+(c.b*0.0722);gl_FragColor=(bright>0.5)? c : vec4(.0);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlur:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\nvarying highp vec2 v_coord;uniform sampler2D u_image;uniform vec2 u_dir;uniform float u_kernel[12];uniform int u_kernelLen;uniform vec2 u_resolution;uniform float u_extent;vec4 FungiBlurx(sampler2D tex,vec2 uv,vec2 dir){vec2 pxSize=u_resolution*dir;vec4 c=vec4(0.0);c+=texture2D(tex,uv-pxSize*u_extent*4.)*0.000229;c+=texture2D(tex,uv-pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv-pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv-pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv)*0.382928;c+=texture2D(tex,uv+pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv+pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv+pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv+pxSize*u_extent*4.)*0.000229;return c;}void main(){gl_FragColor=FungiBlurx(u_image,v_coord,u_dir);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlend:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\nvarying highp vec2 v_coord;uniform sampler2D u_base;uniform sampler2D u_over;const float u_overStrength=0.99;void main(){vec3 cBase=texture2D(u_base,v_coord).rgb;vec3 cOver=texture2D(u_over,v_coord).rgb;gl_FragColor=vec4(cBase+cOver*u_overStrength,1.0);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},screen:{fragmentSource:$s("precision highp float;\n#define GLSLIFY 1\nvarying highp vec2 v_coord;uniform sampler2D u_image;void main(){gl_FragColor=texture2D(u_image,v_coord);}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},tdModelHeatmap:{fragmentSource:$s("#define GLSLIFY 1\nvarying highp float v_heatmap_cl;uniform lowp float u_h_heatmap;uniform sampler2D u_BaseColorSampler;uniform vec4 u_fill_color;vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec4 u_color1=vec4(0.5294117647058824,0.807843137254902,0.9215686274509803,0.8);vec4 u_color2=vec4(0.,1.,0.4980392156862745,0.8);vec4 u_color3=vec4(1.,1.,0.,0.8);vec4 u_color4=vec4(1.,0.1,0.,0.8);void main(){if(v_heatmap_cl<=u_h_heatmap/3.0){vec4 c=mix(u_color1,u_color2,clamp((v_heatmap_cl)/u_h_heatmap*3.0,0.,1.0));gl_FragColor=vec4(c.xyz,c.z*v_heatmap_cl/(u_h_heatmap/3.0));}else if(v_heatmap_cl<=u_h_heatmap/3.0*2.0){gl_FragColor=mix(u_color2,u_color3,(v_heatmap_cl-u_h_heatmap/3.0)/u_h_heatmap*3.0);}else{gl_FragColor=mix(u_color3,u_color4,(v_heatmap_cl-u_h_heatmap/3.0*2.0)/u_h_heatmap*3.0);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;uniform highp float u_animate_pos;uniform highp float u_animate_seg_percent;uniform highp float u_height_scale;uniform bool u_morph_weight;attribute vec3 a_POSITION;attribute vec3 a_POSITION_1;attribute vec3 a_POSITION_2;attribute vec3 a_POSITION_3;attribute vec3 a_POSITION_4;attribute vec3 a_POSITION_5;attribute vec3 a_POSITION_6;attribute vec3 a_POSITION_7;attribute vec3 a_POSITION_8;attribute vec3 a_POSITION_9;attribute vec3 a_POSITION_10;attribute vec3 a_POSITION_11;uniform lowp float u_weight0;uniform lowp float u_weight1;uniform lowp float u_weight2;uniform lowp float u_weight3;uniform lowp float u_weight4;uniform lowp float u_weight5;uniform lowp float u_weight6;uniform lowp float u_weight7;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying highp float v_heatmap_cl;void main(){vec3 pos=vec3(1.0);if(u_morph_weight){pos=a_POSITION+a_POSITION_1*u_weight0+a_POSITION_2*u_weight1+a_POSITION_3*u_weight2+a_POSITION_4*u_weight3+a_POSITION_5*u_weight4+a_POSITION_6*u_weight5+a_POSITION_7*u_weight6+a_POSITION_8*u_weight7;}else{if(u_animate_pos==0.0){pos=vec3(a_POSITION.x,a_POSITION.y*(1.-u_animate_seg_percent)+a_POSITION_1.y*u_animate_seg_percent,a_POSITION.z);}else if(u_animate_pos==1.0){pos=vec3(a_POSITION_1.x,a_POSITION_1.y*(1.-u_animate_seg_percent)+a_POSITION_2.y*u_animate_seg_percent,a_POSITION_1.z);}else if(u_animate_pos==2.0){pos=vec3(a_POSITION_2.x,a_POSITION_2.y*(1.-u_animate_seg_percent)+a_POSITION_3.y*u_animate_seg_percent,a_POSITION_2.z);}else if(u_animate_pos==3.0){pos=vec3(a_POSITION_3.x,a_POSITION_3.y*(1.-u_animate_seg_percent)+a_POSITION_4.y*u_animate_seg_percent,a_POSITION_3.z);}else if(u_animate_pos==4.0){pos=vec3(a_POSITION_4.x,a_POSITION_4.y*(1.-u_animate_seg_percent)+a_POSITION_5.y*u_animate_seg_percent,a_POSITION_4.z);}else if(u_animate_pos==5.0){pos=vec3(a_POSITION_5.x,a_POSITION_5.y*(1.-u_animate_seg_percent)+a_POSITION_6.y*u_animate_seg_percent,a_POSITION_5.z);}else if(u_animate_pos==6.0){pos=vec3(a_POSITION_6.x,a_POSITION_6.y*(1.-u_animate_seg_percent)+a_POSITION_7.y*u_animate_seg_percent,a_POSITION_6.z);}else if(u_animate_pos==7.0){pos=vec3(a_POSITION_7.x,a_POSITION_7.y*(1.-u_animate_seg_percent)+a_POSITION_8.y*u_animate_seg_percent,a_POSITION_7.z);}else if(u_animate_pos==8.0){pos=vec3(a_POSITION_8.x,a_POSITION_8.y*(1.-u_animate_seg_percent)+a_POSITION_9.y*u_animate_seg_percent,a_POSITION_8.z);}else if(u_animate_pos==9.0){pos=vec3(a_POSITION_9.x,a_POSITION_9.y*(1.-u_animate_seg_percent)+a_POSITION_10.y*u_animate_seg_percent,a_POSITION_9.z);}else if(u_animate_pos==10.0){pos=vec3(a_POSITION_10.x,a_POSITION_10.y*(1.-u_animate_seg_percent)+a_POSITION_11.y*u_animate_seg_percent,a_POSITION_10.z);}else if(u_animate_pos==11.0){pos=vec3(a_POSITION_11.x,a_POSITION_11.y*(1.-u_animate_seg_percent)+a_POSITION.y*u_animate_seg_percent,a_POSITION_11.z);}pos.y=pos.y*u_height_scale;}gl_Position=u_matrix*vec4(pos,1);v_heatmap_cl=pos.y;}")},panorama:{fragmentSource:$s("#define GLSLIFY 1\nuniform sampler2D u_std_resolution_img;uniform sampler2D u_low_resolution;varying vec2 v_pos;void main(){vec4 calColor=texture2D(u_std_resolution_img,vec2(v_pos.x,v_pos.y));gl_FragColor=calColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\nuniform mat4 u_matrix;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;}")},sphereHistogramShadow:{fragmentSource:$s("#define GLSLIFY 1\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_base>\nvoid main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereHistogramCameraView:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_f>\nvarying vec4 v_pos_from_light;uniform lowp float u_opacity;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;float getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=u_viewshed_eye0;float my_dist=u_viewshed_dist0;vec4 my_pos=v_viewshed_pos;vec4 my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#include <pragma_extrusion_initialize>\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_LightColor*color.rgb*nDotL;vec3 ambient=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<M_RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;vec4 c=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color :(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=c;}else{float amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4(c.rgb*(1.-amountInLight*0.5),c.a);}}else{gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color :(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nuniform mat4 u_sun_matrix;uniform bool u_with_shadow;varying vec4 v_pos_from_light;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos_region=vec3(u_model*vec4(a_pos,1));if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_model*vec4(a_pos,1.);}}")},sphereHistogram:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_f>\nuniform lowp float u_opacity;void main(){\n#include <pragma_extrusion_initialize>\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=color.rgb*nDotL;vec3 ambient=vec3(0.4,0.4,0.4)*color.rgb;if(u_depth_render==1.0){gl_FragColor=vec4((diffuse+ambient)*v_opacity*u_opacity,u_opacity);}else{gl_FragColor=vec4((diffuse+ambient)*v_opacity,v_opacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nvarying float v_opacity;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));vec3 normal=a_normal_ed.xyz;float t=a_st.z;if(t>0.0){v_opacity=1.2;}else{v_opacity=0.1;}}")},sphereHistogramColor:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_f>\nuniform lowp float u_opacity;void main(){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_LightDirection);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse_a=u_LightColor*u_color_a.rgb*nDotL;vec3 ambient_a=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*u_color_a.rgb;vec3 diffuse_b=u_LightColor*u_color_b.rgb*nDotL;vec3 ambient_b=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*u_color_b.rgb;vec3 diffuse_c=u_LightColor*u_color_c.rgb*nDotL;vec3 ambient_c=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*u_color_c.rgb;vec3 diffuse_d=u_LightColor*u_color_d.rgb*nDotL;vec3 ambient_d=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*u_color_d.rgb;vec3 diffuse_e=u_LightColor*u_color_e.rgb*nDotL;vec3 ambient_e=vec3(M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH,M_AMBIENT_STRENGTH)*u_color_e.rgb;vec3 tmp=vec3(0.0);vec3 real=vec3(0.0);if(v_height<0.25*u_max_height){tmp=(diffuse_b+ambient_b)-(diffuse_a+ambient_a);real=tmp*((v_height)/0.25/u_max_height)+(diffuse_a+ambient_a);}else if(v_height<0.5*u_max_height){tmp=(diffuse_c+ambient_c)-(diffuse_b+ambient_b);real=tmp*((v_height-0.25*u_max_height)/0.25/u_max_height)+(diffuse_b+ambient_b);}else if(v_height<0.75*u_max_height){tmp=(diffuse_d+ambient_d)-(diffuse_c+ambient_c);real=tmp*((v_height-0.5*u_max_height)/0.25/u_max_height)+(diffuse_c+ambient_c);}else if(v_height<0.8*u_max_height){tmp=(diffuse_e+ambient_e)-(diffuse_d+ambient_d);real=tmp*((v_height-0.75*u_max_height)/0.25/u_max_height)+(diffuse_d+ambient_d);}else{real=(diffuse_e+ambient_e);}if(u_depth_render==1.0){gl_FragColor=vec4(real,u_opacity);}else{gl_FragColor=vec4(real,v_opacity*u_opacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);;\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_extrusion_v>\nvarying float v_height;varying float v_opacity;\n#pragma minemap: define highp float base\n#pragma minemap: define highp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize highp float base\n#pragma minemap: initialize highp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));vec3 normal=a_normal_ed.xyz;float t=mod(normal.x,2.0);if(t>0.0){v_opacity=1.2;v_height=height*3.0;}else{v_opacity=0.1;v_height=0.0;}}")},sphereHistogramDynamic:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_f>\nvoid main(){\n#include <pragma_extrusion_initialize>\nif(v_height<0.2*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.2/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.4*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.2*u_max_height)/0.2/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.6*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.4*u_max_height)/0.2/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.6*u_max_height)/0.2/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <variable_extrusion_v>\nuniform vec3 u_LightColor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform lowp float u_dyn_count;uniform float u_fluorescent;varying vec4 v_color;varying float v_opacity;varying float v_height;varying float v_directional;\n#pragma minemap: define lowp vec4 heightArr1\n#pragma minemap: define lowp vec4 heightArr2\n#pragma minemap: define lowp vec4 heightArr3\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize lowp vec4 heightArr1\n#pragma minemap: initialize lowp vec4 heightArr2\n#pragma minemap: initialize lowp vec4 heightArr3\nfloat _height=0.0;float _num=0.0;float _height1=0.0;float _height2=0.0;_num=abs(u_dyn_count)/500.0;if(_num<1.0){_height1=abs(height);_height2=abs(heightArr1[0]/255.0);}else if(_num<2.0){_height1=abs(heightArr1[0]/255.0);_height2=abs(heightArr1[1]/255.0);}else if(_num<3.0){_height1=abs(heightArr1[1]/255.0);_height2=abs(heightArr1[2]/255.0);}else if(_num<4.0){_height1=abs(heightArr1[2]/255.0);_height2=abs(heightArr1[3]/255.0);}else if(_num<5.0){_height1=abs(heightArr1[3]/255.0);_height2=abs(heightArr2[0]/255.0);}else if(_num<6.0){_height1=abs(heightArr2[0]/255.0);_height2=abs(heightArr2[1]/255.0);}else if(_num<7.0){_height1=abs(heightArr2[1]/255.0);_height2=abs(heightArr2[2]/255.0);}else if(_num<8.0){_height1=abs(heightArr2[2]/255.0);_height2=abs(heightArr2[3]/255.0);}else if(_num<9.0){_height1=abs(heightArr2[3]/255.0);_height2=abs(heightArr3[0]/255.0);}else if(_num<10.0){_height1=abs(heightArr3[0]/255.0);_height2=abs(heightArr3[1]/255.0);}else if(_num<11.0){_height1=abs(heightArr3[1]/255.0);_height2=abs(heightArr3[2]/255.0);}else if(_num<12.0){_height1=abs(heightArr3[2]/255.0);_height2=abs(heightArr3[3]/255.0);}_height=20.0+(_height1+(_height2-_height1)/500.0*mod(abs(u_dyn_count),500.0))*1.0;vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos.xy,t>0.0 ? _height : base,1);if(t>0.0){v_opacity=1.2;v_height=_height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_LightColor.r,mix(0.0,0.3,1.0-u_LightColor.r),1.0);v_color.g+=clamp(color.g*directional*u_LightColor.g,mix(0.0,0.3,1.0-u_LightColor.g),1.0);v_color.b+=clamp(color.b*directional*u_LightColor.b,mix(0.0,0.3,1.0-u_LightColor.b),1.0);v_directional=directional;}")},sphereSymtrackingIcon:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_symbol_f>\n#include <pragma_base_define>\nvoid main(){\n#include <pragma_base_initialize>\nif(v_front_of_earth<0.){discard;}if(v_seq<0.0){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_symbol_v>\n#include <pragma_base_define>\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}void main(){\n#include <pragma_base_initialize>\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}vec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ? camera_to_anchor_distance/u_camera_to_center_distance : u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=1.0;float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_matrix*u_rot_matrix*a_projected_pos.xy;vec4 added=vec4(u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+u_pitch_matrix*u_rot_matrix*vec2(a_projected_pos.x,a_projected_pos.y)/u_gl_units_to_pixels+vec2(moveDist.y*sin(lineRotAngle),0.)/u_gl_units_to_pixels,0.0,1.0);gl_Position.xyz+=added.xyz/added.w;}else{gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},sphereSymtrackingSDF:{fragmentSource:$s("#define GLSLIFY 1\n#include <variable_symbol_f>\n#include <pragma_symbol_define>\nvoid main(){\n#include <pragma_symbol_initialize>\nif(v_front_of_earth<0.0){discard;}if(v_seq<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/fontScale;lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/fontScale;buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <variable_symbol_v>\n#include <pragma_symbol_define>\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}void main(){\n#include <pragma_symbol_initialize>\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}vec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-M_DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=M_DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ? camera_to_anchor_distance/u_camera_to_center_distance : u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(!u_rotate_with_map&&!u_pitch_with_map){angle_sin=0.;angle_cos=1.;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else if(!u_rotate_with_map&&u_pitch_with_map){angle_sin=0.;angle_cos=1.;}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(!u_rotate_with_map&&!u_pitch_with_map){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){vec2 moveDist=u_pitch_rot_matrix*a_projected_pos.xy;vec2 added=u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale+u_pitch_rot_matrix*a_projected_pos.xy+vec2(moveDist.y*sin(lineRotAngle));added-=fract(added);gl_Position.xy+=added/u_gl_units_to_pixels;}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position.xy+=vec4(u_pitch_rot_matrix_1*vec4(a_offset/32.0*fontScale/vec2(u_gl_units_to_pixels.x,-u_gl_units_to_pixels.x),0.,1.)).xy;}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position.xy+=u_pitch_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}gl_Position.z=0.0;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);}")},sphereDynamicLine:{fragmentSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <variable_line_f>\nuniform float u_count;uniform float u_segments;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\nfloat total_count=v_info[0];float offset_count=v_info[1];float actualSeq=v_seq-2.0;float actualCount=u_count+offset_count;float quotient=floor(actualCount/(total_count+u_segments));float mod1=mod(quotient,2.0);float count=mod(actualCount,total_count+u_segments);if(mod1!=0.0){count=total_count+u_segments-count;}float start=count-u_segments;float end=count;if(actualSeq<start||actualSeq>end){discard;}mediump float drive_opacity=(actualSeq-start)/u_segments;if(mod1!=0.0){drive_opacity=1.0-drive_opacity;}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*drive_opacity;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:$s("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <variable_line_v>\nattribute float a_seq;attribute vec2 a_info;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_seq=a_seq;v_info=a_info;mediump vec2 normal=vec2(a_normal/2.0>=1.0 ? 1.0 : 0.0,mod(a_normal,2.0)==1.0 ? 1.0 :-1.0);v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_hasBorder==1.0)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_half_render==1.){if(normaldirection==1.){outset=gapwidth+(normal.y>0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereControl:{fragmentSource:$s(Ws),vertexSource:$s(qs)},debugViewPort:{fragmentSource:$s("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 vUv;void main(){gl_FragColor=texture2D(colorTexture,vUv);}"),vertexSource:$s("#define GLSLIFY 1\nattribute vec2 a_pos;varying vec2 vUv;void main(){gl_Position=vec4(a_pos,0.0,1.0);vUv=a_pos;}")}},Js=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g;for(const e in Ks){const t=Ks[e],i={};t.fragmentSource=t.fragmentSource.replace(Js,((e,t,r,o,s)=>(i[s]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${s}\nvarying ${r} ${o} ${s};\n#else\nuniform ${r} ${o} u_${s};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${s}\n    ${r} ${o} ${s} = u_${s};\n#endif\n`))),t.vertexSource=t.vertexSource.replace(Js,((e,t,r,o,s)=>{const n="float"===o?"vec2":"vec4";return i[s]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${s}\nuniform lowp float a_${s}_t;\nattribute ${r} ${n} a_${s};\nvarying ${r} ${o} ${s};\n#else\nuniform ${r} ${o} u_${s};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${s}\n    ${s} = unpack_mix_${n}(a_${s}, a_${s}_t);\n#else\n    ${r} ${o} ${s} = u_${s};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${s}\nuniform lowp float a_${s}_t;\nattribute ${r} ${n} a_${s};\n#else\nuniform ${r} ${o} u_${s};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${s}\n    ${r} ${o} ${s} = unpack_mix_${n}(a_${s}, a_${s}_t);\n#else\n    ${r} ${o} ${s} = u_${s};\n#endif\n`}));}function en(e){return e.replace(Qs,tn)}function tn(e,t){const i=Zs[t];if(void 0===i)throw new Error(`Can not resolve #include <${t}>`);return en(i)}class rn{constructor(e,t,i,r){const o=e.gl;this.program=o.createProgram(),this.textureUnitManager=new mi({context:e});const s=i.defines().concat(this._setMicroDefines(r)),n=s.concat(Ks.prelude.fragmentSource,Ks.unpackAll.fragmentSource,t.fragmentSource).join("\n"),a=s.concat(Ks.prelude.vertexSource,Ks.unpackAll.vertexSource,t.vertexSource).join("\n"),l=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(l,n),o.compileShader(l),o.attachShader(this.program,l);const c=o.createShader(o.VERTEX_SHADER);o.shaderSource(c,a),o.compileShader(c),o.attachShader(this.program,c);const h=i.layoutAttributes||[];for(let e=0;e<h.length;e++)o.bindAttribLocation(this.program,e,h[e].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(let e=0;e<this.numAttributes;e++){const t=o.getActiveAttrib(this.program,e);t&&(this.attributes[t.name]=o.getAttribLocation(this.program,t.name));}const u=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS);for(let e=0;e<u;e++){const t=o.getActiveUniform(this.program,e);t&&(this.uniforms[t.name]=o.getUniformLocation(this.program,t.name));}}_setMicroDefines(e){let t="";for(const i in e)"boolean"==typeof e[i]?e[i]&&(t+=`#define M_${i} \r\n`):t+=`#define M_${i} ${e[i]} \r\n`;return t}draw(e,t,i,r,o,s,n,a,l){const c=e.gl,h={[c.LINES]:2,[c.TRIANGLES]:3}[t];for(const u of s.get()){const s=u.vaos||(u.vaos={});(s[i]||(s[i]=new Le)).bind(e,this,r,n?n.getPaintVertexBuffers():[],o,u.vertexOffset,a,l),c.drawElements(t,u.primitiveLength*h,c.UNSIGNED_SHORT,u.primitiveOffset*h*2);}}}function on(){this.m_mvpMatrix=new e.Matrix4,this.m_prjMatrix=new e.Matrix4,this.m_pViewMatrix=new e.Matrix4;}class sn{constructor(t){this.context=t.context,this.mSMWidth=2048,this.mSMHeight=2048,this.mSMSizeInv=1/2048,this.CascadeShadow_NUM=1,this.mSMArray=new Array(this.CascadeShadow_NUM),this.mSMMatrixArray=new Array;for(let e=0;e<this.CascadeShadow_NUM;e++){const e=new on;this.mSMMatrixArray.push(e);}this.ShadowCade0=0,this.ShadowCade1=1,this.ShadowCade2=2,this.centerOld=new e.Vector3(0,0,0),this.mSceneLightDir3Old=new e.Vector3(0,0,0),this.dirtyShadowMap=!0,this.objShadowCount=0;for(let e=0;e<this.CascadeShadow_NUM;e++)this.mSMArray[e]=this.createAFrameBuffer(this.mSMWidth,this.mSMHeight);}createAFrameBuffer(e,t){const i=this.context.gl,r=this.context.createFramebuffer(e,t,!1),o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),r.colorAttachment.set(o);const s=i.createRenderbuffer();if(!s)throw new Error("Failed to create renderbuffer object");return i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),r.depthAttachment.set(s),r}}class nn{constructor(){this.m_center=new e.Vector3(0,0,0),this.m_radius=0;}setParaFromPoints(t,i){if(i>2){this.m_radius=1e9;for(let r=0;r<i;r++)for(let o=r+1;o<i;o++){let s=-1e9;const n=new e.Vector3;n.add(t[r],t[o]),n.scale(.5);for(let r=0;r<i;r++){const i=(new e.Vector3).copy(t[r]);i.subtract(n);const o=i.lengthSquared();s<o&&(s=o);}this.m_radius>s&&(this.m_center.copy(n),this.m_radius=s);}this.m_radius=Math.sqrt(this.m_radius);}}getCenter(){return this.m_center}getRadius(){return this.m_radius}}class an{constructor(e){this.mGloT3D=e.pTransform3D,this.mPainter=e.pPainter;}updateSMFruBySceneBox(t){this.updateLight2Local();const i=this.mPainter._map.directionLightParameter,r=(new e.Vector3).copy(i.mSceneLightDir3);r.normalize();const o=i.mSceneEnvelope;o.calculateSizeAndCenter();const s=[];s.push(new e.Vector3(o.m_Xmin,o.m_Ymin,o.m_Zmin)),s.push(new e.Vector3(o.m_Xmin,o.m_Ymin,o.m_Zmax)),s.push(new e.Vector3(o.m_Xmin,o.m_Ymax,o.m_Zmin)),s.push(new e.Vector3(o.m_Xmin,o.m_Ymax,o.m_Zmax)),s.push(new e.Vector3(o.m_Xmax,o.m_Ymin,o.m_Zmin)),s.push(new e.Vector3(o.m_Xmax,o.m_Ymin,o.m_Zmax)),s.push(new e.Vector3(o.m_Xmax,o.m_Ymax,o.m_Zmin)),s.push(new e.Vector3(o.m_Xmax,o.m_Ymax,o.m_Zmax));const n=new nn;n.setParaFromPoints(s,8);const a=(new e.Vector3).copy(n.getCenter()),l=1.3*n.getRadius();this.calShadowVPByCenterR(a,l,r,t);}updateLight2Local(){const t=this.mPainter._map.directionLightParameter,i=this.mPainter.style.sourceCaches[t.mCurShadowLayer.source];if(i.root2GeoMat){const r=i.root2GeoMat.clone().invert(),o=this.mPainter._map.sunLight.getSunLightPos(),s=new e.Vector4(o[0],o[1],o[2],0),n=new e.Vector4(0,0,0,0);s.transform(r,n);const a=new e.Vector4(0,0,0,0);let l=new e.Matrix4(e.Matrix4.IDENTITY).rotateX(0);t.mCurShadowLayer instanceof e.TdModelStyleLayer&&(l=new e.Matrix4(e.Matrix4.IDENTITY).rotateX(Math.PI/2)),n.transform(l,a),t.mSceneLightDir3.set(a[0],a[1],a[2]);const c=new e.Vector4(t.mShadowCenter[0],t.mShadowCenter[1],t.mShadowCenter[2],1),h=new e.Vector4(0,0,0,0);c.transform(r,h),t.mShadowCenterLocal.set(h[0],h[1],h[2]);}}updateSMFruByCurViewAndCenterR(t){this.updateLight2Local();const i=this.mPainter._map.directionLightParameter,r=(new e.Vector3).copy(i.mSceneLightDir3);r.normalize();const o=(new e.Vector3).copy(i.mShadowCenterLocal);this.calShadowVPByCenterR(o,1.3*i.mShadowRadius,r,t);}calShadowVPByCenterR(t,i,r,o){const s=this.mPainter._map.directionLightParameter,n=o.centerOld.clone().subtract(t),a=o.mSceneLightDir3Old.clone().subtract(s.mSceneLightDir3);if(n.len()>5||a.len()>1e-4||s.mCurNodeCountRender!=o.mCurNodeCountRenderOld){o.mCurNodeCountRenderOld=s.mCurNodeCountRender,o.centerOld.copy(t),o.mSceneLightDir3Old.copy(s.mSceneLightDir3),o.dirtyShadowMap=!0,o.mSMMatrixArray[0].m_prjMatrix.ortho({left:-i,right:i,bottom:-i,top:i,near:2,far:2*i});const n=r.clone().scale(i),a=t.clone().add(n),l=new e.Vector3(0,1,0);o.mSMMatrixArray[0].m_pViewMatrix.lookAt(a,t,l),o.mSMMatrixArray[0].m_mvpMatrix.copy(o.mSMMatrixArray[0].m_prjMatrix),o.mSMMatrixArray[0].m_mvpMatrix.multiplyRight(o.mSMMatrixArray[0].m_pViewMatrix);}}}class ln{constructor(e){this.mGloT3D=e.pTransform3D,this.mPainter=e.pPainter,this.mSelfcontext=e.context,this.mSMFBO=new sn(e),this.mSMAlg=new an(e);}}class cn{constructor(e){this.context=e.context;const t=this.context.gl;this.mShaderName="TexturedQuad",this.vertexTexCoordBuffer=null,this.FSIZE=0,this.init=!1,this.n=4,this.glodon_SetOBBByPara(t);}glodon_SetOBBByPara(e){const t=new Float32Array([0,1,0,1,0,0,0,0,1,1,1,1,1,0,1,0]);if(this.n=4,this.vertexTexCoordBuffer=e.createBuffer(),!this.vertexTexCoordBuffer)throw new Error("Failed to create the buffer object");e.bindBuffer(e.ARRAY_BUFFER,this.vertexTexCoordBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.FSIZE=t.BYTES_PER_ELEMENT,e.bindBuffer(e.ARRAY_BUFFER,null),this.init=!0;}glodon_Draw(t){const i=t.mShadowEffect.mSMFBO.mSMArray[0];if(!i)return;const r=this.context.gl;if(this.context.setDepthMode(e.DepthMode.disabled),0==this.init)return;const o=t.useProgram(this.mShaderName);r.bindBuffer(r.ARRAY_BUFFER,this.vertexTexCoordBuffer);const s=o.attributes.a_POSITION;r.vertexAttribPointer(s,2,r.FLOAT,!1,4*this.FSIZE,0),r.enableVertexAttribArray(s);const n=o.attributes.a_TEXCOORD_0;r.vertexAttribPointer(n,2,r.FLOAT,!1,4*this.FSIZE,2*this.FSIZE),r.enableVertexAttribArray(n);const a=o.uniforms.u_Sampler,l=o.textureUnitManager.getOneUnit();i&&(this.context.activeTexture.set(l.VALUE),r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),r.uniform1i(a,l.INDEX)),r.drawArrays(r.TRIANGLE_STRIP,0,this.n),this.context.setDepthMode(new e.DepthMode(r.LESS,e.DepthMode.ReadWrite,[0,1]));}}let hn=null;function un(e,t,i){let r=null;switch(i){case"ns":case"ss":r=10-e>=0?t["g"+(10-e)]:14-e>=0?t["y"+(14-e)]:t["r"+(59-e)];break;case"nl":case"sl":r=14-e>=0?t["r"+(14-e)]:25-e>=0?t["g"+(25-e)]:29-e>=0?t["y"+(29-e)]:t["r"+(74-e)];break;case"ws":case"es":r=29-e>=0?t["r"+(29-e)]:40-e>=0?t["g"+(40-e)]:44-e>=0?t["y"+(44-e)]:t["r"+(89-e)];break;case"wl":case"el":r=44-e>=0?t["r"+(44-e)]:55-e>=0?t["g"+(55-e)]:t["y"+(59-e)];}return r}function dn(e,t){const i={};switch(t){case"ns":case"ss":10-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):14-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"nl":case"sl":14-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):25-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):29-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"ws":case"es":29-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):40-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):44-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"wl":case"el":44-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):55-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]);}return i}class _n{constructor(e){}static setPhongLightUniform(e){const{painter:t,program:i,layer:r}=e,o=t.context.gl,s=t.transform,{Ambient:n,Diffuse:a,SpecularColor:l,Shininess:c}=r.phongLightConfig,h=t._map.sunLight.getSunLightPos(),u=s.getCameraPos();o.uniform1i(i.uniforms.u_with_light,!0),o.uniform3fv(i.uniforms["u_lightMaterial.Ambient"],[n,n,n]),o.uniform3fv(i.uniforms["u_lightMaterial.Diffuse"],[a,a,a]),o.uniform3fv(i.uniforms["u_lightMaterial.SpecularColor"],[l,l,l]),o.uniform3fv(i.uniforms["u_lightMaterial.CameraPosition"],[u[0],u[1],u[2]]),o.uniform1f(i.uniforms["u_lightMaterial.Shininess"],c),o.uniform3fv(i.uniforms["u_lightMaterial.Direction"],h);}}class mn{constructor(e){}static setUniformForPrimitive(t){const{layer:i,context:r,textures:o,samplers:s,program:n,mat:a,useTextureMatrix:l}=t,{gl:c}=r;if(!c)throw new Error("setUniformForPrimitive gl==null");const h=n.textureUnitManager;if(mn.setNormalAndTangent(t),!t.isTrafficLight||!function(t){const{timer:i,trafficLightsConf:r,name:o,materials:s,textures:n,samplers:a,context:l,program:c}=t,{gl:h}=l;if(!hn){hn=[];for(const e in r.nodeList)hn.push(r.nodeList[e]);}if(-1!==hn.indexOf(o)){const t=parseInt(i%60),u=r.nodeList;let d=null,_=null;switch(o){case u.nl:d=un(t,r.materialConf,"nl");break;case u.ns:d=un(t,r.materialConf,"ns");break;case u.sl:d=un(t,r.materialConf,"sl");break;case u.ss:d=un(t,r.materialConf,"ss");break;case u.wl:d=un(t,r.materialConf,"wl");break;case u.ws:d=un(t,r.materialConf,"ws");break;case u.el:d=un(t,r.materialConf,"el");break;case u.es:d=un(t,r.materialConf,"es");break;case u.nlR:_=dn(t,"nl").r;break;case u.nlG:_=dn(t,"nl").g;break;case u.nlY:_=dn(t,"nl").y;break;case u.nsR:_=dn(t,"ns").r;break;case u.nsG:_=dn(t,"ns").g;break;case u.nsY:_=dn(t,"ns").y;break;case u.slR:_=dn(t,"sl").r;break;case u.slG:_=dn(t,"sl").g;break;case u.slY:_=dn(t,"sl").y;break;case u.ssR:_=dn(t,"ss").r;break;case u.ssG:_=dn(t,"ss").g;break;case u.ssY:_=dn(t,"ss").y;break;case u.wlR:_=dn(t,"wl").r;break;case u.wlG:_=dn(t,"wl").g;break;case u.wlY:_=dn(t,"wl").y;break;case u.wsR:_=dn(t,"ws").r;break;case u.wsG:_=dn(t,"ws").g;break;case u.wsY:_=dn(t,"ws").y;break;case u.elR:_=dn(t,"el").r;break;case u.elG:_=dn(t,"el").g;break;case u.elY:_=dn(t,"el").y;break;case u.esR:_=dn(t,"es").r;break;case u.esG:_=dn(t,"es").g;break;case u.esY:_=dn(t,"es").y;}const m=s[d];if(m){if(h.uniform4fv(c.uniforms.u_BaseColorFactor,m&&m.pbrMetallicRoughness.baseColorFactor||[1,1,1,1]),!m.pbrMetallicRoughness||!m.pbrMetallicRoughness.baseColorTexture)return h.uniform1i(c.uniforms.u_HAS_BASECOLORMAP,!1),!1;{l.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),h.uniform1i(c.uniforms.u_BaseColorSampler,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),h.uniform1i(c.uniforms.u_HAS_BASECOLORMAP,!0);const t=n[m.pbrMetallicRoughness.baseColorTexture.index];if(t){const e=t.isSizePowerOfTwoNoneSquare()?a[m.sampler]&&a[m.sampler].wrapS?a[m.sampler].wrapS:h.REPEAT:h.CLAMP_TO_EDGE;t.bind(h.LINEAR,e);}}}else h.uniform1i(c.uniforms.u_HAS_BASECOLORMAP,!1),h.uniform4fv(c.uniforms.u_BaseColorFactor,_);return !0}return !1}({context:r,textures:o,samplers:s,program:n,trafficLightsConf:t.trafficLightOptions.trafficLightsConf,timer:t.trafficLightOptions.timer,name:t.trafficLightOptions.name,materials:t.trafficLightOptions.materials}))if(c.uniform4fv(n.uniforms.u_BaseColorFactor,a&&a.pbrMetallicRoughness.baseColorFactor||[1,1,1,1]),a&&a.pbrMetallicRoughness&&a.pbrMetallicRoughness.baseColorTexture){const e=h.getOneUnit();r.activeTexture.set(e.VALUE),c.uniform1i(n.uniforms.u_BaseColorSampler,e.INDEX),c.uniform1i(n.uniforms.u_HAS_BASECOLORMAP,!0),mn._textureBind(o[a.pbrMetallicRoughness.baseColorTexture.index],a,s,r);}else c.uniform1f(n.uniforms.u_reflect,0),c.uniform1i(n.uniforms.u_HAS_BASECOLORMAP,!1);c.uniform4fv(n.uniforms.u_pbrPer,[1.01,1.9,1.01,0]),c.uniform1i(n.uniforms.u_useTextureMatrix,l);const u=a&&a.pbrMetallicRoughness?a.pbrMetallicRoughness.metallicFactor:.3,d=a&&a.pbrMetallicRoughness?a.pbrMetallicRoughness.roughnessFactor:.35,_=!(u&&d);c.uniform2fv(n.uniforms.u_MetallicRoughnessValues,[u,d]);const m=i.lightExposure?i.lightExposure:1;if(c.uniform2fv(n.uniforms.u_satExp,_?[2,m]:[1.3,m]),a?.pbrMetallicRoughness?.metallicRoughnessTexture){const e=h.getOneUnit();r.activeTexture.set(e.VALUE),c.uniform1i(n.uniforms.u_MetallicRoughnessSampler,e.INDEX),c.uniform1i(n.uniforms.u_HAS_METALROUGHNESSMAP,!0),mn._textureBind(o[a.pbrMetallicRoughness.metallicRoughnessTexture.index],a,s,r);}else c.uniform1i(n.uniforms.u_HAS_METALROUGHNESSMAP,!1);if(a?.normalTexture){const e=h.getOneUnit();r.activeTexture.set(e.VALUE),c.uniform1i(n.uniforms.u_NormalSampler,e.INDEX),c.uniform1i(n.uniforms.u_HAS_NORMALMAP,!0),c.uniform1f(n.uniforms.u_NormalScale,a.normalTexture.scale||1),mn._textureBind(o[a.normalTexture.index],a,s,r);}else c.uniform1i(n.uniforms.u_HAS_NORMALMAP,!1);if(a?.occlusionTexture){const e=h.getOneUnit();r.activeTexture.set(e.VALUE),c.uniform1i(n.uniforms.u_OcclusionSampler,e.INDEX),c.uniform1i(n.uniforms.u_HAS_OCCLUSIONMAP,!0),c.uniform1f(n.uniforms.u_OcclusionStrength,a.occlusionTexture.strength||.9),mn._textureBind(o[a.occlusionTexture.index],a,s,r);}else c.uniform1i(n.uniforms.u_HAS_OCCLUSIONMAP,!1);if(a?.emissiveTexture){const e=h.getOneUnit();r.activeTexture.set(e.VALUE),c.uniform1i(n.uniforms.u_EmissiveSampler,e.INDEX),c.uniform1i(n.uniforms.u_HAS_EMISSIVEMAP,!0),c.uniform3fv(n.uniforms.u_EmissiveFactor,a.emissiveFactor||[1,1,1]),mn._textureBind(o[a.emissiveTexture.index],a,s,r);}else c.uniform1i(n.uniforms.u_HAS_EMISSIVEMAP,!1);if(a?.pbrMetallicRoughness?.baseColorTexture?.extensions?.KHR_texture_transform){const e=a.pbrMetallicRoughness.baseColorTexture.extensions.KHR_texture_transform,t=e.offset?e.offset:[0,0],i=e.scale?e.scale:[1,1];c.uniform1i(n.uniforms.u_useKhr,!0),c.uniform4fv(n.uniforms.u_khrValues,[...t,...i]);}else c.uniform1i(n.uniforms.u_useKhr,!1);}static setNormalAndTangent(e){const{u_HAS_NORMALS:t,u_HAS_TANGENTS:i,context:r,program:o}=e;r.gl.uniform1i(o.uniforms.u_HAS_NORMALS,t),r.gl.uniform1i(o.uniforms.u_HAS_TANGENTS,i);}static _textureBind(t,i,r,o){if(t){const{gl:s}=o;let n;n=e.isNumber(i.sampler)||!i.sampler?t.isSizePowerOfTwoNoneSquare()?r[i.sampler]&&r[i.sampler].wrapS?r[i.sampler].wrapS:s.REPEAT:s.CLAMP_TO_EDGE:i.sampler.wrapS||s.CLAMP_TO_EDGE,t.bind(s.LINEAR,n);}}static setUniformForScene(e,t){t.needBackUpTextureUnitManager=!0;const{context:i,program:r,IBL_Support:o,painter:s}=e;if(!s._map._loadIBL){if(o)throw new Error("When 【layer.usePBR】 is true, it is necessary to ensure that the map initialization attribute 【loadIBL】 is true");return}const{gl:n}=i,a=r.textureUnitManager;if(n.uniform3fv(r.uniforms.u_LightColor,[1,1,1]),o){const{mBrdfTex:e,mDiffuseEnvTex:t,mSpecularEnvTex:o}=s._iBLtextures;if(e){const t=a.getOneUnit();i.activeTexture.set(t.VALUE),n.uniform1i(r.uniforms.u_brdfLUT,t.INDEX),e.bind(n.LINEAR,n.CLAMP_TO_EDGE);}if(t){const e=a.getOneUnit();i.activeTexture.set(e.VALUE),n.uniform1i(r.uniforms.u_DiffuseEnvSampler,e.INDEX),n.bindTexture(n.TEXTURE_CUBE_MAP,t);}if(o){const e=a.getOneUnit();i.activeTexture.set(e.VALUE),n.uniform1i(r.uniforms.u_SpecularEnvSampler,e.INDEX),n.bindTexture(n.TEXTURE_CUBE_MAP,o);}}}static setUniformForNode(t){const{painter:i,program:r,context:o,layer:s,modelMatrix:n,transform:a}=t,{gl:l}=o;l.uniformMatrix4fv(r.uniforms.u_model_matrix,!1,n.toFloat32Array()),l.uniformMatrix4fv(r.uniforms.u_model_matrixFS,!1,n.toFloat32Array());const c=n.invert(new e.Matrix4),h=a.getCameraPos(),u=new e.Vector4(h[0],h[1],h[2],1);u.transform(c),l.uniform3fv(r.uniforms.u_cam,[u[0],u[1],u[2]]),_n.setPhongLightUniform({painter:i,program:r,layer:s});}}class fn{constructor(){this.reset();}reset(){this.state={highLightFlagSetted:!1,colorIndexSetted:!1,colorsSetted:!1};}setUniforms(e){const{program:t,context:i,highlightFlag:r,highLightColorsIndex:o,highLightColors:s}=e,{gl:n}=i,a=!!r;if(this.state.highLightFlagSetted?this.state.highLightValue!==a&&(this.state.highLightValue=a,n.uniform1i(t.uniforms.u_hightlight,a)):(n.uniform1i(t.uniforms.u_hightlight,a),this.state.highLightFlagSetted=!0,this.state.highLightValue=a),r){const e=o||0;if(this.state.colorIndexSetted?this.state.colorIndexValue!==e&&(this.state.colorIndexValue=e,n.uniform1i(t.uniforms.u_specialindex,e)):(n.uniform1i(t.uniforms.u_specialindex,e),this.state.colorIndexSetted=!0,this.state.colorIndexValue=e),s)if(this.state.colorsSetted){if(this.state.colorsValue!=s){for(let e=0;e<s.length;e++)n.uniform4fv(t.uniforms[`u_specialcolor[${e}].color`],s[e].toArray());this.state.colorsValue=s;}}else {for(let e=0;e<s.length;e++)n.uniform4fv(t.uniforms[`u_specialcolor[${e}].color`],s[e].toArray());this.state.colorsSetted=!0,this.state.colorsValue=s;}else this.state.colorsSetted?this.state.colorsValue!=[1,.2,.1,1]&&(this.state.colorsValue=[1,.2,.1,1],n.uniform4fv(t.uniforms["u_specialcolor[0].color"],[1,.2,.1,1])):(n.uniform4fv(t.uniforms["u_specialcolor[0].color"],[1,.2,.1,1]),this.state.colorsSetted=!0,this.state.colorsValue=[1,.2,.1,1]);}}}class pn{constructor(){this.reset();}reset(){this.state={setted:!1,offSetted:!1};}static setFlowTexture(e){const{context:t,program:i,flag:r}=e,{gl:o}=t;o.uniform1i(i.uniforms.u_b_flow_text,r);}setUniforms(e){const{context:t,program:i,flowSetted:r,offValue:o,flowDirectionWrapT:s}=e,{gl:n}=t,a=!!r;this.state.setted?a&&this.state.offValue!==o&&this.state.dirTValue!==s?(this.state.offValue=o,this.state.dirTValue=s,n.uniform1i(i.uniforms.u_b_flow_text,!0),s?(n.uniform1i(i.uniforms.u_b_flow_text_s,!1),n.uniform1f(i.uniforms.u_flow_text_off,o)):(n.uniform1i(i.uniforms.u_b_flow_text_s,!0),n.uniform1f(i.uniforms.u_flow_text_off,-o))):n.uniform1i(i.uniforms.u_b_flow_text,a):(this.state.setted=!0,this.state.offValue=o,this.state.dirTSetted=!0,this.state.dirTValue=s,a?(n.uniform1i(i.uniforms.u_b_flow_text,a),s?(n.uniform1i(i.uniforms.u_b_flow_text_s,!1),n.uniform1f(i.uniforms.u_flow_text_off,o)):(n.uniform1i(i.uniforms.u_b_flow_text_s,!0),n.uniform1f(i.uniforms.u_flow_text_off,-o))):n.uniform1i(i.uniforms.u_b_flow_text,a));}}class gn{constructor(){this.reset();}reset(){this.state={setted:!1};}setUniforms(e){const{program:t,context:i,isSkinModel:r}=e,{gl:o}=i,s=!!r;this.state.setted?this.state.value!==s&&(o.uniform1i(t.uniforms.u_morph_weight,s),this.state.value=s):(o.uniform1i(t.uniforms.u_morph_weight,s),this.state.setted=!0,this.state.value=s);}}class vn{constructor(t){this.programCache={},this._context=t.context,this.globalDefinitions={OVERDRAW_INSPECTOR:!1,DEVICE_PIXEL_RATIO:e.exported.devicePixelRatio.toFixed(1),FXAA_QUALITY_PRESET:13,AMBIENT_STRENGTH:.6,RADIATION_REGIONS_COUNT:5,VIEWSHED_COUNT:1,DISCARD_VARYING_NUMBER:100.01,TEXTURE_LOD_SUPPORTED:!!this._context.hasLODExtension,STANDARD_DERIVATIVES_SUPPORTED:!!this._context.hasDerivativesExt,LOG_DEPTH:!1,DEPTH_EXT:!!this._context.extFragDepth};}setGlobalMacroDefinition(e){for(const t in e)this.globalDefinitions[t]=e[t];}_makeSpecialKey(e){if(!e)return "";const t=Object.keys(e).sort();let i="";for(let r=0;r<t.length;r++){const o=t[r];"boolean"==typeof e[o]?e[o]&&(i+=`${o}:${e[o]},`):i+=`${o}:${e[o]},`;}for(const e in this.globalDefinitions)this.globalDefinitions[e]&&(i+=`${e}:${this.globalDefinitions[e]},`);return i}getFullId(e,t,i){return `${e}_${this._makeSpecialKey(t)}_${i}`}hasProgram(e){return e in this.programCache}getProgramByGLSLMacroDefinition(e,t,i){const r=this.getFullId(e,t,i.cacheKey);return this.hasProgram(r)||(this.globalDefinitions.LOG_DEPTH=this._context._logarithmicDepthBuffer,this.programCache[r]=new rn(this._context,Ks[e],i,Object.assign({},t,this.globalDefinitions))),this.programCache[r]}static getVectorLineDefinition(t,i){const r={};return e.defined(i.classificationType)&&i.classificationType!=e.ClassificationType.NONE&&(r.SHADOW_VOLUME=!0),r}static getRasterSourceAndLayerMicroDefinition(e,t,i){const r={};return e.map.style._videoSource&&e._useVideoProject&&(r.NUM_VIDEOS=e.map.style._videoSource._videoMatchOptions.length),r}static getVectorFillDefinition(e,t){return {}}static getTdModelSourceAndLayerMicroDefinition(t,i,r){const o={};return t.clampEnabled&&(o.HAS_CLIPPING=!0,t.clampPlane?o.IS_CLIPPING_PLANE=!0:t.clampBox?o.IS_CLIPPING_BOX=!0:t.clampRange&&(o.IS_CLIPPING_RANGE=!0)),e.defined(t.morphSetting)&&(o.USE_MORPHTARGETS=!0,t.morphSetting.normal&&(o.USE_MORPHNORMALS=!0),t.morphSetting.tangent&&(o.USE_MORPHTANGENTS=!0)),e.defined(t.skins)&&t.skins.length>0&&(o.JOINT_MATRIX_CNT=t.skins[0].count),i.usePBR?(o.USE_PBR=!0,o.USE_IBL=!0):(o.USE_PBR=!1,o.USE_IBL=!1),o.PHONG_LIGHT=!!i.phongLight&&i.phongLight,i.cvtBGR2RGB&&(o.CONVERT_BGR_2_RGB=!0),o.NUM_VIDEOS=0,t.map.style._videoSource&&t._useVideoProject&&(o.NUM_VIDEOS=t.map.style._videoSource._videoMatchOptions.length),r&&(r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW?o.HAS_SHADOW=!0:r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED?o.HAS_VIEWSHED=!0:r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL&&(o.HAS_SHADOW=!0,o.HAS_VIEWSHED=!0)),o}static getGltfTileMicroDefinition(t,i,r,o){const s={};return t.clampEnabled&&(s.HAS_CLIPPING=!0),s.INSTANCE_MATRIX=!!o,i.usePBR?(s.USE_PBR=!0,s.USE_IBL=!0):(s.USE_PBR=!1,s.USE_IBL=!1),s.PHONG_LIGHT=!!i.phongLight&&i.phongLight,i.cvtBGR2RGB&&(s.CONVERT_BGR_2_RGB=!0),s.NUM_VIDEOS=0,t.map.style._videoSource&&t._useVideoProject&&(s.NUM_VIDEOS=t.map.style._videoSource._videoMatchOptions.length),r&&(r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW?s.HAS_SHADOW=!0:r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED?s.HAS_VIEWSHED=!0:r===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL&&(s.HAS_SHADOW=!0,s.HAS_VIEWSHED=!0)),s}static getExtrusionMicroDefinition(e){const t={};return t.PHONG_LIGHT=!!e.phongLight&&e.phongLight,t}destroy(){}}class xn{constructor(){this.mViewshedVisibleColor=new e.Vector3(0,0,0),this.mViewshedInVisibleColor=new e.Vector3(0,0,0),this.mViewshedVisibleDefaultColor=new e.Vector3(0,1,0),this.mViewshedInVisibleDefaultColor=new e.Vector3(1,0,0),this.mCurNodeCountRender=0,this.mSceneLightDir3=new e.Vector3(0,0,1),this.shadowOff=.0025,this.shadowMapInvScale=.3,this.mShadowCenter=new e.Vector3,this.mShadowCenterLocal=new e.Vector3,this.mShadowCenterMode=!1,this.globalInnerColor=new e.Vector4(38/255,65/255,95/255,1),this.globalOuterColor=new e.Vector4(0,0,0,0),this.globalLightPercent=new e.Vector4(1,.02,4.5,1.2),this.nightGlobalPer=.1;}getGlobalInnerColor(){return this.globalInnerColor}getGlobalOuterColor(){return this.globalOuterColor}getGlobalLightPercent(){return this.globalLightPercent}setViewshedVisibleColor(e){this.mViewshedVisibleColor.set(e[0],e[1],e[2]);}setViewshedInVisibleColor(e){this.mViewshedInVisibleColor.set(e[0],e[1],e[2]);}setShadowCenterLngLat(t,i){this.mShadowCenterLngLat=t;const r=e.transformECEFToGeographic([],t,e.CONSTS.TRANSFORM.R);this.mShadowCenter.set(r[0],r[1],r[2]),this.mShadowRadius=i;}}function yn(t,i,r,o){const s=e.createFloat64ArrayFromAMatrix(o);i.identityMatrix||s.multiplyRight(i.matrix),t.uniformMatrix4fv(r.uniforms.u_sceneMatrix,!1,s.toFloat32Array());}function Tn(t){const{gl:i,trackData:r,transform:o,program:s,timeElapsed:n,source:a}=t,l=En(r.link_time,r.total_time_start+n,0,r.link_time.length-2);let c,h,u;if(r.total_time_start+n>r.total_time_end?(c=r.positions[r.positions.length-2],h=r.positions[r.positions.length-1],u=r.positions.length-1):(c=r.positions[l],h=r.positions[l+1],u=l),!c)return null;const d=a.getDisplayBoard(r.link_text,a.configuration.bgImageMathOptions.images[r.link_status[u]],e.defined(a.configuration.bgImageMathOptions.fontColorMatchKey)?r[a.configuration.bgImageMathOptions.fontColorMatchKey]:void 0);if(!d)return null;const _=wn((r.total_time_start+n-r.link_time[l])/(r.link_time[l+1]-r.link_time[l]),c,h),m=e.transformGeographicToECEF([],_),f=a.configuration.bgImageMathOptions.translation;let p;e.defined(f)?Array.isArray(f)?p=f:(p=f[r[a.configuration.bgImageMathOptions.translationMatchKey][0]],e.defined(p)||(p=[0,0,0])):p=[0,0,0];const g=e.calc3dModelTranslateMatrix(!1,{location:m,translation:[p[0],p[1],p[2]]},e.createFloat64ArrayIdentityMatrix());o.calculateVPMatrix().multiplyRight(g,g);const v=new e.Matrix4,x=new e.Matrix4;return v.rotateX((o.pitch-90)*e.CONSTS.TRANSFORM.DEG_TO_RAD),x.rotateY(-o.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD),v.multiplyLeft(x),g.multiplyRight(v),g.multiplyRight(d.nodeMatrix),i.uniformMatrix4fv(s.uniforms.u_matrix,!1,g.toFloat32Array()),d}function Sn(t){if(t.trackData.link_id_minemap.length>"__none_link_data__".length&&0===t.trackData.link_id_minemap.indexOf("__none_link_data__"))return function(t){const{source:i,trackData:r,transform:o,timeElapsed:s,nodeMatrix:n,modelName:a,matrixObject:l}=t,c=(r.total_time_end-r.total_time_start)/10;let h=0;for(let e=0;e<10;e++)s>e*c&&s<(e+1)*c&&(h=e);const u=En(r.link_time,r.total_time_start+c*h,0,r.link_time.length-2),d=En(r.link_time,r.total_time_start+c*(h+1),0,r.link_time.length-2),_=[];for(let t=u;t<d;t++){const s=r.car_rotate[t],c=new e.Matrix4;if(c.rotateY(-s*e.CONSTS.TRANSFORM.DEG_TO_RAD),!r.positions[t])continue;const h=e.transformGeographicToECEF([],r.positions[t]),u=e.calc3dModelTranslateMatrix(!1,{location:h,translation:i.translation||[0,0,0],scale:i.scale||[1,1,1],rotation:i.rotation||[0,0,0]},e.createFloat64ArrayIdentityMatrix());u.multiplyRight(c),n&&u.multiplyRight(n),l[`${r.link_id_minemap}::${a}`]=u.clone().toArray();const d=o.calculateVPMatrix().multiplyRight(u);_.push(u,d);}return _}(t);const{source:i,trackData:r,transform:o,timeElapsed:s,nodeMatrix:n,modelName:a,matrixObject:l}=t,c=En(r.link_time,r.total_time_start+s,0,r.link_time.length-2);let h,u;if(r.total_time_start+s>r.total_time_end?(h=r.positions[r.positions.length-2],u=r.positions[r.positions.length-1]):(h=r.positions[c],u=r.positions[c+1]),!h)return !1;let d,_=null;1===h[3]?_=h:(d=(r.total_time_start+s-r.link_time[c])/(r.link_time[c+1]-r.link_time[c]),_=wn(d,h,u));const m=r.car_rotate?r.car_rotate[c]:0,f=r.car_pitch?r.car_pitch[c]:0,p=new e.Matrix4;p.rotateY(-m*e.CONSTS.TRANSFORM.DEG_TO_RAD),p.rotateX(f*e.CONSTS.TRANSFORM.DEG_TO_RAD);const g=e.transformGeographicToECEF([],_),v=e.calc3dModelTranslateMatrix(!1,{location:g,translation:i.translation||[0,0,0],scale:i.scale||[1,1,1],rotation:i.rotation||[0,0,0]},e.createFloat64ArrayIdentityMatrix());return v.multiplyRight(p),n&&v.multiplyRight(n),l[`${r.link_id_minemap}::${a}`]=v.clone().toArray(),[v,o.calculateVPMatrix().multiplyRight(v)]}function bn(t){const{source:i,gl:r,trackData:o,transform:s,program:n,count:a,nodeMatrix:l,layer:c}=t,h=En(o.seqs,a,0,o.seqs.length-1),u=o.positions[h],d=o.nexts[h];if(!u)return !1;let _=null;_=1===u[3]?u:wn((a-o.seqs[h])/(o.seqs[h+1]-o.seqs[h]),u,d);const m=new e.Matrix4,f=new e.Vector3(d);f.subtract(u).normalize();const p=new e.Quaternion;p.rotationTo([0,0,1],f);const g=new e.Vector3(1,0,0);g.transformByQuaternion(p);const v=new e.Vector3(u),x=new e.Vector3(d),y=new e.Vector3;y.subVectors(v,x).cross(x).normalize();const T=y.clone(),S=new e.Quaternion;S.rotationTo(g,T);let{axis:b,angle:w}=S.getAxisAngle();(b[0]*f[0]<0||b[1]*f[1]<0||b[2]*f[2]<0)&&(w=2*Math.PI-w),p.rotateZ(w);const E=i.rotation;E&&(p.rotateX(E[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),p.rotateY(E[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),p.rotateZ(E[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD));const M=c.useLayerPosition;M&&!c.baseMatrixCalculated&&c.calcBaseMatrix(i);let A=e.createFloat64ArrayIdentityMatrix();A=e.calc3dModelTranslateMatrix(!1,M?c:i,A);const C=A.clone().invert().transpose();r.uniformMatrix4fv(n.uniforms.u_normal,!1,C.toFloat32Array());const R=i.scale||[1,1,1];m.translate([1*_[0],1*_[1],1*_[2]]);const L=(new e.Matrix4).fromQuaternion(p);return m.multiplyRight(L),m.scale(R),l.some((e=>0!==e))&&m.multiplyRight(l),[m,s.calculateVPMatrix().multiplyRight(m)]}function wn(e,t,i){return e>1&&(e=1),[(i[0]-t[0])*e+t[0],(i[1]-t[1])*e+t[1],(i[2]-t[2])*e+t[2]]}function En(e,t,i,r){const o=Math.floor((i+r)/2),s=e[o];return i>r?o:s>t?En(e,t,i,o-1):s<t?En(e,t,o+1,r):o}class Mn{constructor(){}static setUniformForPrimitive(t){const{context:i,textures:r,samplers:o,program:s,mat:n}=t,{gl:a}=i;if(null==a||null==a)throw new Error("setUniformForPrimitive gl==null");if(n.pbrMetallicRoughness&&n.pbrMetallicRoughness.baseColorTexture){const t=s.textureUnitManager.getOneUnit();i.activeTexture.set(t.VALUE),a.uniform1i(s.uniforms.u_BaseColorSampler,t.INDEX),a.uniform1i(s.uniforms.u_HAS_BASECOLORMAP,!0);const l=r[n.pbrMetallicRoughness.baseColorTexture.index];if(l){let t;t=e.isNumber(n.sampler)||!n.sampler?l.isSizePowerOfTwoNoneSquare()?o[n.sampler]&&o[n.sampler].wrapS?o[n.sampler].wrapS:a.REPEAT:a.CLAMP_TO_EDGE:n.sampler.wrapS||a.CLAMP_TO_EDGE,l.bind(a.LINEAR,t);}}}}const An=["gltfShadowEncode"];function Cn(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.cameraDrawMode,s=t.activeCameras,n=i.getSource(),a=t.context,l=a.gl,c=t.useProgram(An[0]),h=new e.Matrix4(e.Matrix4.IDENTITY).rotateX(Math.PI/2),u=new e.Matrix4(e.Matrix4.IDENTITY);if(n instanceof Yt&&n.meshes.length>0){const i=r.useLayerPosition;i&&!r.baseMatrixCalculated&&r.calcBaseMatrix(n),a.setStencilMode(e.StencilMode.disabled);const d=t.transform;a.setDepthMode(new e.DepthMode(l.LESS,e.DepthMode.ReadWrite,[0,1]));let _,m=new e.Matrix4(e.Matrix4.IDENTITY);m=e.calc3dModelTranslateMatrix(!1,i?r:n,m),a.setColorMode(e.ColorMode.unblended);for(let i=0;i<n.nodes.length;i++){const f=n.nodes[i];if(f&&f.hasOwnProperty("mesh")&&f.primitiveStack){if(o===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN)_=t.mShadowEffect.mSMFBO.mSMMatrixArray[0].m_mvpMatrix.toFloat32Array(),l.uniformMatrix4fv(c.uniforms.u_matrix,!1,_),yn(l,f,c,h);else {if(o!==e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)throw new Error("Error draw_3d_modelShadow.js");{const t=e.createFloat64ArrayFromAMatrix(m);f.identityMatrix||t.multiplyRight(f.matrix),e.Matrix4.multiply(t,d.calculateVPMatrix(s.viewshed[0]),t),l.uniformMatrix4fv(c.uniforms.u_matrix,!1,t.toFloat32Array()),l.uniformMatrix4fv(c.uniforms.u_sceneMatrix,!1,u.toFloat32Array());}}for(let i=0;i<f.primitiveStack.length;i++){c.textureUnitManager.reset();const o=n.primitives[f.primitiveStack[i].primitiveInd],s=o.material,l="object"==typeof s?s:n.materials[s];Mn.setUniformForPrimitive({layer:r,painter:t,textures:n.textures,context:a,program:c,mat:l,samplers:n.samplers}),l&&!l.doubleSided&&a.setCullFace(e.CullFaceMode.backCCW),Ht(o,n.gltfModelVAO,a,c,n._options.debug),a.setCullFace(e.CullFaceMode.disabled);}}}}}const Rn=["gltfShadowEncode"];function Ln(t,i,r,o){if(!i.tilesForRender.length)return;const s=t.useProgram(Rn[0]);t.context.setColorMode(e.ColorMode.unblended),t.context.setStencilMode(e.StencilMode.disabled),t.context.setDepthMode(new e.DepthMode(t.context.gl.LESS,e.DepthMode.ReadWrite,[0,1])),function(t,i,r,o,s){const n=t.transform,a=t.context,l=i.getSource();for(const o of i.tilesForRender){if(i.viewport.cullingVolume.computeVisibility(o.boundingVolume)<-.1)continue;s.textureUnitManager.reset(),o.content.gltfUpAxis?"Z"===o.content.gltfUpAxis?l.flipYZ=!0:"Y"===o.content.gltfUpAxis&&(l.flipYZ=!1):l.flipYZ=!1;const c=e.calc3dTileTranslateMatrix(o),h=(new e.Matrix4).rotateX(-Math.PI/2);"i3dm"==o.minemap3DType&&c.multiplyRight(h);const u=i.mTilesInfo.getNodeMatrix(o.tileID);let d;const _=t.activeCameras,m=t.cameraDrawMode;a.setColorMode(e.ColorMode.unblended),o&&o.meshes.length>0&&Pn({painter:t,source:l,tile:o,program:s,transform:n,layer:r,context:a,modelTranslateMatrix:c,tileMatrix:u,cameraDrawMode:m,activeCameras:_,textureMangeBackUp:d});}}(t,i,r,0,s);}function Pn(t){const{painter:i,source:r,tile:o,program:s,transform:n,layer:a,context:l,modelTranslateMatrix:c,tileMatrix:h,cameraDrawMode:u,activeCameras:d}=t,{gl:_}=l,m=new e.Matrix4(e.Matrix4.IDENTITY);let f;for(let t=0;t<o.nodes.length;t++){const p=o.nodes[t];if(p.hasOwnProperty("mesh")&&p.primitiveStack){if(u===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN)f=i.mShadowEffect.mSMFBO.mSMMatrixArray[0].m_mvpMatrix.toFloat32Array(),_.uniformMatrix4fv(s.uniforms.u_matrix,!1,f),yn(_,p,s,h);else {if(u!==e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)throw new Error("Error draw_3d_modelShadow.js");{const t=e.createFloat64ArrayFromAMatrix(c);p.identityMatrix||t.multiplyRight(p.matrix),e.Matrix4.multiply(t,n.calculateVPMatrix(d.viewshed[0]),t),_.uniformMatrix4fv(s.uniforms.u_matrix,!1,t.toFloat32Array()),_.uniformMatrix4fv(s.uniforms.u_sceneMatrix,!1,m.toFloat32Array());}}for(let t=0;t<p.primitiveStack.length;t++){s.textureUnitManager.reset();const n=o.primitives[p.primitiveStack[t].primitiveInd];Mn.setUniformForPrimitive({layer:a,painter:i,textures:o.textures,context:l,program:s,mat:o.materials[n.primitiveInd],samplers:o.samplers}),l.setCullFace(e.CullFaceMode.backCCW),Ht(n,r.gltfModelVAO,l,s,r._options.debug);}}}}const In=function(e,t){if(!e)return !1;const i=t.imageManager.getPattern(e.from),r=t.imageManager.getPattern(e.to);return !i||!r},On=function(t,i,r,o,s){const n=i.context,a=n.gl,l=i.imageManager.getPattern(t.from),c=i.imageManager.getPattern(t.to);a.uniform1i(r.uniforms.u_image,e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.INDEX),a.uniform2fv(r.uniforms.u_pattern_tl_a,l.tl),a.uniform2fv(r.uniforms.u_pattern_br_a,l.br),a.uniform2fv(r.uniforms.u_pattern_tl_b,c.tl),a.uniform2fv(r.uniforms.u_pattern_br_b,c.br);const{width:h,height:u}=i.imageManager.getPixelSize();a.uniform2fv(r.uniforms.u_texsize,[h,u]),a.uniform1f(r.uniforms.u_mix,o.t),a.uniform2fv(r.uniforms.u_pattern_size_a,l.displaySize),a.uniform2fv(r.uniforms.u_pattern_size_b,c.displaySize),a.uniform1f(r.uniforms.u_scale_a,o.fromScale),a.uniform1f(r.uniforms.u_scale_b,o.toScale),a.uniform1f(r.uniforms.u_zoom,1),s||a.uniform1f(r.uniforms.u_zoom,i.transform.zoom),n.activeTexture.set(e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.VALUE),i.imageManager.bind(i.context);},Dn=function(e,t,i){const r=t.context.gl;r.uniform1f(i.uniforms.u_tile_units_to_pixels,1/hr(e,1,t.transform.tileZoom));const o=Math.pow(2,e.tileID.overscaledZ),s=e.tileSize*Math.pow(2,t.transform.tileZoom)/o,n=s*(e.tileID.canonical.x+e.tileID.wrap*o),a=s*e.tileID.canonical.y;r.uniform2f(i.uniforms.u_pixel_coord_upper,n>>16,a>>16),r.uniform2f(i.uniforms.u_pixel_coord_lower,65535&n,65535&a);};class Nn{constructor(e){this.textures={},this.requests={},this.source=e||{fire(){}};}addTexture(t,i,r,o,s){const n=r.gl;if(this.getTexture(t)||this.requests[t])o&&(o.state="loaded"),this.source.fire(new e.Event("data",{dataType:"gltf-data-loaded"}));else {if(i)this.requests[t]=e.getImage({url:i},((i,o)=>{if(i)throw new e.ErrorEvent(i);if(o){const i=new e.Texture(r,o,n.RGBA,{useMipmap:!0});i.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.textures[t]=i,this.requests[t]=null,delete this.requests[t];}}));else {const i=new e.window.Image,a=e.window.URL||e.window.webkitURL;i.onload=()=>{const o=new e.Texture(r,i,n.RGBA,{useMipmap:!0});o.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.textures[t]=o,this.requests[t]=null,delete this.requests[t];};const l=t.slice(t.lastIndexOf("_")+1),c=new e.window.Blob([new Uint8Array(s)],{type:o.result.gltf.images[l].mimeType});i.src=s.length?a.createObjectURL(c):e.CONSTS.SOURCE.TRANSPARENT_PNG_URL;}o.requestImages++;}}getTexture(e){return this.textures[e]}removeTexture(e){this.textures[e]&&(this.requests[e]&&(this.requests[e].cancel(),this.requests[e]=null,delete this.requests[e]),this.textures[e].destroy(),this.textures[e]=null,delete this.textures[e]);}getCanvasData(e){}removeAllTexture(){for(const e in this.textures)this.removeTexture(e),this.requests[e].cancel();}}const Fn=new Nn;function Bn(e,t,i,r,o,s){if(In(i.paint.get("fill-pattern"),e))return;let n=!0;for(const a of r){const r=t.getTile(a),l=r.getBucket(i);l&&(s&&e.clearStencil(),o(e,t,i,r,a,l,n,s),n=!1);}}function Un(t,i,r,o,s,n,a,l){const c=n.programConfigurations.get(r.id);!function(t,i,r,o,s,n,a,l){const c=t.context.gl,h=t.context,u=zn("sphereFill",i.paint.get("fill-pattern"),t,a,i,r,o,n);c.uniform2f(u.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);const d=new e.Matrix2;d.scale([1,Math.cos(t.transform._pitch)]),d.rotate(t.transform.angle),c.uniform2fv(u.uniforms.currentFrustum,[t.transform.near,t.transform.far]),c.uniformMatrix2fv(u.uniforms.u_pixel_matrix,!1,d.toFloat32Array()),c.uniform3fv(u.uniforms.u_camPos,t.transform.getCameraPos()),c.uniform1f(u.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle+Math.PI/18);const _=t.transform.calculateVPMatrix(),m=new e.Matrix4(s.tilePlane.matrix);c.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,m.toFloat32Array()),c.uniformMatrix4fv(u.uniforms.u_matrix,!1,_.multiplyRight(m).toFloat32Array()),l?function(t,i,r,o,s,n,a){s.setDepthMode(new e.DepthMode(n.LESS,e.DepthMode.ReadOnly,[0,1])),s.setColorMode(e.ColorMode.disabled),s.setCullFace(e.CullFaceMode.disabled),n.enable(n.STENCIL_TEST),n.stencilMask(255),n.stencilFunc(n.ALWAYS,0,255),n.stencilOpSeparate(n.FRONT,n.KEEP,n.DECR_WRAP,n.KEEP),n.stencilOpSeparate(n.BACK,n.KEEP,n.INCR_WRAP,n.KEEP),a.draw(t.context,n.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o),s.setColorMode(e.ColorMode.alphaBlended),s.setDepthMode(e.DepthMode.disabled),n.stencilFunc(n.NOTEQUAL,0,255),n.stencilMask(255),n.stencilOpSeparate(n.FRONT,n.ZERO,n.ZERO,n.ZERO),n.stencilOpSeparate(n.BACK,n.ZERO,n.ZERO,n.ZERO),a.draw(t.context,n.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o),s.setDepthMode(new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),s.setStencilMode(e.StencilMode.disabled);}(t,i,s,a,h,c,u):(c.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,new Float32Array(s.tilePlane.matrix)),t.context.setStencilMode(t.transform.zoom>4?t.stencilModeForClipping(o):e.StencilMode.disabled),u.draw(t.context,c.TRIANGLES,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,a),function(t,i,r,o,s,n,a,l){const c=zn("sphereFillOutline",r.getPaintProperty("fill-outline-color")?null:r.paint.get("fill-pattern"),o,s,r,n,a,l);i.uniform2f(c.uniforms.u_world,i.drawingBufferWidth,i.drawingBufferHeight);const h=o.transform.calculateVPMatrix(),u=new e.Matrix4(t.tilePlane.matrix);i.uniformMatrix4fv(c.uniforms.u_matrix,!1,h.multiplyRight(u,new e.Matrix4).toFloat32Array()),c.draw(o.context,i.LINES,r.id,t.layoutVertexBuffer2?t.layoutVertexBuffer2:t.layoutVertexBuffer,t.indexBuffer2,t.segments2,s);}(s,c,i,t,a,r,o,n));}(t,r,o,s,n,a,c,l);}function zn(t,i,r,o,s,n,a,l){let c;const h=r.context.program.get(),u=s.layout.get("dynamic");if(i){c=r.useProgram(`${t}Pattern`,o,vn.getVectorFillDefinition(null,s));const a=new e.EvaluationParameters(r.transform.zoom).getCrossfadeParameters();(l||c.program!==h)&&(o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom}),On(i,r,c,a),r.context.gl.uniform1f(c.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(r.transform.zoom)))),Dn(n,r,c);}else if("none"===u)c=r.useProgram(t,o,vn.getVectorFillDefinition(null,s)),(l||c.program!==h)&&o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom});else {let i=u.toString();if(i=i.toLowerCase(),i=i.charAt(0).toUpperCase()+i.slice(1),c=r.useProgram(`${t}${i}`,o,vn.getVectorFillDefinition(null,s)),l||c.program!==h){o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom});const t=r.context.gl;t.uniform1f(c.uniforms.u_time,r._map.timer.counter),t.uniform1f(c.uniforms.u_zoom,r.transform.zoom),t.uniform3fv(c.uniforms.u_light,r._map.sunLight.getSunLightPos()),t.uniform3fv(c.uniforms.u_coordZXY,[a.canonical.z,a.canonical.x,a.canonical.y]),t.uniform1i(c.uniforms.u_is4326,r._map.projection===e.ProjectionType.LATLON),function(e,t,i){const r=t.gl,o=Fn.getTexture(e.to);if(o){t.activeTexture.set(r.TEXTURE16);const e=o.isSizePowerOfTwoNoneSquare();return o.bind(r.LINEAR,r.REPEAT,e?r.LINEAR_MIPMAP_NEAREST:r.LINEAR),r.uniform1i(i.uniforms.u_image,16),!0}Fn.addTexture(e.to,e.to,t,{requestImages:0});}(s.paint.get("fill-dynamic-image-url"),r.context,c);}}return c}function Gn(t,i,r,o,s,n){let a,l=!0;for(const c of o){const o=i.getTile(c),h=o.getBucket(r);if(!h)continue;e.defined(r.classificationType)&&r.classificationType!=e.ClassificationType.NONE&&t.context.clear({stencil:0});const u=h.programConfigurations.get(r.id),d=t.context.program.get(),_=t.useProgram(s,u,vn.getVectorLineDefinition(null,r));Vn({program:_,painter:t,tile:o,bucket:h,layer:r,coord:c,programConfiguration:u,programChanged:l||_.program!==d,tileRatioChanged:a!==o.tileID.overscaledZ,isBorder:n,sourceCache:i}),a=o.tileID.overscaledZ,l=!1;}}function Vn(t){const i=t.painter,r=t.program,o=t.tile,s=t.layer,n=t.coord,a=t.bucket,l=t.programConfiguration,c=t.programChanged,h=t.tileRatioChanged,u=t.sourceCache,d=t.isBorder,_=i.context,m=_.gl,f=s.paint.get("line-dasharray"),p=s.paint.get("line-pattern"),g=s.getCrossfadeParameters();let v,x,y,T;if(m.uniform2fv(r.uniforms.currentFrustum,[i.transform.near,i.transform.far]),c||h){const t=1/hr(o,1,i.transform.tileZoom);if(l.setUniforms(i.context,r,s.paint,{zoom:i.transform.zoom}),f){v=i.lineAtlas.getDash(f.from,"round"===s.layout.get("line-cap")),x=i.lineAtlas.getDash(f.to,"round"===s.layout.get("line-cap"));const o=v.width*g.fromScale,n=x.width*g.toScale;m.uniform2f(r.uniforms.u_patternscale_a,t/o,-v.height/2),m.uniform2f(r.uniforms.u_patternscale_b,t/n,-x.height/2),m.uniform1f(r.uniforms.u_sdfgamma,i.lineAtlas.width/(256*Math.min(o,n)*e.exported.devicePixelRatio)/2);}else if(p){if(y=i.imageManager.getPattern(p.from),T=i.imageManager.getPattern(p.to),!y||!T)return;m.uniform2f(r.uniforms.u_pattern_size_a,y.displaySize[0]*g.fromScale/t,y.displaySize[1]),m.uniform2f(r.uniforms.u_pattern_size_b,T.displaySize[0]*g.toScale/t,T.displaySize[1]);const{width:e,height:o}=i.imageManager.getPixelSize();m.uniform2fv(r.uniforms.u_texsize,[e,o]);}m.uniform2f(r.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2);}if(c&&(m.uniform1f(r.uniforms.u_half_render,s.paint.get("half-render")),f?(m.uniform1i(r.uniforms.u_image,e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.INDEX),_.activeTexture.set(e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.VALUE),i.lineAtlas.bind(_),m.uniform1f(r.uniforms.u_tex_y_a,v.y),m.uniform1f(r.uniforms.u_tex_y_b,x.y),m.uniform1f(r.uniforms.u_mix,g.t)):p&&(m.uniform1i(r.uniforms.u_image,e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.INDEX),_.activeTexture.set(e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.VALUE),i.imageManager.bind(_),m.uniform2fv(r.uniforms.u_pattern_tl_a,y.tl),m.uniform2fv(r.uniforms.u_pattern_br_a,y.br),m.uniform2fv(r.uniforms.u_pattern_tl_b,T.tl),m.uniform2fv(r.uniforms.u_pattern_br_b,T.br),m.uniform1f(r.uniforms.u_fade,g.t))),m.uniform1f(r.uniforms.u_ratio,1/hr(o,1,i.transform.zoom)),s.paint.get("line-gradient")){const t=a.gradients[s.id];let o=t.texture;if(s.gradientVersion!==t.version){let r=256;if(s.stepInterpolant){const t=u.getSource().maxzoom,o=n.canonical.z===t?Math.ceil(1<<i.transform.maxZoom-n.canonical.z):1;r=e.clamp(e.nextPowerOfTwo(a.maxLineLength/e.EXTENT*1024*o),256,_.maxTextureSize);}t.gradient=e.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:r,image:t.gradient||void 0,clips:a.lineClipsArray}),t.texture?t.texture.update(t.gradient):t.texture=new e.Texture(_,t.gradient,m.RGBA),t.version=s.gradientVersion,o=t.texture;}_.activeTexture.set(e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.VALUE),o.bind(s.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE),m.uniform1i(r.uniforms.u_image,e.CONSTS.GL_CONST.PATTERN_TEXTURE_UNIT1.INDEX),m.uniform1f(r.uniforms.u_image_height,a.lineClipsArray.length);}const S=new e.Matrix2;S.scale([1,Math.cos(i.transform._pitch)]),S.rotate(i.transform.angle),m.uniformMatrix2fv(r.uniforms.u_pixel_matrix,!1,S.toFloat32Array());const b=i.transform.calculateVPMatrix(),w=new e.Matrix4(a.tilePlane.matrix);m.uniformMatrix4fv(r.uniforms.u_matrix,!1,b.multiplyRight(w).toFloat32Array()),m.uniform1f(r.uniforms.u_hasBorder,d?1:0),e.defined(s.classificationType)&&s.classificationType!=e.ClassificationType.NONE&&(_.setDepthMode(new e.DepthMode(m.LESS,e.DepthMode.ReadOnly,[0,1])),_.setColorMode(e.ColorMode.disabled),_.setCullFace(e.CullFaceMode.disabled),m.enable(m.STENCIL_TEST),m.stencilMask(255),m.stencilFunc(m.ALWAYS,0,255),m.stencilOpSeparate(m.FRONT,m.KEEP,m.DECR_WRAP,m.KEEP),m.stencilOpSeparate(m.BACK,m.KEEP,m.INCR_WRAP,m.KEEP),s.paint.get("line-gradient")?r.draw(_,m.TRIANGLES,s.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,l,a.layoutVertexBuffer2):r.draw(_,m.TRIANGLES,s.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,l),_.setDepthMode(e.DepthMode.disabled),m.stencilFunc(m.NOTEQUAL,0,255),m.stencilMask(255),m.stencilOpSeparate(m.FRONT,m.ZERO,m.ZERO,m.ZERO),m.stencilOpSeparate(m.BACK,m.ZERO,m.ZERO,m.ZERO)),_.setColorMode(e.ColorMode.alphaBlended),s.paint.get("line-gradient")?r.draw(_,m.TRIANGLES,s.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,l,a.layoutVertexBuffer2):r.draw(_,m.TRIANGLES,s.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,l),e.defined(s.classificationType)&&s.classificationType!=e.ClassificationType.NONE&&(_.setDepthMode(new e.DepthMode(_.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),_.gl.disable(_.gl.STENCIL_TEST));}function kn(t,i,r,o,s,n,a,l,c,h,u,d){const _=i.context,m=_.gl;(l||c)&&(a.setUniforms(i.context,t,s.paint,{zoom:i.transform.zoom}),m.uniform2f(t.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2)),m.uniform1f(t.uniforms.u_ratio,1/hr(r,1,i.transform.zoom));const f=new e.Matrix2;f.scale([1,Math.cos(i.transform._pitch)]),f.rotate(i.transform.angle),m.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,f.toFloat32Array()),m.uniformMatrix4fv(t.uniforms.u_matrix,!1,i.transform.calculateVPMatrix().multiplyRight(o.tilePlane.matrix).toFloat32Array()),m.uniform1f(t.uniforms.u_device_pixel_ratio,e.exported.devicePixelRatio),m.uniform1f(t.uniforms.u_start,h-u),m.uniform1f(t.uniforms.u_end,h),m.uniform1f(t.uniforms.u_segments,u),m.uniform1f(t.uniforms.u_discard,d),t.draw(_,m.TRIANGLES,s.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,a);}function Hn(e,t,i,r){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t.width,t.height,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),r.colorAttachment.set(i),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),Hn(e,t,i,r));}function Xn(t,i,r,o,s){const n=t.context,a=n.gl,l=t.useProgram(s?"collisionCircle":"collisionBox");n.setDepthMode(e.DepthMode.disabled),n.setStencilMode(e.StencilMode.disabled),n.setColorMode(t.colorModeForRenderPass());for(let e=0;e<o.length;e++){const c=o[e],h=i.getTile(c),u=h.getBucket(r);if(!u)continue;const d=s?u.collisionCircle:u.collisionBox;if(!d)continue;a.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(c.posMatrix)),a.uniform1f(l.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);const _=hr(h,1,t.transform.zoom),m=Math.pow(2,t.transform.zoom-h.tileID.overscaledZ);a.uniform1f(l.uniforms.u_pixels_to_tile_units,_),a.uniform2f(l.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(_*m),t.transform.pixelsToGLUnits[1]/(_*m)),a.uniform1f(l.uniforms.u_overscale_factor,h.tileID.overscaleFactor()),l.draw(n,s?a.TRIANGLES:a.LINES,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,null,d.collisionVertexBuffer,null);}}function jn(e,t,i,r){Xn(e,t,i,r,!1),Xn(e,t,i,r,!0);}const Yn=e.properties.layout;function Wn(t,i,r,o,s,n,a,l,c,h){const u=t.context,d=u.gl,_=t.transform,m="map"===l,f="map"===c,p=m&&"point"!==r.layout.get("symbol-placement"),g=m&&!f&&!p;let v,x=!1;for(const n of o){const o=i.getTile(n),a=o.getBucket(r);if(!a)continue;if(a.z<Math.floor(t.transform.zoom))continue;const l=s?a.text:a.icon;if(!l||!l.segments.get().length)continue;const c=l.programConfigurations.get(r.id),y=s||a.sdfIcons,T=s?a.textSizeData:a.iconSizeData;if(v||(v=t.useProgram(y?"sphereSymbolSDF":"sphereSymbolIcon",c),c.setUniforms(t.context,v,r.paint,{zoom:t.transform.zoom}),d.uniform2f(v.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2),qn({program:v,painter:t,layer:r,isText:s,rotateInShader:g,pitchWithMap:f,sizeData:T,rotateWithMap:m})),u.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),d.uniform1i(v.uniforms.u_texture,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),s)o.glyphAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.uniform2fv(v.uniforms.u_texsize,o.glyphAtlasTexture.size);else {const e=1!==r.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear,i=f||0!==_.pitch;o.imageAtlasTexture.bind(y||t.options.rotating||t.options.zooming||e||i?d.LINEAR:d.NEAREST,d.CLAMP_TO_EDGE),d.uniform2fv(v.uniforms.u_texsize,o.imageAtlasTexture.size);}const S=hr(o,1,t.transform.zoom);if(!n.posMatrix)throw new Error("layerid",r);const b=qi(n.posMatrix,f,m,t.transform,S),w=Zi(n.posMatrix,f,m,t.transform,S);if(p?(d.uniform1i(v.uniforms.u_along_line,!0),Ki(a,n.posMatrix,t,s,b,w,f,h)):d.uniform1i(v.uniforms.u_along_line,!1),d.uniform1f(v.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),!x){const i=new e.Matrix2;i.scale([1,Math.cos(t.transform._pitch)]),d.uniformMatrix2fv(v.uniforms.u_pitch_matrix,!1,i.toFloat32Array());const r=(new e.Matrix2).rotate(t.transform.angle);if(d.uniformMatrix2fv(v.uniforms.u_rot_matrix,!1,r.toFloat32Array()),g){const i=new e.Matrix4;i.scale([1,t.transform.width/t.transform.height,1]),i.rotateAxis(-t.transform.angle,[0,Math.sin(t.transform._pitch),Math.cos(t.transform._pitch)]),d.uniformMatrix4fv(v.uniforms.u_pitch_rot_matrix_1,!1,i.toFloat32Array());}else d.uniformMatrix2fv(v.uniforms.u_pitch_rot_matrix,!1,(new e.Matrix2).rotate(t.transform.angle).multiplyLeft(i).toFloat32Array());d.uniform1f(v.uniforms.u_bearing,-t.transform.angle),d.uniform3fv(v.uniforms.u_camPos,t.transform.getCameraPos()),d.uniform1f(v.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),d.uniformMatrix4fv(v.uniforms.u_symbol_mvp_matrix,!1,new Float32Array(t.transform.td_symbolMVPMatrix)),x=!0;}d.uniformMatrix4fv(v.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(a.tilePlane.matrix).toFloat32Array()),d.uniformMatrix4fv(v.uniforms.u_modelMatrix,!1,new Float32Array(a.tilePlane.matrix)),Zn(v,0,t,r,0,l,s,y);}}function qn(t){const i=t.painter.context.gl,r=t.painter.transform;i.uniform1i(t.program.uniforms.u_pitch_with_map,t.pitchWithMap),i.uniform1i(t.program.uniforms.u_is_text,t.isText),i.uniform1f(t.program.uniforms.u_pitch,r.pitch/360*2*Math.PI);const o="constant"===t.sizeData.functionType||"camera"===t.sizeData.functionType;i.uniform1i(t.program.uniforms.u_is_size_zoom_constant,"constant"===t.sizeData.functionType||"source"===t.sizeData.functionType?1:0),i.uniform1i(t.program.uniforms.u_is_size_feature_constant,o?1:0),i.uniform1f(t.program.uniforms.u_camera_to_center_distance,r.alt);const s=e.evaluateSizeForZoom(t.sizeData,r.zoom,Yn.properties[t.isText?"text-size":"icon-size"]);void 0!==s.uSizeT&&i.uniform1f(t.program.uniforms.u_size_t,s.uSizeT),void 0!==s.uSize&&i.uniform1f(t.program.uniforms.u_size,s.uSize),i.uniform1f(t.program.uniforms.u_aspect_ratio,r.width/r.height),i.uniform1i(t.program.uniforms.u_rotate_symbol,t.rotateInShader),i.uniform1i(t.program.uniforms.u_rotate_with_map,t.rotateWithMap);}function Zn(e,t,i,r,o,s,n,a){const l=i.context,c=l.gl;if(a){const t=0!==r.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1);c.uniform1f(e.uniforms.u_gamma_scale,1),t&&(c.uniform1i(e.uniforms.u_is_halo,!0),$n(s,r,l,e)),c.uniform1i(e.uniforms.u_is_halo,!1);}$n(s,r,l,e);}function $n(e,t,i,r){r.draw(i,i.gl.TRIANGLES,t.id,e.layoutVertexBuffer,e.indexBuffer,e.segments,e.programConfigurations.get(t.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer);}const Qn=new Nn(null),Kn=["sphereExtrusionPattern","sphereExtrusion","sphereExtrusionPatternShadow","sphereExtrusionShadow","sphereExtrusionPatternCameraView","sphereExtrusionCameraView"];function Jn(e,t,i,r,o,s){let n=!0;for(const a of r){const r=t.getTile(a),l=r.getBucket(i);l&&(ea(e,0,i,r,0,l,n,o,s),n=!1);}}function ea(t,i,r,o,s,n,a,l,c){const h=t.context,u=h.gl,d=function(e,t){return !1===e.style.sunLightFlag?(t.phongLight=!1,vn.getExtrusionMicroDefinition(t)):(t.phongLight=!0,vn.getExtrusionMicroDefinition(t))}(t,r),_=t.context.program.get(),m=n.programConfigurations.get(r.id),f=t.useProgram(l,m,d);(a||f.program!==_)&&m.setUniforms(h,f,r.paint,{zoom:t.transform.zoom}),u.uniform2fv(f.uniforms.currentFrustum,[t.transform.near,t.transform.far]);const p=r.radiationRegions;for(let e=0;e<1;e++){const i=p[e];i?(u.uniform1i(f.uniforms[`u_regions[${e}].use`],!0),u.uniform4fv(f.uniforms[`u_regions[${e}].pos`],i.geo),u.uniform1i(f.uniforms[`u_regions[${e}].scan`],!1),u.uniform1i(f.uniforms[`u_regions[${e}].line`],!1),u.uniform1f(f.uniforms[`u_regions[${e}].percent`],t._map.timer.counter/i.speed%1),i.scan?(u.uniform1i(f.uniforms[`u_regions[${e}].scan`],!0),u.uniform3fv(f.uniforms[`u_regions[${e}].north`],i.north),u.uniform3fv(f.uniforms[`u_regions[${e}].cross`],i.cross)):i.line&&(u.uniform1i(f.uniforms[`u_regions[${e}].line`],!0),u.uniform3fv(f.uniforms[`u_regions[${e}].loc`],i.location),u.uniform1i(f.uniforms[`u_regions[${e}].vdir`],i.dirV))):u.uniform1i(f.uniforms[`u_regions[${e}].use`],!1);}const g=new e.EvaluationParameters(t.transform.zoom).getCrossfadeParameters();if(c){if(In(c,t))return;On(c,t,f,g),Dn(o,t,f),r.hasOwnProperty("patternZoomOffset")?u.uniform1f(f.uniforms.u_zoom,t.transform.zoom-17+r.patternZoomOffset):u.uniform1f(f.uniforms.u_zoom,0);const i=r.paint.get("extrusion-top-pattern");i&&function(t,i,r){const o=i.gl,s=Qn.getTexture(t.to);return s?(i.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),s.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.uniform1i(r.uniforms.u_image_top,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),!0):(Qn.addTexture(t.to,t.to,i,{requestImages:0}),!1)}(i,h,f)?u.uniform1i(f.uniforms.u_top_tex_rend,!0):u.uniform1i(f.uniforms.u_top_tex_rend,!1);}const v=t.transform,x=t.cameraDrawMode,y=t.activeCameras,T=new e.Matrix4(n.matrix);if(u.uniform1f(f.uniforms.u_viewshed_count,0),x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){const i=t.fbManager.shadowFramebuffer;i&&(h.activeTexture.set(e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT1.VALUE),u.bindTexture(u.TEXTURE_2D,i.colorAttachment.get()),u.uniform1i(f.uniforms.u_shadow_sampler,e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT1.INDEX)),u.uniform1f(f.uniforms.u_shadow_off,t.shadowOff);}if(r.viewshedRender&&(x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL)){const i=y.viewshed[0].fb;i&&(h.activeTexture.set(e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT2.VALUE),u.bindTexture(u.TEXTURE_2D,i.colorAttachment.get()),u.uniform1i(f.uniforms.u_viewshed_samp0,e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT2.INDEX)),u.uniform1f(f.uniforms.u_shadow_off,t.shadowOff),u.uniform1f(f.uniforms.u_viewshed_count,1);}let S;const b=e.createFloat64ArrayIdentityMatrix();let w,E;if(x!==e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN&&x!==e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||(w=v._center.toArray(),E=t._map.sunLight._shadowSunPosition({target:w,distance:v.alt*e.CONSTS.TRANSFORM.R_ZOOM})),!t.depthPick)if(x===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow.type&&(S||(T.multiplyLeft(v.calculateVPMatrix(E)),S=T.clone(),u.uniformMatrix4fv(f.uniforms.u_matrix,!1,S.toFloat32Array())));else if(x===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)S||(T.multiplyLeft(v.calculateVPMatrix(y.viewshed[0])),S=T.clone(),u.uniformMatrix4fv(f.uniforms.u_matrix,!1,S.toFloat32Array()));else if(x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow.type?(u.uniform1i(f.uniforms.u_with_shadow,!0),b.multiplyLeft(v.calculateVPMatrix(E))):u.uniform1i(f.uniforms.u_with_shadow,!1),u.uniformMatrix4fv(f.uniforms.u_sun_matrix,!1,b.toFloat32Array());else if(x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){const e=v.calculateVPMatrix(y.viewshed[0]).multiplyRight(T);u.uniformMatrix4fv(f.uniforms.u_viewshed_mat0,!1,e.toFloat32Array()),u.uniform3fv(f.uniforms.u_viewshed_eye0,v._lastSunLightStatus.geographic),u.uniform1f(f.uniforms.u_viewshed_dist0,y.viewshed[0]&&y.viewshed[0].farDistance||0),u.uniform1i(f.uniforms.u_viewshed_used0,!0);}else if(x===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow.type?(u.uniform1i(f.uniforms.u_with_shadow,!0),b.copy(v.calculateVPMatrix(E).multiplyRight(T))):u.uniform1i(f.uniforms.u_with_shadow,!1),u.uniformMatrix4fv(f.uniforms.u_sun_matrix,!1,b.toFloat32Array());const e=v.calculateVPMatrix(y.viewshed[0]).multiplyRight(T);u.uniformMatrix4fv(f.uniforms.u_viewshed_mat0,!1,e.toFloat32Array()),u.uniform3fv(f.uniforms.u_viewshed_eye0,v._lastSunLightStatus.geographic),u.uniform1f(f.uniforms.u_viewshed_dist0,y.viewshed[0]&&y.viewshed[0].farDistance||0),u.uniform1i(f.uniforms.u_viewshed_used0,!0);}if(!S){const t=v.calculateVPMatrix().multiplyRight(T);if(u.uniformMatrix4fv(f.uniforms.u_matrix,!1,t.toFloat32Array()),!n.normalMatrix){const t=new e.Matrix4(n.matrix).invert();n.normalMatrix=t.transpose().toArray();}u.uniformMatrix4fv(f.uniforms.u_normal,!1,new Float32Array(n.normalMatrix)),u.uniformMatrix4fv(f.uniforms.u_model,!1,new Float32Array(n.matrix));}const M=r.paint.get("extrusion-self-bloom");if(M){const e=r.paint.get("extrusion-glow-pure-color-height"),i=r.paint.get("extrusion-glow-width"),o=r.paint.get("extrusion-glow-speed"),s=r.paint.get("extrusion-bloom-height");if(s<=0)throw new Error("extrusion-bloom-height cannot be less than zero");if(o<=0)throw new Error("extrusion-glow-fps cannot be less than zero");u.uniform1f(f.uniforms.u_bloom_height,s),u.uniform1f(f.uniforms.u_time,t.timer.counter),u.uniform1f(f.uniforms.u_bloom_speed,1/o*s),u.uniform1f(f.uniforms.u_self_bloom,M),u.uniform1f(f.uniforms.uPureColorHeight,e),u.uniform1f(f.uniforms.uGlowWidth,i);}!function(e,t,i,r){_n.setPhongLightUniform({painter:t,program:e,layer:r});}(f,t,0,r),f.draw(h,u.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,m);}let ta=20;function ia(t){const i=t.painter,r=t.program,o=t.tile,s=t.layer,n=t.bucket,a=t.programConfiguration,l=t.programChanged,c=t.count,h=t.segmentGroup,u=i.context,d=u.gl;(l||t.tileRatioChanged)&&(a.setUniforms(i.context,r,s.paint,{zoom:i.transform.zoom}),d.uniform2f(r.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2)),l&&d.uniform1f(r.uniforms.u_half_render,s.paint.get("half-render")),d.uniform1f(r.uniforms.u_ratio,1/hr(o,1,i.transform.zoom));const _=new e.Matrix2;_.scale([1,Math.cos(i.transform._pitch)]),_.rotate(i.transform.angle),d.uniformMatrix2fv(r.uniforms.u_pixel_matrix,!1,_.toFloat32Array()),d.uniformMatrix4fv(r.uniforms.u_matrix,!1,i.transform.calculateVPMatrix().multiplyRight(n.tilePlane.matrix).toFloat32Array()),d.uniform1f(r.uniforms.u_count,c),d.uniform1f(r.uniforms.u_segments,h),r.draw(u,d.TRIANGLES,s.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,a);}function ra(t,i,r,o,s,n,a,l,c,h,u,d,_){const m=i.context,f=m.gl;(l||c)&&(a.setUniforms(i.context,t,s.paint,{zoom:i.transform.zoom}),f.uniform2f(t.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2)),f.uniform1f(t.uniforms.u_ratio,1/hr(r,1,i.transform.zoom));const p=new e.Matrix2;p.scale([1,Math.cos(i.transform._pitch)]),p.rotate(i.transform.angle),f.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,p.toFloat32Array()),f.uniformMatrix4fv(t.uniforms.u_matrix,!1,i.transform.calculateVPMatrix().multiplyRight(o.tilePlane.matrix).toFloat32Array()),f.uniform1f(t.uniforms.u_start,h-_),f.uniform1f(t.uniforms.u_end,h),f.uniform1f(t.uniforms.u_segments,_),f.uniform1i(t.uniforms.u_reverse,u),f.uniform1i(t.uniforms.u_reserve,d),t.draw(m,f.TRIANGLES,s.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,a);}function oa(t,i,r,o,s,n,a,l){const c=t.context,h=c.gl,u=t.context.program.get(),d=t.useProgram("sphereSprite",a),_=n||d.program!==u,m=l!==i.tileID.overscaledZ;_&&a.setUniforms(t.context,d,o.paint,{zoom:t.transform.zoom}),(_||m)&&h.uniform2f(d.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);const f=new e.Matrix2;f.scale([1,Math.cos(t.transform._pitch)]),f.rotate(t.transform.angle),h.uniformMatrix2fv(d.uniforms.u_pixel_matrix,!1,f.toFloat32Array()),h.uniform1f(d.uniforms.u_count,o.count),h.uniformMatrix4fv(d.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(r.tilePlane.matrix).toFloat32Array()),h.uniform1f(d.uniforms.u_ratio,1/hr(i,1,t.transform.zoom)),d.draw(c,h.TRIANGLES,o.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,a);}const sa=e.Color.parse("#ffffff"),na=e.Color.parse("#333333");class aa{constructor(){this._cameraContainer={},this._sunLightCamera=this.addCameraView(e.CONSTS.CAMERA.SUNLIGHT_CAMERA_ID,{});}addCameraView(t,i){if(this._cameraContainer[t])throw Error("你已经添加过相同id的相机视图了");{let r,o=i.farDistance||100;o*=e.CONSTS.TRANSFORM.R_SCALE,i.location&&(r=i.location.slice(0,2));const s={pitch:i.pitch||30,bearing:i.bearing||0,active:i.active||!1,farDistance:o,hFov:i.hFov||60,wFov:i.wFov||60,location:r,altitude:i.altitude||0,color:i.color||[sa.r,sa.g,sa.b],shadowColor:i.shadowColor||[na.r,na.g,na.b],id:t,fb:null,viewshedWithLine:!!i.viewshedWithLine,useCustomView:!!i.useCustomView};return this._cameraContainer[t]=s,s}}static createACameraView(t){let i,r=t.farDistance||100;return r*=e.CONSTS.TRANSFORM.R_SCALE,t.location&&(i=t.location.slice(0,2)),{pitch:t.pitch||30,bearing:t.bearing||0,active:t.active||!1,farDistance:r,hFov:t.hFov||60,wFov:t.wFov||60,location:i,altitude:t.altitude||0,color:t.color||[sa.r,sa.g,sa.b],shadowColor:t.shadowColor||[na.r,na.g,na.b],id:t.id,fb:null,useCustomView:t.useCustomView}}deleteCameraView(e){this._cameraContainer[e]=null,delete this._cameraContainer[e];}getCameraView(e){return this._cameraContainer[e]}openCameraView(e){return !!this._cameraContainer[e]&&(this._cameraContainer[e].active=!0,!0)}closeCameraView(e){return !!this._cameraContainer[e]&&(this._cameraContainer[e].active=!1,!0)}getAllCameraViews(){return this._cameraContainer}getAllActiveCameraViews(){const t={shadow:null,viewshed:[]};for(const i in this._cameraContainer)this._cameraContainer[i]&&this._cameraContainer[i].active&&(i===e.CONSTS.CAMERA.SUNLIGHT_CAMERA_ID?t.shadow=this._cameraContainer[i]:t.viewshed.push(this._cameraContainer[i]));return t}modifyCameraViewById(t,i){if(this._cameraContainer[t])for(const r in i)if(i[r]||0===i[r])if("color"===r||"shadowColor"===r){if("string"==typeof i[r]){const o=e.Color.parse(i[r]);o&&this._cameraContainer[t]&&(this._cameraContainer[t][r]=[o.r,o.g,o.b]);}}else "farDistance"===r?"number"==typeof i[r]&&(this._cameraContainer[t][r]=i[r]*e.CONSTS.TRANSFORM.R_SCALE):this._cameraContainer[t][r]="location"===r&&i[r]?i[r].slice(0,2):i[r];}modifyCameraViewGroup(e){for(const t in e)this.modifyCameraViewById(t,e[t]);}}function la(t,i,r,o,s,n,a,l){n.bindFramebuffer.set(r||null),n.activeTexture.set(e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.VALUE),a.bindTexture(a.TEXTURE_2D,i.colorAttachment.get()),a.uniform1i(s.uniforms.u_image,e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.INDEX);const c=new e.Matrix4;c.ortho({left:0,right:t.width,bottom:t.height,top:0,near:0,far:1}),a.uniformMatrix4fv(s.uniforms.u_matrix,!1,c.toFloat32Array()),a.uniform2fv(s.uniforms.u_dir,o),a.uniform1f(s.uniforms.u_extent,l||2),a.uniform2fv(s.uniforms.u_resolution,[1/t.width,1/t.height]),a.uniform2f(s.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(n,s,t.viewportBuffer,[]),a.drawArrays(a.TRIANGLE_STRIP,0,4);}class ca{static updateAnimation(e){const{nodes:t,animationMixers:i,skins:r,context:o,program:s,nodeStructure:n}=e,a=o.gl;if(i&&0!==i.length)for(let e=0;e<i.length;e++){const l=i[e];if(l.update(Date.now()),r&&0!==r.length)ca.updateSkin({animationMixer:l,nodes:t,skins:r,context:o,program:s});else {a.uniform1i(s.uniforms.u_has_skinning,!1);for(let e=0;e<t.length;e++)t[e].worldsMatrix=null;const e=l.getMorphAnimation();e?a.uniform2fv(s.uniforms.u_morphTargetInfluences,1===e.value.length?[e.value[0],0]:e.value.slice(0,2)):n&&this.updateNodeStructureMatrix(n,t,l);}}else a.uniform1i(s.uniforms.u_has_skinning,!1);}static updateNodeStructureMatrix(t,i,r){t.forEach((t=>{const o=t.nodeInd,s=t.parentId,n=i[o],a=s?i[s].worldsMatrix||i[s].matrix:new e.Matrix4,l=r.applyAnimationByNodeId(o);n.matrix=l.anim?a.clone().multiplyRight(l.anim):a.clone().multiplyRight(n.localMatrix),n.worldsMatrix=n.matrix,t.hasOwnProperty("children")&&ca.updateNodeStructureMatrix(t.children,i,r);}));}static updateSkin(e){const{nodes:t,animationMixer:i,skins:r,context:o,program:s}=e;for(let e=0;e<t.length;e++)t[e].worldsMatrix=null;const n=o.gl,a=r[0];ca.getWorldMatrixOfSkin(t,a.skeleton,i),n.uniform1i(s.uniforms.u_has_skinning,!0);for(let e=0;e<a.count;e++){const i=t[a.joints[e]],r=t[a.meshInd].matrix.clone().invert().multiplyRight(i.worldsMatrix).multiplyRight(a.inverseBindMatrices.slice(16*e,16*(e+1)));n.uniformMatrix4fv(s.uniforms[`u_jointMatrix[${e}].m`],!1,r.toFloat32Array());}}static getWorldMatrixOfSkin(t,i,r){const o=t[i],s=r.applyAnimationByNodeId(o.nodeInd);if(e.defined(o.parentId)){const i=t[o.parentId];i.worldsMatrix||(i.worldsMatrix=i.matrix||e.createFloat64ArrayIdentityMatrix()),o.worldsMatrix=i.worldsMatrix.clone();}else o.worldsMatrix=o.matrix||e.createFloat64ArrayIdentityMatrix();s.anim&&o.worldsMatrix.multiplyRight(s.anim),e.defined(o.children)&&o.children.forEach((e=>{ca.getWorldMatrixOfSkin(t,e,r);}));}static setAnimation(e){const{animations:t,painter:i,context:r,program:o,modelMatrix:s,nodeMatrix:n,animation:a}=e,{gl:l}=r,{count:c,input:h,output:u}=t[a.ani];s.multiplyRight(n);const d=i._map.timer.counter%h[c-1];let _=0,m=0,f=0;for(let e=0;e<c-1;e++)if(d>=h[e]&&d<=h[e+1]){_=e,m=e+1,f=(d-h[e])/(h[e+1]-h[e]);break}{const e=u.length/h.length,t=[];for(let i=0;i<e;i++)t.push(u[_*e+i]*(1-f)+u[m*e+i]*f),l.uniform1f(o.uniforms[`u_weight${i}`],u[_*e+i]*(1-f)+u[m*e+i]*f);}}reset(){}destroy(){}}class ha{constructor(){this.reset();}reset(){this.state={setted:!1};}setUniforms(e){const{program:t,source:i,context:r,isClamp:o}=e,{gl:s}=r;o&&(i.clampPlane?s.uniform4fv(t.uniforms.u_clamp_plane,i.clampPlane):i.clampBox?(s.uniform3fv(t.uniforms.u_clamp_box,[i.clampBox.x,i.clampBox.y,i.clampBox.z]),s.uniform1i(t.uniforms.u_clamp_box_inner,i.clampBox.inner),s.uniformMatrix4fv(t.uniforms.u_clamp_matrix,!1,i.clampBoxMatrix.toFloat32Array())):i.clampRange&&(s.uniform3fv(t.uniforms.u_min_clamp_bounds,i.minClampBounds),s.uniform3fv(t.uniforms.u_max_clamp_bounds,i.maxClampBounds),s.uniform2fv(t.uniforms.u_x_clamp_range,i.ratioRange[0]),s.uniform2fv(t.uniforms.u_y_clamp_range,i.ratioRange[1]),s.uniform2fv(t.uniforms.u_z_clamp_range,i.ratioRange[2])));}}class ua{constructor(){}static setUniformForScene(t,i){const{painter:r,program:o,context:s,layer:n}=t,{gl:a}=s,l=r.cameraDrawMode,c=r._map.directionLightParameter,h=o.textureUnitManager,u=r.activeCameras;if(n.viewshedRender&&(l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL)){a.uniform1i(o.uniforms.u_OpenViewshed,(null==n.showViewshedColor||null==n.showViewshedColor||0!=n.showViewshedColor)&&"visual_domain_analysis_layer"!=n.id),0!=c.mViewshedVisibleColor.lengthSquared()?a.uniform3fv(o.uniforms.u_viewshedVisibleColor,c.mViewshedVisibleColor.toFloat32Array()):a.uniform3fv(o.uniforms.u_viewshedVisibleColor,c.mViewshedVisibleDefaultColor.toFloat32Array()),0!=c.mViewshedInVisibleColor.lengthSquared()?a.uniform3fv(o.uniforms.u_viewshedInVisibleColor,c.mViewshedInVisibleColor.toFloat32Array()):a.uniform3fv(o.uniforms.u_viewshedInVisibleColor,c.mViewshedInVisibleDefaultColor.toFloat32Array());const e=u.viewshed[0].fb;c.viewshedFBO=e;const t=h.getOneUnit();e&&(i.needBackUpTextureUnitManager=!0,s.activeTexture.set(t.VALUE),a.bindTexture(a.TEXTURE_2D,e.colorAttachment.get()),a.uniform1i(o.uniforms.u_viewshed_samp0,t.INDEX)),a.uniform1f(o.uniforms.u_shadow_off,r.shadowOff),a.uniform1f(o.uniforms.u_viewshed_count,1);}}static setUniformForNode(t){const{painter:i,program:r,context:o,modelMatrix:s,transform:n}=t,{gl:a}=o,l=i.cameraDrawMode,c=i.activeCameras;if(l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){const e=n.calculateVPMatrix(c.viewshed[0]).multiplyRight(s);a.uniformMatrix4fv(r.uniforms.u_viewshed_mat0,!1,e.toFloat32Array()),a.uniform3fv(r.uniforms.u_viewshed_eye0,n._lastSunLightStatus.geographic),a.uniform1f(r.uniforms.u_viewshed_dist0,c.viewshed[0]&&c.viewshed[0].farDistance||0),a.uniform1i(r.uniforms.u_viewshed_used0,!0);}}static setUniformForPrimitive(e){}}class da{constructor(){}static setUniformForScene(t,i){const{painter:r,program:o,context:s,layer:n,modelTranslateMatrix:a}=t,{gl:l}=s,c=r.cameraDrawMode,h=o.textureUnitManager;if(c===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||c===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){!function(e,t,i,r,o,s,n){n&&(e.uniform1i(r.uniforms.u_EnableShadowCenter,o.mShadowCenterMode),e.uniform1i(r.uniforms.u_LayerEnableSM,o.mCurShadowLayer==n));const a=o.mSceneLightDir3.clone();a.normalize(),e.uniform3fv(r.uniforms.u_SceneLightDir3,a.toFloat32Array()),e.uniform1f(r.uniforms.u_shadow_off,o.shadowOff),e.uniform1f(r.uniforms.gMapSizeInv,.5*t.mShadowEffect.mSMFBO.mSMSizeInv*o.shadowMapInvScale),e.uniformMatrix4fv(r.uniforms.u_Geo_matrix,!1,i.toFloat32Array()),e.uniform4fv(r.uniforms.u_ShadowCenter,[o.mShadowCenter[0],o.mShadowCenter[1],o.mShadowCenter[2],o.mShadowRadius]);const l=t.mShadowEffect.mSMFBO.mSMMatrixArray[0].m_mvpMatrix.toFloat32Array();e.uniformMatrix4fv(r.uniforms.u_sun_matrix,!1,l);}(l,r,a,o,r._map.directionLightParameter,0,n);const e=r.mShadowEffect.mSMFBO.mSMArray[0],t=h.getOneUnit();e&&(i.needBackUpTextureUnitManager=!0,s.activeTexture.set(t.VALUE),l.bindTexture(l.TEXTURE_2D,e.colorAttachment.get()),l.uniform1i(o.uniforms.u_shadow_sampler,t.INDEX));}}static setUniformForNode(t){const{painter:i,program:r,context:o,modelMatrix:s,oneNode:n}=t,{gl:a}=o,l=i.cameraDrawMode;l!==e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW&&l!==e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL||yn(a,n,r,s);}static setUniformForPrimitive(e){}}const _a=["gltfPBR"],ma=["gltfPBR","gltfPBRI3DM"];function fa(t){const{painter:i,source:r,tile:o,program:s,transform:n,layer:a,context:l,modelTranslateMatrix:c,tileMatrix:h,clampTranslateMatrix:u,setters:d,textureMangeBackUp:_,videoSource:m,useVideo:f}=t,{gl:p}=l,g=i._map.directionLightParameter;for(let t=0;t<o.nodes.length;t++){const v=o.nodes[t];if(!v.hasOwnProperty("mesh"))continue;if(!v.primitiveStack)continue;const x=c.clone(),y=r._clampEnabled?u.clone():new e.Matrix4;v.identityMatrix||(x.multiplyRight(v.matrix),r._clampEnabled&&y.multiplyRight(v.matrix)),p.uniformMatrix4fv(s.uniforms.u_clamp_model_matrix,!1,y.toFloat32Array()),mn.setUniformForNode({painter:i,program:s,context:l,modelMatrix:x,transform:n,layer:a}),i.depthPick||(da.setUniformForNode({painter:i,program:s,context:l,modelMatrix:h,transform:n,oneNode:v}),ua.setUniformForNode({painter:i,program:s,context:l,modelMatrix:x,transform:n}));const T=x.multiplyLeft(n.calculateVPMatrix());p.uniformMatrix4fv(s.uniforms.u_matrix,!1,T.toFloat32Array());for(let n=0;n<v.primitiveStack.length;n++){s.textureUnitManager.reset(),_&&(s.textureUnitManager=mi.copy(_,l)),f&&m.uploadTexture(i,s);const c=o.primitives[v.primitiveStack[n].primitiveInd],h=o.materials.filter((e=>e.id===c.material.id));h.length||console.warn(`warn: ${o.tileID} materials[${c.primitiveInd}] is ${h[0]}`),d.morphSetter.setUniforms({program:s,context:l,isSkinModel:c.isSkinModel}),d.highLightSetter.setUniforms({program:s,context:l,highlightFlag:o.nodes[t].primitiveStack[n].highlight,highLightColors:a.highLightColors,highLightColorsIndex:a.highLightColorsIndex}),mn.setUniformForPrimitive({layer:a,painter:i,textures:o.textures,u_HAS_TANGENTS:c.u_HAS_TANGENTS,u_HAS_NORMALS:c.u_HAS_NORMALS,context:l,program:s,mat:h[0],samplers:o.samplers,isTrafficLight:!1,trafficLightOptions:null,useTextureMatrix:o.useTextureMatrix}),m&&m._videoMatchOptions.length>0&&l.setColorMode(new e.ColorMode([p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),Ht(c,r.gltfModelVAO,l,s,r._options.debug),g.mCurNodeCountRender++;}}}function pa(e,t,i){const r=e.context,o=r.gl,s=e.useProgram("debug"),n=e.debugTileCache.getTileByCoord(i);e.debugTileCache.debugVAO.bind(r,s,n.debugBuffer,[]),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,e.transform.calculateVPMatrix().multiplyRight(n.matrix).toFloat32Array()),o.uniform4f(s.uniforms.u_color,1,0,0,1),o.drawArrays(o.LINE_STRIP,0,n.lineVerticesCount),o.uniform4f(s.uniforms.u_color,0,0,0,1),o.drawArrays(o.LINES,n.lineVerticesCount,n.textVerticesCount);}class ga{constructor(t,i,r){this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this.max=t,i&&(this.onRemove=i),this._projection=r||e.ProjectionType.MERCATOR,this.reset();}reset(){if(this.onRemove)for(const e in this.data)this.onRemove(e);return this.data={},this.poleData={},this.poleVectorData={},this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this}get projection(){return this._projection}set projection(e){this._projection!==e&&(this._projection=e,this.reset());}has(e){return e.wrapped().key in this.data}hasPole(e){return !!this.poleData[e]}hasVectorPole(e){return !!this.poleVectorData[e]}_addATerrainTile(t,i){const r=new e.SegmentVector,o=new e.StructArrayLayout5f20,s=new e.StructArrayLayout3ui6;r.prepareSegment(0,o,s);const n=e.CONSTS.TILE.EXTENT,a=t.canonical.x,l=t.canonical.y;let c=2;c=64/Math.pow(2,t.overscaledZ),c<e.CONSTS.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(c=e.CONSTS.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);const h=[],u=n/c,d=t.overscaledZ;let _=[],m=[];for(let e=0;e<c;e++){const t=r.prepareSegment(4*(c+1),o,s);this._xyToGeographic(h,0,e*u,d,a,l),0===_.length&&(_=h.slice(0),m=this._xyToLngLat(0,e*u,d,a,l)),o.emplaceBack(h[0]-_[0],h[1]-_[1],h[2]-_[2],0,e*u),this._xyToGeographic(h,0,(e+1)*u,d,a,l),o.emplaceBack(h[0]-_[0],h[1]-_[1],h[2]-_[2],0,(e+1)*u),t.vertexLength+=2;for(let i=1;i<=c;i++){this._xyToGeographic(h,i*u,e*u,d,a,l),o.emplaceBack(h[0]-_[0],h[1]-_[1],h[2]-_[2],i*u,e*u),this._xyToGeographic(h,i*u,(e+1)*u,d,a,l),o.emplaceBack(h[0]-_[0],h[1]-_[1],h[2]-_[2],i*u,(e+1)*u);const r=t.vertexLength;s.emplaceBack(r-2,r-1,r),s.emplaceBack(r,r-1,r+1),t.vertexLength+=2,t.primitiveLength+=2;}}return this.data[t.wrapped().key]={rtc:_,sphereSegments:r,sphereMaskedBoundsBuffer:i.createVertexBuffer(o,e.sphereRasterBoundsAttributes.members),sphereMaskedIndexBuffer:i.createIndexBuffer(s),matrix:e.calc3dVectorTileTranslateMatrix(m,_)},this.data[t.wrapped().key]}_addARasterPoleTerrainTile(t,i,r){const o=new e.SegmentVector,s=new e.StructArrayLayout5f20,n=new e.StructArrayLayout3ui6;o.prepareSegment(0,s,n);const a=e.CONSTS.TILE.EXTENT,l=r.canonical.x,c=r.canonical.y,h=[85.05112877980659,-85.05112877980659],u=[],d=a/128,_=i?(90-h[0])/1:-(90-h[0])/1,m=r.overscaledZ,f=360/Math.pow(2,m),p=f*r.canonical.x-180,g=Math.abs(f*(r.canonical.x+1)-180-p)/128;let v=[],x=[];for(let t=0;t<1;t++){const r=i?h[0]+(t+1)*_:h[1]+t*_,f=i?h[0]+t*_:h[1]+(t+1)*_,y=o.prepareSegment(516,s,n);this._xyToGeographic(u,0,i?0:a,m,l,c),0===v.length&&(v=u.slice(0),x=this._xyToLngLat(0,i?0:a,m,l,c)),e.transformECEFToGeographic(u,[p,r],e.CONSTS.TRANSFORM.R),s.emplaceBack(u[0]-v[0],u[1]-v[1],u[2]-v[2],0,t*d),e.transformECEFToGeographic(u,[p,f],e.CONSTS.TRANSFORM.R),s.emplaceBack(u[0]-v[0],u[1]-v[1],u[2]-v[2],0,(t+1)*d),y.vertexLength+=2;for(let i=1;i<=128;i++){e.transformECEFToGeographic(u,[p+i*g,r],e.CONSTS.TRANSFORM.R),s.emplaceBack(u[0]-v[0],u[1]-v[1],u[2]-v[2],i*d,t*d),e.transformECEFToGeographic(u,[p+i*g,f],e.CONSTS.TRANSFORM.R),s.emplaceBack(u[0]-v[0],u[1]-v[1],u[2]-v[2],i*d,(t+1)*d);const o=y.vertexLength;n.emplaceBack(o-2,o-1,o),n.emplaceBack(o,o-1,o+1),y.vertexLength+=2,y.primitiveLength+=2;}}return this.poleData[r.wrapped().key]={rtc:v,sphereSegments:o,sphereMaskedBoundsBuffer:t.createVertexBuffer(s,e.sphereRasterBoundsAttributes.members),sphereMaskedIndexBuffer:t.createIndexBuffer(n),matrix:e.calc3dVectorTileTranslateMatrix(x,v)},this.poleData[r.wrapped().key]}_xyToGeographic(t,i,r,o,s,n){const a=e.getSpherePos(i,r,0,s,n,o,this.projection);t[0]=a[0],t[1]=a[1],t[2]=a[2];}_xyToLngLat(t,i,r,o,s){return e.xyToLngLat(t,i,0,o,s,r,this.projection)}get(e,t,i){return this.has(e)?(this.order.splice(this.order.indexOf(e.wrapped().key),1),this.order.push(e.wrapped().key),this.data[e.wrapped().key]):(this.order.push(e.wrapped().key),this._addATerrainTile(e,t))}getPole(e,t,i){const r=i.wrapped().key;return this.hasPole(r)?(this.orderOfPole.splice(this.orderOfPole.indexOf(r),1),this.orderOfPole.push(r),this.poleData[r]):(this.orderOfPole.push(r),this._addARasterPoleTerrainTile(e,t,i))}remove(e){return this.data[e]?(this.onRemove&&this.onRemove(this.data[e]),delete this.data[e],this.order.splice(this.order.indexOf(e),1),this):this}setMaxSize(e){for(this.max=e;this.order.length>this.max;)this.remove(this.order[0]);return this}updateCacheSize(e){const t=Math.ceil(e.width/256)+1,i=Math.ceil(e.height/256)+1,r=2*Math.floor(t*i*5);for(this.max=r;this.order.length>this.max;)this.remove(this.order[0]);return this}}function va(t,i,r){const o=i;if(!o)return;t.context.bindFramebuffer.set(r?r.framebuffer:null);const s=t.context,n=s.gl,a=t.useProgram("fxaaFlsify");s.setDepthMode(e.DepthMode.disabled),s.activeTexture.set(e.CONSTS.GL_CONST.FXAA_TEXTURE_UNIT1.VALUE),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),n.uniform1i(a.uniforms.u_image,e.CONSTS.GL_CONST.FXAA_TEXTURE_UNIT1.INDEX);const l=new e.Matrix4;l.ortho({left:0,right:t.width,bottom:t.height,top:0,near:0,far:1}),n.uniformMatrix4fv(a.uniforms.u_matrix,!1,l.toFloat32Array()),n.uniform2fv(a.uniforms.u_resolution,[t.width,t.height]),n.uniform2f(a.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(s,a,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4);}const xa=["bloomBrightFilter","bloomBlur","bloomBlend","screen"];function ya(t,i,r,o,s,n){const a=i;if(!a)return;const l=t.context,c=l.gl;t.context.bindFramebuffer.set(r?r.framebuffer:null);const h=t.useProgram(o);xa[2]===o?(l.activeTexture.set(e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.VALUE),c.bindTexture(c.TEXTURE_2D,n.colorAttachment.get()),c.uniform1i(h.uniforms.u_base,e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.INDEX),l.activeTexture.set(e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT2.VALUE),c.bindTexture(c.TEXTURE_2D,a.colorAttachment.get()),c.uniform1i(h.uniforms.u_over,e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT2.INDEX)):(l.activeTexture.set(e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.VALUE),c.bindTexture(c.TEXTURE_2D,a.colorAttachment.get()),c.uniform1i(h.uniforms.u_image,e.CONSTS.GL_CONST.BLUR_TEXTURE_UNIT1.INDEX));const u=new e.Matrix4;u.ortho({left:0,right:t.width,bottom:t.height,top:0,near:0,far:1}),c.uniformMatrix4fv(h.uniforms.u_matrix,!1,u.toFloat32Array()),c.uniform2fv(h.uniforms.u_dir,s),c.uniform1f(h.uniforms.u_extent,t._map._bloomOptions.extent),c.uniform2fv(h.uniforms.u_resolution,[1/t.width,1/t.height]),c.uniform2f(h.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(l,h,t.viewportBuffer,[]),c.drawArrays(c.TRIANGLE_STRIP,0,4);}const Ta=["sphereHistogramColor","sphereHistogram","sphereHistogramPatternShadow","sphereHistogramShadow","sphereHistogramPatternCameraView","sphereHistogramCameraView"];function Sa(t,i,r,o,s,n,a,l){const c=t.context,h=c.gl,u=r.layout.get("histogram-color-render"),d=t.context.program.get(),_=n.programConfigurations.get(r.id);let m=null;if(m=t.useProgram(u?"sphereHistogramColor":l,_),(a||m.program!==d)&&_.setUniforms(c,m,r.paint,{zoom:t.transform.zoom}),u){const t=r.paint.get("histogram-colors"),i=[];for(let r=0;r<t.length;r++){const o=e.parseCSSColor(t[r]);o[0]/=255,o[1]/=255,o[2]/=255,i.push(o);}h.uniform4fv(m.uniforms.u_color_a,i[0]),h.uniform4fv(m.uniforms.u_color_b,i[1]),h.uniform4fv(m.uniforms.u_color_c,i[2]),h.uniform4fv(m.uniforms.u_color_d,i[3]),h.uniform4fv(m.uniforms.u_color_e,i[4]);}const f=t.transform,p=t.cameraDrawMode,g=t.activeCameras,v=new e.Matrix4(n.matrix);if(h.uniform1f(m.uniforms.u_viewshed_count,0),p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){const i=t.fbManager.shadowFramebuffer;i&&(c.activeTexture.set(e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT1.VALUE),h.bindTexture(h.TEXTURE_2D,i.colorAttachment.get()),h.uniform1i(m.uniforms.u_shadow_sampler,e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT1.INDEX)),h.uniform1f(m.uniforms.u_shadow_off,t.shadowOff);}if(r.viewshedRender&&(p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL)){const i=g.viewshed[0].fb;i&&(c.activeTexture.set(e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT2.VALUE),h.bindTexture(h.TEXTURE_2D,i.colorAttachment.get()),h.uniform1i(m.uniforms.u_viewshed_samp0,e.CONSTS.GL_CONST.SHADOW_TEXTURE_UNIT2.INDEX)),h.uniform1f(m.uniforms.u_shadow_off,t.shadowOff),h.uniform1f(m.uniforms.u_viewshed_count,1);}let x;const y=new e.Matrix4;let T,S;if(p!==e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN&&p!==e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||(T=f._center.toArray(),S=t._map.sunLight._shadowSunPosition({target:T,distance:f.alt*e.CONSTS.TRANSFORM.R_ZOOM})),!t.depthPick)if(p===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow.type&&(x||(v.multiplyLeft(f.calculateVPMatrix(S)),x=v.clone(),h.uniformMatrix4fv(m.uniforms.u_matrix,!1,x.toFloat32Array())));else if(p===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)x||(v.multiplyLeft(f.calculateVPMatrix(g.viewshed[0])),x=v.clone(),h.uniformMatrix4fv(m.uniforms.u_matrix,!1,x.toFloat32Array()));else if(p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow.type?(h.uniform1i(m.uniforms.u_with_shadow,!0),y.copy(v.clone().multiplyLeft(f.calculateVPMatrix(S)))):h.uniform1i(m.uniforms.u_with_shadow,!1),h.uniformMatrix4fv(m.uniforms.u_sun_matrix,!1,y.toFloat32Array());else if(p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){const e=v.clone().multiplyLeft(f.calculateVPMatrix(g.viewshed[0]));h.uniformMatrix4fv(m.uniforms.u_viewshed_mat0,!1,e.toFloat32Array()),h.uniform3fv(m.uniforms.u_viewshed_eye0,f._lastSunLightStatus.geographic),h.uniform1f(m.uniforms.u_viewshed_dist0,g.viewshed[0]&&g.viewshed[0].farDistance||0),h.uniform1i(m.uniforms.u_viewshed_used0,!0);}else if(p===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow.type?(h.uniform1i(m.uniforms.u_with_shadow,!0),y.copy(f.calculateVPMatrix(S).multiplyRight(v))):h.uniform1i(m.uniforms.u_with_shadow,!1),h.uniformMatrix4fv(m.uniforms.u_sun_matrix,!1,y.toFloat32Array());const e=f.calculateVPMatrix(g.viewshed[0]).multiplyRight(v);h.uniformMatrix4fv(m.uniforms.u_viewshed_mat0,!1,e.toFloat32Array()),h.uniform3fv(m.uniforms.u_viewshed_eye0,f._lastSunLightStatus.geographic),h.uniform1f(m.uniforms.u_viewshed_dist0,g.viewshed[0]&&g.viewshed[0].farDistance||0),h.uniform1i(m.uniforms.u_viewshed_used0,!0);}if(!x){if(x=f.calculateVPMatrix().multiplyRight(v),h.uniformMatrix4fv(m.uniforms.u_matrix,!1,x.toFloat32Array()),!n.normalMatrix){const t=new e.Matrix4(n.matrix).invert();n.normalMatrix=t.transpose().toArray();}h.uniformMatrix4fv(m.uniforms.u_normal,!1,new Float32Array(n.normalMatrix)),h.uniformMatrix4fv(m.uniforms.u_model,!1,new Float32Array(n.matrix));}h.uniform1f(m.uniforms.u_opacity,r.paint.get("histogram-opacity")),h.uniform1f(m.uniforms.u_depth_render,r.paint.get("depth-change"));const b=r.layout.get("histogram-max-height-render");if(b){h.uniform1f(m.uniforms.u_is_max_length,b);const e=r.paint.get("histogram-max-height");h.uniform1f(m.uniforms.u_max_height,e);}!function(e,t){const i=t.context.gl;i.uniform3fv(e.uniforms.u_LightDirection,t._map.sunLight.getSunLightPos()),i.uniform3fv(e.uniforms.u_LightColor,[1,1,1]);}(m,t),m.draw(c,h.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,_);}const ba=e.properties$1.layout;function wa(e){let t=(Date.now()-e)/1e3;return t>1?t=1:t<0&&(t=0),t}function Ea(t,i,r,o,s,n,a,l,c,h,u){const d=t.context,_=d.gl,m=t.transform,f="map"===l,p="map"===c,g=f&&"point"!==r.layout.get("symbol-placement"),v=f&&!p&&!g;let x,y=!1;const T=r.layout.get("symtracking-display-mode");for(const n of o){const o=i.getTile(n),a=o.getBucket(r);if(!a)continue;const l=s?a.text:a.icon;if(!l||!l.segments.get().length)continue;const c=l.programConfigurations.get(r.id),b=s||a.sdfIcons,w=s?a.textSizeData:a.iconSizeData;if(!x){x=t.useProgram(b?"sphereSymtrackingSDF":"sphereSymtrackingIcon",c),c.setUniforms(t.context,x,r.paint,{zoom:t.transform.zoom}),_.uniform2f(x.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);let o=0;if(T===e.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.DEFAULT)o=0;else if(T===e.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.SEQUENCE)o=1,u=wa(i.getSource()._timestamp);else {o=2,S=i.getSource()._timestamp,u=Date.now()-S;const e=a.timestampExtraData;_.uniform2fv(x.uniforms.u_timestamp_se,[e.total_time_start,e.total_time_end]);}_.uniform1f(x.uniforms.u_display_mode,o),Ma({program:x,painter:t,layer:r,isText:s,rotateInShader:v,pitchWithMap:p,sizeData:w,rotateWithMap:f,_count:u});}if(d.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),_.uniform1i(x.uniforms.u_texture,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),s)o.glyphAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.uniform2fv(x.uniforms.u_texsize,o.glyphAtlasTexture.size);else {const e=1!==r.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear,i=p||0!==m.pitch;o.imageAtlasTexture.bind(b||t.options.rotating||t.options.zooming||e||i?_.LINEAR:_.NEAREST,_.CLAMP_TO_EDGE),_.uniform2fv(x.uniforms.u_texsize,o.imageAtlasTexture.size);}const E=hr(o,1,t.transform.zoom),M=qi(n.posMatrix,p,f,t.transform,E),A=Zi(n.posMatrix,p,f,t.transform,E);if(g?(_.uniform1i(x.uniforms.u_along_line,!0),Ki(a,n.posMatrix,t,s,M,A,p,h)):_.uniform1i(x.uniforms.u_along_line,!1),_.uniform1f(x.uniforms.u_fade_change,1),!y){const i=new e.Matrix2;if(i.scale([1,Math.cos(t.transform._pitch)]),_.uniformMatrix2fv(x.uniforms.u_pitch_matrix,!1,i.toFloat32Array()),_.uniformMatrix2fv(x.uniforms.u_rot_matrix,!1,(new e.Matrix2).rotate(t.transform.angle).toFloat32Array()),v){const i=new e.Matrix4;i.scale([1,t.transform.width/t.transform.height,1]),i.rotateAxis(-t.transform.angle,[0,Math.sin(t.transform._pitch),Math.cos(t.transform._pitch)]),_.uniformMatrix4fv(x.uniforms.u_pitch_rot_matrix_1,!1,i.toFloat32Array());}else _.uniformMatrix2fv(x.uniforms.u_pitch_rot_matrix,!1,(new e.Matrix2).rotate(t.transform.angle).multiplyLeft(i).toFloat32Array());_.uniform1f(x.uniforms.u_bearing,-t.transform.angle),_.uniform3fv(x.uniforms.u_camPos,t.transform.getCameraPos()),_.uniform1f(x.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),_.uniformMatrix4fv(x.uniforms.u_symbol_mvp_matrix,!1,new Float32Array(t.transform.td_symbolMVPMatrix)),y=!0;}_.uniformMatrix4fv(x.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(a.tilePlane.matrix).toFloat32Array()),_.uniformMatrix4fv(x.uniforms.u_modelMatrix,!1,new Float32Array(a.tilePlane.matrix)),Aa(x,0,t,r,0,l,s,b);}var S;}function Ma(t){const i=t.painter.context.gl,r=t.painter.transform;i.uniform1i(t.program.uniforms.u_pitch_with_map,t.pitchWithMap),i.uniform1i(t.program.uniforms.u_is_text,t.isText),i.uniform1f(t.program.uniforms.u_pitch,r.pitch/360*2*Math.PI);const o="constant"===t.sizeData.functionType||"camera"===t.sizeData.functionType;i.uniform1i(t.program.uniforms.u_is_size_zoom_constant,"constant"===t.sizeData.functionType||"source"===t.sizeData.functionType?1:0),i.uniform1i(t.program.uniforms.u_is_size_feature_constant,o?1:0),i.uniform1f(t.program.uniforms.u_camera_to_center_distance,r.alt);const s=e.evaluateSizeForZoom(t.sizeData,r.zoom,ba.properties[t.isText?"text-size":"icon-size"]);void 0!==s.uSizeT&&i.uniform1f(t.program.uniforms.u_size_t,s.uSizeT),void 0!==s.uSize&&i.uniform1f(t.program.uniforms.u_size,s.uSize),i.uniform1f(t.program.uniforms.u_aspect_ratio,r.width/r.height),i.uniform1i(t.program.uniforms.u_rotate_symbol,t.rotateInShader),i.uniform1i(t.program.uniforms.u_rotate_with_map,t.rotateWithMap),i.uniform1f(t.program.uniforms.u_seq,t._count?t._count:0);}function Aa(e,t,i,r,o,s,n,a){const l=i.context,c=l.gl;a&&(0!==r.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1)&&(c.uniform1i(e.uniforms.u_is_halo,!0),Ca(s,r,l,e)),c.uniform1i(e.uniforms.u_is_halo,!1)),Ca(s,r,l,e);}function Ca(e,t,i,r){r.draw(i,i.gl.TRIANGLES,t.id,e.layoutVertexBuffer,e.indexBuffer,e.segments,e.programConfigurations.get(t.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer);}class Ra{constructor(){this.counter=0,this.timeSave=Date.now(),this._state=!1,this.needClearTime=!0,this._pause=!1;}update(){if(this._state){const e=Date.now();this.needClearTime?this.needClearTime=!1:this.counter+=(e-this.timeSave)/1e3,this.timeSave=e;}}reset(){return this.counter=0,this.counter}get state(){return this._state}set state(e){this._state=e,e||(this.needClearTime=!0);}pauseTimer(){this.state=!1;}resumeTimer(){this.state=!0;}}const La=new Nn;function Pa(t,i,r,o,s,n,a,l){const c=n.programConfigurations.get(r.id);!function(t,i,r,o,s,n,a,l){const c=t.context.gl,h=t.context,u=Ia("sphereFill",i.paint.get("fill-pattern"),t,a,i,r,o,n);c.uniform2f(u.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);const d=new e.Matrix2;d.scale([1,Math.cos(t.transform._pitch)]),d.rotate(t.transform.angle),c.uniformMatrix2fv(u.uniforms.u_pixel_matrix,!1,d.toFloat32Array()),c.uniform3fv(u.uniforms.u_camPos,t.transform.getCameraPos()),c.uniform1f(u.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle+Math.PI/18),c.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,new Float32Array(s.tilePlane.matrix)),c.uniformMatrix4fv(u.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(s.tilePlane.matrix).toFloat32Array()),l?function(t,i,r,o,s,n,a){s.setDepthMode(new e.DepthMode(n.LEQUAL,e.DepthMode.ReadOnly,[0,1])),s.setColorMode(e.ColorMode.disabled),s.setCullFace(e.CullFaceMode.disabled),n.enable(n.STENCIL_TEST),n.stencilMask(255),n.stencilFunc(n.ALWAYS,0,255),n.stencilOpSeparate(n.FRONT,n.KEEP,n.KEEP,n.DECR_WRAP),n.stencilOpSeparate(n.BACK,n.KEEP,n.KEEP,n.INCR_WRAP),a.draw(t.context,n.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o),s.setColorMode(e.ColorMode.alphaBlended),n.stencilFunc(n.NOTEQUAL,0,255),n.stencilMask(0),a.draw(t.context,n.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,o),s.setStencilMode(e.StencilMode.disabled);}(t,i,s,a,h,c,u):(c.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,new Float32Array(s.tilePlane.matrix)),t.context.setStencilMode(t.transform.zoom>4?t.stencilModeForClipping(o):e.StencilMode.disabled),u.draw(t.context,c.TRIANGLES,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,a),function(e,t,i,r,o,s,n,a){const l=Ia("sphereFillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),r,o,i,s,n,a);t.uniform2f(l.uniforms.u_world,t.drawingBufferWidth,t.drawingBufferHeight),t.uniformMatrix4fv(l.uniforms.u_matrix,!1,r.transform.calculateVPMatrix().multiplyRight(e.tilePlane.matrix).toFloat32Array()),l.draw(r.context,t.LINES,i.id,e.layoutVertexBuffer2?e.layoutVertexBuffer2:e.layoutVertexBuffer,e.indexBuffer2,e.segments2,o);}(s,c,i,t,a,r,o,n));}(t,r,o,s,n,a,c,l);}function Ia(t,i,r,o,s,n,a,l){let c;const h=r.context.program.get(),u=s.layout.get("dynamic");if(i){c=r.useProgram(`${t}Pattern`,o);const a=new e.EvaluationParameters(r.transform.zoom).getCrossfadeParameters();(l||c.program!==h)&&(o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom}),On(i,r,c,a),r.context.gl.uniform1f(c.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(r.transform.zoom)))),Dn(n,r,c);}else if("none"===u)c=r.useProgram(t,o),(l||c.program!==h)&&o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom});else {let i=u.toString();if(i=i.toLowerCase(),i=i.charAt(0).toUpperCase()+i.slice(1),c=r.useProgram(`${t}${i}`,o),l||c.program!==h){o.setUniforms(r.context,c,s.paint,{zoom:r.transform.zoom});const t=r.context.gl;t.uniform1f(c.uniforms.u_time,r._map.timer.counter),t.uniform1f(c.uniforms.u_zoom,r.transform.zoom),t.uniform3fv(c.uniforms.u_light,r._map.sunLight.getSunLightPos()),t.uniform3fv(c.uniforms.u_coordZXY,[a.canonical.z,a.canonical.x,a.canonical.y]),t.uniform1i(c.uniforms.u_is4326,r._map.projection===e.ProjectionType.LATLON),function(e,t,i){const r=t.gl,o=La.getTexture(e.to);if(o){t.activeTexture.set(r.TEXTURE16);const e=o.isSizePowerOfTwoNoneSquare();return o.bind(r.LINEAR,r.REPEAT,e?r.LINEAR_MIPMAP_NEAREST:r.LINEAR),r.uniform1i(i.uniforms.u_image,16),!0}La.addTexture(e.to,e.to,t,{requestImages:0});}(s.paint.get("fill-dynamic-image-url"),r.context,c);}}return c}class Oa{constructor(e,t,i){this.context=e,this.width=t,this.height=i,this.framebufferPool={},this.createFramebuffers(),this.createFramebufferOfPool(),this.poolSize=6;}createFramebufferOfPool(){for(let e=0;e<this.poolSize;e++)this.framebufferPool[`key${e}`]={fobj:this.createAFrameBuffer(),inUse:!1};}createFramebuffers(){this.pickFramebuffer=this.createAFrameBuffer(),this.shadowFramebuffer=this.createAFrameBuffer(),this.fxaaFramebuffer=this.createAFrameBuffer(),this.fxaaExcFramebuffer=this.createAFrameBuffer(),this.bloomBaseColorFramebuffer=this.createAFrameBuffer(),this.bloomFramebuffer=this.createAFrameBuffer(),this.bloomExcFramebuffer=this.createAFrameBuffer(),this.globalAtmosphereFramebuffer=this.createAFrameBuffer(),this.globalExcAtmosphereFramebuffer=this.createAFrameBuffer(),this.maskFramebuffer=this.createAFrameBuffer();}createAFrameBuffer(t=1,i={depthRenderbuffer:!0,depthStencilRenderbuffer:!1}){const r=this.context.createFramebuffer(this.width*t,this.height*t,!1),o=new e.Texture(this.context,{width:this.width*t,height:this.height*t,data:null},this.context.gl.RGBA);if(o.bind(this.context.gl.LINEAR,this.context.gl.CLAMP_TO_EDGE),r.colorAttachment.set(o.texture),i.depthRenderbuffer){const e=this.context.createRenderbuffer(this.context.gl.DEPTH_COMPONENT16,this.width*t,this.height*t);r.depthAttachment.set(e);}if(i.depthStencilRenderbuffer){const e=this.context.createRenderbuffer(this.context.gl.DEPTH_STENCIL,this.width*t,this.height*t);r.depthStencilAttachment.set(e);}return r}destoryAFramebuffer(e){e&&(e.destroy(),e=null);}resize(e,t){this.width=e,this.height=t,this.destoryAFramebuffer(this.pickFramebuffer),this.pickFramebuffer=null,this.destoryAFramebuffer(this.shadowFramebuffer),this.shadowFramebuffer=null,this.destoryAFramebuffer(this.fxaaFramebuffer),this.fxaaFramebuffer=null,this.destoryAFramebuffer(this.fxaaExcFramebuffer),this.fxaaExcFramebuffer=null,this.destoryAFramebuffer(this.bloomBaseColorFramebuffer),this.bloomBaseColorFramebuffer=null,this.destoryAFramebuffer(this.bloomFramebuffer),this.bloomFramebuffer=null,this.destoryAFramebuffer(this.bloomExcFramebuffer),this.bloomExcFramebuffer=null,this.destoryAFramebuffer(this.globalAtmosphereFramebuffer),this.globalAtmosphereFramebuffer=null,this.destoryAFramebuffer(this.globalExcAtmosphereFramebuffer),this.globalExcAtmosphereFramebuffer=null,this.destoryAFramebuffer(this.maskFramebuffer),this.maskFramebuffer=null;for(const e in this.framebufferPool)this.destoryAFramebuffer(this.framebufferPool[e].fobj),this.framebufferPool[e].fobj=null,this.framebufferPool[e]=null;this.createFramebufferOfPool(),this.createFramebuffers();}getAFramebufferFromPool(){let e=null;for(const t in this.framebufferPool)this.framebufferPool[t].inUse||(e=this.framebufferPool[t].fobj,this.framebufferPool[t].inUse=!0);return e||(e=this.createAFrameBuffer(),this.framebufferPool[`key${this.poolSize}`]={fobj:e,inUse:!0},this.poolSize+=1),e}releaseAFramebufferOfPool(e){for(const t in this.framebufferPool)this.framebufferPool[t].fobj===e&&(this.framebufferPool[t].inUse=!1);}}const Da=e.createLayout([{name:"a_pos",components:3,type:"Float32"}],4);class Na{constructor(t){this._tileCount=0,this.cache={},this.keys=[],this._context=t.context,this._projectionType=t.projection||e.ProjectionType.MERCATOR,this.debugVAO=new Le;}setProjection(e){this._projectionType=e;}setMaxTile(e){for(this._tileCount=e;this.keys.length>this._tileCount;)this.removeTileById(this.keys[0]);}addTileByCoord(t){const i=t.canonical,r=i.z,o=i.x,s=i.y,n=t.key,a=new e.StructArrayLayout3f12;let l=8-r;l<1&&(l=1);let c=0,h=[];for(let t=0;t<l+1;t++){const i=e.getSpherePos(t/(l+1)*e.EXTENT,5,0,o,s,r,this._projectionType);0===h.length&&(h=i),a.emplaceBack(i[0]-h[0],i[1]-h[1],i[2]-h[2]),c++;}for(let t=0;t<l+1;t++){const i=e.getSpherePos(e.EXTENT,t/(l+1)*e.EXTENT,5,o,s,r,this._projectionType);a.emplaceBack(i[0]-h[0],i[1]-h[1],i[2]-h[2]),c++;}for(let t=l+1;t>0;t--){const i=e.getSpherePos(t/(l+1)*e.EXTENT,e.EXTENT,5,o,s,r,this._projectionType);a.emplaceBack(i[0]-h[0],i[1]-h[1],i[2]-h[2]),c++;}for(let t=l+1;t>=0;t--){const i=e.getSpherePos(0,t/(l+1)*e.EXTENT,5,o,s,r,this._projectionType);a.emplaceBack(i[0]-h[0],i[1]-h[1],i[2]-h[2]),c++;}const u=function(e,t,i,r){r=r||1;const o=[];let s,n,a,l,c,h,u,d;for(s=0,n=e.length;s<n;s++)if(c=Fa[e[s]],c){for(d=null,a=0,l=c[1].length;a<l;a+=2)-1===c[1][a]&&-1===c[1][a+1]?d=null:(h=t+c[1][a]*r,u=800-c[1][a+1]*r,d&&o.push(d.x,d.y,h,u),d={x:h,y:u});t+=c[0]*r;}return o}(t.toString(),50,0,20);let d=0;for(let t=0;t<u.length;t+=2){const i=e.getSpherePos(u[t],u[t+1],5,o,s,r,this._projectionType);a.emplaceBack(i[0]-h[0],i[1]-h[1],i[2]-h[2]),d++;}const _=this._context.createVertexBuffer(a,Da.members);return this.keys.push(n),this.cache[n]={rP:h,matrix:(new e.Matrix4).translate(h),debugBuffer:_,lineVerticesCount:c,textVerticesCount:d},this.cache[n]}getTileByCoord(e){if(!this.hasTile(e.key))return this.addTileByCoord(e);for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e.key)return this.keys.splice(t,1),this.keys.push(e.key),this.cache[e.key]}removeTileById(e){this.cache[e].debugBuffer.destroy(),this.cache[e]=null,delete this.cache[e];for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e){this.keys.splice(t,1);break}}hasTile(e){return !!this.cache[e]}release(){for(;this.keys.length>0;)this.removeTileById(this.keys[0]);}}const Fa={" ":[16,[]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]]},Ba={sphere:function(t,i){if(i.id!==e.CONSTS.SOURCE.GLOBAL_SOURCE_ID)return;const r=t.context,o=r.gl,s=i.getSource(),n=["sphere","sphereAtmosphere","bloomBlur","screen"];if(s instanceof vi&&s.texture){i.id!==e.CONSTS.SOURCE.SKYBOX_SOURCE_ID&&t._map.clipGroundState&&r.setStencilMode(e.StencilMode.openClipGround);const a=t.transform;let l=null;const c=t._map.directionLightParameter;if(s.renderAtmosphere&&a.zoom<8){l=t.useProgram(n[1]),r.bindFramebuffer.set(t.fbManager.globalExcAtmosphereFramebuffer.framebuffer),r.clear({color:new e.Color(1,1,1,0),depth:1}),r.bindFramebuffer.set(t.fbManager.globalAtmosphereFramebuffer.framebuffer),r.clear({color:new e.Color(1,1,1,0),depth:1}),r.setColorMode(e.ColorMode.unblended),r.setDepthMode(e.DepthMode.disabled),r.setCullFace(e.CullFaceMode.disabled),o.uniform2fv(l.uniforms.u_resolution,[t.width,t.height]),o.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.calculateVPMatrix({id:e.CONSTS.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID,pitch:a.pitch,bearing:a.bearing,altitude:0}).toFloat32Array()),o.uniform4fv(l.uniforms.u_GlobalOuterColor,c.globalOuterColor.toFloat32Array());const i=t.getSphereBuffer();t.sphereVAO.bind(r,l,i,[]),o.drawArrays(s._options.debug?o.LINE_STRIP:o.TRIANGLE_STRIP,0,i.length),l=t.useProgram(n[2]);for(let e=0;e<1;e++)la(t,t.fbManager.globalAtmosphereFramebuffer,t.fbManager.globalExcAtmosphereFramebuffer.framebuffer,[0,1],l,r,o,2),la(t,t.fbManager.globalExcAtmosphereFramebuffer,t.fbManager.globalAtmosphereFramebuffer.framebuffer,[1,0],l,r,o,2);r.setColorMode(new e.ColorMode([o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),l=t.useProgram(n[3]),la(t,t.fbManager.globalAtmosphereFramebuffer,t.getDefaultFrameBuffer(),[1,0],l,r,o);}r.setCullFace(e.CullFaceMode.backCCW),r.setColorMode(e.ColorMode.unblended),r.setDepthMode(e.DepthMode.disabled),l=t.useProgram(n[0],null,{GLOBE_MODE:!0}),s.cloudTime++,o.uniform1f(l.uniforms.time,s.cloudTime/1e3),o.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.calculateVPMatrix().toFloat32Array()),r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.VALUE),o.uniform1i(l.uniforms.u_imageGlobal,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.INDEX),s.texture.bind(o.LINEAR,o.REPEAT),s.cloudTexture?(o.uniform1i(l.uniforms.u_withCloud,!0),r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT3.VALUE),o.uniform1i(l.uniforms.u_imageCloud,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT3.INDEX),s.cloudTexture.bind(o.LINEAR,o.REPEAT)):o.uniform1i(l.uniforms.u_withCloud,!1),s.nightTexture?(r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT4.VALUE),o.uniform1i(l.uniforms.u_imageNightLight,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT4.INDEX),s.nightTexture.bind(o.LINEAR,o.REPEAT),o.uniform1i(l.uniforms.u_with_nighttexture,!0)):o.uniform1i(l.uniforms.u_with_nighttexture,!1);const h=t._map.sunLight.getSunLightPos();o.uniform3fv(l.uniforms.u_LightDirection,h);const u=e.clamp(.3*(a.zoom-1),0,1);o.uniform1f(l.uniforms.u_daytex_percent,u);const d=a.getCameraPos();o.uniform3fv(l.uniforms.u_cam,d),o.uniform4fv(l.uniforms.u_GlobalInnerColor,c.globalInnerColor.toFloat32Array()),o.uniform4fv(l.uniforms.u_LightPer,c.globalLightPercent.toFloat32Array()),o.uniform1f(l.uniforms.u_NightGlobalPer,c.nightGlobalPer);const _=t.getSphereBuffer();t.sphereVAO.bind(r,l,_,[]),o.drawArrays(s._options.debug?o.LINE_STRIP:o.TRIANGLE_STRIP,0,_.length);}r.setDepthMode(new e.DepthMode(r.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),r.setStencilMode(e.StencilMode.disabled),r.setCullFace(e.CullFaceMode.disabled);},sphereSkybox:function(t,i){const r=t.context,o=r.gl,s=i.getSource(),n=["sphereSkybox","sphereAtmosphere","bloomBlur","screen"];if(s instanceof vi&&s.texture){i.id!==e.CONSTS.SOURCE.SKYBOX_SOURCE_ID&&t._map.clipGroundState&&r.setStencilMode(e.StencilMode.openClipGround);const a=t.transform;let l=null;if(i.id===e.CONSTS.SOURCE.SKYBOX_SOURCE_ID){l=t.useProgram(n[0],null,{SKYBOX_CUBE_MAP:s.isCubeMap}),o.uniformMatrix4fv(l.uniforms.u_matrix,!1,a.calculateVPMatrix(aa.createACameraView({id:e.CONSTS.CAMERA.SKYBOX_CAMERA_ID,pitch:a.pitch,bearing:-a.bearing,altitude:0})).toFloat32Array()),o.uniform1i(l.uniforms.u_with_light,!1),s.skyTime++;let i=s.skyTime/1e3;i-=Math.floor(i),o.uniform1f(l.uniforms.time,i);}r.setColorMode(e.ColorMode.unblended),o.uniform1i(l.uniforms.u_fog_render,!1),r.setDepthMode(e.DepthMode.disabled),r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.VALUE),o.uniform1i(l.uniforms.u_image0,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.INDEX),s.texture.bind(o.LINEAR,o.REPEAT),s.nightTexture?(r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),o.uniform1i(l.uniforms.u_image2,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),s.nightTexture.bind(o.LINEAR,o.REPEAT),o.uniform1i(l.uniforms.u_with_nighttexture,!0)):o.uniform1i(l.uniforms.u_with_nighttexture,!1),s.dayTexture?(r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT3.VALUE),o.uniform1i(l.uniforms.u_image1,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT3.INDEX),s.dayTexture.bind(o.LINEAR,o.REPEAT),o.uniform1i(l.uniforms.u_with_daytex,1),o.uniform1f(l.uniforms.u_daytex_percent,e.clamp((a.zoom-3)/10,0,1))):o.uniform1i(l.uniforms.u_with_daytex,0);const c=t.cubeBuffer;t.cubeVAO.bind(r,l,c,[]),o.drawArrays(s._options.debug?o.LINE_STRIP:o.TRIANGLES,0,c.length);}r.setDepthMode(new e.DepthMode(r.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),r.setStencilMode(e.StencilMode.disabled),r.setCullFace(e.CullFaceMode.disabled);},maskFill:function(t,i,r,o){if(0===r.paint.get("fill-opacity").constantOr(1))return;const s=t.context;s.setColorMode(e.ColorMode.unblended),s.setDepthMode(e.DepthMode.disabled);const n=s.gl,a=!!r.vectorRenderInSpace;s.setCullFace(e.CullFaceMode.disabled),s.setStencilMode(e.StencilMode.disabled),t.context.bindFramebuffer.set(t.fbManager.maskFramebuffer.framebuffer),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),function(e,t,i,r,o,s){if(In(i.paint.get("fill-pattern"),e))return;let n=!0;for(const a of r){const r=t.getTile(a),l=r.getBucket(i);l&&(s&&e.clearStencil(),o(e,t,i,r,a,l,n,s),n=!1);}}(t,i,r,o,Pa,a),t.fbManager.maskFramebuffer.vpMatrix=t.transform.calculateVPMatrix(),s.setCullFace(e.CullFaceMode.disabled),t.context.bindFramebuffer.set(null);},raster:function(t,i,r,o){if("translucent"!==t.renderPass)return;if(!r.paint)return;if(0===r.paint.get("raster-opacity"))return;const s=t.context,n=s.gl,a=i.getSource(),l=t.useProgram("sphereRaster",null,vn.getRasterSourceAndLayerMicroDefinition(a,r));n.uniform2fv(l.uniforms.currentFrustum,[t.transform.near,t.transform.far]),t._map.clipGroundState&&s.setStencilMode(e.StencilMode.openClipGround),s.setColorMode(new e.ColorMode([n.ONE,n.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),i._source.renderWithTerrain?t.context.setDepthMode(new e.DepthMode(n.LESS,e.DepthMode.ReadWrite,[0,1])):(t.context.setDepthMode(e.DepthMode.disabled),t.context.setCullFace(new e.CullFaceMode(!0,n.BACK,n.CCW)));const c=s._Program.textureUnitManager.getOneUnit(),h=s._Program.textureUnitManager.getOneUnit();var u,d;n.uniform1f(l.uniforms.u_brightness_low,r.paint.get("raster-brightness-min")),n.uniform1f(l.uniforms.u_brightness_high,r.paint.get("raster-brightness-max")),n.uniform1f(l.uniforms.u_saturation_factor,(u=r.paint.get("raster-saturation"))>0?1-1/(1.001-u):-u),n.uniform1f(l.uniforms.u_contrast_factor,(d=r.paint.get("raster-contrast"))>0?1/(1-d):1+d),n.uniform3fv(l.uniforms.u_spin_weights,function(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return [(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}(r.paint.get("raster-hue-rotate"))),n.uniform1f(l.uniforms.u_buffer_scale,1),n.uniform1i(l.uniforms.u_image0,c.INDEX),n.uniform1i(l.uniforms.u_image1,h.INDEX),n.uniform1i(l.uniforms.u_isPole,!1),t.style.map.disableBlinnPhong?n.uniform1i(l.uniforms.u_with_light,!1):t.style.sunLightFlag||t.transform.zoom<4?(n.uniform1i(l.uniforms.u_with_light,!0),n.uniform3fv(l.uniforms.u_LightDirection,t._map.sunLight.fixedMode===e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.FIXED?e.transformECEFToGeographic([],[t.transform.center.lng-45,t.transform.center.lat+10],e.CONSTS.TRANSFORM.R):t._map.sunLight.getSunLightPos()),n.uniform3fv(l.uniforms.u_LightColor,[1,1,1]),n.uniform3fv(l.uniforms.u_cam,t.transform.getCameraPos())):n.uniform1i(l.uniforms.u_with_light,!1),n.uniform1i(l.uniforms.u_fog_render,!1),n.uniform1f(l.uniforms.u_opacity,r.paint.get("raster-opacity")),n.uniform1i(l.uniforms.u_is_dem,!1);let _,m=!1,f=a._useVideoProject;const p=t._map.style._videoSource;f=!!p&&f&&p.available,f&&(m=p._parseVideoTexture(t,l,m)),m&&(_=mi.copy(l.textureUnitManager,s),m=!1);for(const u of o){l.textureUnitManager.reset(),_&&(l.textureUnitManager=mi.copy(_,s)),f&&p.uploadTexture(t,l);const o=i.getTile(u);o.registerFadeDuration(r.paint.get("raster-fade-duration"));const d=i.findLoadedParent(u,0,{});let m,g;const v="nearest"===r.paint.get("raster-resampling")?n.NEAREST:n.LINEAR;if(s.activeTexture.set(c.VALUE),o.texture.bind(v,n.CLAMP_TO_EDGE),s.activeTexture.set(h.VALUE),d?(d.texture.bind(v,n.CLAMP_TO_EDGE),m=Math.pow(2,d.tileID.overscaledZ-o.tileID.overscaledZ),g=[o.tileID.canonical.x*m%1,o.tileID.canonical.y*m%1]):o.texture.bind(v,n.CLAMP_TO_EDGE),n.uniform2fv(l.uniforms.u_tl_parent,g||[0,0]),n.uniform1f(l.uniforms.u_scale_parent,m||1),a instanceof di)n.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(a.matrix).toFloat32Array()),n.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,a.matrix.toFloat32Array()),n.uniform1i(l.uniforms.u_is_image,!0),l.draw(s,n.TRIANGLES,r.id,a.sphereBoundsBuffer,a.sphereIndexBuffer,a.sphereSegments);else if(o.terrainFlag){const e=o.terrainData;if(!e)continue;n.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(e.matrix).toFloat32Array()),n.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,new Float32Array(e.matrix)),n.uniform1i(l.uniforms.u_is_dem,!0),l.draw(s,n.TRIANGLES,r.id,e.sphereMaskedBoundsBuffer,e.sphereMaskedIndexBuffer,e.sphereSegments);}else {const i=t.sphereTileVerticeCache.get(o.tileID,s);n.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(i.matrix).toFloat32Array()),n.uniformMatrix4fv(l.uniforms.u_model_matrix,!1,new Float32Array(i.matrix)),r.depthTest?s.setDepthMode(new e.DepthMode(n.LEQUAL,e.DepthMode.ReadWrite,[0,1])):(s.setCullFace(e.CullFaceMode.backCCW),s.setDepthMode(e.DepthMode.disabled)),l.draw(s,n.TRIANGLES,r.id,i.sphereMaskedBoundsBuffer,i.sphereMaskedIndexBuffer,i.sphereSegments);}}t.transform.projection===e.ProjectionType.MERCATOR&&(t.transform.inPole||t.transform.zoom<e.CONSTS.TRANSFORM.TERRAIN_FIND_ZOOM_MIN)&&function(t,i,r,o){const s=t.context,n=s.gl,a=i.getSource(),l=t.useProgram("sphereRaster");if(a instanceof di||!(o.length>0))return;s.setStencilMode(e.StencilMode.openClipGround),t.context.setCullFace(new e.CullFaceMode(!0,n.BACK,n.CCW)),t.context.setDepthMode(new e.DepthMode(n.LESS,e.DepthMode.ReadWrite,[0,1])),n.uniform1f(l.uniforms.u_buffer_scale,1),n.uniform1i(l.uniforms.u_image0,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX);let c=!1;t.style.map.disableBlinnPhong?n.uniform1i(l.uniforms.u_with_light,!1):t.style.sunLightFlag||t.transform.zoom<4?(n.uniform1i(l.uniforms.u_with_light,!0),n.uniform3fv(l.uniforms.u_LightDirection,t._map.sunLight.fixedMode===e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.FIXED?e.transformECEFToGeographic([],[t.transform.center.lng-45,t.transform.center.lat+10],e.CONSTS.TRANSFORM.R):t._map.sunLight.getSunLightPos()),n.uniform3fv(l.uniforms.u_LightColor,[1,1,1]),n.uniform3fv(l.uniforms.u_cam,t.transform.getCameraPos())):n.uniform1i(l.uniforms.u_with_light,!1);for(const a of o){if(0===a.canonical.y)c=!0;else {if(a.canonical.y!==Math.pow(2,a.overscaledZ)-1)continue;c=!1;}const o=i.getTile(a);if(o.terrainData)return;n.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().toFloat32Array()),o.registerFadeDuration(r.paint.get("raster-fade-duration"));const h="nearest"===r.paint.get("raster-resampling")?n.NEAREST:n.LINEAR;s.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),o.texture.bind(h,n.CLAMP_TO_EDGE),n.uniform2fv(l.uniforms.u_tl_parent,[0,0]),n.uniform1f(l.uniforms.u_scale_parent,1),n.uniform1i(l.uniforms.u_isNorth,c);const u=t.sphereTileVerticeCache.getPole(s,c,a);n.uniform1i(l.uniforms.u_isPole,!0),n.uniformMatrix4fv(l.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(u.matrix).toFloat32Array()),s.setDepthMode(r.depthTest?new e.DepthMode(n.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),l.draw(s,n.TRIANGLES,r.id,u.sphereMaskedBoundsBuffer,u.sphereMaskedIndexBuffer,u.sphereSegments);}s.setCullFace(e.CullFaceMode.disabled),s.setStencilMode(e.StencilMode.disabled);}(t,i,r,o),s.setCullFace(e.CullFaceMode.disabled),s.setStencilMode(e.StencilMode.disabled),s.setDepthMode(e.DepthMode.disabled);},fill:function(t,i,r,o){if(0===r.paint.get("fill-opacity").constantOr(1))return;const s=t.context;s.setColorMode(e.ColorMode.alphaBlended),s.setDepthMode(r.depthTest?new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled);const n=s.gl,a=e.defined(r.classificationType)&&r.classificationType!=e.ClassificationType.NONE;a?(s.setCullFace(e.CullFaceMode.disabled),Bn(t,i,r,o,Un,a)):(s.setCullFace(new e.CullFaceMode(!0,n.BACK,n.CW)),t._map.clipGroundState&&s.setStencilMode(e.StencilMode.openClipGround),Bn(t,i,r,o,Un,a)),s.setCullFace(e.CullFaceMode.disabled),s.setStencilMode(e.StencilMode.disabled);},"3d-tiles":function(t,i,r,o){if(!i.tilesForRender.length)return;const s={clippingSetter:new ha,highLightSetter:new fn,morphSetter:new gn};t.context.setColorMode(e.ColorMode.unblended),t.context.setStencilMode(e.StencilMode.disabled),t.context.setDepthMode(new e.DepthMode(t.context.gl.LESS,e.DepthMode.ReadWrite,[0,1])),function(t,i,r,o,s){const n=t._map.directionLightParameter;if(t._map._shadowFlag&&(null==n.mSceneEnvelope||n.mCurShadowLayer!=r)){const t=i.mTilesInfo.mRootNode,r=new e.CN_Envelope,o=t.mCenter.clone().subtract(t.mRadius),s=t.mCenter.clone().add(t.mRadius);r.update(o),r.update(s),n.mSceneEnvelope=r;}let a;const l=t.cameraDrawMode,c=t.transform,h=t.context,u=h.gl;0==h.supportPBR&&(r.usePBR=!1);const d=i.getSource();for(const o of i.tilesForRender){if(o.childTiles.length>0)continue;if(a=l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL?t.useProgram(ma[0],null,vn.getGltfTileMicroDefinition(i.getSource(),r,l)):"i3dm"===o.minemap3DType?t.useProgram(ma[1],null,vn.getGltfTileMicroDefinition(i.getSource(),r,void 0,!0)):t.useProgram(ma[0],null,vn.getGltfTileMicroDefinition(i.getSource(),r)),pn.setFlowTexture({context:t.context,program:a,flag:!1}),u.uniform2fv(a.uniforms.currentFrustum,[t.transform.near,t.transform.far]),i.viewport.cullingVolume.computeVisibility(o.boundingVolume)<-.1)continue;a.textureUnitManager.reset(),o.content.gltfUpAxis?"Z"===o.content.gltfUpAxis?d.flipYZ=!0:"Y"===o.content.gltfUpAxis&&(d.flipYZ=!1):d.flipYZ=!1;const n=e.calc3dTileTranslateMatrix(o,d),_=(new e.Matrix4).rotateX(-Math.PI/2);"i3dm"==o.minemap3DType&&n.multiplyRight(_);const m=i.mTilesInfo.getNodeMatrix(o.tileID);if(!i.root2GeoMat){i.root2GeoMat=new e.Matrix4(e.Matrix4.IDENTITY);const t=m.clone().invert();e.Matrix4.multiply(i.root2GeoMat,n,t);}const f=e.createFloat64ArrayIdentityMatrix(),p=n.invert(new e.Matrix4).transpose(new e.Matrix4);let g;u.uniformMatrix4fv(a.uniforms.u_normal,!1,p.toFloat32Array());const v={needBackUpTextureUnitManager:!1},x=t.activeCameras,y=new e.Matrix4;da.setUniformForScene({painter:t,program:a,context:h,layer:r,modelTranslateMatrix:n,rotation0:y},v),ua.setUniformForScene({painter:t,program:a,context:h,layer:r},v),mn.setUniformForScene({painter:t,context:h,program:a,IBL_Support:r.usePBR},v);let T=d._useVideoProject;const S=t._map.style._videoSource;T=!!S&&T&&S.available,T&&(v.needBackUpTextureUnitManager=S._parseVideoTexture(t,a,v.needBackUpTextureUnitManager)),v.needBackUpTextureUnitManager&&(g=mi.copy(a.textureUnitManager,h),v.needBackUpTextureUnitManager=!1),s.clippingSetter.setUniforms({program:a,source:d,context:h,isClamp:d._clampEnabled&&d.minClampBounds&&d.maxClampBounds}),h.setColorMode(new e.ColorMode([u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),u.uniform3fv(a.uniforms.u_cam,c.getCameraPos()),o&&o.meshes.length>0&&fa({painter:t,source:d,tile:o,program:a,transform:c,layer:r,context:h,modelTranslateMatrix:n,tileMatrix:m,clampTranslateMatrix:f,cameraDrawMode:l,activeCameras:x,setters:s,textureMangeBackUp:g,videoSource:S,useVideo:T});}}(t,i,r,0,s);},line:function(t,i,r,o){if(void 0===r.paint)return;const s=r.paint.get("line-opacity"),n=r.paint.get("line-width");if(0===s.constantOr(1)||0===n.constantOr(1))return;const a=t.context;a.setCullFace(e.CullFaceMode.disabled),a.setDepthMode(r.depthTest?new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled);const l=a.gl;l.enable(l.POLYGON_OFFSET_FILL);const c=r.paint.get("line-dasharray")?"sphereLineSDF":r.paint.get("line-pattern")?"sphereLinePattern":r.paint.get("line-gradient")?"sphereLineGradient":"sphereLine",h="visible"===r.layout.get("border-visibility");h&&Gn(t,i,r,o,c,h),Gn(t,i,r,o,c,!1),a.setStencilMode(e.StencilMode.disabled),l.disable(l.POLYGON_OFFSET_FILL);},airline:function(t,i,o,s){const n=o.paint.get("airline-opacity"),a=o.paint.get("airline-width");if(0===n.constantOr(1)||0===a.constantOr(1))return;const l=t.context;l.setColorMode(e.ColorMode.alphaBlended),l.setDepthMode(o.depthTest?new e.DepthMode(l.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),t._map.clipGroundState&&l.setStencilMode(e.StencilMode.openClipGround);const c=o.paint.get("airline-seg-group"),h="history"===o.paint.get("airline-type")?1:0,u=t._map.timer.counter*o.paint.get("airline-speed");!function(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(let i=0;i<t.TRW.layerForwards.length;i++){const r=t.TRW.layerForwards[i];if(r.id===e.id){e.count&&(e.count+=r.count),t.TRW.layerForwards.splice(i,1);break}}}}(o,r),function(e,t,i,r,o,s,n,a){let l,c=!0;for(const o of r){const r=t.getTile(o),h=r.getBucket(i);if(!h)continue;const u=h.programConfigurations.get(i.id),d=e.context.program.get(),_=e.useProgram("sphereAirLine",u);kn(_,e,r,h,i,0,u,c||_.program!==d,l!==r.tileID.overscaledZ,s,n,a),l=r.tileID.overscaledZ,c=!1;}}(t,i,o,s,0,u,c,h),l.setStencilMode(e.StencilMode.disabled);},circle:function(t,i,r,o){if(void 0===r.paint)return;const s=r.paint.get("circle-opacity"),n=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity");if(0===s.constantOr(1)&&(0===n.constantOr(1)||0===a.constantOr(1)))return;const l=t.context,c=l.gl;l.setColorMode(e.ColorMode.alphaBlended),l.setDepthMode(r.depthTest?new e.DepthMode(l.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),l.setStencilMode(e.StencilMode.disabled),l.setCullFace(e.CullFaceMode.disabled);let h=!0;for(let s=0;s<o.length;s++){const n=i.getTile(o[s]).getBucket(r);if(!n)continue;e.defined(r.classificationType)&&r.classificationType!=e.ClassificationType.NONE&&t.context.clear({stencil:0});const a=t.context.program.get(),u=n.programConfigurations.get(r.id),d=t.useProgram("sphereCircle",u);(h||d.program!==a)&&(u.setUniforms(l,d,r.paint,{zoom:t.transform.zoom}),h=!1),c.uniform2f(d.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);const _=new e.Matrix2;_.scale([1,"map"===r.paint.get("circle-pitch-alignment")?Math.cos(t.transform._pitch):1]),_.rotate(t.transform.angle),c.uniformMatrix2fv(d.uniforms.u_pixel_matrix,!1,_.toFloat32Array()),c.uniformMatrix4fv(d.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(n.tilePlane.matrix).toFloat32Array()),c.uniformMatrix4fv(d.uniforms.u_modelMatrix,!1,new Float32Array(n.tilePlane.matrix)),c.uniform3fv(d.uniforms.u_camPos,t.transform.getCameraPos()),c.uniform1f(d.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),c.uniform2fv(d.uniforms.currentFrustum,[t.transform.near,t.transform.far]),e.defined(r.classificationType)&&r.classificationType!=e.ClassificationType.NONE&&(l.setDepthMode(new e.DepthMode(c.LESS,e.DepthMode.ReadOnly,[0,1])),l.setColorMode(e.ColorMode.disabled),c.enable(c.STENCIL_TEST),c.stencilMask(255),c.stencilFunc(c.ALWAYS,0,255),c.stencilOpSeparate(c.FRONT,c.KEEP,c.DECR_WRAP,c.KEEP),c.stencilOpSeparate(c.BACK,c.KEEP,c.INCR_WRAP,c.KEEP),d.draw(l,c.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,u),l.setColorMode(e.ColorMode.alphaBlended),c.disable(c.DEPTH_TEST),c.stencilFunc(c.NOTEQUAL,0,255),c.stencilMask(255),c.stencilOpSeparate(c.FRONT,c.ZERO,c.ZERO,c.ZERO),c.stencilOpSeparate(c.BACK,c.ZERO,c.ZERO,c.ZERO)),d.draw(l,c.TRIANGLES,r.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,u),e.defined(r.classificationType)&&r.classificationType!=e.ClassificationType.NONE&&(l.setDepthMode(e.DepthMode.disabled),l.setStencilMode(e.StencilMode.disabled));}},heatmap:function(t,i,r,o){if(void 0===r.paint)return;if(0===r.paint.get("heatmap-opacity"))return;const s=t.context,n=s.gl;s.setCullFace(e.CullFaceMode.disabled),function(t,i,r){const o=t.gl;t.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.VALUE),t.viewport.set([0,0,i.width,i.height]);let s=r.heatmapFbo;if(s)o.bindTexture(o.TEXTURE_2D,s.colorAttachment.get()),t.bindFramebuffer.set(s.framebuffer);else {const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),s=r.heatmapFbo=t.createFramebuffer(i.width,i.height),Hn(t,i,e,s);}}(s,t,r),s.clear({color:e.Color.transparent}),s.setColorMode(new e.ColorMode([n.ONE,n.ONE],e.Color.transparent,[!0,!0,!0,!0]));const a=new e.Matrix2;a.scale([1,Math.cos(t.transform._pitch)]),a.rotate(t.transform.angle);let l=!0;for(let e=0;e<o.length;e++){const c=o[e];if(i.hasRenderableParent(c))continue;const h=i.getTile(c).getBucket(r);if(!h)continue;const u=t.context.program.get(),d=h.programConfigurations.get(r.id),_=t.useProgram("sphereHeatmap",d),{zoom:m}=t.transform;(l||_.program!==u)&&(d.setUniforms(t.context,_,r.paint,{zoom:m}),l=!1),n.uniform1f(_.uniforms.u_intensity,r.paint.get("heatmap-intensity")),n.uniform1f(_.uniforms.u_deviceWidth,t.width),n.uniform1f(_.uniforms.u_deviceHeight,t.height),n.uniformMatrix2fv(_.uniforms.u_pixel_matrix,!1,a.toFloat32Array());const f=t.transform;n.uniformMatrix4fv(_.uniforms.u_matrix,!1,f.calculateVPMatrix().toFloat32Array()),n.uniform3fv(_.uniforms.u_camera_pos,f.getCameraPos()),_.draw(s,n.TRIANGLES,r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,d);}s.viewport.set([0,0,t.width,t.height]),s.bindFramebuffer.set(null),s.setColorMode(e.ColorMode.alphaBlended),t._map.clipGroundState&&s.setStencilMode(e.StencilMode.openClipGround),function(t,i){const r=t.context,o=r.gl,s=i.heatmapFbo;if(!s)return;r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),o.bindTexture(o.TEXTURE_2D,s.colorAttachment.get()),r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.VALUE);let n=i.colorRampTexture;n||(n=i.colorRampTexture=new e.Texture(r,i.colorRamp,o.RGBA)),n.bind(o.LINEAR,o.CLAMP_TO_EDGE),r.setDepthMode(e.DepthMode.disabled);const a=t.useProgram("heatmapTexture"),l=i.paint.get("heatmap-opacity");o.uniform1f(a.uniforms.u_opacity,l),o.uniform1i(a.uniforms.u_image,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),o.uniform1i(a.uniforms.u_color_ramp,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.INDEX);const c=new e.Matrix4;c.ortho({left:0,right:t.width,bottom:t.height,top:0,near:0,far:1}),o.uniformMatrix4fv(a.uniforms.u_matrix,!1,c.toFloat32Array()),o.uniform2f(a.uniforms.u_world,o.drawingBufferWidth,o.drawingBufferHeight),t.viewportVAO.bind(t.context,a,t.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4);}(t,r),s.setStencilMode(e.StencilMode.disabled);},"3d-model":function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=new fn,s=new ha;new gn;const n=new pn,a=i.getSource(),l=a.configuration.renderType;if("dyn_heatmap2"===l||"dyn_heatmap"===l)return function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.context,s=o.gl,n=t.useProgram("tdModelHeatmap"),a=i.getSource(),l=a.configuration;s.uniform1i(n.uniforms.u_r_heatmap,!0),s.uniform1f(n.uniforms.u_h_heatmap,l.dynMaxHeight),s.uniform1f(n.uniforms.u_height_scale,l.heightScale);const c=t._map.timer.counter*(l.speedFactor||6)%(60*l.loopCount),h=Math.floor(c/60);if(s.uniform1f(n.uniforms.u_animate_pos,h),s.uniform1f(n.uniforms.u_animate_seg_percent,c/60-h),a instanceof Yt&&a.meshes.length>0){r.clipGround&&(s.enable(s.STENCIL_TEST),s.stencilFunc(s.ALWAYS,1,255),s.stencilOp(s.KEEP,s.KEEP,s.REPLACE),s.stencilMask(255));const i=t.transform;o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));let c=new e.Matrix4;c=e.calc3dModelTranslateMatrix(!1,a,c);const h=e.CONSTS.FRAMEBUFFER.DEPTH_IMAGE_SCALE;s.uniform2fv(n.uniforms.u_resolution,[t.width*h,t.height*h]),o.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),s.uniform1i(n.uniforms.u_BaseColorSampler,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),o.setColorMode(new e.ColorMode([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),s.uniform1i(n.uniforms.u_morph_weight,"dyn_heatmap"===l.renderType);for(let r=0;r<a.nodes.length;r++){const l=a.nodes[r];if(l.hasOwnProperty("mesh")&&l.primitiveStack)for(let h=0;h<l.primitiveStack.length;h++){const u=a.primitives[l.primitiveStack[h].primitiveInd],d=c.clone();a.animationMixers&&a.animationMixers.length?ca.setAnimation({animations:a.animationMixers[0].options.animations,animation:{ani:0,cha:""},context:o,program:n,modelMatrix:d,nodeMatrix:a.nodes[r].matrix,painter:t}):l.identityMatrix||d.multiplyRight(l.matrix),s.uniformMatrix4fv(n.uniforms.u_model_matrix,!1,d.toFloat32Array());const _=i.calculateVPMatrix().multiplyRight(d);s.uniformMatrix4fv(n.uniforms.u_matrix,!1,_.toFloat32Array()),Ht(u,a.gltfModelVAO,o,n,a._options.debug),o.setCullFace(e.CullFaceMode.disabled);}}r.clipGround&&o.setStencilMode(e.StencilMode.disabled);}}(t,i,r);if("airline"===l)return function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.context,s=o.gl,n=i.getSource(),a=n.configuration,{lineNodeName:l,staticModelName:c,lines:h}=a,u=[];let d=[],_=0,m=0,f=0,p=0;const g=new fn,v=new gn,x=new pn;if(n instanceof Yt&&n.meshes.length>0){o.setColorMode(new e.ColorMode([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0]));const i=t.transform;o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));let a=t.useProgram("gltfAirLine");s.uniform2fv(a.uniforms.currentFrustum,[t.transform.near,t.transform.far]);for(let r=0;r<n.nodes.length;r++){const c=n.nodes[r];if(c.properties.name===l&&c.primitiveStack){x.setUniforms({context:o,program:a,flowSetted:c.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:c.properties.flowDirectionWrapT});for(let r=0;r<c.primitiveStack.length;r++){const l=c.primitiveStack[r],h=n.primitives[l.primitiveInd];o.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),s.uniform1i(a.uniforms.u_BaseColorSampler,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX);const u="object"==typeof h.material?h.material:n.materials[h.material];if(!u.materialParams)continue;s.uniform1i(a.uniforms.u_hightlight,!!l.highlight),n.textures&&n.textures[u.baseColorTexture&&u.baseColorTexture.index||0]?(s.uniform1i(a.uniforms.u_use_text,!0),s.uniform4fv(a.uniforms.u_fill_color,u.baseColorFactor||[1,1,1,1]),n.textures[u.baseColorTexture.index].bind(s.LINEAR,n.meshes[r].wrap||n.samplers[u.sampler].wrapS||s.CLAMP_TO_EDGE,n.textures[u.baseColorTexture.index].isSizePowerOfTwoNoneSquare()?s.LINEAR_MIPMAP_NEAREST:s.LINEAR)):(s.uniform1i(a.uniforms.u_use_text,!1),s.uniform4fv(a.uniforms.u_fill_color,u.pbrMetallicRoughness&&u.pbrMetallicRoughness.baseColorFactor||[.6,.6,.6,1]));const g=new e.Matrix4;g.scale([e.CONSTS.TRANSFORM.R_SCALE,e.CONSTS.TRANSFORM.R_SCALE,e.CONSTS.TRANSFORM.R_SCALE]);const v=i.calculateVPMatrix(),x=v.clone().multiplyRight(g);s.uniform1i(a.uniforms.u_with_shadow,!1),s.uniformMatrix4fv(a.uniforms.u_cam_matrix,!1,v.toFloat32Array()),s.uniformMatrix4fv(a.uniforms.u_proj_matrix,!1,i.td_projectionMatrix.toFloat32Array()),s.uniformMatrix4fv(a.uniforms.u_matrix,!1,x.toFloat32Array()),s.uniform2fv(a.uniforms.u_repeat,u.materialParams.repeat),s.uniform2fv(a.uniforms.u_resolution,[t.width,t.height]),s.uniform1f(a.uniforms.u_lineWidth,u.materialParams.lineWidth),s.uniform1f(a.uniforms.u_opacity,u.materialParams.opacity),s.uniform1i(a.uniforms.u_useAlphaMap,!!u.materialParams.useAlphaMap),s.uniform1f(a.uniforms.u_sizeAttenuation,u.materialParams.sizeAttenuation),s.uniform1f(a.uniforms.u_opacity,u.materialParams.opacity),s.uniform1f(a.uniforms.u_alphaTest,u.materialParams.alphaTest),s.uniform1i(a.uniforms.u_useMap,!!u.materialParams.useMap),s.uniform1i(a.uniforms.u_useDash,!!u.materialParams.useDash),s.uniform1f(a.uniforms.u_dashArray,u.materialParams.dashArray),s.uniform1f(a.uniforms.u_dashOffset,u.materialParams.dashOffset),s.uniform1f(a.uniforms.u_dashRatio,u.materialParams.dashRatio),s.uniform1f(a.uniforms.u_alphaTest,u.materialParams.alphaTest),s.uniform1f(a.uniforms.u_visibility,u.materialParams.visibility);const y=u.materialParams.color;s.uniform3fv(a.uniforms.u_color,[y.r,y.g,y.b]),m=u.materialParams.speedFactor,f=u.materialParams.segmentCount,p=u.materialParams.segmentGroup,_=t._map.timer.counter*m%(f+p),s.uniform1f(a.uniforms.u_count,_),s.uniform1f(a.uniforms.u_segments,p),t.context.setCullFace(e.CullFaceMode.disabled),Ht(h,n.gltfModelVAO,o,a,n._options.debug),d=h.triangleData;}}}let b=!1;for(let e=0;e<h.length;e++){const t=h[e][0],i=h[e][0]+h[e][1];u.push(0===e?0:u[e-1]+h[e-1][1]),_>t&&_<i&&(b=!0);}if(!b)return;a=t.useProgram("gltfPBR",null,vn.getTdModelSourceAndLayerMicroDefinition(n,r)),o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));for(let l=0;l<n.nodes.length;l++){const m=n.nodes[l];if(m.primitiveStack)for(let l=0;l<m.primitiveStack.length;l++){const f=n.primitives[m.primitiveStack[l].primitiveInd];if(!m.userNodeData||m.userNodeData.name!==c)continue;o.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.VALUE),s.uniform1i(a.uniforms.u_BaseColorSampler,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT2.INDEX);const p=n.materials[f.material];if(p.materialParams&&("MeshLineMaterial"===p.materialParams.type||"ParticleMaterial"===p.materialParams.type))continue;"OPAQUE"!==p.alphaMode&&o.setColorMode(e.ColorMode.alphaBlended),v.setUniforms({program:a,context:o,isSkinModel:!1}),g.setUniforms({program:a,context:o,highlightFlag:!1,highLightColors:r.highLightColors,highLightColorsIndex:r.highLightColorsIndex}),mn.setUniformForPrimitive({layer:r,painter:t,textures:n.textures,u_HAS_TANGENTS:n.u_HAS_TANGENTS,u_HAS_NORMALS:n.u_HAS_NORMALS,context:o,program:a,mat:p,samplers:n.samplers,isTrafficLight:!1,trafficLightOptions:null});const x=new e.Matrix4;s.uniform1i(a.uniforms.u_with_shadow,!1),s.uniformMatrix4fv(a.uniforms.u_cam_matrix,!1,x.toFloat32Array());const b=parseInt(_);for(let r=0;r<h.length;r++){const l=new e.Matrix4,c=h[r][0],m=h[r][0]+h[r][1];if(b<=c+5||b>=m-5)continue;const p=b-c+u[r];if(!d[2*p]||!d[2*(p+1)])continue;const g=d[2*p][0],v=d[2*(p+1)][0],x=[((S=v)[0]-(T=g)[0])*(y=_-b)+T[0],(S[1]-T[1])*y+T[1],(S[2]-T[2])*y+T[2]],w=new e.Vector3(v);w.subtract(g).normalize();const E=new e.Quaternion;E.rotationTo([0,0,1],w);const M=new e.Vector3(1,0,0);M.transformByQuaternion(E);const A=new e.Vector3(g),C=new e.Vector3(v),R=new e.Vector3;R.subVectors(A,C).cross(C).normalize();const L=R.clone(),P=new e.Quaternion;P.rotationTo(M,L);let{axis:I,angle:O}=P.getAxisAngle();(I[0]*w[0]<0||I[1]*w[1]<0||I[2]*w[2]<0)&&(O=2*Math.PI-O),E.rotateZ(O),l.translate([x[0]*e.CONSTS.TRANSFORM.R_SCALE,x[1]*e.CONSTS.TRANSFORM.R_SCALE,x[2]*e.CONSTS.TRANSFORM.R_SCALE]);const D=(new e.Matrix4).fromQuaternion(E);if(l.multiplyRight(D),l.scale([e.CONSTS.TRANSFORM.R_SCALE,e.CONSTS.TRANSFORM.R_SCALE,e.CONSTS.TRANSFORM.R_SCALE]),t.style.sunLightFlag){const e=l.clone().invert().transpose();s.uniformMatrix4fv(a.uniforms.u_normal,!1,e.toFloat32Array()),s.uniform1i(a.uniforms.u_with_light,!0),s.uniform3fv(a.uniforms.u_LightDirection,t._map.sunLight.getSunLightPos()),s.uniform3fv(a.uniforms.u_LightColor,[1,1,1]);}else s.uniform1i(a.uniforms.u_with_light,!1);const N=i.calculateVPMatrix().multiplyRight(l);s.uniformMatrix4fv(a.uniforms.u_matrix,!1,N.toFloat32Array()),Ht(f,n.gltfModelVAO,o,a,n._options.debug);}}}}var y,T,S;}(t,i,r);if("track"===l)return function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.context,s=o.gl,n=i.getSource(),a=n.configuration,{speedFactor:l,segmentCount:c,realtime:h,timestamp:u,trackData:d}=a,_=new fn,m=new pn,f=Date.now()-u;if(n instanceof Yt&&n.meshes.length>0){o.setStencilMode(e.StencilMode.disabled),o.setColorMode(new e.ColorMode([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0]));const i=t.transform;o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));const a=t._map.timer.counter*l%c;if(!h){let e=!1;for(let t=0;t<d.length;t++){const{start:i,end:r}=d[t];if(a>i&&a<r){e=!0;break}}if(!e)return}const u=t.useProgram("gltfPBR",null,vn.getTdModelSourceAndLayerMicroDefinition(n,r));s.uniform2fv(u.uniforms.currentFrustum,[t.transform.near,t.transform.far]),o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));const p={};let g;const v={needBackUpTextureUnitManager:!1};mn.setUniformForScene({painter:t,context:o,program:u,IBL_Support:r.usePBR},v),v.needBackUpTextureUnitManager&&(g=mi.copy(u.textureUnitManager,o),v.needBackUpTextureUnitManager=!1);for(let l=0;l<n.nodes.length;l++){const c=n.nodes[l];if(c.primitiveStack){m.setUniforms({context:o,program:u,flowSetted:c.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:c.properties.flowDirectionWrapT}),m.setUniforms({context:o,program:u,flowSetted:c.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:c.properties.flowDirectionWrapT}),m.setUniforms({context:o,program:u,flowSetted:c.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:c.properties.flowDirectionWrapT}),m.setUniforms({context:o,program:u,flowSetted:c.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:c.properties.flowDirectionWrapT});for(let l=0;l<d.length;l++){const m=d[l];let v="";if(h){const e=En(m.link_time,m.total_time_start+f,0,m.link_time.length-2),t=n.configuration.modelMap[m[n.configuration.modelMatchKeyName][e]];if(t!==c.properties.name&&t!==c.properties.fatherName)continue;if(0===e&&m.total_time_start+f<m.link_time[0])continue;v=t;}else {if(m.model!==c.properties.name&&m.model!==c.properties.fatherName)continue;if(a<m.start||a>m.end)continue}if(!m)continue;const x=h?Sn({source:n,gl:s,trackData:m,transform:i,program:u,count:a,realtime:h,timeElapsed:f,nodeMatrix:c.matrix,modelName:v,matrixObject:p,layer:r}):bn({source:n,gl:s,trackData:m,transform:i,program:u,count:a,realtime:h,timeElapsed:f,nodeMatrix:c.matrix,modelName:v,matrixObject:p,layer:r}),y=x.length;for(let a=0;a<y;a+=2){s.uniformMatrix4fv(u.uniforms.u_matrix,!1,x[a+1].toFloat32Array()),mn.setUniformForNode({painter:t,program:u,context:o,modelMatrix:x[a],transform:i,layer:r});for(let i=0;i<c.primitiveStack.length;i++){u.textureUnitManager.reset(),g&&(u.textureUnitManager=mi.copy(g,o));const a=n.primitives[c.primitiveStack[i].primitiveInd],l=a.material,h="object"==typeof l?l:n.materials[l];_.setUniforms({program:u,context:o,highlightFlag:!1,highLightColors:r.highLightColors,highLightColorsIndex:r.highLightColorsIndex});const d=n.sceneConf&&n.sceneConf.trafficLightsConf;mn.setUniformForPrimitive({layer:r,painter:t,textures:n.textures,u_HAS_TANGENTS:a.u_HAS_TANGENTS,u_HAS_NORMALS:a.u_HAS_NORMALS,context:o,program:u,mat:h,samplers:n.samplers,isTrafficLight:d,trafficLightOptions:d?{trafficLightsConf:n.sceneConf.trafficLightsConf,timer:t._map.timer.counter,name:c.properties.name,materials:n.materials}:null}),h&&!h.doubleSided&&o.setCullFace(e.CullFaceMode.backCCW),t._map.style._videoSource&&t._map.style._videoSource._videoMatchOptions.length>0&&o.setColorMode(new e.ColorMode([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),Ht(a,n.gltfModelVAO,o,u,n._options.debug),o.setCullFace(e.CullFaceMode.disabled);}}}}}n.configuration.matrixObject=p;for(let e=0;n.configuration.showDisplayBoard&&e<n.nodes.length;e++){const r=n.nodes[e];if(r.primitiveStack)for(let e=0;e<d.length;e++){const o=d[e];if(o.link_id_minemap.length>"__none_link_data__".length&&0===o.link_id_minemap.indexOf("__none_link_data__"))continue;const a=En(o.link_time,o.total_time_start+f,0,o.link_time.length-2),l=n.configuration.modelMap[o[n.configuration.modelMatchKeyName][a]];if(l!==r.properties.name&&l!==r.properties.fatherName)continue;if(!o)continue;const c=Tn({gl:s,trackData:o,transform:i,program:u,timeElapsed:f,source:n});c&&c.texture&&Xt(n.gltfModelVAO,u,t.displayBoardVertexBuffer,t,c.texture);}}}}(t,i,r);if(a.primitives.length>0){const o=a.primitives[0].material;if(o&&o.materialParams){if("MeshLineMaterial"===o.materialParams.type)return function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.context,s=o.gl,n=t.useProgram("gltfLineModel"),a=i.getSource();if(a instanceof Yt&&a.meshes.length>0){const i=t.transform;o.setDepthMode(new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,[0,1]));const r=e.calc3dModelTranslateMatrix(!1,a,r);if(a.identityMatrix||r.multiplyRight(a.matrix),t.style.sunLightFlag){const e=r.clone().invert().transpose();s.uniformMatrix4fv(n.uniforms.u_normal,!1,e.toFloat32Array()),s.uniform1i(n.uniforms.u_with_light,!0),s.uniform3fv(n.uniforms.u_LightDirection,t._map.sunLight.getSunLightPos()),s.uniform3fv(n.uniforms.u_LightColor,[1,1,1]);}else s.uniform1i(n.uniforms.u_with_light,!1);o.activeTexture.set(s.TEXTURE2),s.uniform1i(n.uniforms.u_BaseColorSampler,2);for(let e=0;e<a.nodes.length;e++){const l=a.nodes[e];if(l.primitiveStack)for(let e=0;e<l.primitiveStack.length;e++){const c=l.primitiveStack[e],h=a.primitives[c.primitiveInd],u=h.material,d="object"==typeof u?u:a.materials[u];if(!d.materialParams)continue;s.uniform1i(n.uniforms.u_hightlight,!!c.highlight),a.textures&&a.textures.length>0&&a.textures[d&&d.baseColorTexture.index||0]?(s.uniform1i(n.uniforms.u_use_text,!0),s.uniform4fv(n.uniforms.u_fill_color,d&&d.baseColorFactor||[.6,.6,.6,1]),a.textures[d.baseColorTexture.index].bind(s.LINEAR,a.meshes[e].wrap||a.samplers[d.sampler].wrapS||s.CLAMP_TO_EDGE)):(s.uniform1i(n.uniforms.u_use_text,!1),s.uniform4fv(n.uniforms.u_fill_color,d&&d.pbrMetallicRoughness.baseColorFactor||[.6,.6,.6,1]));const _=r.clone();l.identityMatrix||_.multiplyRight(l.matrix),_.multiplyLeft(i.calculateVPMatrix()),s.uniformMatrix4fv(n.uniforms.u_proj_matrix,!1,i.td_projectionMatrix.toFloat32Array()),s.uniformMatrix4fv(n.uniforms.u_matrix,!1,_.toFloat32Array()),s.uniform2fv(n.uniforms.u_repeat,d.materialParams.repeat),s.uniform2fv(n.uniforms.u_resolution,[t.width,t.height]),s.uniform1f(n.uniforms.u_lineWidth,d.materialParams.lineWidth),s.uniform1f(n.uniforms.u_opacity,d.materialParams.opacity),s.uniform1f(n.uniforms.u_useAlphaMap,d.materialParams.useAlphaMap),s.uniform1f(n.uniforms.u_sizeAttenuation,d.materialParams.sizeAttenuation),s.uniform1f(n.uniforms.u_opacity,d.materialParams.opacity),s.uniform1f(n.uniforms.u_alphaTest,d.materialParams.alphaTest),s.uniform1i(n.uniforms.u_useMap,d.materialParams.useMap),s.uniform1i(n.uniforms.u_useDash,d.materialParams.useDash),s.uniform1f(n.uniforms.u_dashArray,d.materialParams.dashArray),s.uniform1f(n.uniforms.u_dashOffset,d.materialParams.dashOffset),s.uniform1f(n.uniforms.u_dashRatio,d.materialParams.dashRatio),s.uniform1f(n.uniforms.u_alphaTest,d.materialParams.alphaTest),s.uniform1f(n.uniforms.u_visibility,d.materialParams.visibility);const m=d.materialParams.color;s.uniform3fv(n.uniforms.u_color,[m.r,m.g,m.b]),Ht(h,a.gltfModelVAO,o,n,a._options.debug);}}}}(t,i,r);if("ParticleMaterial"===o.materialParams.type)return function(t,i,r){if(r&&r.visibility&&"none"===r.visibility)return;const o=t.context,s=o.gl,n=t.useProgram("gltfParticleModel"),a=i.getSource(),l=t._map.timer.counter;if(a instanceof Yt&&a.meshes.length>0){const i=t.transform;o.setDepthMode(e.DepthMode.disabled);let c=e.createFloat64ArrayIdentityMatrix();c=e.calc3dModelTranslateMatrix(!1,a,c),s.uniform1i(n.uniforms.u_with_light,!1),o.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),s.uniform1i(n.uniforms.u_BaseColorSampler,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX);for(let h=0;h<a.nodes.length;h++){const u=a.nodes[h];if(u.primitiveStack)for(let h=0;h<u.primitiveStack.length;h++){const d=a.primitives[u.primitiveStack[h].primitiveInd],_=d.material;mn.setUniformForPrimitive({layer:r,painter:t,textures:a.textures,u_HAS_TANGENTS:d.u_HAS_TANGENTS,u_HAS_NORMALS:d.u_HAS_NORMALS,context:o,program:n,mat:_,samplers:a.samplers,isTrafficLight:!1,trafficLightOptions:null});const m=c.clone();u.identityMatrix||m.multiplyRight(u.matrix);const f=(new e.Matrix4).rotateY(-i.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD);m.multiplyRight(f);const p=(new e.Matrix4).rotateX(-Math.PI/2+i._pitch);m.multiplyRight(p),m.multiplyLeft(i.calculateVPMatrix()),s.uniform1i(n.uniforms.u_with_shadow,!1),s.uniform4fv(n.uniforms.uColor,_.materialParams.particleColor),s.uniform3fv(n.uniforms.uFirePos,_.materialParams.position),s.uniform1f(n.uniforms.uTime,l),s.uniform1i(n.uniforms.uUseBillboarding,!1),s.uniformMatrix4fv(n.uniforms.uViewMatrix,!1,i.td_viewMatrix.toFloat32Array()),s.uniformMatrix4fv(n.uniforms.u_matrix,!1,m.toFloat32Array()),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE),Ht(d,a.gltfModelVAO,o,n,a._options.debug),s.disable(s.BLEND);}}}}(t,i,r)}}const c=t.context,h=c.gl;let u;0==c.supportPBR&&(r.usePBR=!1);const d=t.cameraDrawMode;if(u=t.useProgram(_a[0],null,d===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||d===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||d===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL?vn.getTdModelSourceAndLayerMicroDefinition(a,r,d):vn.getTdModelSourceAndLayerMicroDefinition(a,r)),h.uniform2fv(u.uniforms.currentFrustum,[t.transform.near,t.transform.far]),a instanceof Yt&&a.meshes.length>0){const l=t._map.directionLightParameter,d=(new e.Matrix4).rotateX(Math.PI/2),_=r.useLayerPosition;_&&!r.baseMatrixCalculated&&r.calcBaseMatrix(a),c.setStencilMode(r.clipGround?e.StencilMode.enableClipGround:e.StencilMode.disabled);const m=t.transform;c.setDepthMode(new e.DepthMode(h.LESS,e.DepthMode.ReadWrite,[0,1]));const f=new e.Matrix4;let p=new e.Matrix4;p=e.calc3dModelTranslateMatrix(!1,_?r:a,p);const g=a.clampEnabled;s.setUniforms({program:u,source:a,context:c,isClamp:g}),g&&f.translate((_?r:a).translation||[0,0,0]);const v=p.invert(new e.Matrix4).transpose();let x;h.uniformMatrix4fv(u.uniforms.u_normal,!1,v.toFloat32Array());const y={needBackUpTextureUnitManager:!1};let T=a._useVideoProject;const S=t._map.style._videoSource;T=!!S&&T&&S.available,T&&(y.needBackUpTextureUnitManager=S._parseVideoTexture(t,u,y.needBackUpTextureUnitManager)),t._map._shadowFlag&&(i.root2GeoMat||(i.root2GeoMat=p.clone()),m.mSceneToGlobe=p,null!=l.mSceneEnvelope&&l.mCurShadowLayer==r||(l.mSceneEnvelope=function(t){const i=new e.CN_Envelope,r=new e.Matrix4(e.Matrix4.IDENTITY).rotateX(Math.PI/2);for(let o=0;o<t.nodes.length;o++){const s=t.nodes[o];if(!s||!s.hasOwnProperty("mesh")||!s.primitiveStack)continue;const n=(new e.Matrix4).copy(r);s.identityMatrix||n.multiplyRight(s.matrix);for(let r=0;r<s.primitiveStack.length;r++){const o=t.primitives[s.primitiveStack[r].primitiveInd],a=o.aabb[0],l=o.aabb[1],c=new e.Vector4(a[0],a[1],a[2],1),h=new e.Vector4(0,0,0,1);c.transform(n,h);const u=new e.Vector4(l[0],l[1],l[2],1),d=new e.Vector4(0,0,0,1);u.transform(n,d);const _=new e.Vector3(h[0],h[1],h[2]),m=new e.Vector3(d[0],d[1],d[2]);i.update(_),i.update(m);}}return i}(a))),da.setUniformForScene({painter:t,program:u,context:c,layer:r,modelTranslateMatrix:p,rotationY:d},y),ua.setUniformForScene({painter:t,program:u,context:c,layer:r},y),mn.setUniformForScene({painter:t,context:c,program:u,IBL_Support:r.usePBR},y),y.needBackUpTextureUnitManager&&(x=mi.copy(u.textureUnitManager,c),y.needBackUpTextureUnitManager=!1),c.setColorMode(new e.ColorMode([h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),ca.updateAnimation({animationMixers:a.animationMixers,nodes:a.nodes,skins:a.skins,context:c,program:u,nodeStructure:a.nodeStructure});for(let i=0;i<a.nodes.length;i++){const s=a.nodes[i];if(!s||!s.hasOwnProperty("mesh")||!s.primitiveStack)continue;n.setUniforms({context:c,program:u,flowSetted:s.properties.flowTexture,offValue:t._map.timer.counter,flowDirectionWrapT:s.properties.flowDirectionWrapT});const v=p.clone(),y=f.clone();s.identityMatrix||(v.multiplyRight(s.matrix),g&&y.multiplyRight(s.matrix)),h.uniformMatrix4fv(u.uniforms.u_clamp_model_matrix,!1,y.toFloat32Array()),mn.setUniformForNode({painter:t,program:u,context:c,modelMatrix:v,transform:m,layer:r}),t.depthPick||(da.setUniformForNode({painter:t,program:u,context:c,modelMatrix:d,transform:m,oneNode:s}),ua.setUniformForNode({painter:t,program:u,context:c,modelMatrix:v,transform:m}));const b=v.multiplyLeft(m.calculateVPMatrix());h.uniformMatrix4fv(u.uniforms.u_matrix,!1,b.toFloat32Array());for(let n=0;n<s.primitiveStack.length;n++){u.textureUnitManager.reset(),x&&(u.textureUnitManager=mi.copy(x,c)),T&&S.uploadTexture(t,u);const d=a.primitives[s.primitiveStack[n].primitiveInd],m=d.material,f="object"==typeof m?m:a.materials[m];o.setUniforms({program:u,context:c,highlightFlag:_?r.nodes[i].primitiveStack[n].highlight:a.nodes[i].primitiveStack[n].highlight,highLightColors:r.highLightColors,highLightColorsIndex:r.highLightColorsIndex});const p=a.sceneConf&&a.sceneConf.trafficLightsConf;mn.setUniformForPrimitive({layer:r,painter:t,textures:a.textures,u_HAS_TANGENTS:d.u_HAS_TANGENTS,u_HAS_NORMALS:d.u_HAS_NORMALS,context:c,program:u,mat:f,samplers:a.samplers,isTrafficLight:p,trafficLightOptions:p?{trafficLightsConf:a.sceneConf.trafficLightsConf,timer:t._map.timer.counter,name:s.properties.name,materials:a.materials}:null}),f&&!f.doubleSided&&c.setCullFace(e.CullFaceMode.backCCW),S&&S._videoMatchOptions.length>0&&c.setColorMode(new e.ColorMode([h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA],e.Color.transparent,[!0,!0,!0,!0])),Ht(d,a.gltfModelVAO,c,u,a._options.debug),l.mCurNodeCountRender++,c.setCullFace(e.CullFaceMode.disabled);}}r.clipGround&&c.setStencilMode(e.StencilMode.disabled);}},symbol:function(t,i,r,o){if(void 0===r.paint)return;if("translucent"!==t.renderPass)return;const s=t.context;s.setStencilMode(e.StencilMode.disabled),s.setColorMode(e.ColorMode.alphaBlended),s.setDepthMode(e.DepthMode.disabled),s.setCullFace(e.CullFaceMode.disabled),0!==r.paint.get("icon-opacity").constantOr(1)&&Wn(t,i,r,o,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright")),0!==r.paint.get("text-opacity").constantOr(1)&&Wn(t,i,r,o,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright")),i.map.showCollisionBoxes&&jn(t,i,r,o);},extrusion:function(t,i,r,o){if(!r.paint||0===r.paint.get("extrusion-opacity").value.value)return;const s=t.context;let n;s.setDepthMode(new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]));const a=r.paint.get("extrusion-pattern"),l=t.cameraDrawMode;n=l===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN||l===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?a?Kn[2]:Kn[3]:l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||l===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL?a?Kn[4]:Kn[5]:a?Kn[0]:Kn[1],1===r.paint.get("extrusion-opacity").value.value?(s.setStencilMode(e.StencilMode.disabled),s.setColorMode(e.ColorMode.disabled),Jn(t,i,r,o,n,a),s.setStencilMode(t.stencilModeFor3D()),s.setColorMode(e.ColorMode.unblended),Jn(t,i,r,o,n,a)):a?(s.setStencilMode(e.StencilMode.disabled),s.setColorMode(e.ColorMode.disabled),Jn(t,i,r,o,n,a),s.setStencilMode(t.stencilModeFor3D()),s.setColorMode(e.ColorMode.alphaBlended),Jn(t,i,r,o,n,a)):(r.paint.get("extrusion-close-stencil-clip")||(s.setStencilMode(e.StencilMode.disabled),s.setColorMode(e.ColorMode.disabled),Jn(t,i,r,o,n,a)),s.setStencilMode(t.stencilModeFor3D()),s.setColorMode(e.ColorMode.alphaBlended),Jn(t,i,r,o,n,a));},histogram:function(t,i,r,o){if(!r.paint||0===r.paint.get("histogram-opacity"))return;const s=t.context;let n;s.setDepthMode(new e.DepthMode(s.gl.LESS,e.DepthMode.ReadWrite,[0,1]));const a=t.cameraDrawMode;n=a===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN||a===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?Ta[3]:a===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||a===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||a===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL?Ta[5]:Ta[1],s.setColorMode(a===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN||a===e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?e.ColorMode.unblended:e.ColorMode.alphaBlended);let l=!0;for(const e of o){const o=i.getTile(e).getBucket(r);o&&(Sa(t,0,r,0,0,o,l,n),l=!1);}},sprite:function(t,i,r,o){if(void 0===r.paint)return;if("translucent"!==t.renderPass)return;const s=r.paint.get("sprite-opacity"),n=r.paint.get("sprite-width");if(0===s.constantOr(1)||0===n.constantOr(1))return;const a=t.context;let l;a.setCullFace(e.CullFaceMode.disabled),a.setDepthMode(r.depthTest?new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),t._map.clipGroundState&&a.setStencilMode(e.StencilMode.openClipGround);let c=!0;r.hasOwnProperty("count")||(r.count=0),r.count=t._map.timer.counter*(r.paint.get("sprite-speed")||60),a.setColorMode(e.ColorMode.alphaBlended);for(const e of o){const o=i.getTile(e),s=o.getBucket(r);if(!s)continue;const n=s.programConfigurations.get(r.id);oa(t,o,s,r,0,c,n,l),l=o.tileID.overscaledZ,c=!1;}a.setStencilMode(e.StencilMode.disabled),a.setColorMode(e.ColorMode.unblended);},tracking:function(t,i,o,s){if(void 0===o.paint)return;const n=o.paint.get("tracking-opacity"),a=o.paint.get("tracking-width");if(0===n.constantOr(1)||0===a.constantOr(1))return;const l=t.context;l.setColorMode(e.ColorMode.alphaBlended),l.setDepthMode(o.depthTest?new e.DepthMode(l.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),t._map.clipGroundState&&l.setStencilMode(e.StencilMode.openClipGround);const c=o.paint.get("tracking-seg-group"),h=o.paint.get("tracking-delay"),u=o.paint.get("tracking-speed")?o.paint.get("tracking-speed"):1;if("history"===o.paint.get("tracking-type")){o.first||(o.first=!0,o.histStart=0,o.histCount=0,o.isReverse=!1,o.isReserve=!1);const e=t.timer.counter*u;"loop"===o.layout.get("tracking-display-mode")?(o.histCount=e,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse"===o.layout.get("tracking-display-mode")?(o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1):"loop-reserve"===o.layout.get("tracking-display-mode")?(o.isReserve=!0,o.histCount=e,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse-reserve"===o.layout.get("tracking-display-mode")&&(o.isReserve=!0,o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1),r.TRW&&r.TRW.setProgress(o.histCount),o.histStart=o.histEnd;}else {o.count||(o.count=1);const e=t.timer.counter*u,i=r.TRW,s=o.paint.get("tracking-run-time");o.count=e;const n=i&&i.hasOwnProperty("replaceOffset")?i.replaceOffset:s+h;o.count%=n;const a=i&&i.hasOwnProperty("requestOffset")?i.requestOffset:h;o.count===a&&i&&i.request(),0===o.count&&(i&&i.replace(),o.count=h),i&&(i.currentSeq=o.count);}!function(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(let i=0;i<t.TRW.layerForwards.length;i++){const r=t.TRW.layerForwards[i];if(r.id===e.id){e.count&&(e.count+=r.count),t.TRW.layerForwards.splice(i,1);break}}}}(o,r),l.setCullFace(e.CullFaceMode.disabled),function(e,t,i,r,o,s,n,a,l){let c,h=!0;for(const o of r){const r=t.getTile(o),u=r.getBucket(i);if(!u)continue;const d=u.programConfigurations.get(i.id),_=e.context.program.get(),m=e.useProgram("sphereTracking",d);ra(m,e,r,u,i,0,d,h||m.program!==_,c!==r.tileID.overscaledZ,s,n,a,l),c=r.tileID.overscaledZ,h=!1;}}(t,i,o,s,0,"history"===o.paint.get("tracking-type")?o.histCount:o.count,o.isReverse,o.isReserve,c),l.setStencilMode(e.StencilMode.disabled);},dynamicLine:function(t,i,r,o){const s=r.paint.get("dynamicLine-opacity"),n=r.paint.get("dynamicLine-width");if(0===s.constantOr(1)||0===n.constantOr(1))return;const a=t.context;a.setColorMode(e.ColorMode.alphaBlended),a.setCullFace(e.CullFaceMode.disabled),a.setDepthMode(new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]));const l=a.gl;ta=r.paint.get("dynamicLine-seg-group")||20;const c=t.timer.counter*r.paint.get("dynamicLine-speed");t._map.clipGroundState&&a.setStencilMode(e.StencilMode.openClipGround),l.enable(l.POLYGON_OFFSET_FILL),function(e,t,i,r,o,s,n,a){let l,c=!0;for(const o of r){const r=t.getTile(o),s=r.getBucket(i);if(!s)continue;const h=s.programConfigurations.get(i.id),u=e.context.program.get(),d=e.useProgram("sphereDynamicLine",h);ia({program:d,painter:e,tile:r,bucket:s,layer:i,programConfiguration:h,programChanged:c||d.program!==u,tileRatioChanged:l!==r.tileID.overscaledZ,isBorder:!1,count:n,segmentGroup:a}),l=r.tileID.overscaledZ,c=!1;}}(t,i,r,o,0,0,c,ta),a.setStencilMode(e.StencilMode.disabled),l.disable(l.POLYGON_OFFSET_FILL);},background:function(t,i,r,o){const s=r.paint.get("background-color"),n=r.paint.get("background-opacity");if(0===n)return;const a=t.context,l=a.gl,c=r.paint.get("background-pattern");a.setDepthMode(e.DepthMode.disabled),a.setCullFace(e.CullFaceMode.backCCW),a.setStencilMode(e.StencilMode.disabled),a.setColorMode(1===n?e.ColorMode.unblended:e.ColorMode.alphaBlended),t._map.clipGroundState&&a.setStencilMode(e.StencilMode.openClipGround);const h=new e.EvaluationParameters(t.transform.zoom).getCrossfadeParameters();let u;if(c){const e=void 0===r.paint.get("background-pattern-fixed")||r.paint.get("background-pattern-fixed");if(In(c,t))return;u=t.useProgram("sphereBackgroundPattern"),On(c,t,u,h,e),t.tileExtentPatternVAO.bind(a,u,t.tileExtentBuffer,[]);}else u=t.useProgram("sphereBackground"),l.uniform4fv(u.uniforms.u_color,s?[s.r,s.g,s.b,s.a]:[.35,.35,.35,1]),t.tileExtentVAO.bind(a,u,t.tileExtentBuffer,[]);l.uniform2fv(u.uniforms.currentFrustum,[t.transform.near,t.transform.far]),l.uniform1f(u.uniforms.u_opacity,n);const d=t.transform,_=d.coveringTiles({tileSize:d.tileSize});for(const e of _){const i=t.sphereTileVerticeCache.get(e,a);l.uniformMatrix4fv(u.uniforms.u_matrix,!1,t.transform.calculateVPMatrix().multiplyRight(i.matrix).toFloat32Array()),u.draw(a,l.TRIANGLES,r.id,i.sphereMaskedBoundsBuffer,i.sphereMaskedIndexBuffer,i.sphereSegments);}t.transform.projection===e.ProjectionType.MERCATOR&&function(e,t){const i=e.context,r=i.gl;r.uniformMatrix4fv(t.uniforms.u_matrix,!1,e.transform.calculateVPMatrix().toFloat32Array());const o=e.getSphereBuffer();e.sphereVAO.bind(i,t,o,[]),r.drawArrays(r.TRIANGLE_STRIP,0,o.length);}(t,u),a.setStencilMode(e.StencilMode.disabled);},fxaa:function(e){for(let t=0;t<1;t++)va(e,e.fbManager.fxaaFramebuffer,e.fbManager.fxaaExcFramebuffer),va(e,e.fbManager.fxaaExcFramebuffer,e.fbManager.fxaaFramebuffer);va(e,e.fbManager.fxaaFramebuffer,null);},bloom:function(t){let i,r;t.getDefaultFrameBuffer()===t.fbManager.fxaaFramebuffer.framebuffer?(i=t.fbManager.fxaaFramebuffer,r=!0):(i=t.fbManager.bloomBaseColorFramebuffer,r=!1),t.context.setCullFace(e.CullFaceMode.disabled),t.context.setColorMode(e.ColorMode.unblended),t.context.setDepthMode(e.DepthMode.disabled),ya(t,i,t.fbManager.bloomFramebuffer,xa[0],[0,1],null);for(let e=0;e<t._map._bloomOptions.step;e++)ya(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomExcFramebuffer,xa[1],[0,1],null),ya(t,t.fbManager.bloomExcFramebuffer,t.fbManager.bloomFramebuffer,xa[1],[1,0],null);r?(ya(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomBaseColorFramebuffer,xa[2],[0,1],i),ya(t,t.fbManager.bloomBaseColorFramebuffer,t.fbManager.fxaaFramebuffer,xa[3],[0,1],null)):ya(t,t.fbManager.bloomFramebuffer,null,xa[2],[0,1],i);},custom:function(t,i,r){const o=t.context,s=r.implementation;t.setCustomLayerDefaults(),o.setStencilMode(e.StencilMode.disabled);const n="3d"===s.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled;o.setDepthMode(n),o.setColorMode(e.ColorMode.unblended);const a=e.calcCustomLayerTranslateMatrix(s.anchor,e.createFloat64ArrayIdentityMatrix());a.multiplyLeft(t.transform.customLayerMatrix()),s.render(o.gl,a.toFloat32Array()),o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null);},panorama:function(t,i){if(!t._map.panoramaMode)return;const r=t.context,o=r.gl,s=i.getSource();if(s instanceof xi){if(r.setStencilMode(e.StencilMode.disabled),s.texture){const i=t.useProgram("panorama");o.uniformMatrix4fv(i.uniforms.u_matrix,!1,t.transform.td_vpMatrix.clone().toFloat32Array()),r.setColorMode(e.ColorMode.unblended),r.setCullFace(e.CullFaceMode.disabled),r.setDepthMode(new e.DepthMode(r.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),r.activeTexture.set(e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE),o.uniform1i(i.uniforms.u_std_resolution_img,e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.INDEX),s.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const n=s.sphereBuffer;s.sphereVAO.bind(r,i,n,[]),o.drawArrays(s._options.debug?o.LINE_STRIP:o.TRIANGLE_STRIP,0,n.length);}r.setDepthMode(new e.DepthMode(r.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]));}},debug:function(t,i,r){t.debugTileCache.setMaxTile(2*r.length);const o=t.context;o.setDepthMode(new e.DepthMode(o.gl.LESS,e.DepthMode.ReadWrite,[0,1])),o.setStencilMode(e.StencilMode.disabled),o.setColorMode(e.ColorMode.unblended);for(let e=0;e<r.length;e++)pa(t,0,r[e]);},symtracking:function(t,i,r,o){if(void 0===r.paint)return;if("translucent"!==t.renderPass)return;if(r.layout.get("symtracking-display-mode")===e.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.DEFAULT){r._count=r._count?r._count:0,void 0===r.first&&(r.first=!0),r.startOffset=r.startOffset?r.startOffset:0,r.preFps=r.preFps?r.preFps:0,r.fpsDifference=r.fpsDifference?r.fpsDifference:0,r.fpsOffset=r.fpsOffset?r.fpsOffset:0,r.totalFpsOffset=r.totalFpsOffset?r.totalFpsOffset:0;const e=r.layout.get("symtracking-fps"),i=r.layout.get("symtracking-time-segment");r.offset=r.paint.get("symtracking-delay");const o=e*(i+r.offset);r.first&&(r.startOffset=t.timer.counter*e,r.first=!1,r.fpsFirst=e);const s=t.timer.counter;r.preFps&&r.preFps!==r.layout.get("symtracking-fps")&&(r.fpsDifference=r.layout.get("symtracking-fps")-r.preFps,r.fpsOffset=s*r.fpsDifference,r.totalFpsOffset+=r.fpsOffset),r.preFps=e,r._count=Math.round(s*e-r.startOffset-r.totalFpsOffset),r._count%=o;}const s=t.context;s.setStencilMode(e.StencilMode.disabled),s.setColorMode(e.ColorMode.alphaBlended),s.setCullFace(e.CullFaceMode.disabled),s.setDepthMode(r.depthTest?new e.DepthMode(s.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1]):e.DepthMode.disabled),0!==r.paint.get("icon-opacity").constantOr(1)&&Ea(t,i,r,o,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),r._count),0!==r.paint.get("text-opacity").constantOr(1)&&Ea(t,i,r,o,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),r._count),i.map.showCollisionBoxes&&jn(t,i,r,o);}};class Ua{constructor(t,i,r,o){this.context=new re(t,r),this.transform=i,this._tileTextures={},this.timer=o,this.setup(),this.numSublayers=Nr.maxUnderzooming+Nr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new e.ProgramConfiguration,this.crossTileSymbolIndex=new Or,this.depthPick=!1,this._logarithmicDepthBuffer=r._logarithmicDepthBuffer,this.context._logarithmicDepthBuffer=this._logarithmicDepthBuffer,this.shadowOff=e.CONSTS.EFFECTS.SHADOW_OFFSET,this.sphereTileVerticeCache=new ga(0,null,this.transform.projection),this._map=r,this.fbManager=null,this._currentCameraView=null,this.activeCameras=null,this.cameraDrawMode=e.CONSTS.CAMERA.DRAW_MODE.NORMAL,this._currentFrameBuffer=null,this.emptyTileTextureCanvas=null,this.nextStencilID=1,this.shaderProgramManager=new vn({context:this.context}),this.transform.setPainter(this),this.genSphereVAO(),this._displayBoardArray=[],this.displayBoardVertexBuffer=jt.createGlBuffer("",this.context),this.mShadowEffect=new ln({context:this.context,pTransform3D:this.transform,pPainter:this}),this.mTexturedQuad=new cn({context:this.context});}getSphereBuffer(){return this.sphereBuffer}genSphereVAO(){if(!this.sphereBuffer){const t=new e.StructArrayLayout5f20;e.sphereGenerator(e.CONSTS.TRANSFORM.R,9,256,e.ProjectionType.LATLON,t),this.sphereBuffer=this.context.createVertexBuffer(t,ui.members);}if(!this.cubeBuffer){const t=new e.StructArrayLayout5f20;e.cubeGenerator(1,1,1,1,t),this.cubeBuffer=this.context.createVertexBuffer(t,ui.members);}this.sphereVAO||(this.sphereVAO=new Le),this.cubeVAO||(this.cubeVAO=new Le);}addDisplayBoard(e){this._displayBoardArray.push(e);}removeDisplayBoard(e){for(let t=0;t<this._displayBoardArray.length;t++)if(e===this._displayBoardArray[t]){this._displayBoardArray.splice(t,1);break}}renderDisplayBoards(){if(this._displayBoardArray&&this._displayBoardArray.length>0){const e=this.useProgram("simpleModel");for(let t=0;t<this._displayBoardArray.length;t++)this._displayBoardArray[t].render(this.viewportVAO,e,this.displayBoardVertexBuffer);}}setSkyBoxMapTexture(e,t){this.skyBoxCubeTexture=e,this.isSkyBoxCubeTexture=t,this.shaderProgramManager.setGlobalMacroDefinition({SKYBOX_CUBE_MAP_G:t});}setBrdfTexture(e){this.brdfTexture=e;}setShadowOff(e,t){this.shadowOff=e,this.shadowDistance=t;}get projection(){return this._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this._projection=t,this.sphereTileVerticeCache.projection=t);}resize(t,i){const r=this.context.gl;if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.disableDepthPick(),this.style)for(const e of this.style._order)this.style._layers[e].resize();this.depthRbo&&(r.deleteRenderbuffer(this.depthRbo),this.depthRbo=null),this.fbManager?this.fbManager.resize(this.width,this.height):this.fbManager=new Oa(this.context,this.width,this.height);}getDefaultFrameBuffer(){return this._currentFrameBuffer}enableDepthPick(){this.depthPick=!0,this.bindPickBuffer();}bindPickBuffer(){this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.clear({color:e.Color.transparent,depth:1});}disableDepthPick(){this.depthPick=!1,this.context.bindFramebuffer.set(this.getDefaultFrameBuffer());}getPickRay(t){const i=t,r=this.context.gl;if(!this.style)return {z_ndc:.991};const o=new Uint8Array(4);if(this._checkStatusChange()){this.enableDepthPick(),this.render(this.style,this.options),this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),r.readPixels(i.x*e.window.devicePixelRatio,this.height-i.y*e.window.devicePixelRatio,1,1,r.RGBA,r.UNSIGNED_BYTE,o);let t=2*(this.context.czm_unpackDepth(o)-.5);this.disableDepthPick(),t>1?t=.999:t<-1&&(t=-.999),this.ray=new se(this.transform.getCameraPos(),ws(i.x,i.y,t,this.transform)),this.ray.z_ndc=t;}else {this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),r.readPixels(i.x*e.window.devicePixelRatio,this.height-i.y*e.window.devicePixelRatio,1,1,r.RGBA,r.UNSIGNED_BYTE,o);let t=2*(this.context.czm_unpackDepth(o)-.5);this.disableDepthPick(),t>1?t=.999:t<-1&&(t=-.999),this.ray=new se(this.transform.getCameraPos(),ws(i.x,i.y,t,this.transform)),this.ray.z_ndc=t;}return this.ray}queryPixelColor(t,i){const r=t[0],o=this.context.gl,s=new Uint8Array(4);o.readPixels(r.x*e.window.devicePixelRatio,this.height-r.y*e.window.devicePixelRatio,1,1,o.RGBA,o.UNSIGNED_BYTE,s);const n=`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${+parseFloat(s[3]/255).toFixed(2)})`;return {rgba:n,hex:e.rgba2Hex(n),color:new e.Color(s[0]/255,s[1]/255,s[2]/255,s[3]/255)}}_checkStatusChange(){if(!this.ray)return !0;const e=this.transform;return this._rayStatus?(this._rayStatus.zoom!==e.zoom||this._rayStatus.pitch!==e.pitch||this._rayStatus.bearing!==e.bearing||this._rayStatus.center.lng!==e.center.lng||this._rayStatus.center.lat!==e.center.lat)&&(this._rayStatus={zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,center:e.center},!0):(this._rayStatus={zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,center:e.center},!0)}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,Vs.members),this.tileExtentVAO=new Le,this.tileExtentPatternVAO=new Le;const r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(e.EXTENT,e.EXTENT),r.emplaceBack(0,e.EXTENT),r.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(r,Vs.members),this.debugVAO=new Le;const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(o,hi.members),this.rasterBoundsVAO=new Le;const s=new e.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(s,Vs.members),this.viewportVAO=new Le;}clearStencil(){const t=this.context,i=t.gl;t.setColorMode(e.ColorMode.disabled),t.setDepthMode(e.DepthMode.disabled),t.setStencilMode(new e.StencilMode({func:i.ALWAYS,mask:0},0,255,i.ZERO,i.ZERO,i.ZERO));const r=new e.Matrix4;r.ortho({left:0,right:this.width,bottom:this.height,top:0,near:0,far:1}),r.scale([i.drawingBufferWidth,i.drawingBufferHeight,0]);const o=this.useProgram("sphereClipping");i.uniformMatrix4fv(o.uniforms.u_matrix,!1,r.toFloat32Array()),this.viewportVAO.bind(t,o,this.viewportBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,4);}_renderTileClippingMasks(t){const i=this.context,r=i.gl;this.nextStencilID+t.length>256&&(this.nextStencilID=1,this.clearStencil()),i.setColorMode(e.ColorMode.disabled),i.setDepthMode(e.DepthMode.disabled),this._tileClippingMaskIDs={};for(const o of t){const t=this._tileClippingMaskIDs[o.key]=this.nextStencilID++;i.setStencilMode(new e.StencilMode({func:r.ALWAYS,mask:0},t,255,r.KEEP,r.KEEP,r.REPLACE));const s=this.useProgram("sphereClipping"),n=this.sphereTileVerticeCache.get(o,i);r.uniformMatrix4fv(s.uniforms.u_matrix,!1,this.transform.calculateVPMatrix().multiplyRight(n.matrix).toFloat32Array()),s.draw(i,r.TRIANGLES,"layer.id.sphereClipping",n.sphereMaskedBoundsBuffer,n.sphereMaskedIndexBuffer,n.sphereSegments);}}stencilModeFor3D(){this.nextStencilID+1>256&&(this.nextStencilID=1,this.clearStencil());const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return "opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,r){const o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(r||this.context.gl.LEQUAL,i,[o,o])}depthModeForExtrusionlayer(t,i,r){const o=Math.max(1-this.currentLayer*this.depthEpsilon*11e3,.2),s=Math.min(1-(1+this.currentLayer)*this.depthEpsilon*11e3,0);return new e.DepthMode(r||this.context.gl.LEQUAL,i,[s,o])}_drawSurroundings(){this.style.sourceCaches[e.CONSTS.SOURCE.SKYBOX_SOURCE_ID]&&Ba.sphereSkybox(this,this.style.sourceCaches[e.CONSTS.SOURCE.SKYBOX_SOURCE_ID]),this.style.sourceCaches[e.CONSTS.SOURCE.GLOBAL_SOURCE_ID]&&Ba.sphere(this,this.style.sourceCaches[e.CONSTS.SOURCE.GLOBAL_SOURCE_ID]);}getCurrentCameraView(){return this._currentCameraView}_sphereDrawShadowLoop(t){const i=this._map.directionLightParameter;let r;this.context.clear({color:e.Color.transparent,depth:1}),this.clearStencil(),this.currentLayer=0;const o=this.style._order;for(;this.currentLayer<o.length;this.currentLayer++){const e=this.style._layers[o[this.currentLayer]];"visual_domain_analysis_layer"!==e.id&&(t&&!0===t&&e!==i.mCurShadowLayer||-1===e.type.indexOf("3d-model")&&-1===e.type.indexOf("3d-tiles")||(r=this.style.sourceCaches[e.source],e&&e.isHidden(this.transform.zoom)||(-1!==e.type.indexOf("3d-model")&&Cn(this,r,e),-1!==e.type.indexOf("3d-tiles")&&Ln(this,r,e))));}}_sphereDrawLoop(){let t;this.renderPass="offscreen";let i=[];this.clearStencil(),this.currentLayer=0;const r=this.style._order;if(this.context.clear({color:this._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1}),this._map.clipGroundState)for(;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]];-1!==e.type.indexOf("3d-model")&&!0===e.clipGround&&(t=this.style.sourceCaches[e.source],this.renderSphereLayer(this,t,e,i));}for(;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]];e&&-1!==e.type.indexOf("heatmap")&&(e.source===(t&&t.id)||(t=this.style.sourceCaches[e.source],i=[],t&&(i=t.getVisibleCoordinates()),i.length))&&this.renderSphereLayer(this,t,e,i);}let o;this._drawSurroundings(),void 0!==this._map.style._videoSource&&this._map.style._videoSource.prepare(),this.renderPass="translucent";let s=[];this.currentLayer=0;const n=this.style._order;for(;this.currentLayer<n.length;this.currentLayer++){const e=this.style._layers[n[this.currentLayer]];if(-1===e.type.indexOf("3d-model")||!0!==e.clipGround){if(e.source!==(o&&o.id))o=this.style.sourceCaches[e.source],s=[],o&&o.getVisibleCoordinates&&(s=o.getVisibleCoordinates("symbol"===e.type||"symtracking"===e.type));else {const t=e.layout&&e.layout.get("symbol-placement"),i=s.every((e=>e.posMatrix));!t||"point"!==t&&"line"!==t&&"line-center"!==t||i||(s=[],o&&o.getVisibleCoordinates&&(s=o.getVisibleCoordinates("symbol"===e.type||"symtracking"===e.type)));}(0!==e.type.indexOf("heatmap")||s.length)&&this.renderSphereLayer(this,o,e,s);}}}sphereModeRender(){if(this.sphereTileVerticeCache.updateCacheSize(this.transform),this._map.panoramaMode)return this.renderSphereLayer(this,this.style.sourceCaches[e.CONSTS.SOURCE.PANORAMA_SOURCE_ID],this.style._layers[e.CONSTS.LAYER.PANORAMA_LAYER_ID],{});if(this.depthPick)this.cameraDrawMode=e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN,this._currentFrameBuffer=this.fbManager.pickFramebuffer.framebuffer,this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN,this._sphereDrawLoop();else {let t=e.CONSTS.CAMERA.DRAW_MODE.NORMAL;const i=this._map.directionLightParameter;if(this.activeCameras.shadow&&i.mSceneEnvelope){const r=this.mShadowEffect.mSMFBO;i.mShadowCenterMode?this.mShadowEffect.mSMAlg.updateSMFruByCurViewAndCenterR(r):this.mShadowEffect.mSMAlg.updateSMFruBySceneBox(r),r.dirtyShadowMap&&(r.dirtyShadowMap=!1,this.cameraDrawMode=e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN,this._currentFrameBuffer=r.mSMArray[0].framebuffer,this.context.bindFramebuffer.set(r.mSMArray[0].framebuffer),this.context.viewport.set([0,0,r.mSMWidth,r.mSMHeight]),this._currentCameraView=this.activeCameras.shadow,this._sphereDrawShadowLoop()),t=e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW;}const r=[];this.activeCameras.viewshed.length>0&&(t=t===e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_SHADOW?e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_ALL:e.CONSTS.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED);for(let t=0;t<this.activeCameras.viewshed.length&&t<1;t++){this.cameraDrawMode=e.CONSTS.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED;const i=this.fbManager.getAFramebufferFromPool();r.push(i);const o=this.activeCameras.viewshed[t];o.fb=i,this._currentCameraView=o,this._currentFrameBuffer=i.framebuffer,this.context.bindFramebuffer.set(i.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._sphereDrawShadowLoop();}i.mCurNodeCountRender=0,this._map.fxaaRender?(this._currentFrameBuffer=this.fbManager.fxaaFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):this._map.bloomRender?(this.fbManager.bloomBaseColorFramebuffer=this.fbManager.createAFrameBuffer(1,{depthRenderbuffer:!1,depthStencilRenderbuffer:!0}),this._currentFrameBuffer=this.fbManager.bloomBaseColorFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):(this._currentFrameBuffer=null,this.context.bindFramebuffer.set(null)),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=t,this._sphereDrawLoop(),this.renderDisplayBoards();for(let e=0;e<r.length;e++)this.activeCameras.viewshed[e].fb=null,this.fbManager.releaseAFramebufferOfPool(r[e]);this._map.bloomRender&&this.renderSphereLayer(this,{},{type:"bloom",isHidden:e=>e<0},{}),this._map.fxaaRender&&this.renderSphereLayer(this,{},{type:"fxaa",isHidden:e=>e<0},{});}}renderSphereLayer(e,t,i,r){if(!i||!i.isHidden(this.transform.zoom))if(i||r){if("clipVideoLayer"===i.id)e._map.activeClipVideo&&Ba.maskFill(e,t,i,r);else if(i&&r){if("line"===i.type&&i.paint){const e=i.paint.get("line-opacity");this._map.transform.zoom>=7&&(e.constantOr(1)<1||!e.isConstant())&&this._renderTileClippingMasks(r);}else if("fill"===i.type&&i.paint){const e=i.paint.get("fill-opacity"),t=i.getPaintProperty("fill-outline-color"),o=this._map.style._originalLayer.includes(i.id);this._map.transform.zoom>=7&&(e.constantOr(1)<1||!e.isConstant()||!o&&t)&&this._renderTileClippingMasks(r);}Ba[i.type](e,t,i,r);}}else Ba.sphere(e,t);}render(t,i){this._tileClippingMaskIDs={},this.nextStencilID=1,this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.imageManager.beginFrame(),this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now());for(const e in t.sourceCaches){const t=this.style.sourceCaches[e];t.used&&t.prepare(this.context);}this.context.bindFramebuffer.set(null);const r=this.context.gl;if(this.context.setStencilMode(new e.StencilMode({func:this.context.gl.ALWAYS,mask:0},255,255,r.KEEP,r.KEEP,r.REPLACE)),this.context.setColorMode(e.ColorMode.unblended),this.context.setDepthMode(new e.DepthMode(this.context.gl.LEQUAL,e.DepthMode.ReadWrite,[0,1])),this.context.setCullFace(e.CullFaceMode.disabled),this.activeCameras=this._map.getAllActiveCameraViews(),this.context.clear({color:this._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1}),this.sphereModeRender(),this.options.showTileBoundaries){this.debugTileCache||(this.debugTileCache=new Na({projection:this._map.projection,context:this.context}));const e=Object.keys(this.style.sourceCaches);for(let t=0;t<e.length;t++){const i=this.style.sourceCaches[e[t]],r=i.getVisibleCoordinates();if(i&&!(i instanceof vs)&&r.length>0){Ba.debug(this,i,r);break}}}else this.debugTileCache&&(this.debugTileCache.release(),this.debugTileCache=null);this.setCustomLayerDefaults();}translatePosMatrix(e,t,i,r,o){if(!i[0]&&!i[1])return e;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t];}const n=[o?i[0]:hr(t,i[0],this.transform.zoom),o?i[1]:hr(t,i[1],this.transform.zoom),0];return e.clone().translate(n)}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e];}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}useProgram(e,t,i){const r=this.shaderProgramManager.getProgramByGLSLMacroDefinition(e,i,t||this.emptyProgramConfiguration);return r.textureUnitManager.reset(),this.context.program.set(r.program),this.context._Program=r,r}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault();}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD);}destroy(){}}class za{constructor(){e.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=function(e,t){let i=!1,r=0;const o=()=>{r=0,i&&(e(),r=setTimeout(o,300),i=!1);};return ()=>(i=!0,r||o(),r)}(this._updateHashUnthrottled.bind(this));}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(t.lng*o)/o,n=Math.round(t.lat*o)/o,a=this._map.getBearing(),l=this._map.getPitch();let c="";return c+=e?`#/${s}/${n}/${i}`:`#${i}/${n}/${s}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),c}_onHashChange(){const t=e.window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)}_updateHashUnthrottled(){const t=this.getHashString();e.window.history.replaceState(e.window.history.state,"",t);}}const Ga={linearity:.3,easing:e.bezier(0,0,.3,1)},Va=e.extend({deceleration:2500,maxSpeed:1400},Ga),ka=e.extend({deceleration:20,maxSpeed:1400},Ga),Ha=e.extend({deceleration:1e3,maxSpeed:360},Ga),Xa=e.extend({deceleration:1e3,maxSpeed:90},Ga);class ja{constructor(e){this._map=e,this.clear();}clear(){this._inertiaBuffer=[];}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t});}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift();}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry3d(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(i.pan.mag()){const s=Wa(i.pan.mag(),r,e.extend({},Va,t||{}));o.offset=i.pan.mult(s.amount/i.pan.mag()),o.center=this._map.transform.center,Ya(o,s);}if(i.zoom){const e=Wa(i.zoom,r,ka);o.zoom=this._map.transform.zoom+e.amount,Ya(o,e);}if(i.bearing){const t=Wa(i.bearing,r,Ha);o.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),Ya(o,t);}if(i.pitch){const e=Wa(i.pitch,r,Xa);o.pitch=this._map.transform.pitch+e.amount,Ya(o,e);}if(o.zoom||o.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;o.around=e?this._map.unproject(e):this._map.getCenter();}return this.clear(),e.extend(o,{noMoveStart:!0})}}function Ya(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing);}function Wa(t,i,r){const{maxSpeed:o,linearity:s,deceleration:n}=r,a=e.clamp(t*s/(i/1e3),-o,o),l=Math.abs(a)/(n*s);return {easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class qa extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,o={}){const s=e.DOM.mousePos(i.getCanvasContainer(),r),n=i.unproject(s);super(t,e.extend({point:s,lngLat:n,originalEvent:r},o)),this._defaultPrevented=!1,this.target=i;}}class Za extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const o="touchend"===t?r.changedTouches:r.touches,s=e.DOM.touchPos(i.getCanvasContainer(),o),n=s.map((e=>i.unproject(e))),a=s.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.pointGeometry3d(0,0));super(t,{points:s,point:a,lngLats:n,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1;}}class $a extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1;}}class Qa{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance;}reset(){delete this._mousedownPos;}wheel(e){return this._firePreventable(new $a(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new qa(e.type,this._map,e))}mouseup(e){this._map.fire(new qa(e.type,this._map,e));}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new qa(i.type,this._map,i));}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new qa(e.type,this._map,e)));}dblclick(e){return this._firePreventable(new qa(e.type,this._map,e))}mouseover(e){this._map.fire(new qa(e.type,this._map,e));}mouseout(e){this._map.fire(new qa(e.type,this._map,e));}touchstart(e){return this._firePreventable(new Za(e.type,this._map,e))}touchmove(e){this._map.fire(new Za(e.type,this._map,e));}touchend(e){this._map.fire(new Za(e.type,this._map,e));}touchcancel(e){this._map.fire(new Za(e.type,this._map,e));}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return {}}isEnabled(){return !0}isActive(){return !1}enable(){}disable(){}}class Ka{constructor(e){this._map=e;}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent;}mousemove(e){this._map.fire(new qa(e.type,this._map,e));}mousedown(){this._delayContextMenu=!0;}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent);}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new qa(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault();}isEnabled(){return !0}isActive(){return !1}enable(){}disable(){}}class Ja{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1;}isEnabled(){return !!this._enabled}isActive(){return !!this._active}enable(){this.isEnabled()||(this._enabled=!0);}disable(){this.isEnabled()&&(this._enabled=!1);}mousedown(t,i){this.isEnabled()&&t.shiftKey&&0===t.button&&(e.DOM.disableDrag(),this._startPos=this._lastPos=i,this._active=!0);}mousemoveWindow(t,i){if(!this._active)return;const r=i;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=r,this._box||(this._box=e.DOM.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(o.x,r.x),n=Math.max(o.x,r.x),a=Math.min(o.y,r.y),l=Math.max(o.y,r.y);this._map._requestDomTask((()=>{this._box&&(e.DOM.setTransform(this._box,`translate(${s}px,${a}px)`),this._box.style.width=n-s+"px",this._box.style.height=l-a+"px");}));}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,o=e.DOM.mousePos(this._el,t);if(this.reset(),e.DOM.suppressClick(),r.x!==o.x||r.y!==o.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,o,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t);}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e));}blur(){this.reset();}reset(){this._active=!1,this._container.classList.remove("minemap-crosshair"),this._box&&(e.DOM.remove(this._box),this._box=null),e.DOM.enableDrag(),delete this._startPos,delete this._lastPos;}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function el(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class tl{constructor(e){this.reset(),this.numTouches=e.numTouches;}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1;}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.pointGeometry3d(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=el(r,i)));}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=el(i,t);for(const e in this.touches){const t=this.touches[e],i=r[e];(!i||i.dist(t)>30)&&(this.aborted=!0);}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class il{constructor(e){this.singleTap=new tl(e),this.numTaps=e.numTaps,this.reset();}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset();}touchstart(e,t,i){this.singleTap.touchstart(e,t,i);}touchmove(e,t,i){this.singleTap.touchmove(e,t,i);}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class rl{constructor(){this._zoomIn=new il({numTouches:1,numTaps:2}),this._zoomOut=new il({numTouches:2,numTaps:1}),this.reset();}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset();}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i);}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i);}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),o=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):o?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(o)},{originalEvent:e})}):void 0}touchcancel(){this.reset();}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}const ol={0:1,2:2};class sl{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1;}blur(){this.reset();}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton;}_correctButton(e,t){return !1}_move(e,t){return {}}mousedown(t,i){if(this._lastPoint)return;const r=e.DOM.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=i,this._eventButton=r);}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),function(e,t){const i=ol[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(t){this._lastPoint&&e.DOM.mouseButton(t)===this._eventButton&&(this._moved&&e.DOM.suppressClick(),this.reset());}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class nl extends sl{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0);}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return {around:t,panDelta:t.sub(e)}}}class al extends sl{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault();}}class ll extends sl{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault();}}class cl{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this);}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry3d(0,0);}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer));}return e.preventDefault(),this._calculateTransform(e,t,i)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset();}touchcancel(){this.reset();}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const o=el(r,i),s=new e.pointGeometry3d(0,0),n=new e.pointGeometry3d(0,0);let a=0;for(const e in o){const t=o[e],i=this._touches[e];i&&(s._add(t),n._add(t.sub(i)),a++,o[e]=t);}if(this._touches=o,a<this._minTouches||!n.mag())return;const l=n.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("minemap-touch-pan-blocker-override","minemap-scrollable-page"));}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("minemap-touch-pan-blocker-override","minemap-scrollable-page")),this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=e.DOM.create("div","minemap-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`);}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("minemap-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("minemap-touch-pan-blocker-show");}),500);}}class hl{constructor(){this.reset();}reset(){this._active=!1,delete this._firstTwoTouches;}_start(e){}_move(e,t,i){return {}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]));}touchmove(e,t,i){if(!this._firstTwoTouches)return;e.preventDefault();const[r,o]=this._firstTwoTouches,s=ul(i,t,r),n=ul(i,t,o);if(!s||!n)return;const a=this._aroundCenter?null:s.add(n).div(2);return this._move([s,n],a,e)}touchend(t,i,r){if(!this._firstTwoTouches)return;const[o,s]=this._firstTwoTouches,n=ul(r,i,o),a=ul(r,i,s);n&&a||(this._active&&e.DOM.suppressClick(),this.reset());}touchcancel(){this.reset();}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}function ul(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function dl(e,t){return Math.log(e/t)/Math.LN2}class _l extends hl{reset(){super.reset(),delete this._distance,delete this._startDistance;}_start(e){this._startDistance=this._distance=e[0].dist(e[1]);}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(dl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dl(this._distance,i),pinchAround:t}}}function ml(e,t){return 180*e.angleWith(t)/Math.PI}class fl extends hl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector;}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1]);}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ml(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=ml(e,this._startVector);return Math.abs(i)<t}}function pl(e){return Math.abs(e.y)>Math.abs(e.x)}class gl extends hl{constructor(e){super(),this._map=e;}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints;}_start(e){this._lastPoints=e,pl(e[0].sub(e[1]))&&(this._valid=!1);}_move(e,t,i){const r=e[0].sub(this._lastPoints[0]),o=e[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&i.touches.length<3)&&(this._valid=this.gestureBeginsVertically(r,o,i.timeStamp),this._valid))return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5}}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,o=t.mag()>=2;if(!r&&!o)return;if(!r||!o)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const s=e.y>0==t.y>0;return pl(e)&&pl(t)&&s}}const vl={panStep:100,bearingStep:15,pitchStep:10};class xl{constructor(){const e=vl;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1;}blur(){this.reset();}reset(){this._active=!1;}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,o=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:n=>{const a=n.getZoom();n.easeTo({duration:300,easeId:"keyboardHandler",easing:yl,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:n.getBearing()+i*this._bearingStep,pitch:n.getPitch()+r*this._pitchStep,offset:[-o*this._panStep,-s*this._panStep],center:n.getCenter()},{originalEvent:e});}}}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0;}enableRotation(){this._rotationDisabled=!1;}}function yl(e){return e*(2-e)}const Tl=4.000244140625;class Sl{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this);}setZoomRate(e){this._defaultZoomRate=e;}setWheelZoomRate(e){this._wheelZoomRate=e;}isEnabled(){return !!this._enabled}isActive(){return !!this._active||void 0!==this._finishTimeout}isZooming(){return !!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker());}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()));}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer));}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.exported.now(),o=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Tl==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault();}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e);}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=e.DOM.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame());}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,i=()=>t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Tl?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const o=i(),s=Math.pow(2,o),n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*r))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0;}const r="number"==typeof this._targetZoom?this._targetZoom:i(),o=this._startZoom,s=this._easing;let n,a=!1;if("wheel"===this._type&&o&&s){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=s(t);n=e.number(o,r,i),t<1?this._frameId||(this._frameId=!0):a=!0;}else n=r,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout;}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:n-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,r=(e.exported.now()-t.start)/t.duration,o=t.easing(r+.01)-t.easing(r),s=.27/Math.sqrt(o*o+1e-4)*.01,n=Math.sqrt(.0729-s*s);i=e.bezier(s,n,.25,1);}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset();}reset(){this._active=!1;}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=e.DOM.create("div","minemap-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`);}_isFullscreen(){return !!e.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("minemap-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("minemap-scroll-zoom-blocker-show");}),200);}}class bl{constructor(e,t){this._clickZoom=e,this._tapZoom=t;}enable(){this._clickZoom.enable(),this._tapZoom.enable();}disable(){this._clickZoom.disable(),this._tapZoom.disable();}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wl{constructor(){this.reset();}reset(){this._active=!1;}blur(){this.reset();}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e});}}}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class El{constructor(){this._tap=new il({numTouches:1,numTaps:1}),this.reset();}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset();}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i));}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],o=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:o/128}}}else this._tap.touchmove(e,t,i);}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp);}touchcancel(){this.reset();}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class Ml{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i;}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("minemap-touch-drag-pan");}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("minemap-touch-drag-pan");}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Al{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i;}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable();}disable(){this._mouseRotate.disable(),this._mousePitch.disable();}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cl{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0;}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("minemap-touch-zoom-rotate");}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("minemap-touch-zoom-rotate");}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable();}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable();}}const Rl=e=>e.zoom||e.drag||e.pitch||e.rotate;class Ll extends e.Event{}function Pl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Il{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ja(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,r]of this._listeners)e.DOM.addEventListener(t,i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r);}destroy(){for(const[t,i,r]of this._listeners)e.DOM.removeEventListener(t,i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r);}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Qa(t,e));const r=t.boxZoom=new Ja(t,e);this._add("boxZoom",r);const o=new rl,s=new wl;t.doubleClickZoom=new bl(s,o),this._add("tapZoom",o),this._add("clickZoom",s);const n=new El;this._add("tapDragZoom",n);const a=t.touchPitch=new gl(t);this._add("touchPitch",a);const l=new al(e),c=new ll(e);t.dragRotate=new Al(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const h=new nl(e),u=new cl(t,e);t.dragPan=new Ml(i,h,u),this._add("mousePan",h),this._add("touchPan",u,["touchZoom","touchRotate"]);const d=new fl,_=new _l;t.touchZoomRotate=new Cl(i,_,d,n),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ka(t));const m=t.scrollZoom=new Sl(t,this);this._add("scrollZoom",m,["mousePan"]);const f=t.keyboard=new xl;this._add("keyboard",f);for(const i of ["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i]);}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t;}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[];}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return !0;return !1}isZooming(){return !!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return !!this._eventsInProgress.rotate}isMoving(){return Boolean(Rl(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return !0;return !1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`);}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(t,i){this._updatingCamera=!0;const r="renderFrame"===t.type,o=r?void 0:t,s={needsRenderFrame:!1},n={},a={},l=t.touches?this._getMapTouches(t.touches):void 0,c=l?e.DOM.touchPos(this._el,l):r?void 0:e.DOM.mousePos(this._el,t);for(const{handlerName:e,handler:r,allowed:h}of this._handlers){if(!r.isEnabled())continue;let u;this._blockedByActive(a,h,e)?r.reset():r[i||t.type]&&(u=r[i||t.type](t,c,l),this.mergeHandlerResult(s,n,u,e,o),u&&u.needsRenderFrame&&this._triggerRenderFrame()),(u||r.isActive())&&(a[e]=r);}const h={};for(const e in this._previousActiveHandlers)a[e]||(h[e]=o);this._previousActiveHandlers=a,(Object.keys(h).length||Pl(s))&&(this._changes.push([s,n,h]),this._triggerRenderFrame()),(Object.keys(a).length||Pl(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=s;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map));}mergeHandlerResult(t,i,r,o,s){if(!r)return;e.extend(t,r);const n={handlerName:o,originalEvent:r.originalEvent||s};void 0!==r.zoomDelta&&(i.zoom=n),void 0!==r.panDelta&&(i.drag=n),void 0!==r.pitchDelta&&(i.pitch=n),void 0!==r.bearingDelta&&(i.rotate=n);}_applyChanges(){const t={},i={},r={};for(const[o,s,n]of this._changes)o.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry3d(0,0))._add(o.panDelta)),o.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+o.pitchDelta),void 0!==o.aroundCoord&&(t.aroundCoord=o.aroundCoord),void 0!==o.around&&(t.around=o.around),void 0!==o.pinchAround&&(t.pinchAround=o.pinchAround),o.noInertia&&(t.noInertia=o.noInertia),e.extend(i,s),e.extend(r,n);this._updateMapTransform(t,i,r),this._changes=[];}_updateMapTransform(e,t,i){const r=this._map,o=r.transform;if(!Pl(e))return this._fireEvents(t,i,!0);let{panDelta:s,zoomDelta:n,bearingDelta:a,pitchDelta:l,around:c,pinchAround:h}=e;void 0!==h&&(c=h),o.cameraElevationReference="sea",r._stop(!0),c=c||r.transform.centerPoint;const u=o.pointLocation(s?c.sub(s):c);a&&(o.bearing+=a),l&&(o.pitch+=l),n&&(o.zoom+=n),o.setLocationAtPoint(u,c),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,i,!0);}_fireEvents(t,i,r){const o=Rl(this._eventsInProgress),s=Rl(t),n={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(n[`${e}start`]=i),this._eventsInProgress[e]=t[e];}!o&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in n)this._fireEvent(e,n[e]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i);}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,a[`${e}end`]=l);}for(const e in a)this._fireEvent(e,a[e]);const c=Rl(this._eventsInProgress);if(r&&(o||s)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1;}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}));}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ll("renderFrame",{timeStamp:e})),this._applyChanges();}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame());}}class Ol extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],e.bindAll(["_renderFrameCallback"],this);}getCenter(){return this.transform.center}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.pointGeometry3d.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.extend({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.extend({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.extend({bearing:t},i),r)}resetNorth(t,i){return this.transform.panoramaMode?(this.easeTo({center:[0,0],duration:2e3,bearing:0,pitch:0,zoom:1}),this.fire(new e.Event("panorama-resetangle",{}))):this.rotateTo(0,e.extend({duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){return t=e.LngLatBounds.convert(t),this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,i)}_cameraForBoxAndBearing(t,r,o,s){if("number"==typeof(s=e.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const e=s.padding;s.padding={top:e,bottom:e,right:e,left:e};}if(!i(Object.keys(s.padding).sort(((e,t)=>e<t?-1:e>t?1:0)),["bottom","left","right","top"]))return void e.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");const n=[(s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2],a=Math.min(s.padding.right,s.padding.left),l=Math.min(s.padding.top,s.padding.bottom);s.offset=[s.offset[0]+n[0],s.offset[1]+n[1]];const c=e.pointGeometry3d.convert(s.offset),h=this.transform,u=this._calcOffsetDifLngLat(c);s.center={lng:(t.lng+r.lng)/2-u[0],lat:(t.lat+r.lat)/2-u[1]};const d=e.transformECEFToGeographic([],[(t.lng+r.lng)/2,t.lat],e.CONSTS.TRANSFORM.R),_=e.transformECEFToGeographic([],[(t.lng+r.lng)/2,r.lat],e.CONSTS.TRANSFORM.R),m=Math.sqrt(Math.pow(d[0]-_[0],2)+Math.pow(d[1]-_[1],2)+Math.pow(d[2]-_[2],2)),f=Math.atan((h.height-l)/h.height*Math.tan(h._fov/2)),p=e.transformECEFToGeographic([],[t.lng,(t.lat+r.lat)/2],e.CONSTS.TRANSFORM.R),g=e.transformECEFToGeographic([],[r.lng,(t.lat+r.lat)/2],e.CONSTS.TRANSFORM.R),v=Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2)),x=Math.atan((h.width-a)/h.height*Math.tan(h._fov/2)),y=h.width/v,T=h.height/m;if(T<0||y<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let S,b;T<y?(S=f,b=m):(S=x,b=v);const w=Math.asin(b/2/e.CONSTS.TRANSFORM.R),E=Math.sin(Math.PI-S-w)*e.CONSTS.TRANSFORM.R/Math.sin(S);return s.zoom=e.getZoomFromDistance(h._fov,E,e.CONSTS.TRANSFORM.R),s.bearing=0,s}fitBounds(e,t,i){return this._fitInternal(this.cameraForBounds(e,t),t,i)}fitScreenCoordinates(t,i,r,o,s){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry3d.convert(t)),this.transform.pointLocation(e.pointGeometry3d.convert(i)),r,o),o,s)}_fitInternal(t,i,r){return t?(i=e.extend(t,i)).linear?this.easeTo(i,r):this.flyTo(i,r):this}jumpTo(t,i){this.stop();const r=this.transform;let o=!1,s=!1,n=!1;return "zoom"in t&&r.zoom!==+t.zoom&&(o=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(s=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(n=!0,r.pitch=+t.pitch),this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),o&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),s&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),n&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i))}easeTo(t,i){this._stop(!1,t.easeId);const r=(i=>{if(void 0!==i&&"string"!=typeof i)return t.easing;switch(i){case"linear":return e.linear;case"easeIn":return e.easeIn;case"easeOut":return e.easeOut;case"easeInOut":return e.easeInOut;default:return e.ease}})(t.easing);(t=e.extend({offset:[0,0],duration:500},t)).easing=r,!1===t.animate&&(t.duration=0);const o=this.transform,s=this.getZoom(),n=this.getBearing(),a=this.getPitch(),l="zoom"in t?+t.zoom:s,c="bearing"in t?this._normalizeBearing(t.bearing,n):n,h="pitch"in t?+t.pitch:a,u=this._calcOffsetDifLngLat(t.offset);let d,_;t.around&&(d=e.LngLat.convert(t.around),_=o.locationPoint(d));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==s,this._rotating=this._rotating||n!==c,this._pitching=this._pitching||h!==a,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,m),this._ease((r=>{if(this._zooming&&(o.zoom=e.number(s,l,r)),this._rotating&&(o.bearing=e.number(n,c,r)),this._pitching&&(o.pitch=e.number(a,h,r)),d)o.setLocationAtPoint(d,_);else {let i,s;t.center?t.center.length?(s=t.center[1],i=t.center[0]):(s=t.center.lat,i=t.center.lng):(s=o.center.lat,i=o.center.lng);let n=s+u[1]*r*25;n>90&&(n=90),n<-90&&(n=-90);let a=i+u[0]*r*25;a>180&&(a-=360),a<-180&&(a+=360),o.center=new e.LngLat(e.number(o.center.lng,a,r),e.number(o.center.lat,n,r));}this._fireMoveEvents(i);}),(e=>{this._afterEase(i,e);}),t),this}_calcOffsetDifLngLat(t){t instanceof Array&&(t={x:t[0],y:t[1]});const i=this.transform;let r=0,o=0,s=0;if(0!==t.x&&0!==t.y)Math.abs(t.x)>Math.abs(t.y)?(r=10,o=10*t.y/t.x,s=t.x/10):(r=10*t.x/t.y,o=10,s=t.y/10);else if(0!==t.x&&0===t.y)r=10,s=t.x/10;else {if(0!==t.x||0===t.y)return [0,0];o=10,s=t.y/10;}const n=i.pointLocation(new e.pointGeometry3d(i.width/2+r,i.height/2+10+o)),a=i.pointLocation(new e.pointGeometry3d(i.width/2,i.height/2+10));return n&&a?[(a.lng-n.lng)*s/25,(a.lat-n.lat)*s/25]:[0,0]}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t));}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t));}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId,this.transform.cameraElevationReference="ground";const r=this._zooming,o=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,r&&this.fire(new e.Event("zoomend",t)),o&&this.fire(new e.Event("rotateend",t)),s&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t));}flyTo(t,i){this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.sphereFly?e.easeForSphere:e.ease},t);const r=this.transform,o=this.getZoom(),s=this.getBearing(),n=this.getPitch(),a="zoom"in t?e.clamp(+t.zoom,r.minZoom,r.maxZoom):o,l="bearing"in t?this._normalizeBearing(t.bearing,s):s,c="pitch"in t?+t.pitch:n,h=r.zoomScale(a-o),u=r.centerPoint.add(e.pointGeometry3d.convert(t.offset)),d=r.pointLocation(u),_=e.LngLat.convert(t.center||d);this._normalizeCenter(_);const m=r.project(d),f=r.project(_).sub(m);let p=t.curve;const g=Math.max(r.width,r.height),v=g/h,x=f.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,o,a),r.minZoom,r.maxZoom),s=g/r.zoomScale(i-o);p=Math.sqrt(s/x*2);}const y=p*p;function T(e){const t=(v*v-g*g+(e?-1:1)*y*y*x*x)/(2*(e?v:g)*y*x);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return (Math.exp(e)-Math.exp(-e))/2}function b(e){return (Math.exp(e)+Math.exp(-e))/2}const w=T(0);let E=function(e){return b(w)/b(w+p*e)},M=function(e){return g*((b(w)*(S(t=w+p*e)/b(t))-S(w))/y)/x;var t;},A=(T(1)-w)/p;if(Math.abs(x)<1e-6||!isFinite(A)){if(Math.abs(g-v)<1e-6)return this.easeTo(t,i);const e=v<g?-1:1;A=Math.abs(Math.log(v/g))/p,M=function(){return 0},E=function(t){return Math.exp(e*p*t)};}return t.duration="duration"in t?+t.duration:1e3*A/("screenSpeed"in t?+t.screenSpeed/p:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=s!==l,this._pitching=c!==n,this._prepareEase(i,!1),this._ease((h=>{const d=h*A,_=1/E(d);r.zoom=1===h?a:o+r.scaleZoom(_),this._rotating&&(r.bearing=e.number(s,l,h)),this._pitching&&(r.pitch=e.number(n,c,h));const p=r.unproject(m.add(f.mult(M(d))).mult(_));r.setLocationAtPoint(r.renderWorldCopies?p.wrap():p,u),this._fireMoveEvents(i),t.sphereFly&&(this.style.shouldUpdateSource=!1);}),(()=>(t.sphereFly&&(this.style.shouldUpdateSource=!0),this._afterEase(i))),t),this}isEasing(){return !!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t);}if(!e){const e=this.handlers;e&&e.stop(!1);}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame?(this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()):this.stop();}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0;}_limitLat(e){return e.lat<this.latRange[0]?e.lat=this.latRange[0]:e.lat>this.latRange[1]&&(e.lat=this.latRange[1]),e}}class Dl{constructor(t={}){this.options=t,e.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);}getDefaultPosition(){return "bottom-right"}onAdd(t){const i=this.options&&this.options.compact;return this._map=t,this._container=e.DOM.create("div","minemap-ctrl minemap-ctrl-attrib"),i&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){e.DOM.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0;}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".minemap-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:r.ACCESS_TOKEN}];if(e){const i=t.reduce(((e,i,r)=>(i.value&&(e+=`${i.key}=${i.value}${r<t.length-1?"&":""}`),e)),"?");e.href=`https://www.minemap.com/feedback/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`;}}_updateData(e){e&&"metadata"===e.sourceDataType&&(this._updateAttributions(),this._updateEditLink());}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}const t=this._map.style.sourceCaches;for(const i in t){const r=t[i].getSource();r.attribution&&e.indexOf(r.attribution)<0&&e.push(r.attribution);}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return !1;return !0})),e.length?(this._container.innerHTML=e.join(" | "),this._container.classList.remove("minemap-attrib-empty")):this._container.classList.add("minemap-attrib-empty"),this._editLink=null;}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact");}}class Nl{constructor(){e.bindAll(["_updateLogo"],this);}onAdd(t,i){this._map=t,this._container=e.DOM.create("div","minemap-ctrl");const r=e.DOM.create("a","minemap-ctrl-logo");return r.target="_blank",r.href=i||"https://www.minedata.cn/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container}onRemove(){e.DOM.remove(this._container),this._map.off("sourcedata",this._updateLogo);}getDefaultPosition(){return "bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");}_logoRequired(){if(this._map.style)return !0}}class Fl{constructor(){}max(e){return Math.max.apply(null,e)}min(e){return Math.min.apply(null,e)}range(e){return this.max(e)-this.min(e)}midrange(e){return this.range(e)/2}sum(e){let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i];return t}mean(e){return this.sum(e)/e.length}median(e){e.sort(((e,t)=>e-t));const t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2}modes(e){if(!e.length)return [];let t={},i=0,r=[];return e.forEach((e=>{t[e]?t[e]++:t[e]=1,t[e]>i?(r=[e],i=t[e]):t[e]===i&&(r.push(e),i=t[e]);})),r}variance(e){const t=this.mean(e);return this.mean(e.map((e=>Math.pow(e-t,2))))}standardDeviation(e){return Math.sqrt(this.variance(e))}meanAbsoluteDeviation(e){const t=this.mean(e);return this.mean(e.map((e=>Math.abs(e-t))))}zScores(e){const t=this.mean(e),i=this.standardDeviation(e);return e.map((e=>(e-t)/i))}average(e){return this.mean(e)}}const Bl=function(){return window&&window.performance?window.performance.now():Date.now()};class Ul{constructor(e={}){this.options=e,this.framesCounter=0,this.lastFPSTimestamp=null,this.lastFPSMeasure=0,this.measurements=[],this.lastMeasurementTimestamp=null,this.started=!1,this.stat=new Fl;}startMeasuring(e){this.started=!0,this.updateFPS(),e&&!isNaN(e)&&e>0&&setTimeout(this.stopMeasuring.bind(this),e);}stopMeasuring(){this.started=!1;}registerRenderFrame(){this.started&&(this.framesCounter++,this.updateFPS());}getLastMeasurement(){return this.measurements.length?this.measurements[this.measurements.length-1]:0}updateFPS(){null===this.lastFPSTimestamp&&(this.lastFPSTimestamp=Bl());const e=Bl(),t=e-this.lastFPSTimestamp;if(t>500){let i=Math.round(this.framesCounter/(t/1e3)*10)/10;i=i>60?60:i,this.lastFPSTimestamp=e,this.framesCounter=0,this.recordMeasurement(i,t);}}recordMeasurement(e,t){this.measurements.push(e);}getMeasurements(){return this.measurements.slice()}getMeasurementsReport(){const e=this.getMeasurements();return {measurements:e,median:Number(this.stat.median(e).toFixed(1)),average:Number(this.stat.average(e).toFixed(1)),variance:Number(this.stat.variance(e).toFixed(1)),stdDev:Number(this.stat.standardDeviation(e).toFixed(1))}}}class zl{constructor(e={className:"minemap-fps-control"}){this.measurer=new Ul,this.options=e,this.countRenderBound=this.measurer.registerRenderFrame.bind(this.measurer),this.updateFPSCounterBound=this.updateFPSCounter.bind(this),this.lastFPSMeasure=null;}updateFPSCounter(){const e=this.measurer.getLastMeasurement(),t=this.measurer.getMeasurementsReport();if(e===this.lastFPSMeasure)return;let i=`FPS:${e.toFixed(1)}<br />`;i+=`平均值:${t.median}<br />`,this._container.innerHTML=i;}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className=`${this.options.className} minemap-ctrl-group minemap-ctrl`,this.addEventListeners(),this.measurer.startMeasuring(),this._container}remove(){this.onRemove();}onRemove(){this.removeEventListeners(),this.measurer.stopMeasuring(),this._container.remove();}addEventListeners(){this._map.on("render",this.countRenderBound),this._map.on("render",this.updateFPSCounterBound);}removeEventListeners(){this._map.off("render",this.countRenderBound),this._map.off("render",this.updateFPSCounterBound);}}"undefined"==typeof global&&window.minemap&&(minemap.FPSControl=zl);var Gl=zl;class Vl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1;}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];}}class kl{constructor(t,i){this.map=i,this._sphereRender=t.sphereRender||!1,this._projection=t.projection||e.ProjectionType.MERCATOR,this.options=t;}set sphereRender(e){this._sphereRender=e,this.map.transform.sphereRender=e;}get sphereRender(){return this._sphereRender}get projection(){return this._projection}set projection(t){this._projection=t||e.ProjectionType.MERCATOR,this.map.transform.projection=this._projection,this.map.style.changWorkerProjection(this._projection),this.map.painter.projection=this._projection;}}let Hl=null,Xl=0,jl=0;const Yl={obj:null,init(e){Hl=e.cb,Xl=e.restrictX,jl=e.restrictY,e.handler.onmousedown=this.start,e.handler.root=e.root||e.handler;const t=e.handler.root;t.onDragStart=e.dragStart||new Function,t.onDrag=e.onDrag||new Function,t.onDragEnd=e.onDragEnd||new Function;},start(t){const i=Yl.obj=this;i.style.cursor="move";const r=(t=t||Yl.fixEvent(e.window.event)).pageY;i.lastMouseX=t.pageX,i.lastMouseY=r;const o=i.root.offsetLeft,s=i.root.offsetTop;i.root.style.left=`${o}px`,i.root.style.top=`${s}px`,e.window.document.onmouseup=Yl.end,e.window.document.onmousemove=Yl.drag,i.root.onDragStart(o,s);},drag(t){const i=(t=t||Yl.fixEvent(e.window.event)).pageX,r=t.pageY,o=Yl.obj.root;let s=o.style.left?parseInt(o.style.left):0,n=o.style.top?parseInt(o.style.top):0;s<=-1&&(s=-1),n<=-1&&(n=-1),s>=Xl&&(s=Xl),n>=jl&&(n=jl);const a=i-Yl.obj.lastMouseX+s,l=r-Yl.obj.lastMouseY+n;o.style.left=`${a}px`,o.style.top=`${l}px`,Yl.obj.root.onDrag(a,l),Yl.obj.lastMouseX=i,Yl.obj.lastMouseY=r;},end(){const t=Yl.obj.root.style.left?parseInt(Yl.obj.root.style.left):0,i=Yl.obj.root.style.top?parseInt(Yl.obj.root.style.top):0;Yl.obj.root.onDragEnd(t,i),e.window.setTimeout((()=>{Hl(t,i);}),100),e.window.document.onmousemove=null,e.window.document.onmouseup=null,Yl.obj=null;},fixEvent:t=>(t.pageX=t.clientX+e.window.document.documentElement.scrollLeft,t.pageY=t.clientY+e.window.document.documentElement.scrollTop,t)};function Wl(t,i,r){if(t=new e.LngLat(t.lng,t.lat),i){const o=new e.LngLat(t.lng-360,t.lat),s=new e.LngLat(t.lng+360,t.lat),n=r.locationPoint(t).distSqr(i);r.locationPoint(o).distSqr(i)<n?t=o:r.locationPoint(s).distSqr(i)<n&&(t=s);}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360;}return t}const ql={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zl extends e.Evented{constructor(t){if(super(),(arguments[0]instanceof e.window.HTMLElement||2===arguments.length)&&(t=e.extend({element:t},arguments[1])),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"top-left",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._alt=0,this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry3d.convert(t&&t.offset||[0,0]);else {this._defaultMarker=!0,this._element=e.DOM.create("div");const i=41,r=27,o=e.DOM.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"height",`${i}px`),o.setAttributeNS(null,"width",`${r}px`),o.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const s=e.DOM.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");const n=e.DOM.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"fill-rule","nonzero");const a=e.DOM.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of l){const i=e.DOM.createNS("http://www.w3.org/2000/svg","ellipse");i.setAttributeNS(null,"opacity","0.04"),i.setAttributeNS(null,"cx","10.5"),i.setAttributeNS(null,"cy","5.80029008"),i.setAttributeNS(null,"rx",t.rx),i.setAttributeNS(null,"ry",t.ry),a.appendChild(i);}const c=e.DOM.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill",this._color);const h=e.DOM.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),c.appendChild(h);const u=e.DOM.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"opacity","0.25"),u.setAttributeNS(null,"fill","#000000");const d=e.DOM.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),u.appendChild(d);const _=e.DOM.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_.setAttributeNS(null,"fill","#FFFFFF");const m=e.DOM.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const f=e.DOM.createNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"fill","#000000"),f.setAttributeNS(null,"opacity","0.25"),f.setAttributeNS(null,"cx","5.5"),f.setAttributeNS(null,"cy","5.5"),f.setAttributeNS(null,"r","5.4999962");const p=e.DOM.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#FFFFFF"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962"),m.appendChild(f),m.appendChild(p),n.appendChild(a),n.appendChild(c),n.appendChild(u),n.appendChild(_),n.appendChild(m),o.appendChild(n),o.setAttributeNS(null,"height",i*this._scale+"px"),o.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(o),this._offset=e.pointGeometry3d.convert(t&&t.offset||[-13.5*this._scale,-35*this._scale]);}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("minemap-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault();})),this._element.addEventListener("mousedown",(e=>{e.preventDefault();}));const i=this._element.classList;for(const e in ql)i.remove(`minemap-marker-anchor-${e}`);i.add(`minemap-marker-anchor-${this._anchor}`),this._popup=null;}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),e.__markerList.push(this)),this}remove(){if(this._map){for(let e=0;e<this._map.__markerList.length;e++)this._map.__markerList[e]===this&&this._map.__markerList.splice(e,1);this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),delete this._map;}return this._clearFadeTimer(),e.DOM.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getAltitude(){return this._alt}setAltitude(e){return this._alt=e,this._pos=null,this._popup&&this._popup.setAltitude(this._alt),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset;}e._markerBinded=!0,this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false");}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup();}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup();}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null);}#e(){const t=this._pos||new e.pointGeometry3d(0,0),i=this.#t(),r=this.#i();this._element.style.transform=`${ql[this._anchor]} translate(${t.x}px, ${t.y}px) rotateX(${i}deg) rotateZ(${r}deg)`;}#t(){return "viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}#i(){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}#r(){const e=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._element.style.visibility=this._map.panoramaMode?e.w>0?"hidden":"visible":!this._map.transform.checkPositionForeground(this._lngLat)||e.w<0?"hidden":"visible";}#o(t){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment||"map"===this._rotationAlignment||"map"===this._pitchAlignment?this._offset:e.pointGeometry3d.convert([0,0])}_update(t){if(e.window.cancelAnimationFrame(this._updateFrameId),!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Wl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat,this._alt)._add(this._offset),this.#r(),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this.#e());})):this._pos=this._pos.round();const i=this.#o(),r=Math.abs(i.x)/parseFloat(e.DOM.getAllStyle(this._element).width)*100,o=Math.abs(i.y)/parseFloat(e.DOM.getAllStyle(this._element).height)*100;e.DOM.setTransformOrigin(this._element,`${r}% ${o}%`),this._map._requestDomTask((()=>{this._element&&this._pos&&this._anchor&&this.#e();}));}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry3d.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e;}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos,this._alt),this._lngLat&&(this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag"))));}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive";}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp));}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}enableDragging(){return this.setDraggable(!0),this}disableDragging(){return this.setDraggable(!1),this}isDraggable(){return this._draggable}getDraggable(){return this.isDraggable()}getMap(){return this._map}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const $l={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","GeolocateControl.Geolocate":"Geolocate","LogoControl.Title":"MineMap logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ql{constructor(t){if(this.fixedMode=t&&t.mode||e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.FIXED,t&&t.date)this.date=t.date;else {const e=new Date,t=e.getMonth()+1,i=e.getDate(),r=12,o=e.getMinutes();this.date={month:t,day:i,hour:r,minute:o};}this.setSunLightPos(this.date);}setSunLightFixedMode(e){e&&(this.fixedMode=e);}transMonth2Day(e){if(1===e.month)return 0;if(2===e.month)return 31;if(3===e.month)return 59;if(4===e.month)return 90;if(5===e.month)return 120;if(6===e.month)return 151;if(7===e.month)return 181;if(8===e.month)return 212;if(9===e.month)return 243;if(10===e.month)return 273;if(11===e.month)return 304;if(12===e.month)return 334;throw new Error("Error transMonth2Day Not Int!")}getSunDuration(e,t){const i=this.transMonth2Day(t),r=23.45*Math.sin(360*(i+t.day-80)/370*Math.PI/180),o=Math.PI/180,s=180/Math.PI,n=Math.tan(e*o)*Math.tan(r*o);let a;a=n>=1?Math.PI:n<-1?0:Math.acos(-n);const l=2/15*a*s;return [12-l/2,12+l/2]}setSunLightPos(t){this.date=t;const i=this.transMonth2Day(t);this._meanSolarTime=this.date.hour+this.date.minute/60-8,this._sunLatLng=[180-15*this._meanSolarTime,23.45*Math.sin(360*(i+this.date.day-80)/370*Math.PI/180)];const r=e.transformECEFToGeographic([],this._sunLatLng,e.CONSTS.TRANSFORM.R+0);this._sunLightCenter=r;}_shadowSunPosition(e){const t=Math.round(e.target[0]/15),i=(this._meanSolarTime+t+24)%24+(e.target[0]-15*t)/15,r=e.target[1]*Math.PI/180,o=this._sunLatLng[1]*Math.PI/180,s=15*(i-12)*Math.PI/180,n=parseFloat((Math.sin(o)*Math.sin(r)+Math.cos(o)*Math.cos(r)*Math.cos(s)).toPrecision(8)),a=180*Math.asin(n)/Math.PI,l=parseFloat(((n*Math.sin(r)-Math.sin(o))/(Math.cos(a*Math.PI/180)*Math.cos(r))).toPrecision(8));let c=180*Math.acos(l)/Math.PI;return a>=0?(i>=12&&(c=-c),this._shadow={active:!0,altitude:e.distance,bearing:c,color:[1,1,1],farDistance:.783927971443699,hFov:60,id:"SUNLIGHT_CAMERA_ID",pitch:90-a,shadowColor:[.2,.2,.2],wFov:0,location:e.target,type:"day"},this._shadow):(this._shadow={type:"night"},this._shadow)}getSunLightPos(){return this._sunLightCenter}}function Kl(e){return !function(e){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return !1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===Jl[t=e&&e.failIfMajorPerformanceCaveat]&&(Jl[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(Kl.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return !1;try{t=i.createShader(i.VERTEX_SHADER);}catch(e){return !1}return !(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),Jl[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t;}(e)}var Jl={};Kl.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class ec{constructor(t){this.context=t.context,this.map=t.savedMap;const{gl:i}=this.context,o=i.getExtension("EXT_SRGB"),s=o?o.SRGB_EXT:i.RGBA,n=this.map.getStyle(),l="minemap://assets/IBLtextures";this.IBLUrl=(e=>{if(!a(e))return e;const t=_(e);return `${r.SRC_URL}${t.authority}${t.path}`})(n.IBL?n.IBL:l),n.IBL||this.map.testMode||e.warnOnce(`map.style has no IBL defined, minemap.js sets the default value to ${l}`),this.getIBLImage(`${this.IBLUrl}/SkyBox0/brdfLUT.png`,s,i),this.mDiffuseEnvTex=this.loadCubeMap(i,"diffuse"),this.mSpecularEnvTex=this.loadCubeMap(i,"specular"),this.isLoaded=!0;}async getIBLImage(t,i,r){const o=await(()=>new Promise(((i,r)=>{e.getImage(this.map._transformRequest(t,e.ResourceType.Image),((e,t)=>{e&&r(e),i(t);}));})))();if(!(o.nodeName||o.width&&o.height))throw this.isLoaded=!1,new Error("load IBL image error");{const t=new e.Texture(this.context,o,i,{useMipmap:!1});t.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.mBrdfTex=t;}}loadCubeMap(e,t){const i=e.getExtension("EXT_SRGB"),r=e.createTexture();let o=-1,s=e.TEXTURE0,n=0;if("diffuse"===t?(s=e.TEXTURE1,o=1,n=1):"specular"===t?(s=e.TEXTURE2,o=2,n=10):"environment"===t&&(s=e.TEXTURE0,o=0,n=1),-1===o)return null;e.activeTexture(s),e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n<2?(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR));const a=`${this.IBLUrl}/SkyBox0/${t}/${t}`;for(let t=0;t<n;t++){const o=[[`${a}_right_${t}.jpg`,e.TEXTURE_CUBE_MAP_POSITIVE_X],[`${a}_left_${t}.jpg`,e.TEXTURE_CUBE_MAP_NEGATIVE_X],[`${a}_top_${t}.jpg`,e.TEXTURE_CUBE_MAP_POSITIVE_Y],[`${a}_bottom_${t}.jpg`,e.TEXTURE_CUBE_MAP_NEGATIVE_Y],[`${a}_front_${t}.jpg`,e.TEXTURE_CUBE_MAP_POSITIVE_Z],[`${a}_back_${t}.jpg`,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(let n=0;n<o.length;n++)this.loadCubeImage(t,o[n][1],o[n][0],s,i,r,e);}return r}async loadCubeImage(t,i,r,o,s,n,a){const l=await(()=>new Promise(((t,i)=>e.getImage(this.map._transformRequest(r,e.ResourceType.Image),((e,r)=>{e&&i(e),t(r);})))))();if(l.nodeName||l.width&&l.height)this.onLoadEnvironmentURLImage(o,s,n,i,l,t,a);else if(l)throw this.isLoaded=!1,new Error("load IBL image error")}onLoadEnvironmentURLImage(e,t,i,r,o,s,n){const a=t?t.SRGB_EXT:n.RGBA;n.activeTexture(e),n.bindTexture(n.TEXTURE_CUBE_MAP,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.texImage2D(r,s,a,a,n.UNSIGNED_BYTE,o),i[r]=!0;}}const tc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,dragZoom:!1,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!1,fps:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,crossSourceCollisions:!0,sphereRender:!0,projection:e.ProjectionType.MERCATOR,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体",defaultCursor:null,loadIBL:!0,logoControl:!0,logoUrl:""},{HTMLImageElement:ic,HTMLElement:rc,ImageBitmap:oc}=e.window;class sc extends Ol{constructor(t){if("undefined"==typeof global&&!Kl(void 0))throw new Error("minemap.js is not supported in the current environment");if(null!=(t=e.extend({},tc,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");const i=new Os(t.minZoom,t.maxZoom,t.renderWorldCopies,!0,t.projection,t.minPitch,t.maxPitch);super(i,t),this._minMax3dtileBoundHeight={minHeight:0,maxHeight:0},this._logarithmicDepthBuffer=t.logarithmicDepthBuffer||!1,this._canvasTransparent=void 0===t.canvasTransparent||t.canvasTransparent,this.fPMode=t.fPMode||!1,this.testMode=t.testMode||!1,this.td_cameraManager=new aa,this.sunLight=new Ql({mode:e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.FIXED}),this._shadowFlag=!1,this._viewShedFlag=!1,i.setMap(this),this.mapControl=new kl(t,this),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new Vl,this._domRenderTaskQueue=new Vl,this._fxaaRender=t.fxaaRender||!1,this._bloomRender=t.bloomRender||!1,this._bloomOptions={step:9,extent:6},this._controls=[],this.__markerList=[],this.__popupList=[],this.disableBlinnPhong=t.disableBlinnPhong||!1,this.isLatLon="LATLON"===t.projection,this._loadIBL=t.loadIBL,this._cooperativeGestures=t.cooperativeGestures,this._locale=e.extend({},$l,t.locale),this._clickTolerance=t.clickTolerance,this._containerWidth=0,this._containerHeight=0;const r=t.transformRequest;if(this._transformRequest=r?(e,t)=>r(e,t)||{url:e,type:t}:e=>({url:e}),this.timer=new Ra,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else {if(!(t.container instanceof rc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container;}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the MineMap Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Il(this,t),this._hash=t.hash&&(new za).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily,projection:t.projection}),t.attributionControl&&this.addControl(new Dl),t.fps&&this.addFPSControl(),t.logoControl&&this.addControl(new Nl,t.logoPosition,t.logoUrl),this.on("style.load",(()=>{if(Object.getOwnPropertyDescriptor(this,"testMode").hasOwnProperty("get"))throw new Error("The introduction framework modifies the properties of minemap itself. Please check whether the instantiated object uses the Object.defineproperty method (P.S. may be due to Vue or React)");this.painter._iBLtextures=t.loadIBL?new ec({context:this.painter.context,savedMap:this}):null,this.transform.unmodified&&this.jumpTo(this.style.stylesheet);})),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=t,t.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this.setCursor(t.defaultCursor),this.directionLightParameter=new xn;}getCurrentLocation(){return {center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}}__onMove(){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4);}disableDrag(){this.dragPan.disable();}enableDrag(){this.dragPan.enable();}setCursor(e){this._canvas.style.cursor=e||"";}getCursor(){return this.getCanvas().style.cursor}setZoomAndCenter(e,t){this.jumpTo({center:t,zoom:e});}getAllMarkers(){return this.__markerList}addMarker(t){!e.arrayInclude(this.__markerList,t)&&t instanceof Zl&&(this.__markerList.push(t),t.addTo(this));}addMarkers(e){for(let t=0;t<e.length;t++)this.addMarker(e[t]);}removeMarker(e){e instanceof Zl&&e.remove();}removeMarkers(e){if(e)for(let t=0;t<e.length;t++){this.removeMarker(e[t]);for(let i=0;i<this.__markerList.length;i++)e[t]===this.__markerList[i]&&this.__markerList.splice(i,1);}else {for(let e=0;e<this.__markerList.length;e++)this.removeMarker(this.__markerList[e]);this.__markerList=[];}}removeOverviewMap(){this.overviewMapInstance&&(this._overviewDrag.remove(),this.off("moveend",this.__onMove),this.overviewMapInstance.remove(),this.overviewMapInstance=null,this.getContainer().parentNode.parentNode.removeChild(this._overviewMapElement),this._overviewMapElement=null);}addOverviewMap(){this.overviewMapInstance||(this._overviewMapElement=e.window.document.createElement("div"),this._overviewMapElement.id=`overviewMap_${Math.random()}`,this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px",this.getContainer().parentNode.parentNode.appendChild(this._overviewMapElement),this.overviewMapInstance=new sc({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,dragZoom:!1,maxZoom:22,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0,projection:this.isLatLon?"LATLON":"MERCATOR"}),this.on("moveend",this.__onMove),setTimeout((()=>{const t=e.window.document.createElement("div");this.overviewMapInstance.getCanvas().style.cursor="";const i=this.getBounds();let r=this.overviewMapInstance.project(i.getSouthWest()),o=this.overviewMapInstance.project(i.getNorthEast());o.y<=45&&(o=new e.pointGeometry3d(o.x,45)),r.x<=45&&(r=new e.pointGeometry3d(45,r.y)),t.style.top=`${Math.round(o.y)}px`,t.style.left=`${Math.round(r.x)}px`,t.style.width=`${Math.round(160-2*r.x)}px`,t.style.height=`${Math.round(160-2*o.y)}px`,t.style.border="2px solid red",t.style.position="absolute",this._overviewMapElement.appendChild(t),Yl.init({handler:this._overviewMapElement,root:t,restrictX:2*Math.round(r.x),restrictY:2*Math.round(o.y),cb:(e,i)=>{if(e-Math.round(r.x)!=0||i-Math.round(o.y)!=0){const s=this.overviewMapInstance.unproject([e-Math.round(r.x)+80,i-Math.round(o.y)+80]);this.flyTo({center:s,bearing:this.overviewMapInstance.getBearing()}),t.style.top=`${Math.round(o.y)}px`,t.style.left=`${Math.round(r.x)}px`;}}});}),1e3));}openOverviewMap(e){this._overviewMap=e,this.overviewMapInstance?this._overviewMapElement.style.display="block":this.addOverviewMap();}closeOverviewMap(){this.overviewMapInstance&&(this._overviewMapElement.style.display="none");}getOverviewMap(){return this._overviewMap}addControl(t,i,r){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=t.onAdd(this,r);this._controls.push(t);const s=this._controlPositions[i];return -1!==i.indexOf("bottom")?s.insertBefore(o,s.firstChild):s.appendChild(o),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return (new e.LngLatBounds).extend(this.transform.pointLocation(new e.pointGeometry3d(0,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,this.transform.height))).extend(this.transform.pointLocation(new e.pointGeometry3d(0,this.transform.height)))}getMaxBounds(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new e.LngLatBounds([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null}setMaxBounds(t){if(t){const i=e.LngLatBounds.convert(t);this.transform.lngRange=[i.getWest(),i.getEast()],this.transform.latRange=[i.getSouth(),i.getNorth()],this._update();}else null==t&&(this.transform.lngRange=null,this._update());return this}setMinZoom(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}project(t,i){return this.transform.locationPoint(e.LngLat.convert(t),i)}unproject(t,i){return this.transform.pointLocation(e.pointGeometry3d.convert(t),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const o=o=>{const s=t.filter((e=>this.getLayer(e))),n=s.length?this.queryRenderedFeatures(o.point,{layers:s}):[];n.length?r||(r=!0,i.call(this,new qa(e,this,o.originalEvent,{features:n}))):r=!1;},s=()=>{r=!1;};return {layers:new Set(t),listener:i,delegates:{mousemove:o,mouseout:s}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const o=o=>{const s=t.filter((e=>this.getLayer(e)));(s.length?this.queryRenderedFeatures(o.point,{layers:s}):[]).length?r=!0:r&&(r=!1,i.call(this,new qa(e,this,o.originalEvent)));},s=t=>{r&&(r=!1,i.call(this,new qa(e,this,t.originalEvent)));};return {layers:new Set(t),listener:i,delegates:{mousemove:o,mouseout:s}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),o=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];o.length&&(e.features=o,i.call(this,e),delete e.features);};return {layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const r=(e,t)=>{if(e.size!==t.size)return !1;for(const i of e)if(!t.has(i))return !1;return !0},o=this._delegatedListeners?this._delegatedListeners[e]:void 0;return o&&(e=>{for(let o=0;o<e.length;o++){const s=e[o];if(s.listener===i&&r(s.layers,t)){for(const e in s.delegates)this.off(e,s.delegates[e]);return e.splice(o,1),this}}})(o),this}queryRenderedFeatures(t,i){if(!this.style)return [];let r;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0])r=[e.pointGeometry3d.convert(t)];else {const i=e.pointGeometry3d.convert(t[0]),o=e.pointGeometry3d.convert(t[1]);r=[i,new e.pointGeometry3d(o.x,i.y),o,new e.pointGeometry3d(i.x,o.y),i];}return this.style.queryRenderedFeatures(r,i,this.transform)}queryPixelColor(t,i){if(!this.painter)return [];let r;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0])t=e.pointGeometry3d.convert(t),r=[new e.pointGeometry3d(t.x,t.y,0)];else {const i=e.pointGeometry3d.convert(t[0]),o=e.pointGeometry3d.convert(t[1]);r=[i,new e.pointGeometry3d(o.x,i.y),o,new e.pointGeometry3d(i.x,o.y),i];}return this.painter.queryPixelColor(r,i)}querySpherePosition(e,t){return this.queryDEMSourceHeightByPoint(e,t)}queryDEMSourceHeightByPoint(t,i){if(!i)return [];let r;r=t.point instanceof e.pointGeometry3d?t.point:e.pointGeometry3d.convert(t.point);const o=this.style.querySpherePosition({point:r},i);return this.triggerRepaint(),o}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(t,i){return i=e.extend({},{localIdeographFontFamily:tc.localIdeographFontFamily},i),this.projection===e.ProjectionType.LATLON&&(i.projection=e.ProjectionType.LATLON),this.style&&(this.style.fristClassificationTypeId=void 0),(i.keepUserInfo||i.diff)&&this.style&&t?(this._diffStyle(t,i),this):this._updateStyle(t,i)}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new Gs(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty());}_diffStyle(t,i){if("string"==typeof t){const r=l(t),o=this._transformRequest(r,e.ResourceType.Style);e.getJSON(o,((t,r)=>{t?this.fire(new e.ErrorEvent(t)):r&&this._updateDiff(r,i);}));}else "object"==typeof t&&this._updateDiff(t,i);}_updateDiff(t,i){try{this.style.setState(t,i.keepUserInfo)&&(this._update(!0),this.fire(new e.Event("style.load")));}catch(r){e.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,i);}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0),this}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)));}clipGround(e){this.clipGroundState=!0,e.addTo(this,!0);}removeClipGround(e){this.clipGroundState=!1,e.removeFrom(this);}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e)if(!e[t].loaded())return !1;return !0}addSourceType(e,t,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._update(!0),this}getSource(e){if(this.style)return this.style.getSource(e)}addImage(t,i,{pixelRatio:r=1,sdf:o=!1,stretchX:s,stretchY:n,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof ic||oc&&i instanceof oc){const{width:l,height:c,data:h}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},h),pixelRatio:r,stretchX:s,stretchY:n,content:a,sdf:o,version:0});}else {if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:h}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(h)),pixelRatio:r,stretchX:s,stretchY:n,content:a,sdf:o,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t);}}}updateImage(t,i){const r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=i instanceof ic||oc&&i instanceof oc?e.exported.getImageData(i):i,{width:s,height:n,data:a}=o;return void 0===s||void 0===n?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):s!==r.data.width||n!==r.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(a,!(i instanceof ic||oc&&i instanceof oc)),void this.style.updateImage(t,r))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e);}loadImage(t,i){e.getImage(this._transformRequest(t,e.ResourceType.Image),i);}loadImages(e,t){const i={};e.forEach((r=>{this.loadImage(r,((o,s)=>{o?t(o):(i[r]=s,Object.keys(i).length===e.length&&t(null,i));}));}));}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0),this}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0),this}removeLayer(e){return this.style.removeLayer(e),this._update(!0),this}getLayer(e){return this.style.getLayer(e)}setFilter(e,t){return this.style.setFilter(e,t),this._update(!0),this}setSourceFilter(e,t){return this.style.setSourceFilter(e,t),this._update(!0),this}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0),this}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i){return this.style.setPaintProperty(e,t,i),this._update(!0),this}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i){return this.style.setLayoutProperty(e,t,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setSunLight(e){this.sunLight.setSunLightPos(e),this._update(!0);}setShadowCenterLngLat(e,t){this.directionLightParameter.setShadowCenterLngLat(e,t);}setShadowLayer(e){this.directionLightParameter.mCurShadowLayer=e;}setShadowCenterMode(e){this.directionLightParameter.mShadowCenterMode=e;}getSunDuration(e,t){return this.sunLight.getSunDuration(e,t)}setViewshedVisibleColor(t){if(!t)return;let i;if(t instanceof Array)i=[t[0],t[1],t[2]];else {const r=e.Color.parse(t);i=[r.r,r.g,r.b];}this.directionLightParameter.setViewshedVisibleColor(i);}setViewshedInVisibleColor(t){if(!t)return;let i;if(t instanceof Array)i=t;else {const r=e.Color.parse(t);i=[r.r,r.g,r.b];}this.directionLightParameter.setViewshedInVisibleColor(i);}enableSunLightFixed(){this.sunLight.setSunLightFixedMode(e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.FIXED);}disableSunLightFixed(){this.sunLight.setSunLightFixedMode(e.CONSTS.CAMERA.SUNLIGHT_FIXED_MODE.DYNAMIC);}enableSunLight(){this.style.enableSunLight(),this._update(!0);}disableSunLight(){this.style.disableSunLight(),this._update(!0);}enableShadow(){this.openCameraView(e.CONSTS.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!0,this._update(!0);}disableShadow(){this.closeCameraView(e.CONSTS.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!1,this._update(!0),this.directionLightParameter.mCurShadowLayer=null;}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let r,o=this._container;for(;o&&!r;){const t=e.window.getComputedStyle(o).transform;t&&"none"!==t&&(r=t.match(/matrix.*\((.+)\)/)[1].split(", ")),o=o.parentElement;}r?(this._containerWidth=r[0]&&"0"!==r[0]?Math.abs(t/r[0]):t,this._containerHeight=r[3]&&"0"!==r[3]?Math.abs(i/r[3]):i):(this._containerWidth=t,this._containerHeight=i);}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for minemap.js, which may cause the map to display incorrectly. Please ensure your page includes minemap.css");}_setupContainer(){const t=this._container;t.classList.add("minemap-map"),(this._missingCSSCanary=e.DOM.create("div","minemap-canary",t)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=e.DOM.create("div","minemap-canvas-container",t);this._interactive&&i.classList.add("minemap-interactive"),this._canvas=e.DOM.create("canvas","minemap-canvas",i),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=e.DOM.create("div","minemap-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{o[t]=e.DOM.create("div",`minemap-ctrl-${t}`,r);})),this._container.addEventListener("scroll",this._onMapScroll,!1);}_resizeCanvas(t,i){const r=e.window.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`;}_setupPainter(){const i=e.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},t.webGLContextAttributes),r=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);r?this.painter=new Ua(r,this.transform,this,this.timer):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}));}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}));}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return !this._styleDirty&&!(!this.style||!this.style.loaded())}_update(e,t,i){this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this._noServericeRequest=!0===t,this._forceServericeRequest=!0===i,this.triggerRepaint());}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e);}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e);}_render(t){if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;let i=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=e.exported.now();this.style.zoomHistory.update(t,r);const o=new e.EvaluationParameters(t,{now:r,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=o.crossFadingFactor();1===s&&s===this._crossFadingFactor||(i=!0,this._crossFadingFactor=s),this.style.update(o);}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform,this._noServericeRequest,this._forceServericeRequest)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.Event("idle")),this}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style?.sttc?.removeAllTerrainTile(),this.style?.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),nc(this._canvasContainer),nc(this._controlContainer),nc(this._missingCSSCanary),this._container.classList.remove("minemap-map"),this._removed=!0,this.fire(new e.Event("remove")),this.removeOverviewMap();}triggerRepaint(){this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{this._frame=null,this._render(e),this.timer.update();})));}getAllLayers(){return this.style._layers||{}}getAllSources(){const e=this.style.sourceCaches,t={};if(!(Object.keys(e).length>0))throw new Error("No data source");for(const i in e)e.hasOwnProperty(i)&&(t[i]=this.getSource(i));return t}getAllPopups(){return this.__popupList}_rerender(){this.style&&!this._frame&&(this._frame=e.exported.frame((()=>{this._frame=null,this._render(),this.timer.update();})));}_onWindowOnline(){this._update();}_onWindowResize(){this._trackResize&&this.resize()._update();}get showTileBoundaries(){return !!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update());}get showCollisionBoxes(){return !!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update());}get showOverdrawInspector(){return !!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update());}get repaint(){return !!this._repaint}set repaint(e){this._repaint=e,this.timer.state=!!e,this._update();}set fxaaRender(e){this._fxaaRender=e;}get fxaaRender(){return this._fxaaRender}set bloomRender(e){this._bloomRender=e;}get bloomRender(){return this._bloomRender}get projection(){return this.mapControl._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this.mapControl._projection=t);}get vertices(){return !!this._vertices}set vertices(e){this._vertices=e,this._update();}get panoramaMode(){return this._panoramaMode}set panoramaMode(e){this._panoramaMode=e,this.transform.panoramaMode=e,this.triggerRepaint();}get fPMode(){return this.transform.fPMode}set fPMode(e){this.transform.fPMode=e;}set cameraHeightOffset(e){this.transform.cameraHeightOffset=e;}get cameraHeightOffset(){return this.transform.cameraHeightOffset}setBloomOptions(e){e&&(this._bloomOptions=e);}_onData(t){"cesium-tile"===t.dataType?(this._sourcesDirty=!1,this.triggerRepaint()):"gltf-data-loaded"===t.dataType?this._update(!1,!0):(this._update("style"===t.dataType,!1),this.fire(new e.Event(`${t.dataType}data`,t)));}_onDataLoading(t){this.fire(new e.Event(`${t.dataType}dataloading`,t));}setDemMaxTiles(e){}addCameraView(e,t){return this.td_cameraManager.addCameraView(e,t)}deleteCameraView(e){return this.td_cameraManager.deleteCameraView(e)}openCameraView(e){return this.td_cameraManager.openCameraView(e)}closeCameraView(e){return this.td_cameraManager.closeCameraView(e)}getCameraView(e){return this.td_cameraManager.getCameraView(e)}getAllActiveCameraViews(){return this.td_cameraManager.getAllActiveCameraViews()}modifyCameraViewGroup(e){this.td_cameraManager.modifyCameraViewGroup(e);}modifyCameraViewById(e,t){this.td_cameraManager.modifyCameraViewById(e,t);}getTranslatedLngLatPoint(t,i){return e.getTranslatedLngLatPoint(t,i)}getCameraViewOptionFromStartEnd(t,i){const r=e.calcLocalCoords(i,t),o=r[0],s=r[1],n=r[2],a=Math.atan2(n,o)*(180/Math.PI),l=new e.Vector3(r).len();let c=Math.atan(s/Math.sqrt(o*o+n*n));return c=180*c/Math.PI,{distance:l,bearing:a,pitch:c}}getTDSpaceCoord(t){if(t.disableLayer){const i=this.unproject(t.point,0),r=i?e.transformECEFToGeographic([],i.toArray(),e.CONSTS.TRANSFORM.REAL_R):null;return {lngLat:i,geographic:r,altitude:0}}{const i=this.queryRenderedFeatures(t.point,{disableLayer:!1,modelHighlight:t.modelHighlight,highlightRange:t.highlightRange||e.CONSTS.HIGHLIGHT_TYPE.PRIMITIVE});if(0===i.length){const i=this.unproject(t.point,0),r=i?e.transformECEFToGeographic([],i.toArray(),e.CONSTS.TRANSFORM.REAL_R):null;return {lngLat:i,geographic:r,altitude:0}}{let r=null;for(let e=0;e<i.length;e++)i[e].hasOwnProperty("intersectionPoint")&&(r=i[e].intersectionPoint);if(r){const t=e.transformGeographicToECEF([],r);return {geographic:r,lngLat:new e.LngLat(t[0],t[1]),altitude:t[2]*e.CONSTS.TRANSFORM.R_ZOOM}}{const i=this.unproject(t.point,0),r=i?e.transformECEFToGeographic([],i.toArray(),e.CONSTS.TRANSFORM.REAL_R):null;return {lngLat:i,geographic:r,altitude:0}}}}}setTimerCount(e){this.timer.counter=e,this._stopTimerCount=!1,this.timer.resumeTimer();}pauseTimerCount(){this._stopTimerCount||this.timer.pauseTimer();}resumeTimerCount(){this._stopTimerCount||this.timer.resumeTimer();}stopTimerCount(){this._stopTimerCount=!0,this.timer.pauseTimer();}getCameraHeight(){return +(this.transform.alt*e.CONSTS.TRANSFORM.R_ZOOM).toFixed(2)}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}addFPSControl(){return this.fpsControl||(this.fpsControl=new Gl,this.addControl(this.fpsControl,"top-right")),this.fpsControl}removeFPSControl(){this.fpsControl&&(this.removeControl(this.fpsControl),this.fpsControl=null);}}function nc(e){e.parentNode&&e.parentNode.removeChild(e);}const ac={showCompass:!0,showZoom:!0};class lc{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new al({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new ll({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),e.DOM.addEventListener(i,"mousedown",this.mousedown),e.DOM.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),e.DOM.addEventListener(i,"touchmove",this.touchmove),e.DOM.addEventListener(i,"touchend",this.touchend),e.DOM.addEventListener(i,"touchcancel",this.reset);}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),e.DOM.disableDrag();}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&i.setBearing(i.getBearing()+r.bearingDelta),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t);r&&r.pitchDelta&&i.setPitch(i.getPitch()+r.pitchDelta);}}off(){const t=this.element;e.DOM.removeEventListener(t,"mousedown",this.mousedown),e.DOM.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),e.DOM.removeEventListener(t,"touchmove",this.touchmove),e.DOM.removeEventListener(t,"touchend",this.touchend),e.DOM.removeEventListener(t,"touchcancel",this.reset),this.offTemp();}offTemp(){e.DOM.enableDrag(),e.DOM.removeEventListener(e.window,"mousemove",this.mousemove),e.DOM.removeEventListener(e.window,"mouseup",this.mouseup);}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),e.DOM.mousePos(this.element,t)),e.DOM.addEventListener(e.window,"mousemove",this.mousemove),e.DOM.addEventListener(e.window,"mouseup",this.mouseup);}mousemove(t){this.move(t,e.DOM.mousePos(this.element,t));}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp();}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=e.DOM.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos));}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=e.DOM.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos));}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset();}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp();}}const cc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0};let hc;var uc="object"==typeof global&&global&&global.Object===Object&&global,dc="object"==typeof self&&self&&self.Object===Object&&self,_c=uc||dc||Function("return this")(),mc=_c.Symbol,fc=Object.prototype,pc=fc.hasOwnProperty,gc=fc.toString,vc=mc?mc.toStringTag:void 0,xc=Object.prototype.toString,yc=mc?mc.toStringTag:void 0,Tc=/\s/,Sc=/^\s+/;function bc(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var wc=/^[-+]0x[0-9a-f]+$/i,Ec=/^0b[01]+$/i,Mc=/^0o[0-7]+$/i,Ac=parseInt;function Cc(e){if("number"==typeof e)return e;if(function(e){return "symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":yc&&yc in Object(e)?function(e){var t=pc.call(e,vc),i=e[vc];try{e[vc]=void 0;var r=!0;}catch(e){}var o=gc.call(e);return r&&(t?e[vc]=i:delete e[vc]),o}(e):function(e){return xc.call(e)}(e)}(e)}(e))return NaN;if(bc(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=bc(t)?t+"":t;}if("string"!=typeof e)return 0===e?e:+e;var i;e=(i=e)?i.slice(0,function(e){for(var t=e.length;t--&&Tc.test(e.charAt(t)););return t}(i)+1).replace(Sc,""):i;var r=Ec.test(e);return r||Mc.test(e)?Ac(e.slice(2),r?2:8):wc.test(e)?NaN:+e}var Rc=function(){return _c.Date.now()},Lc=Math.max,Pc=Math.min;const Ic={maxWidth:100,unit:"metric"};function Oc(t,i,r,o){const s=o&&o.maxWidth||100,n=t._container.getBoundingClientRect().height/2,a=t._container.getBoundingClientRect().width/2,l=function(t,i){const r=e.CONSTS.TRANSFORM.R,o=Math.PI/180,s=t.lat*o,n=i.lat*o,a=Math.sin(s)*Math.sin(n)+Math.cos(s)*Math.cos(n)*Math.cos((i.lng-t.lng)*o);return r*Math.acos(Math.min(a,1))}(t.unproject([a,n]),t.unproject([a+1,n]))*s;if(o&&"imperial"===o.unit){const e=3.2808*l;e>5280?Dc(i,r,s,e/5280,t._getUIString("ScaleControl.Miles"),t):Dc(i,r,s,e,t._getUIString("ScaleControl.Feet"),t);}else o&&"nautical"===o.unit?Dc(i,r,s,l/1852,t._getUIString("ScaleControl.NauticalMiles"),t):l>=1e3?Dc(i,r,s,l/1e3,t._getUIString("ScaleControl.Kilometers"),t):Dc(i,r,s,l,t._getUIString("ScaleControl.Meters"),t);}function Dc(e,t,i,r,o,s){const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,t*i}(r),a=n/r;s._requestDomTask((()=>{e.style.width=i*a+"px",e.innerHTML=`${n}&nbsp;${o}`;})),t.innerHTML=n+o;}const Nc=(t,i,r)=>{const o=t.createShader(i);if(null==o)throw new Error("unable to create shader");if(t.shaderSource(o,r),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(o);return e.warnOnce(`Failed to compile shader: ${i}`),t.deleteShader(o),null}return o};class Fc{constructor(t,i,r,o){this._gl=t,this._options=i,this._canvas=r,this.map=o,this.lastX=-1,this.lastY=-1,this.lastMouseLnglat=[-1,-1],this.dragging=!1,this.curLnglat=[i.center[0],-i.center[1]],this.bufferArray=[],this.initViewVec(),this.mvpMatrix=new e.Matrix4,this.projMatrix=new e.Matrix4,this.projMatrix.perspective({fov:1,aspect:this._canvas.width/this._canvas.height,near:.01,far:10}),this.viewMatrix=new e.Matrix4,this.modelMatrix=new e.Matrix4,this.init(t),this.rotateGlobal();}initViewVec(){this.viewEye=[0,0,5],this.viewAt=[0,0,0],this.viewUp=[0,1,0];}initVertexBuffers(e){const t=50,i=[],r=[],o=[];for(let e=0;e<=t;e++){const r=e*Math.PI/t,s=Math.sin(r),n=Math.cos(r);for(let r=0;r<=t;r++){const a=2*r*Math.PI/t,l=Math.sin(a),c=Math.cos(a)*s,h=n,u=l*s,d=1-e/t;o.push(1-r/t-.25),o.push(d),i.push(2.3*c),i.push(2.3*h),i.push(2.3*u);}}for(let e=0;e<t;e++)for(let i=0;i<t;i++){const o=51*e+i,s=o+t+1;r.push(o),r.push(s),r.push(o+1),r.push(s),r.push(s+1),r.push(o+1);}if(!this.initArrayBuffer(e,"a_Position",new Float32Array(i),e.FLOAT,3))return -1;if(!this.initArrayBuffer(e,"a_TexCoord",new Float32Array(o),e.FLOAT,2))return -1;const s=e.createBuffer();return this.bufferArray.push(s),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),e.STATIC_DRAW),r.length}initArrayBuffer(e,t,i,r,o){const s=e.createBuffer();this.bufferArray.push(s),e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);const n=e.getAttribLocation(e.program,t);return e.vertexAttribPointer(n,o,r,!1,0,0),e.enableVertexAttribArray(n),!0}initTextures(t,i,r){this.texture=t.createTexture();const o=t.getUniformLocation(t.program,"u_Sampler");return e.getImage({url:i},((e,i)=>{if(e)throw new ErrorEvent(e);if(i){this.loadTexture(t,i,this.texture,o),this.initEventHandlers();const e=t.getUniformLocation(t.program,"u_MvpMatrix"),s=()=>{this.draw(t,r,e),requestAnimationFrame(s);};s();}})),!0}loadTexture(e,t,i,r){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,t),e.uniform1i(r,0);}draw(e,t,i){this.mvpMatrix=this.projMatrix.clone(),this.mvpMatrix.multiplyRight(this.viewMatrix),this.mvpMatrix.multiplyRight(this.modelMatrix),e.uniformMatrix4fv(i,!1,this.mvpMatrix.toFloat32Array()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawElements(e.TRIANGLES,t,e.UNSIGNED_SHORT,0);}init(e){((e,t,i)=>{const r=((e,t,i)=>{const r=Nc(e,e.VERTEX_SHADER,"#define GLSLIFY 1\nattribute vec4 a_Position;attribute vec2 a_TexCoord;varying vec2 v_TexCoord;uniform mat4 u_MvpMatrix;void main(){gl_Position=u_MvpMatrix*a_Position;v_TexCoord=a_TexCoord;}"),o=Nc(e,e.FRAGMENT_SHADER,"#ifdef GL_ES\nprecision mediump float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D u_Sampler;varying vec2 v_TexCoord;void main(){gl_FragColor=texture2D(u_Sampler,v_TexCoord);}");if(!r||!o)return null;const s=e.createProgram();if(!s)return null;if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){const t=e.getProgramInfoLog(s);return console.warn(`Failed to link program: ${t}`),e.deleteProgram(s),e.deleteShader(o),e.deleteShader(r),null}return s})(e);r?(e.useProgram(r),e.program=r):console.warn("Failed to create program");})(e);const t=this.initVertexBuffers(e);e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),this.initTextures(e,this._options.url,t);}initEventHandlers(){e.DOM.addEventListener(this._canvas,"mousedown",this._onDraggingStart.bind(this)),e.DOM.addEventListener(this._canvas,"touchstart",this._onDraggingStart.bind(this)),e.DOM.addEventListener(this._canvas,"mousemove",this._onDraggingMove.bind(this)),e.DOM.addEventListener(this._canvas,"touchmove",this._onDraggingMove.bind(this)),e.DOM.addEventListener(this._canvas,"mouseup",this._onDraggingEnd.bind(this)),e.DOM.addEventListener(this._canvas,"mouseout",this._onDraggingEnd.bind(this)),e.DOM.addEventListener(this._canvas,"touchend",this._onDraggingEnd.bind(this)),this._options.clickCallback&&e.DOM.addEventListener(this._canvas,"click",this._onClick.bind(this));}destroyEventHandlers(){e.DOM.removeEventListener(this._canvas,"mousedown",this._onDraggingStart),e.DOM.removeEventListener(this._canvas,"touchstart",this._onDraggingStart),e.DOM.removeEventListener(this._canvas,"mousemove",this._onDraggingMove),e.DOM.removeEventListener(this._canvas,"touchmove",this._onDraggingMove),e.DOM.removeEventListener(this._canvas,"mouseup",this._onDraggingEnd),e.DOM.removeEventListener(this._canvas,"mouseout",this._onDraggingEnd),e.DOM.removeEventListener(this._canvas,"touchend",this._onDraggingEnd),this._options.clickCallback&&e.DOM.removeEventListener(this._canvas,"click",this._onClick);}mouse2Lnglat(t,i){const r=this.calculateWebGLLngLat(t,i),o=e.limitLnglatScope([r[0]-90,r[1]]);return [-o[0],o[1]]}_onClick(e){if(this.isMoveEvt)return;let t,i;const r=e.target.getBoundingClientRect();e.changedTouches&&e.changedTouches.length?(t=e.changedTouches[0].clientX-r.left-e.target.clientLeft,i=e.changedTouches[0].clientY-r.top-e.target.clientTop):(t=e.layerX,i=e.layerY),e.lnglat=this.mouse2Lnglat(t,i),this._options.clickCallback(e);}_onDraggingEnd(e){let t,i;e.changedTouches&&e.changedTouches.length?(t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY):(t=e.clientX,i=e.clientY),this.isMoveEvt=!0,this.moveDownXY&&t===this.moveDownXY.x&&i===this.moveDownXY.y&&(this.isMoveEvt=!1,this._onClick(e)),this.dragging=!1,this._canvas.style.cursor="pointer";}_onDraggingStart(e){let t,i;e.preventDefault(),e.touches&&e.touches.length?(t=e.touches[0].clientX,i=e.touches[0].clientY):(t=e.clientX,i=e.clientY),this.moveDownXY={x:t,y:i},this.isMoveEvt=!1,this._canvas.style.cursor="grabbing";const r=e.target.getBoundingClientRect();r.left<=t&&t<r.right&&r.top<=i&&i<r.bottom&&(e.touches&&e.touches.length?(this.lastX=e.touches[0].clientX-r.left-e.target.clientLeft,this.lastY=e.touches[0].clientY-r.top-e.target.clientTop):(this.lastX=e.layerX,this.lastY=e.layerY),this.dragging=!0);}_onDraggingMove(t){if(!this.dragging)return;let i,r;this.isMoveEvt=!0;const o=t.target.getBoundingClientRect();t.touches&&t.touches.length?(i=t.touches[0].clientX-o.left-t.target.clientLeft,r=t.touches[0].clientY-o.top-t.target.clientTop):(i=t.layerX,r=t.layerY);const s=this.calculateWebGLLngLat(i,r);this.lastMouseLnglat=this.calculateWebGLLngLat(this.lastX,this.lastY);const n=s[0]-this.lastMouseLnglat[0],a=s[1]-this.lastMouseLnglat[1];this.lastX=i,this.lastY=r,this.curLnglat=[this.curLnglat[0]+n,this.curLnglat[1]+a],this.curLnglat=e.limitLnglatScope(this.curLnglat),this.rotateGlobal(),this.map.setCenter([this.curLnglat[0],-this.curLnglat[1]]);}rotateGlobal(){const t=new e.Matrix4;t.rotateY(this.curLnglat[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateX(this.curLnglat[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD);const i=this._multiplyVector3(t,this.viewEye),r=this._multiplyVector3(t,this.viewAt),o=this._multiplyVector3(t,this.viewUp);this.viewMatrix.lookAt(i,r,[o[0]-i[0],o[1]-i[1],o[2]-i[2]]);}setCenter(e,t){this.curLnglat=[e[0],-e[1]],this.lastMouseLnglat=t,this.rotateGlobal();}calculateWebGLLngLat(t,i){const{width:r,height:o}=this._canvas,s=new e.Vector4([0,0,0,1]),n=this.viewMatrix.clone().invert();s.transform(n);const a=[s[0]/s[3],s[1]/s[3],s[2]/s[3]],l=bs({canvasX:t,canvasY:i,transform:{width:r,height:o,td_projectionInverseMatrix:new e.Matrix4,td_viewInverseMatrix:n,td_camPosNormalized:a,getCameraPos:()=>a,type:"smallGlobal",Zup:!1}});if(l.lngLat)return this.toArray(l.lngLat);throw new Error("The longitude and latitude calculation is null!")}toArray(e){return [e.lng,e.lat]}_multiplyVector3(t,i){const r=new e.Vector3(i);return r[0]=i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+t[11],r[1]=i[0]*t[1]+i[1]*t[5]+i[2]*t[9]+t[12],r[2]=i[0]*t[2]+i[1]*t[6]+i[2]*t[10]+t[13],r.toArray()}destroyGL(){if(this.texture&&this._gl.deleteTexture(this.texture),this.bufferArray.length)for(let e=0;e<this.bufferArray.length;e++){const t=this.bufferArray[e];this.bufferArray.splice(e,1),this._gl.deleteBuffer(t),e--;}}destroyed(){this.destroyEventHandlers(),this.destroyGL();}}const Bc={width:100,height:100},Uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");class Gc{constructor(e){this.pos=e.pos,this.up=e.up,this.forward=e.forward;}equals(e){for(let t=0;t<3;t++)if(this.pos[t]!==e.pos[t]||this.up[t]!==e.up[t]||this.forward[t]!==e.forward[t])return !1;return !0}equalsAndSet(e){return !!this.equals(e)||(this.pos=e.pos.slice(0),this.up=e.up.slice(0),this.forward=e.forward.slice(0),!1)}}class Vc{constructor(e,t,i,r,o){this.videosMap=e,this.videoMap=t,this.init(),this.frustum=new ms,this.map=i,this.flvjs=r,this._vcm=o,this.cameraStore=new Gc({up:[0,0,0,0],forward:[0,0,0,0],pos:[0,0,0,0]});}init(){const e=this.videosMap.values().next().value;this.url=e.controlUrl,this.convertSphereGeo(),this.calculateVideosBbox();}stopVideo(e){}startVideo(e){}listen(e,t,i){this.player.pause(),this.player.unload(),this.player.load(),this.player.play();}update(e=!1){if(this.cameraStore.equalsAndSet({up:this.map.transform.camera_upwardPos,pos:this.map.transform.camera_currentPos,forward:this.map.transform.camera_forwardPos})&&!e)return;const t=[],i=[],r=[],o=[],s=this.map.painter.transform.calculateVPMatrix();this.frustum.updateFrustumPlanes(s);const n=this.videosMap.values().next().value;for(const s of n.videos){if(void 0===s.box)continue;const n=this.frustum.intersectsBox(s.box);(n!==s.videoParams.scheduleOptions.isVisable||e)&&(s.videoParams.scheduleOptions.isVisable=n,n?(t.push(s.clipOptions.userKey),i.length<1&&i.push(s.clipOptions.sceneId),this.process(s)):(r.push(s.clipOptions.userKey),o.length<1&&o.push(s.clipOptions.sceneId),this.process(s)));}const a=[];a.push(t),a.push(i),a.push(r),a.push(o),this.sendMessage(a,this.callback);}process(e){e.videoParams.scheduleOptions.isVisable?(e.enabled=!0,e.videoPlayer&&(e.videoPlayer.unload(),e.videoPlayer.load(),e.videoPlayer.play())):(e.enabled=!1,e.videoPlayer&&(e.videoPlayer.pause(),e.videoPlayer.unload()));}sendMessage(t,i){let r="",o="",s="",n="";r=t[0].toString(),o=t[1].toString(),s=t[2].toString(),n=t[3].toString();const a={id:s,sceneId:n,isRun:1};""!=r&&e.getVideoControl({msg:{id:r,sceneId:o,isRun:0},url:this.url},this.getVideoControlCallback.bind(this)),""!=s&&e.getVideoControl({msg:a,url:this.url},this.getVideoControlCallback.bind(this));}getVideoControlCallback(e,t){if(e)throw new Error(e);if(0===t.data.isRun){const e=t.data.id.split(",");for(const t of e){const e=this.videoMap.get(t);e.videoPlayer.unload(),e.videoPlayer.load(),e.videoPlayer.play(),this._vcm.add(e);}this._vcm.isClip()&&this._vcm.clip();}else if(1===t.data.isRun){const e=t.data.id.split(",");for(const t of e)this._vcm.remove(t);}}convertSphereGeo(){this.videosMap.values().next().value.videos.forEach((t=>{const i=[];t.clipOptions&&t.clipOptions.polygonGeo&&t.clipOptions.polygonGeo.forEach((t=>{const r=[];e.transformECEFToGeographic(r,t,e.CONSTS.TRANSFORM.R),i.push(r);})),t.sphereGeo=i;}));}calculateVideosBbox(){const e=this.videosMap.values().next().value;for(const t of e.videos){let e;t.sphereGeo.length>0&&(e=this.calculateBbox(t.sphereGeo)),t.box=e;}}calculateBbox(e){const t={min:{x:e[0][0],y:e[0][1],z:e[0][2]},max:{x:e[0][0],y:e[0][1],z:e[0][2]}};for(const i of e)i[0]<t.min.x&&(t.min.x=i[0]),i[0]>t.max.x&&(t.max.x=i[0]),i[1]<t.min.y&&(t.min.y=i[1]),i[1]>t.max.y&&(t.max.y=i[1]),i[2]<t.min.z&&(t.min.z=i[2]),i[2]>t.max.z&&(t.max.z=i[2]);return t}cull(){}}class kc{constructor(t,i,r){r instanceof Array?this.constructorV1(t,i,r):(this.map=t,this._clipSource=void 0,this._clipSourceBackUp=void 0,this._clipSourceId="clipVideoSource",this._clipLayerId="clipVideoLayer",this._features=new kt,this.edit=i,this._currentClipId=void 0,this.clipFeatures=new Map,t.activeClipVideo=!1,this.videoSource=null,this._init(),t.clipTool=this,this.canvas2d=e.window.document.createElement("canvas"),this.videoOptions=new Map);}constructorV1(t,i,r){this.map=t,this.controlOptions={isAutoSchedule:r[0].isAutoSchedule,endDurtion:r[0].endDurtion,startDurtion:r[0].startDurtion},this._clipSource=void 0,this._clipSourceBackUp=void 0,this._clipSourceId="clipVideoSource",this._clipLayerId="clipVideoLayer",this._features=new kt,this.edit=i,this._currentClipId=void 0,this.clipFeatures=new Map,t.activeClipVideo=!1,this.videoSource=null,this._init(),t.clipTool=this,this.canvas2d=e.window.document.createElement("canvas"),this.videoOptions=new Map,this.videosMap=new Map,this.videoMap=new Map,this.videoCtl=null,this.flvjs=null,this.map.vcm=this,this.initVidoes(r);}setAutoSchedule(e){this.controlOptions.isAutoSchedule=e;}updateSchedule(e){this.videoCtl.update(e);}initVidoes(e){e.forEach((e=>{for(const t of e.videos)this.videoMap.set(t.clipOptions.userKey,t);this.videosMap.set(e.sourceId,e),this.flvjs=e.flvjs;})),this.videoCtl=new Vc(this.videosMap,this.videoMap,this.map,this.flvjs,this);}_init(){this._clipSource={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}}]},this._clipLineData={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[]]}}]},this._clipSourceBackUp={type:"FeatureCollection",features:[]},this.map.on("load",(()=>{this.map.addSource("clipVideoSource",{type:"geojson",data:this._clipSource,minzoom:1,maxzoom:23}),this.map.addLayer({id:"clipVideoLayer",type:"fill",maskType:!0,source:"clipVideoSource",layout:{visibility:"visible"},paint:{"fill-color":["get","color"],"fill-opacity":1},minzoom:1,maxzoom:19.5}),this._updateSourceColor();}));}_updateSourceColor(){this.videoSource=this.map.style._videoSource;const e=this.map.style._videoSource._videoMatchOptions,t=e.length;for(let i=0;i<t;++i)e.values[i].clipOptions.userKey&&(this.videoOptions[e.values[i].clipOptions.userKey]=e.values[i],e.values[i].color=[0,0,0]);}addClipID(e,t){if(this.clipFeatures.has(e))this.clipFeatures[e].push(t);else {this.clipFeatures.set(e,[]);const i=this._getColor(e);this.clipFeatures.get(e).push({featureID:t,color:i});}}removeClipID(e,t){}_generateFeature(e,t){const i={type:"Feature",geometry:{type:t,coordinates:[]}};return i.geometry.coordinates=e.geometry.coordinates.map((e=>e)),i}_updtateClipRegion(e){if(this.map.getSource("minemap-draw-cold")._data){const e=this.map.getSource("minemap-draw-cold")._data;this._clipSourceBackUp.features=[],this.__parseFeatures(e.features);}}get3DCoord(e){return this.map.getTDSpaceCoord({point:e,modelHighlight:!1})}getClipFeatures(){return this.edit.draw.getAll()}_updateFeaturesColor(e){if(e&&0!=e.length)for(let t=0;t<e.length;++t){const i=e[t],r=i.properties.userKey;i.properties.videoKey=this.videoOptions[r]?r:0;}}updateClipFeatures(e){this._updateFeaturesColor(e.features),this.edit.setFeatures(e);}clip(e){e||(e=this.edit.draw.getAll().features),0!=e.length&&this._parseFeatures(e);}cancelClip(){this.map.activeClipVideo=!1,this.map.setLayoutProperty("gl-draw-polygon-fill-inactive.cold","visibility","visible");}isClip(){return this.map.activeClipVideo}getAll(){return this.map.style._videoSource._videoMatchOptions}get(e){return this.map.style._videoSource.getVideoOptionByKey(e)}add(e){return this.videoSource=this.map.style._videoSource,e.color=[0,0,0],this.videoSource.addVideoOption(e.clipOptions.userKey,e)}remove(e){return this.videoSource=this.map.style._videoSource,this.videoSource.removeVideoOptionBykey(e)}update(e){}printPicture(e){const t=this.get(e)?this.get(e)[0]:null;if(!t||!t.videoPlayer)return !1;const i=t.videoPlayer.getVideo();i.setAttribute("crossOrigin","Anonymous");const r=this.canvas2d.getContext("2d"),o=i.videoHeight,s=i.videoWidth;return this.canvas2d.height=o,this.canvas2d.width=s,r.drawImage(i,0,0,s,o),this.canvas2d.toDataURL("image/jpeg")}positioning(e,t,i){const r=this.get(e);r[0].location=[r[0].location[0]+(i[0]-t[0]),r[0].location[1]+(i[1]-t[1])];}__parseFeatures(e){0==e.length?this.map.activeClipVideo=!1:(e.forEach((e=>{"Polygon"==e.geometry.type&&this._clipSourceBackUp.features.push(this._generateFeature(e));})),this.map.getSource(this._clipSourceId).setData(this._clipSourceBackUp),this.map.activeClipVideo=!0,this.map.setLayoutProperty("gl-draw-polygon-fill-inactive.cold","visibility","none"));}_parseFeatures(e){0==e.length?this.map.activeClipVideo=!1:(this._clipSource.features.length=0,this._clipLineData.features.length=0,e.forEach(((e,t)=>{if("Polygon"==e.geometry.type){e.properties.color=this._getColor(e.properties.videoKey),e.properties.id=e.id;const t=this.get(e.properties.videoKey);if(t.length>0)for(let i=0;i<t.length;i++)t[i].color=this._getColor(e.properties.videoKey,1);this._clipSource.features.push(e);}})),this.map.getSource(this._clipSourceId).setData(this._clipSource),this.map.activeClipVideo=!0,this.map.setLayoutProperty("gl-draw-polygon-fill-inactive.cold","visibility","none"),this.map.setLayoutProperty("gl-draw-polygon-stroke-inactive.cold","visibility","none"));}_getClipIdColor(e){let t;return this.map.getSource("clipVideoSource")._data.forEach((i=>{e.properties.id===i.properties.id&&(t=i.properties.color);})),t||(t=this._setHex(this._currentClipId)),t}removeAllRegion(){this._clipSource.features=[],this.map.getSource(this._clipSourceId).setData(this._clipSource);}editClipRegion(){this.map.setLayoutProperty("gl-draw-polygon-fill-inactive.cold","visibility","visible");}exportClipData(e,t){e&&0!=e.features.length&&kc.downloadFile(t=t||"clipRegion",e);}_setHex(e){const t=[];return e=Math.floor(e),t[0]=e>>16,t[1]=e>>8,t[2]=e,`rgb(${t[0]},${t[1]},${t[2]})`}_hexToRgb(e){const t=[];return 3===(e=e.substr(1)).length&&(e=e.replace(/(.)/g,"$1$1")),e.replace(/../g,(e=>{t.push(parseInt(e,16));})),`rgb(${t.join(",")})`}_rgbToHex(e){const t=e.toString().match(/\d+/g);let i="#";for(let e=0;e<3;e++)i+=`0${Number(t[e]).toString(16)}`.slice(-2);return i}_getColor(e,t=0){let i=255&e;i=Math.floor(255*(1-i/255));const r=[0,0,(i/255).toFixed(5)],o=this._rgbToHex(`rgb(0,0,${i})`);return 0==t?o:r}importClipData(t,i){e.getJSON(t,((e,t)=>{i(t);}));}}kc.downloadFile=function(t,i){const r=JSON.stringify(i),o=new Blob([r],{type:"application/octet-stream"}),s=`${t}.json`;if(e.window.navigator&&e.window.navigator.msSaveOrOpenBlob)e.window.navigator.msSaveOrOpenBlob(o,s);else {const t=document.createElement("a");t.href=e.window.URL.createObjectURL(o),t.download=s,t.click(),e.window.URL.revokeObjectURL(o);}};const Hc={getJSON:e.getJSON},Xc={ClassificationType:e.ClassificationType,vcm:kc,version:"3.4.0-beta.4",isSupported:t,workerCount:Math.max(Math.floor(e.exported.hardwareConcurrency/2),1),setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:sc,Navigation:class{constructor(t){this.options=e.extend({},ac,t),this._container=e.DOM.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in",(()=>this._map._getUIString("NavigationControl.ZoomIn")),(()=>this._map.zoomIn())),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out",(()=>this._map._getUIString("NavigationControl.ZoomOut")),(()=>this._map.zoomOut()))),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass",(()=>this._map._getUIString("NavigationControl.ResetBearing")),(()=>this._map.resetNorth())),this._compassIcon=e.DOM.create("span","minemap-ctrl-compass-arrow",this._compass));}_rotateCompassArrow(e){const t=this._map.panoramaMode?`rotate(${e.angle}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t);}));}onAdd(e){return this._map=e,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._map.on("panorama-change-bearing",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){e.DOM.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._map.off("panorama-change-bearing",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map;}_createButton(t,i,r){const o=e.DOM.create("button",t,this._container);return o.type="button",o.title=i,o.setAttribute("aria-label",i),o.addEventListener("click",r),o}},Geolocate:class extends e.Evented{constructor(t){super(),this.options=e.extend({},cc,t),e.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this);}onAdd(t){var i;return this._map=t,this._container=e.DOM.create("div","minemap-ctrl minemap-ctrl-group"),i=this._setupUI,void 0!==hc?i(hc):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{hc="denied"!==e.state,i(hc);})):(hc=!!e.window.navigator.geolocation,i(hc)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),e.DOM.remove(this._container),this._map=void 0;}_onSuccess(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish();}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._map.fitBounds(i.toBounds(t.coords.accuracy),this.options.fitBoundsOptions,{geolocateSource:!0});}_updateMarker(e){e?this._userLocationDotMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove();}_onError(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish();}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;}_setupUI(t){!1!==t?(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=e.DOM.create("button","minemap-ctrl-icon minemap-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label",this._map._getUIString("GeolocateControl.Geolocate")),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=e.DOM.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new Zl(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")));}))):e.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.");}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error");}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions));}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return !0}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);}},Attribution:Dl,Scale:class{constructor(t){this.options=e.extend({},Ic,t),e.bindAll(["_onMove","setUnit"],this);}getDefaultPosition(){return "bottom-left"}onAdd(t){this._map=t,this._container=e.DOM.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._content=e.DOM.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);const i=e.DOM.create("div","minemap-ctrl-scale-left-bar",this._container),r=e.DOM.create("div","minemap-ctrl-scale-right-bar",this._container),o=e.DOM.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(o),this._onMove=(s=e=>{Oc(this._map,this._container,this._content,this.options);},a=!0,l=!0,bc(n)&&(a="leading"in n?!!n.leading:a,l="trailing"in n?!!n.trailing:l),function(e,t,i){var r,o,s,n,a,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var i=r,s=o;return r=o=void 0,c=t,n=e.apply(s,i)}function m(e){return c=e,a=setTimeout(p,t),h?_(e):n}function f(e){var i=e-l;return void 0===l||i>=t||i<0||u&&e-c>=s}function p(){var e=Rc();if(f(e))return g(e);a=setTimeout(p,function(e){var i=t-(e-l);return u?Pc(i,s-(e-c)):i}(e));}function g(e){return a=void 0,d&&r?_(e):(r=o=void 0,n)}function v(){var e=Rc(),i=f(e);if(r=arguments,o=this,l=e,i){if(void 0===a)return m(l);if(u)return clearTimeout(a),a=setTimeout(p,t),_(l)}return void 0===a&&(a=setTimeout(p,t)),n}return t=Cc(t)||0,bc(i)&&(h=!!i.leading,s=(u="maxWait"in i)?Lc(Cc(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=l=o=a=void 0;},v.flush=function(){return void 0===a?n:g(Rc())},v}(s,200,{leading:a,maxWait:200,trailing:l})),this._map.on("move",this._onMove),this._onMove(),this._container;var s,n,a,l;}onRemove(){e.DOM.remove(this._container),this._map.off("move",this._onMove),this._map=void 0;}setUnit(e){this.options.unit=e,Oc(this._map,this._container,this._content,this.options);}},Fullscreen:class{constructor(){this._fullscreen=!1,e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl";}onAdd(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=e.DOM.create("div",`${this._className} minemap-ctrl-group`),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._container}onRemove(){e.DOM.remove(this._container),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon);}_checkFullscreenSupport(){return !!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=e.DOM.create("button",`${this._className}-icon ${this._className}-fullscreen`,this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon);}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e;}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(`${this._className}-shrink`),this._fullscreenButton.classList.toggle(`${this._className}-fullscreen`));}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen();}},Thumbnail:class{constructor(t){this.options=e.extend({},Bc,t),e.bindAll(["_onMove","_onMoveStart"],this);}getDefaultPosition(){return "bottom-right"}_onMove(e){const t=this._map.getCenter().toArray();let i=0,r=0;this.lastLnglat&&(i=t[0]-this.lastLnglat[0],r=t[1]-this.lastLnglat[1]),this.lastLnglat=t,this.drawThumnailControl.dragging||this.drawThumnailControl.setCenter([t[0]+i,t[1]+r],this.lastLnglat);}_onMoveStart(){const e=this._map.getCenter().toArray();this.lastLnglat=e;}_setupPainter(){const i=e.extend({failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1},t.webGLContextAttributes),r=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);r?this.drawThumnailControl=new Fc(r,this.options,this._canvas,this._map):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));}onAdd(t){this._map=t,this.options.center=t.getCenter().toArray(),this._container=e.DOM.create("div","minemap-ctrl minemap-ctrl-thumbnail",t.getContainer()),this._canvas=e.DOM.create("canvas","minemap-ctrl-thumbnail-canvas",this._container),this._container.appendChild(this._canvas);const{width:i,height:r}=this.options;return this._container.style=`width: ${i}px; height: ${r}px`,this._canvas.style.borderRadius="50%",this._canvas.width=i,this._canvas.height=r,this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","map-control"),this._canvas.style.outline="0px",this._canvas.style.cursor="pointer",this._setupPainter(),this._map.on("move",this._onMove),this._map.on("movestart",this._onMoveStart),this._container}onRemove(){this.drawThumnailControl.destroyed(),e.DOM.remove(this._container),this._map.off("move",this._onMove),this._map.off("movestart",this._onMoveStart),delete this._map;}getContainer(){return this}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(Uc),t),this._alt=0,e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[]);}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("minemap-track-pointer")):this._map.on("move",this._update),t.__popupList.push(this),this.fire(new e.Event("open")),this}isOpen(){return !!this._map}remove(){if(this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map){for(let e=0;e<this._map.__popupList.length;e++)this._map.__popupList[e]===this&&this._map.__popupList.splice(e,1);this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map;}return this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("minemap-track-pointer")),this}getAltitude(){return this._alt}setAltitude(e){return this._alt=e,this._pos=null,this._update(),this._trackPointer=!1,this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("minemap-popup-track-pointer"),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),r=e.window.document.createElement("body");let o;for(r.innerHTML=t;o=r.firstChild,o;)i.appendChild(o);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=e.DOM.create("div","minemap-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=e.DOM.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose));}_createContent(){this._content&&e.DOM.remove(this._content),this._content=e.DOM.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=e.DOM.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose));}_updateClassList(){const e=[...this._classList];e.push("minemap-popup"),this._anchor&&e.push(`minemap-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("minemap-popup-track-pointer"),this._container.className=e.join(" ");}_update(t){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=e.DOM.create("div","minemap-popup",this._map.getContainer()),this._tip=e.DOM.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),r=function(t){if(t||(t=new e.pointGeometry3d(0,0)),"number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));return {center:new e.pointGeometry3d(0,0),top:new e.pointGeometry3d(0,t),"top-left":new e.pointGeometry3d(i,i),"top-right":new e.pointGeometry3d(-i,i),bottom:new e.pointGeometry3d(0,-t),"bottom-left":new e.pointGeometry3d(i,-i),"bottom-right":new e.pointGeometry3d(-i,-i),left:new e.pointGeometry3d(t,0),right:new e.pointGeometry3d(-t,0)}}if(t instanceof e.pointGeometry3d||Array.isArray(t)){const i=e.pointGeometry3d.convert(t);return {center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return {center:e.pointGeometry3d.convert(t.center||[0,0]),top:e.pointGeometry3d.convert(t.top||[0,0]),"top-left":e.pointGeometry3d.convert(t["top-left"]||[0,0]),"top-right":e.pointGeometry3d.convert(t["top-right"]||[0,0]),bottom:e.pointGeometry3d.convert(t.bottom||[0,0]),"bottom-left":e.pointGeometry3d.convert(t["bottom-left"]||[0,0]),"bottom-right":e.pointGeometry3d.convert(t["bottom-right"]||[0,0]),left:e.pointGeometry3d.convert(t.left||[0,0]),right:e.pointGeometry3d.convert(t.right||[0,0])}}(this.options.offset),o=this._anchor=this._getAnchor(r),s=i.add(r[o]).round();this._map._requestDomTask((()=>{this._container&&o&&(this._container.style.transform=`${ql[o]} translate(${s.x}px,${s.y}px)`);})),this._updatePanoramaMode();}this._updateClassList();}}_updatePanoramaMode(){if(!this._trackPointer){const e=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._container.style.visibility=this._map.panoramaMode?e.w>0?"hidden":"visible":!this._map.transform.checkPositionForeground(this._lngLat)||e.w<0?"hidden":"visible";}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(zc);e&&e.focus();}_onClose(){this.remove();}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e);}getElement(){return this._container}getMap(){return this._map}_onMouseUp(e){this._update(e.point);}_onMouseMove(e){this._update(e.point);}_onDrag(e){this._update(e.point);}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._pos,i=this._container.offsetWidth,r=this._container.offsetHeight;let o;return o=t.y+e.bottom.y<r?["top"]:t.y>this._map.transform.height-r?["bottom"]:[],t.x<i/2?o.push("left"):t.x>this._map.transform.width-i/2&&o.push("right"),0===o.length?"bottom":o.join("-")}},Marker:Zl,DisplayBoard:jt,Style:Gs,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry3d,Evented:e.Evented,config:r,ProjectionType:e.ProjectionType,util:Hc,R:e.CONSTS.TRANSFORM.R,get accessToken(){return r.ACCESS_TOKEN},set accessToken(e){r.ACCESS_TOKEN=e;},get appKey(){return r.APP_KEY},set appKey(e){r.APP_KEY=e;},get key(){return r.KEY},set key(e){r.KEY=e;},get solution(){return r.SOLU},set solution(e){r.SOLU=e;},get dataVersion(){return r.DATA_VERSION},set dataVersion(e){r.DATA_VERSION=e;},get TRW(){return r.TRW},set TRW(e){r.TRW=e;},get spriteUrl(){return r.spriteUrl},set spriteUrl(e){r.spriteUrl=e;},get fontsUrl(){return r.fontsUrl},set fontsUrl(e){r.fontsUrl=e;},get serviceUrl(){return r.SERVICE_URL},set serviceUrl(e){r.SERVICE_URL=e;},get domainUrl(){return r.DOMAIN},set domainUrl(e){r.DOMAIN=e,r.SRC_URL=r.DOMAIN+r.SRC_BASE,r.SERVICE_URL=r.DOMAIN+r.SERVICE_BASE;},get dataDomainUrl(){return r.DATA_DOMAIN},set dataDomainUrl(e){r.DATA_DOMAIN=e,Array.isArray(e)?(r.API_URL=r.DATA_DOMAIN.map((e=>e+r.API_BASE)),r.DYN_URL=r.DATA_DOMAIN.map((e=>e+r.DYN_BASE)),r.MERGE_URL=r.DATA_DOMAIN.map((e=>e+r.MERGE_BASE)),r.OTHER_URL=r.DATA_DOMAIN.map((e=>e+r.OTHER_BASE))):(r.API_URL=r.DATA_DOMAIN+r.API_BASE,r.DYN_URL=r.DATA_DOMAIN+r.DYN_BASE,r.MERGE_URL=r.DATA_DOMAIN+r.MERGE_BASE,r.OTHER_URL=r.DATA_DOMAIN+r.OTHER_BASE);},get serverDomainUrl(){return r.SERVER_DOMAIN},set serverDomainUrl(e){r.SERVER_DOMAIN=e,r.SERVER_URL=Array.isArray(e)?r.SERVER_DOMAIN.map((e=>`${e}/service/`)):`${r.SERVER_DOMAIN}/service/`;},LAYER_LAYOUT_CONSTS:e.LAYER_LAYOUT_CONSTS,get maxParallelImageRequests(){return r.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){r.MAX_PARALLEL_IMAGE_REQUESTS=e;},prewarm:function(){Ni().acquire(Pi);},clearPrewarmedResources:function(){const e=Di;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Pi),Di=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"));},workerUrl:"",setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return Xc}));

//

var minemap$1 = minemap;

return minemap$1;

}));
